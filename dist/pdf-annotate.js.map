{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 04f8acd06b152d962753","webpack:///./index.js","webpack:///./src/PDFJSAnnotate.js","webpack:///./src/adapter/StoreAdapter.js","webpack:///./src/utils/abstractFunction.js","webpack:///./src/UI/event.js","webpack:///./~/events/events.js","webpack:///./src/UI/utils.js","webpack:///./~/create-stylesheet/index.js","webpack:///./src/adapter/LocalStoreAdapter.js","webpack:///./src/utils/uuid.js","webpack:///./src/render/index.js","webpack:///./src/render/appendChild.js","webpack:///./~/object-assign/index.js","webpack:///./src/render/renderLine.js","webpack:///./src/utils/setAttributes.js","webpack:///./src/utils/normalizeColor.js","webpack:///./src/render/renderPath.js","webpack:///./src/render/renderPoint.js","webpack:///./src/render/renderRect.js","webpack:///./src/render/renderText.js","webpack:///./src/a11y/renderScreenReaderHints.js","webpack:///./src/a11y/insertScreenReaderHint.js","webpack:///./src/a11y/createScreenReaderOnly.js","webpack:///./src/a11y/insertElementWithinChildren.js","webpack:///./src/a11y/insertElementWithinElement.js","webpack:///./src/a11y/renderScreenReaderComments.js","webpack:///./src/a11y/insertScreenReaderComment.js","webpack:///./src/a11y/initEventHandlers.js","webpack:///./src/UI/index.js","webpack:///./src/UI/edit.js","webpack:///./src/UI/pen.js","webpack:///./src/UI/point.js","webpack:///./src/UI/rect.js","webpack:///./src/UI/text.js","webpack:///./src/UI/page.js","webpack:///./shared/initColorPicker.js","webpack:///./shared/pdf_viewer.js"],"names":["PDFJS","require","initColorPicker","StoreAdapter","LocalStoreAdapter","__storeAdapter","getStoreAdapter","setStoreAdapter","adapter","UI","render","getAnnotations","documentId","pageNumber","arguments","definition","Object","keys","forEach","key","annotationId","annotation","content","commentId","__getAnnotations","fn","then","annotations","a","__addAnnotation","addAnnotation","__editAnnotation","editAnnotation","__deleteAnnotation","deleteAnnotation","success","__addComment","addComment","comment","__deleteComment","deleteComment","abstractFunction","name","Error","fireEvent","addEventListener","removeEventListener","emitter","clickNode","document","handleDocumentClick","e","clientX","clientY","target","emit","on","removeListener","findSVGContainer","findSVGAtPoint","findAnnotationAtPoint","pointIntersectsRect","getOffsetAnnotationRect","getAnnotationRect","scaleUp","scaleDown","getScroll","getOffset","disableUserSelect","enableUserSelect","getMetadata","BORDER_COLOR","userSelectStyleSheet","body","setAttribute","node","parentNode","nodeName","toUpperCase","getAttribute","x","y","elements","querySelectorAll","i","l","length","el","rect","getBoundingClientRect","svg","top","bottom","left","right","offsetLeft","offsetTop","h","w","LINE_OFFSET","toLowerCase","minX","maxX","minY","maxY","replace","split","splice","p","s","map","parseInt","height","width","result","includes","viewport","scale","scrollTop","scrollLeft","head","appendChild","removeChild","JSON","parse","Promise","resolve","reject","filter","page","class","getAnnotation","findAnnotation","uuid","push","updateAnnotations","index","getComments","localStorage","getItem","setItem","stringify","REGEXP","PATTERN","replacement","c","r","Math","random","v","toString","data","innerHTML","removeAttribute","Array","isArray","isFirefox","test","navigator","userAgent","getTranslation","rotation","transform","trans","path","querySelector","n","child","type","renderLine","group","createElementNS","stroke","color","strokeWidth","rectangles","line","x1","y1","x2","y2","setAttributes","UPPER_REGEX","BLACKLIST","keyCase","indexOf","match","attributes","normalizeColor","REGEX_HASHLESS_HEX","renderPath","d","lines","p1","p2","join","fill","renderPoint","SIZE","D","outerSVG","innerSVG","viewBox","renderRect","fillOpacity","createRect","renderText","text","size","fontSize","renderScreenReaderHints","SORT_TYPES","sortBy","sort","sortByPoint","b","sortByRectPoint","sortByLinePoint","lineA","lineB","insertScreenReaderHint","COMMENT_TYPES","num","rects","first","last","createScreenReaderOnly","createElement","createTextNode","style","position","overflow","insertElementWithinChildren","nodes","insertBefore","textLayer","textRect","insertElementWithinElement","OFFSET_ADJUST","max","textLayerElementFromPoint","temp","cloneNode","tail","unshift","pop","outerHTML","renderScreenReaderComments","comments","promise","getElementById","list","insertScreenReaderComment","item","initEventHandlers","reorderAnnotationsByType","removeAnnotation","insertComment","removeComment","removeElementById","elementId","disableEdit","enableEdit","setCanEdit","disablePen","enablePen","setPen","disablePoint","enablePoint","disableRect","enableRect","disableText","enableText","setText","createPage","renderPage","_enabled","_canEdit","isDragging","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","OVERLAY_BORDER_SIZE","createEditOverlay","overlayId","targetId","destroyEditOverlay","anchor","id","styleLeft","styleTop","boxSizing","border","borderRadius","background","padding","textAlign","textDecoration","handleDocumentKeyup","handleDocumentMousedown","borderColor","boxShadow","display","handleDocumentMousemove","handleDocumentMouseup","keyCode","cursor","offsetHeight","offsetWidth","getDelta","propX","propY","calcDelta","deltaX","$","deltaY","t","modelY","viewY","modelX","viewX","originX","originY","setTimeout","handleAnnotationClick","value","_penSize","_penColor","savePoint","point","penSize","penColor","input","handleInputBlur","handleInputKeyup","focus","closeInput","trim","assign","_type","getSelectionRects","selection","window","getSelection","range","getRangeAt","getClientRects","saveRect","removeAllRanges","boundingRect","offset","_textSize","_textColor","saveText","textSize","textColor","PAGE_TEMPLATE","children","canvas","mozOpaque","renderOptions","pdfDocument","rotate","all","getPage","pdfPage","canvasContext","getContext","alpha","getViewport","scalePage","getTextContent","normalizeWhitespace","textContent","textLayerFactory","DefaultTextLayerFactory","textLayerBuilder","createTextLayerBuilder","setTextContent","context","wrapper","outputScale","getOutputScale","scaled","sx","sy","sfx","approximateFraction","sfy","visibility","roundToDivide","floor","xinv","limit","x_","q","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","div","round","COLORS","hex","onChange","setColor","fireOnChange","currentValue","closePicker","togglePicker","isPickerOpen","openPicker","picker","createColorOption","margin","onclick","className","pdfViewerWrapper","CSS_UNITS","DEFAULT_SCALE_VALUE","DEFAULT_SCALE","UNKNOWN_SCALE","MAX_AUTO_SCALE","SCROLLBAR_PADDING","VERTICAL_PADDING","getFileName","url","query","end","min","substring","lastIndexOf","scrollIntoView","element","spot","skipOverflowHiddenElements","parent","offsetParent","console","error","checkOverflow","offsetY","clientTop","offsetX","clientLeft","clientHeight","scrollHeight","getComputedStyle","dataset","_scaleY","_scaleX","undefined","watchScroll","viewAreaElement","callback","debounceScroll","evt","rAF","requestAnimationFrame","viewAreaElementScrolled","currentY","lastY","state","down","_eventHandler","parseQueryString","parts","params","ii","param","decodeURIComponent","binarySearchFirstItem","items","condition","minIndex","maxIndex","currentIndex","currentItem","getVisibleElements","scrollEl","views","sortByVisibility","clientWidth","isElementBottomBelowViewTop","view","elementBottom","visible","currentHeight","viewHeight","hiddenHeight","percentHeight","currentWidth","viewWidth","firstVisibleElementInd","percent","pc","abs","noContextMenuHandler","preventDefault","getPDFFileNameFromURL","reURI","reFilename","splitURI","exec","suggestedFilename","ProgressBar","ProgressBarClosure","clamp","opts","bar","units","prototype","updateBar","ProgressBar_updateBar","_indeterminate","classList","add","remove","progressSize","_percent","val","isNaN","setWidth","ProgressBar_setWidth","viewer","container","scrollbarWidth","hide","ProgressBar_hide","show","ProgressBar_show","PDFLinkService","baseUrl","pdfViewer","pdfHistory","_pagesRefCache","setDocument","PDFLinkService_setDocument","create","setViewer","PDFLinkService_setViewer","setHistory","PDFLinkService_setHistory","pagesCount","numPages","currentPageNumber","navigateTo","PDFLinkService_navigateTo","dest","destString","self","goToDestination","destRef","gen","scrollPageIntoView","hash","getPageIndex","pageIndex","pageNum","cacheKey","destinationPromise","getDestination","destination","getDestinationHash","PDFLinkService_getDestinationHash","getAnchorUrl","escape","pdfOpenParams","destKind","currentScaleValue","scaleNumber","parseFloat","PDFLinkService_getAnchorUrl","setHash","PDFLinkService_setHash","updateNextHashParam","nameddest","zoomArgs","zoom","zoomArg","zoomArgNumber","event","createEvent","initCustomEvent","mode","pagemode","dispatchEvent","unescape","executeNamedAction","PDFLinkService_executeNamedAction","action","back","forward","cachePageRef","PDFLinkService_cachePageRef","pageRef","refStr","PresentationModeState","UNKNOWN","NORMAL","CHANGING","FULLSCREEN","IGNORE_CURRENT_POSITION_ON_ZOOM","DEFAULT_CACHE_SIZE","CLEANUP_TIMEOUT","RenderingStates","INITIAL","RUNNING","PAUSED","FINISHED","PDFRenderingQueue","PDFRenderingQueueClosure","pdfThumbnailViewer","onIdle","highestPriorityPage","idleTimeout","printing","isThumbnailViewEnabled","PDFRenderingQueue_setViewer","setThumbnailViewer","PDFRenderingQueue_setThumbnailViewer","isHighestPriority","PDFRenderingQueue_isHighestPriority","renderingId","renderHighestPriority","PDFRenderingQueue_renderHighestPriority","currentlyVisiblePages","clearTimeout","forceRendering","bind","getHighestPriority","PDFRenderingQueue_getHighestPriority","scrolledDown","visibleViews","numVisible","isViewFinished","nextPageIndex","previousPageIndex","PDFRenderingQueue_isViewFinished","renderingState","renderView","PDFRenderingQueue_renderView","resume","continueRendering","draw","TEXT_LAYER_RENDER_DELAY","PDFPageView","PDFPageViewClosure","options","defaultViewport","renderingQueue","annotationLayerFactory","pdfPageRotate","hasRestrictedScaling","onBeforeDraw","onAfterDraw","zoomLayer","annotationLayer","setPdfPage","PDFPageView_setPdfPage","totalRotation","stats","reset","destroy","PDFPageView_destroy","cleanup","PDFPageView_reset","keepZoomLayer","keepAnnotations","renderTask","cancel","childNodes","currentZoomLayerNode","currentAnnotationNode","loadingIconDiv","update","PDFPageView_update","clone","isScalingRestricted","maxCanvasPixels","pixelsInViewport","maxScale","sqrt","useOnlyCssZoom","cssTransform","firstChild","updatePosition","PDFPageView_updatePosition","PDFPageView_transform","redrawAnnotations","CustomStyle","relativeRotation","_viewport","absRotation","scaleX","scaleY","setProp","textLayerViewport","textRelativeRotation","textAbsRotation","textLayerDiv","transX","transY","getPagePoint","PDFPageView_getPagePoint","convertToPdfPoint","PDFPageView_draw","canvasWrapper","isCanvasHidden","actualSizeViewport","resolveRenderPromise","rejectRenderPromise","pageViewDrawCallback","zoomLayerCanvas","renderContinueCallback","cont","resumeCallback","renderContext","onContinue","pdfPageRenderCallback","textContentResolved","pdfPageRenderError","createAnnotationLayerBuilder","beforePrint","PDFPageView_beforePrint","PRINT_OUTPUT_SCALE","cssScale","printContainer","mozPrintCallback","obj","save","fillStyle","fillRect","restore","_transformMatrix","intent","done","abort","TextLayerBuilder","TextLayerBuilderClosure","renderingDone","divContentDone","pageIdx","matches","textDivs","findController","textLayerRenderTask","_bindMouse","_finishRendering","TextLayerBuilder_finishRendering","endOfContent","TextLayerBuilder_render","timeout","textLayerFrag","createDocumentFragment","renderTextLayer","updateMatches","reason","TextLayerBuilder_setTextContent","convertMatches","TextLayerBuilder_convertMatches","iIndex","bidiTexts","queryLen","ret","m","len","matchIdx","str","begin","divIdx","renderMatches","TextLayerBuilder_renderMatches","prevEnd","isSelectedPage","selected","selectedMatchIdx","highlightAll","infinity","beginText","appendTextToDiv","fromOffset","toOffset","span","i0","i1","isSelected","highlightSuffix","updateMatchPosition","n0","n1","TextLayerBuilder_updateMatches","clearedUntilDivIdx","active","pageMatches","TextLayerBuilder_bindMouse","adjustTop","divBounds","pageY","toFixed","AnnotationLayerBuilder","AnnotationLayerBuilderClosure","pageDiv","linkService","AnnotationLayerBuilder_render","parameters","dontFlip","AnnotationLayer","mozL10n","translate","AnnotationLayerBuilder_hide","DefaultAnnotationLayerFactory","SimpleLinkService","PDFViewer","PDFPageViewBuffer","cachePush","shift","resize","newSize","isSameScale","oldScale","newScale","firstElementChild","removePageBorders","defaultRenderingQueue","scroll","_scrollUpdate","updateInProgress","presentationModeState","_resetView","_pages","getPageView","_currentPageNumber","initUIEvent","previousPageNumber","currentScale","_currentScale","_currentScaleValue","_setScale","pagesRotation","_pagesRotation","pageView","resolvePagesPromise","pagesPromise","isOnePageRenderedResolved","resolveOnePageRendered","onePageRendered","bindOnAfterAndBeforeDraw","pdfViewLoadOnBeforeDraw","_buffer","pdfViewLoadOnAfterDraw","firstPagePromise","disableTextLayer","disableAutoFetch","getPagesLeft","ref","resolveFirstPage","_location","_pagesRequests","hasChildNodes","lastChild","PDFViewer_scrollUpdate","_setScaleDispatchEvent","pdfViewer_setScaleDispatchEvent","newValue","preset","presetValue","_setScaleUpdatePages","pdfViewer_setScaleUpdatePages","noScroll","isInPresentationMode","isChangingPresentationMode","pdfViewer_setScale","currentPage","hPadding","vPadding","pageWidthScale","pageHeightScale","isLandscape","horizontalScale","PDFViewer_scrollPageIntoView","widthScale","heightScale","changeOrientation","pageWidth","pageHeight","convertToViewportPoint","_updateLocation","firstPage","normalizedScaleValue","currentPageView","topLeft","intLeft","intTop","PDFViewer_update","_getVisiblePages","visiblePages","suggestedCacheSize","currentId","stillFullyVisible","location","containsElement","contains","isHorizontalScrollbarEnabled","scrollWidth","_ensurePdfPageLoaded","getPageTextContent","setFindController","SimpleLinkServiceClosure","PDFHistory","initialized","initialDestination","initialBookmark","initialize","pdfHistoryInitialize","fingerprint","reInitialized","allowHashChange","historyUnlocked","isViewerInPresentationMode","previousHash","currentBookmark","updatePreviousBookmark","previousBookmark","previousPage","nextHashParam","currentUid","uid","current","history","_isStateObjectDefined","_pushOrReplaceState","pdfHistoryPopstate","_goTo","previousParams","replacePreviousHistoryState","updateHistoryWithCurrentHash","slice","_pushToHistory","_updatePreviousBookmark","rewriteHistoryAfterBack","rewriteHistoryAfterForward","pdfHistoryBeforeUnload","_getPreviousParams","replacePrevious","pdfHistoryPageShow","detail","clearHistoryState","pdfHistory_clearHistoryState","pdfHistory_isStateObjectDefined","pdfHistory_pushOrReplaceState","stateObj","replaceState","pushState","isHashChangeUnlocked","pdfHistory_updatePreviousBookmark","updateCurrentBookmark","pdfHistoryUpdateCurrentBookmark","bookmark","pdfHistoryUpdateNextHashParam","pdfHistoryPush","isInitialBookmark","pdfHistory_getPreviousParams","onlyCheckPage","beforeUnload","_stateObj","pdfHistory_stateObj","pdfHistory_pushToHistory","addPrevious","overwrite","pdfHistory_goTo","currentHash","pdfHistoryBack","go","pdfHistoryForward","pdfHistoryGo","direction","call"],"mappings":"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;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,gBAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH,qBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;SCzRgB4C,gB,GAAAA,gB;SAqBAC,c,GAAAA,c;SAuBAC,qB,GAAAA,qB;SAwBAC,mB,GAAAA,mB;SAUAC,uB,GAAAA,uB;SAiBAC,iB,GAAAA,iB;SA8FAC,O,GAAAA,O;SAkBAC,S,GAAAA,S;SAiBAC,S,GAAAA,S;SAoBAC,S,GAAAA,S;SAkBAC,iB,GAAAA,iB;SAUAC,gB,GAAAA,gB;SAWAC,W,GAAAA,W;;AA/ShB;;;;;;AAEO,KAAMC,sCAAe,SAArB;;AAEP,KAAMC,uBAAuB,gCAAiB;AAC5CC,SAAM;AACJ,4BAAuB,MADnB;AAED,yBAAoB,MAFnB;AAGA,wBAAmB,MAHnB;AAII,oBAAe;AAJnB;AADsC,EAAjB,CAA7B;AAQAD,sBAAqBE,YAArB,CAAkC,+BAAlC,EAAmE,MAAnE;;AAEA;;;;;;AAMO,UAAShB,gBAAT,CAA0BiB,IAA1B,EAAgC;AACrC,OAAIC,aAAaD,IAAjB;;AAEA,UAAO,CAACC,aAAaA,WAAWA,UAAzB,KACCA,eAAe3B,QADvB,EACiC;AAC/B,SAAI2B,WAAWC,QAAX,CAAoBC,WAApB,OAAsC,KAAtC,IACAF,WAAWG,YAAX,CAAwB,6BAAxB,MAA2D,MAD/D,EACuE;AACrE,cAAOH,UAAP;AACD;AACF;;AAED,UAAO,IAAP;AACD;;AAED;;;;;;;AAOO,UAASjB,cAAT,CAAwBqB,CAAxB,EAA2BC,CAA3B,EAA8B;AACnC,OAAIC,WAAWjC,SAASkC,gBAAT,CAA0B,yCAA1B,CAAf;;AAEA,QAAK,IAAIC,IAAE,CAAN,EAASC,IAAEH,SAASI,MAAzB,EAAiCF,IAAEC,CAAnC,EAAsCD,GAAtC,EAA2C;AACzC,SAAIG,KAAKL,SAASE,CAAT,CAAT;AACA,SAAII,OAAOD,GAAGE,qBAAH,EAAX;;AAEA,SAAI5B,oBAAoBmB,CAApB,EAAuBC,CAAvB,EAA0BO,IAA1B,CAAJ,EAAqC;;AAEnC,cAAOD,EAAP;AACD;AACF;;AAED,UAAO,IAAP;AACD;;AAED;;;;;;;AAOO,UAAS3B,qBAAT,CAA+BoB,CAA/B,EAAkCC,CAAlC,EAAqC;AAC1C,OAAIS,MAAM/B,eAAeqB,CAAf,EAAkBC,CAAlB,CAAV;AACA,OAAI,CAACS,GAAL,EAAU;AAAE;AAAS;AACrB,OAAIR,WAAWQ,IAAIP,gBAAJ,CAAqB,0BAArB,CAAf;;AAEA;AACA,QAAK,IAAIC,IAAE,CAAN,EAASC,IAAEH,SAASI,MAAzB,EAAiCF,IAAEC,CAAnC,EAAsCD,GAAtC,EAA2C;AACzC,SAAIG,KAAKL,SAASE,CAAT,CAAT;AACA,SAAIvB,oBAAoBmB,CAApB,EAAuBC,CAAvB,EAA0BnB,wBAAwByB,EAAxB,CAA1B,CAAJ,EAA4D;AAC1D,cAAOA,EAAP;AACD;AACF;;AAED,UAAO,IAAP;AACD;;AAED;;;;;;;;AAQO,UAAS1B,mBAAT,CAA6BmB,CAA7B,EAAgCC,CAAhC,EAAmCO,IAAnC,EAAyC;AAC9C,UAAOP,KAAKO,KAAKG,GAAV,IAAiBV,KAAKO,KAAKI,MAA3B,IAAqCZ,KAAKQ,KAAKK,IAA/C,IAAuDb,KAAKQ,KAAKM,KAAxE;AACD;;AAED;;;;;;AAMO,UAAShC,uBAAT,CAAiCyB,EAAjC,EAAqC;AAC1C,OAAIC,OAAOzB,kBAAkBwB,EAAlB,CAAX;;AAD0C,oBAEVpB,UAAUoB,EAAV,CAFU;AAAA,OAEpCQ,UAFoC,cAEpCA,UAFoC;AAAA,OAExBC,SAFwB,cAExBA,SAFwB;;AAG1C,UAAO;AACLL,UAAKH,KAAKG,GAAL,GAAWK,SADX;AAELH,WAAML,KAAKK,IAAL,GAAYE,UAFb;AAGLD,YAAON,KAAKM,KAAL,GAAaC,UAHf;AAILH,aAAQJ,KAAKI,MAAL,GAAcI;AAJjB,IAAP;AAMD;;AAED;;;;;;AAMO,UAASjC,iBAAT,CAA2BwB,EAA3B,EAA+B;AACpC,OAAIU,IAAI,CAAR;AAAA,OAAWC,IAAI,CAAf;AAAA,OAAkBlB,IAAI,CAAtB;AAAA,OAAyBC,IAAI,CAA7B;AACA,OAAIO,OAAOD,GAAGE,qBAAH,EAAX;AACA;AACA,OAAMU,cAAc,EAApB;;AAEA,WAAQZ,GAAGV,QAAH,CAAYuB,WAAZ,EAAR;AACE,UAAK,MAAL;AACA,WAAIC,aAAJ;AAAA,WAAUC,aAAV;AAAA,WAAgBC,aAAhB;AAAA,WAAsBC,aAAtB;;AAEAjB,UAAGR,YAAH,CAAgB,GAAhB,EAAqB0B,OAArB,CAA6B,GAA7B,EAAkC,EAAlC,EAAsCC,KAAtC,CAA4C,GAA5C,EAAiDC,MAAjD,CAAwD,CAAxD,EAA2DzF,OAA3D,CAAmE,UAAC0F,CAAD,EAAO;AACxE,aAAIC,IAAID,EAAEF,KAAF,CAAQ,GAAR,EAAaI,GAAb,CAAiB;AAAA,kBAAKC,SAAS3B,CAAT,EAAY,EAAZ,CAAL;AAAA,UAAjB,CAAR;;AAEA,aAAI,OAAOiB,IAAP,KAAgB,WAAhB,IAA+BQ,EAAE,CAAF,IAAOR,IAA1C,EAAgD;AAAEA,kBAAOQ,EAAE,CAAF,CAAP;AAAc;AAChE,aAAI,OAAOP,IAAP,KAAgB,WAAhB,IAA+BO,EAAE,CAAF,IAAOP,IAA1C,EAAgD;AAAEA,kBAAOO,EAAE,CAAF,CAAP;AAAc;AAChE,aAAI,OAAON,IAAP,KAAgB,WAAhB,IAA+BM,EAAE,CAAF,IAAON,IAA1C,EAAgD;AAAEA,kBAAOM,EAAE,CAAF,CAAP;AAAc;AAChE,aAAI,OAAOL,IAAP,KAAgB,WAAhB,IAA+BK,EAAE,CAAF,IAAOL,IAA1C,EAAgD;AAAEA,kBAAOK,EAAE,CAAF,CAAP;AAAc;AACjE,QAPD;;AASAZ,WAAIO,OAAOD,IAAX;AACAL,WAAII,OAAOD,IAAX;AACArB,WAAIqB,IAAJ;AACApB,WAAIsB,IAAJ;AACA;;AAEA,UAAK,MAAL;AACAN,WAAIc,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,IAAsCgC,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,CAA1C;AACAmB,WAAIa,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,IAAsCgC,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,CAA1C;AACAC,WAAI+B,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,CAAJ;AACAE,WAAI8B,SAASxB,GAAGR,YAAH,CAAgB,IAAhB,CAAT,EAAgC,EAAhC,CAAJ;;AAEA,WAAIkB,MAAM,CAAV,EAAa;AACXA,cAAKE,WAAL;AACAlB,cAAMkB,cAAc,CAApB;AACD;AACD;;AAEA,UAAK,MAAL;AACAF,WAAIT,KAAKwB,MAAT;AACAd,WAAIV,KAAKyB,KAAT;AACAjC,WAAI+B,SAASxB,GAAGR,YAAH,CAAgB,GAAhB,CAAT,EAA+B,EAA/B,CAAJ;AACAE,WAAI8B,SAASxB,GAAGR,YAAH,CAAgB,GAAhB,CAAT,EAA+B,EAA/B,IAAqCkB,CAAzC;AACA;;AAEA,UAAK,GAAL;AAAA,yBACgC9B,UAAUoB,EAAV,CADhC;AAAA,WACMQ,UADN,eACMA,UADN;AAAA,WACkBC,SADlB,eACkBA,SADlB;;AAEAC,WAAIT,KAAKwB,MAAT;AACAd,WAAIV,KAAKyB,KAAT;AACAjC,WAAIQ,KAAKK,IAAL,GAAYE,UAAhB;AACAd,WAAIO,KAAKG,GAAL,GAAWK,SAAf;;AAEA,WAAIT,GAAGR,YAAH,CAAgB,wBAAhB,MAA8C,WAAlD,EAA+D;AAC7DkB,cAAKE,WAAL;AACAlB,cAAMkB,cAAc,CAApB;AACD;AACD;;AAEA,UAAK,MAAL;AACA,UAAK,KAAL;AACAF,WAAIc,SAASxB,GAAGR,YAAH,CAAgB,QAAhB,CAAT,EAAoC,EAApC,CAAJ;AACAmB,WAAIa,SAASxB,GAAGR,YAAH,CAAgB,OAAhB,CAAT,EAAmC,EAAnC,CAAJ;AACAC,WAAI+B,SAASxB,GAAGR,YAAH,CAAgB,GAAhB,CAAT,EAA+B,EAA/B,CAAJ;AACAE,WAAI8B,SAASxB,GAAGR,YAAH,CAAgB,GAAhB,CAAT,EAA+B,EAA/B,CAAJ;AACA;AAzDF;;AA4DA;AACA,OAAImC,SAAS;AACXvB,UAAKV,CADM;AAEXY,WAAMb,CAFK;AAGXiC,YAAOf,CAHI;AAIXc,aAAQf,CAJG;AAKXH,YAAOd,IAAIkB,CALA;AAMXN,aAAQX,IAAIgB;AAND,IAAb;;AASA;AACA;AACA;AACA;AACA,OAAI,CAAC,CAAC,KAAD,EAAQ,GAAR,EAAakB,QAAb,CAAsB5B,GAAGV,QAAH,CAAYuB,WAAZ,EAAtB,CAAL,EAAuD;AACrDc,cAASlD,QAAQL,eAAe6B,KAAKK,IAApB,EAA0BL,KAAKG,GAA/B,CAAR,EAA6CuB,MAA7C,CAAT;AACD;;AAED,UAAOA,MAAP;AACD;;AAED;;;;;;;AAOO,UAASlD,OAAT,CAAiB0B,GAAjB,EAAsBF,IAAtB,EAA4B;AACjC,OAAI0B,SAAS,EAAb;;AADiC,sBAEd5C,YAAYoB,GAAZ,CAFc;AAAA,OAE3B0B,QAF2B,gBAE3BA,QAF2B;;AAIjCpG,UAAOC,IAAP,CAAYuE,IAAZ,EAAkBtE,OAAlB,CAA0B,UAACC,GAAD,EAAS;AACjC+F,YAAO/F,GAAP,IAAcqE,KAAKrE,GAAL,IAAYiG,SAASC,KAAnC;AACD,IAFD;;AAIA,UAAOH,MAAP;AACD;;AAED;;;;;;;AAOO,UAASjD,SAAT,CAAmByB,GAAnB,EAAwBF,IAAxB,EAA8B;AACnC,OAAI0B,SAAS,EAAb;;AADmC,uBAEhB5C,YAAYoB,GAAZ,CAFgB;AAAA,OAE7B0B,QAF6B,iBAE7BA,QAF6B;;AAInCpG,UAAOC,IAAP,CAAYuE,IAAZ,EAAkBtE,OAAlB,CAA0B,UAACC,GAAD,EAAS;AACjC+F,YAAO/F,GAAP,IAAcqE,KAAKrE,GAAL,IAAYiG,SAASC,KAAnC;AACD,IAFD;;AAIA,UAAOH,MAAP;AACD;;AAED;;;;;;AAMO,UAAShD,SAAT,CAAmBqB,EAAnB,EAAuB;AAC5B,OAAI+B,YAAY,CAAhB;AACA,OAAIC,aAAa,CAAjB;AACA,OAAI3C,aAAaW,EAAjB;;AAEA,UAAO,CAACX,aAAaA,WAAWA,UAAzB,KACCA,eAAe3B,QADvB,EACiC;AAC/BqE,kBAAa1C,WAAW0C,SAAxB;AACAC,mBAAc3C,WAAW2C,UAAzB;AACD;;AAED,UAAO,EAAED,oBAAF,EAAaC,sBAAb,EAAP;AACD;;AAED;;;;;;AAMO,UAASpD,SAAT,CAAmBoB,EAAnB,EAAuB;AAC5B,OAAIX,aAAaW,EAAjB;;AAEA,UAAO,CAACX,aAAaA,WAAWA,UAAzB,KACCA,eAAe3B,QADvB,EACiC;AAC/B,SAAI2B,WAAWC,QAAX,CAAoBC,WAApB,OAAsC,KAA1C,EAAiD;AAC/C;AACD;AACF;;AAED,OAAIU,OAAOZ,WAAWa,qBAAX,EAAX;;AAEA,UAAO,EAAEM,YAAYP,KAAKK,IAAnB,EAAyBG,WAAWR,KAAKG,GAAzC,EAAP;AACD;;AAED;;;AAGO,UAASvB,iBAAT,GAA6B;AAClC,OAAI,CAACI,qBAAqBI,UAA1B,EAAsC;AACpC3B,cAASuE,IAAT,CAAcC,WAAd,CAA0BjD,oBAA1B;AACD;AACF;;AAGD;;;AAGO,UAASH,gBAAT,GAA4B;AACjC,OAAIG,qBAAqBI,UAAzB,EAAqC;AACnCJ,0BAAqBI,UAArB,CAAgC8C,WAAhC,CAA4ClD,oBAA5C;AACD;AACF;;AAED;;;;;AAKO,UAASF,WAAT,CAAqBoB,GAArB,EAA0B;AAC/B,UAAO;AACL9E,iBAAY8E,IAAIX,YAAJ,CAAiB,4BAAjB,CADP;AAELlE,iBAAYkG,SAASrB,IAAIX,YAAJ,CAAiB,wBAAjB,CAAT,EAAqD,EAArD,CAFP;AAGLqC,eAAUO,KAAKC,KAAL,CAAWlC,IAAIX,YAAJ,CAAiB,4BAAjB,CAAX;AAHL,IAAP;AAKD,E;;;;;;ACrTD;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA,wBAAuB,2CAA2C;AAClE;;AAEA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA,6CAA4C;AAC5C;;AAEA;AACA;AACA;AACA,IAAG;AACH;;;;;;;;;;;;;AClCA;;;;AACA;;;;;;;;;;;;AAEA;AACA;KACqB3E,iB;;;AACnB,gCAAc;AAAA;;AAAA,kIACN;AACJO,qBADI,0BACWC,UADX,EACuBC,UADvB,EACmC;AACrC,gBAAO,IAAIgH,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIpG,cAAchB,gBAAeC,UAAf,EAA2BoH,MAA3B,CAAkC,UAAC5C,CAAD,EAAO;AACzD,oBAAOA,EAAE6C,IAAF,KAAWpH,UAAX,IAAyBuE,EAAE8C,KAAF,KAAY,YAA5C;AACD,YAFiB,CAAlB;;AAIAJ,mBAAQ;AACNlH,mCADM;AAENC,mCAFM;AAGNc;AAHM,YAAR;AAKD,UAVM,CAAP;AAWD,QAbG;AAeJwG,oBAfI,yBAeUvH,UAfV,EAesBQ,YAftB,EAeoC;AACtC,gBAAOyG,QAAQC,OAAR,CAAgBnH,gBAAeC,UAAf,EAA2BwH,eAAexH,UAAf,EAA2BQ,YAA3B,CAA3B,CAAhB,CAAP;AACD,QAjBG;AAmBJU,oBAnBI,yBAmBUlB,UAnBV,EAmBsBC,UAnBtB,EAmBkCQ,UAnBlC,EAmB8C;AAChD,gBAAO,IAAIwG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC1G,sBAAW6G,KAAX,GAAmB,YAAnB;AACA7G,sBAAWgH,IAAX,GAAkB,qBAAlB;AACAhH,sBAAW4G,IAAX,GAAkBpH,UAAlB;;AAEA,eAAIc,cAAchB,gBAAeC,UAAf,CAAlB;AACAe,uBAAY2G,IAAZ,CAAiBjH,UAAjB;AACAkH,6BAAkB3H,UAAlB,EAA8Be,WAA9B;;AAEAmG,mBAAQzG,UAAR;AACD,UAVM,CAAP;AAWD,QA/BG;AAiCJW,qBAjCI,0BAiCWpB,UAjCX,EAiCuBQ,YAjCvB,EAiCqCC,UAjCrC,EAiCiD;AACnD,gBAAO,IAAIwG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIpG,cAAchB,gBAAeC,UAAf,CAAlB;AACAe,uBAAYyG,eAAexH,UAAf,EAA2BQ,YAA3B,CAAZ,IAAwDC,UAAxD;AACAkH,6BAAkB3H,UAAlB,EAA8Be,WAA9B;;AAEAmG,mBAAQzG,UAAR;AACD,UANM,CAAP;AAOD,QAzCG;AA2CJa,uBA3CI,4BA2CatB,UA3Cb,EA2CyBQ,YA3CzB,EA2CuC;AACzC,gBAAO,IAAIyG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIS,QAAQJ,eAAexH,UAAf,EAA2BQ,YAA3B,CAAZ;AACA,eAAIoH,QAAQ,CAAC,CAAb,EAAgB;AACd,iBAAI7G,cAAchB,gBAAeC,UAAf,CAAlB;AACAe,yBAAYgF,MAAZ,CAAmB6B,KAAnB,EAA0B,CAA1B;AACAD,+BAAkB3H,UAAlB,EAA8Be,WAA9B;AACD;;AAEDmG,mBAAQ,IAAR;AACD,UATM,CAAP;AAUD,QAtDG;AAwDJW,kBAxDI,uBAwDQ7H,UAxDR,EAwDoBQ,YAxDpB,EAwDkC;AACpC,gBAAO,IAAIyG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCD,mBAAQnH,gBAAeC,UAAf,EAA2BoH,MAA3B,CAAkC,UAAC5C,CAAD,EAAO;AAC/C,oBAAOA,EAAE8C,KAAF,KAAY,SAAZ,IAAyBnB,SAAS3B,EAAE/D,UAAX,MAA2B0F,SAAS3F,YAAT,CAA3D;AACD,YAFO,CAAR;AAGD,UAJM,CAAP;AAKD,QA9DG;AAgEJiB,iBAhEI,sBAgEOzB,UAhEP,EAgEmBQ,YAhEnB,EAgEiCE,OAhEjC,EAgE0C;AAC5C,gBAAO,IAAIuG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIzF,UAAU;AACZ4F,oBAAO,SADK;AAEZG,mBAAM,qBAFM;AAGZhH,yBAAYD,YAHA;AAIZE,sBAASA;AAJG,YAAd;;AAOA,eAAIK,cAAchB,gBAAeC,UAAf,CAAlB;AACAe,uBAAY2G,IAAZ,CAAiBhG,OAAjB;AACAiG,6BAAkB3H,UAAlB,EAA8Be,WAA9B;;AAEAmG,mBAAQxF,OAAR;AACD,UAbM,CAAP;AAcD,QA/EG;AAiFJE,oBAjFI,yBAiFU5B,UAjFV,EAiFsBW,SAjFtB,EAiFiC;AACnC,gBAAO,IAAIsG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCpH,2BAAeC,UAAf;AACA,eAAI4H,QAAQ,CAAC,CAAb;AACA,eAAI7G,cAAchB,gBAAeC,UAAf,CAAlB;AACA,gBAAK,IAAIwE,IAAE,CAAN,EAASC,IAAE1D,YAAY2D,MAA5B,EAAoCF,IAAEC,CAAtC,EAAyCD,GAAzC,EAA8C;AAC5C,iBAAIzD,YAAYyD,CAAZ,EAAeiD,IAAf,KAAwB9G,SAA5B,EAAuC;AACrCiH,uBAAQpD,CAAR;AACA;AACD;AACF;;AAED,eAAIoD,QAAQ,CAAC,CAAb,EAAgB;AACd7G,yBAAYgF,MAAZ,CAAmB6B,KAAnB,EAA0B,CAA1B;AACAD,+BAAkB3H,UAAlB,EAA8Be,WAA9B;AACD;;AAEDmG,mBAAQ,IAAR;AACD,UAjBM,CAAP;AAkBD;AApGG,MADM;AAuGb;;;;;mBAxGkB1H,iB;;;AA2GrB,UAASO,eAAT,CAAwBC,UAAxB,EAAoC;AAClC,UAAO+G,KAAKC,KAAL,CAAWc,aAAaC,OAAb,CAAwB/H,UAAxB,kBAAX,KAAiE,EAAxE;AACD;;AAED,UAAS2H,iBAAT,CAA2B3H,UAA3B,EAAuCe,WAAvC,EAAoD;AAClD+G,gBAAaE,OAAb,CAAwBhI,UAAxB,mBAAkD+G,KAAKkB,SAAL,CAAelH,WAAf,CAAlD;AACD;;AAED,UAASyG,cAAT,CAAwBxH,UAAxB,EAAoCQ,YAApC,EAAkD;AAChD,OAAIoH,QAAQ,CAAC,CAAb;AACA,OAAI7G,cAAchB,gBAAeC,UAAf,CAAlB;AACA,QAAK,IAAIwE,IAAE,CAAN,EAASC,IAAE1D,YAAY2D,MAA5B,EAAoCF,IAAEC,CAAtC,EAAyCD,GAAzC,EAA8C;AAC5C,SAAIzD,YAAYyD,CAAZ,EAAeiD,IAAf,KAAwBjH,YAA5B,EAA0C;AACxCoH,eAAQpD,CAAR;AACA;AACD;AACF;AACD,UAAOoD,KAAP;AACD;;;;;;;;;;;;mBCpHuBH,I;AAdxB,KAAMS,SAAS,OAAf;AACA,KAAMC,UAAU,sCAAhB;;AAEA,UAASC,WAAT,CAAqBC,CAArB,EAAwB;AACtB,OAAIC,IAAIC,KAAKC,MAAL,KAAc,EAAd,GAAiB,CAAzB;AACA,OAAIC,IAAIJ,KAAK,GAAL,GAAWC,CAAX,GAAgBA,IAAE,GAAF,GAAM,GAA9B;AACA,UAAOG,EAAEC,QAAF,CAAW,EAAX,CAAP;AACD;;AAED;;;;;AAKe,UAASjB,IAAT,GAAgB;AAC7B,UAAOU,QAAQtC,OAAR,CAAgBqC,MAAhB,EAAwBE,WAAxB,CAAP;AACD;;;;;;;;;;;;mBCDuBtI,M;;AAfxB;;;;AACA;;;;AACA;;;;;;AAEA;;;;;;;;;;;AAWe,UAASA,MAAT,CAAgBgF,GAAhB,EAAqB0B,QAArB,EAA+BmC,IAA/B,EAAqC;AAClD,UAAO,IAAI1B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC;AACArC,SAAI8D,SAAJ,GAAgB,EAAhB;AACA9D,SAAIhB,YAAJ,CAAiB,6BAAjB,EAAgD,IAAhD;AACAgB,SAAIhB,YAAJ,CAAiB,4BAAjB,EAA+CiD,KAAKkB,SAAL,CAAezB,QAAf,CAA/C;AACA1B,SAAI+D,eAAJ,CAAoB,4BAApB;AACA/D,SAAI+D,eAAJ,CAAoB,wBAApB;;AAEA;AACA,SAAI,CAACF,IAAL,EAAW;AACT,cAAOzB,QAAQpC,GAAR,CAAP;AACD;;AAEDA,SAAIhB,YAAJ,CAAiB,4BAAjB,EAA+C6E,KAAK3I,UAApD;AACA8E,SAAIhB,YAAJ,CAAiB,wBAAjB,EAA2C6E,KAAK1I,UAAhD;;AAEA;AACA,SAAI,CAAC6I,MAAMC,OAAN,CAAcJ,KAAK5H,WAAnB,CAAD,IAAoC4H,KAAK5H,WAAL,CAAiB2D,MAAjB,KAA4B,CAApE,EAAuE;AACrE,cAAOwC,QAAQpC,GAAR,CAAP;AACD;;AAED;AACA6D,UAAK5H,WAAL,CAAiBT,OAAjB,CAAyB,UAACU,CAAD,EAAO;AAC9B,kCAAY8D,GAAZ,EAAiB9D,CAAjB,EAAoBwF,QAApB;AACD,MAFD;;AAIAU,aAAQpC,GAAR;AACD,IA3BM,CAAP;AA4BD;;;;;;;;;;;;mBCiEuB+B,W;;AA7GxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,KAAMmC,YAAY,WAAWC,IAAX,CAAgBC,UAAUC,SAA1B,CAAlB;;AAEA;;;;;;;AAOA,UAASC,cAAT,CAAwB5C,QAAxB,EAAkC;AAChC,OAAIpC,UAAJ;AACA,OAAIC,UAAJ;;AAEA;AACA;AACA,WAAOmC,SAAS6C,QAAT,GAAoB,GAA3B;AACE,UAAK,CAAL;AACEjF,WAAIC,IAAI,CAAR;AACA;AACF,UAAK,EAAL;AACED,WAAI,CAAJ;AACAC,WAAKmC,SAASH,KAAT,GAAiBG,SAASC,KAA3B,GAAoC,CAAC,CAAzC;AACA;AACF,UAAK,GAAL;AACErC,WAAKoC,SAASH,KAAT,GAAiBG,SAASC,KAA3B,GAAoC,CAAC,CAAzC;AACApC,WAAKmC,SAASJ,MAAT,GAAkBI,SAASC,KAA5B,GAAqC,CAAC,CAA1C;AACA;AACF,UAAK,GAAL;AACErC,WAAKoC,SAASJ,MAAT,GAAkBI,SAASC,KAA5B,GAAqC,CAAC,CAA1C;AACApC,WAAI,CAAJ;AACA;AAfJ;;AAkBA,UAAO,EAAED,IAAF,EAAKC,IAAL,EAAP;AACD;;AAED;;;;;;;AAOA,UAASiF,SAAT,CAAmBvF,IAAnB,EAAyByC,QAAzB,EAAmC;AACjC,OAAI+C,QAAQH,eAAe5C,QAAf,CAAZ;;AAEA;AACAzC,QAAKD,YAAL,CAAkB,WAAlB,aAAwC0C,SAASC,KAAjD,iBAAkED,SAAS6C,QAA3E,oBAAkGE,MAAMnF,CAAxG,UAA8GmF,MAAMlF,CAApH;;AAEA;AACA,OAAI,CAAC2E,SAAD,IAAcjF,KAAKE,QAAL,CAAcuB,WAAd,OAAgC,KAAlD,EAAyD;AACvDzB,UAAKD,YAAL,CAAkB,GAAlB,EAAuBqC,SAASpC,KAAKI,YAAL,CAAkB,GAAlB,CAAT,EAAiC,EAAjC,IAAuCqC,SAASC,KAAvE;AACA1C,UAAKD,YAAL,CAAkB,GAAlB,EAAuBqC,SAASpC,KAAKI,YAAL,CAAkB,GAAlB,CAAT,EAAiC,EAAjC,IAAuCqC,SAASC,KAAvE;;AAEA,SAAIrC,IAAI+B,SAASpC,KAAKI,YAAL,CAAkB,GAAlB,EAAuB,EAAvB,CAAT,CAAR;AACA,SAAIE,IAAI8B,SAASpC,KAAKI,YAAL,CAAkB,GAAlB,EAAuB,EAAvB,CAAT,CAAR;AACA,SAAIkC,QAAQF,SAASpC,KAAKI,YAAL,CAAkB,OAAlB,CAAT,EAAqC,EAArC,CAAZ;AACA,SAAIiC,SAASD,SAASpC,KAAKI,YAAL,CAAkB,QAAlB,CAAT,EAAsC,EAAtC,CAAb;AACA,SAAIqF,OAAOzF,KAAK0F,aAAL,CAAmB,MAAnB,CAAX;AACA,SAAI3E,MAAM0E,KAAKxF,UAAf;;AAEA;AACA,MAACD,IAAD,EAAOe,GAAP,EAAY0E,IAAZ,EAAkBzF,KAAK0F,aAAL,CAAmB,MAAnB,CAAlB,EAA8CnJ,OAA9C,CAAsD,UAACoJ,CAAD,EAAO;AAC3DA,SAAE5F,YAAF,CAAe,OAAf,EAAwBqC,SAASuD,EAAEvF,YAAF,CAAe,OAAf,CAAT,EAAkC,EAAlC,IAAwCqC,SAASC,KAAzE;AACAiD,SAAE5F,YAAF,CAAe,QAAf,EAAyBqC,SAASuD,EAAEvF,YAAF,CAAe,QAAf,CAAT,EAAmC,EAAnC,IAAyCqC,SAASC,KAA3E;AACD,MAHD;;AAKA;AACA6C,eAAUE,IAAV,EAAgB,4BAAa,EAAb,EAAiBhD,QAAjB,EAA2B,EAAEC,OAAO,CAAT,EAA3B,CAAhB;;AAEA,aAAOD,SAAS6C,QAAT,GAAoB,GAA3B;AACE,YAAK,EAAL;AACEtF,cAAKD,YAAL,CAAkB,GAAlB,EAAuB0C,SAASH,KAAT,GAAiBhC,CAAjB,GAAqBgC,KAA5C;AACAtC,cAAKD,YAAL,CAAkB,GAAlB,EAAuBM,CAAvB;AACAU,aAAIhB,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACAgB,aAAIhB,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AACF,YAAK,GAAL;AACEC,cAAKD,YAAL,CAAkB,GAAlB,EAAuB0C,SAASH,KAAT,GAAiBjC,CAAjB,GAAqBiC,KAA5C;AACAtC,cAAKD,YAAL,CAAkB,GAAlB,EAAuB0C,SAASJ,MAAT,GAAkB/B,CAAlB,GAAsB+B,MAA7C;AACAtB,aAAIhB,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AACF,YAAK,GAAL;AACEC,cAAKD,YAAL,CAAkB,GAAlB,EAAuBO,CAAvB;AACAN,cAAKD,YAAL,CAAkB,GAAlB,EAAuB0C,SAASJ,MAAT,GAAkBhC,CAAlB,GAAsBgC,MAA7C;AACAtB,aAAIhB,YAAJ,CAAiB,GAAjB,EAAsB,CAAC,CAAvB;AACAgB,aAAIhB,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AAjBJ;AAmBD;;AAED,UAAOC,IAAP;AACD;;AAED;;;;;;;;AAQe,UAAS8C,WAAT,CAAqB/B,GAArB,EAA0BrE,UAA1B,EAAsC+F,QAAtC,EAAgD;AAC7D,OAAI,CAACA,QAAL,EAAe;AACbA,gBAAWO,KAAKC,KAAL,CAAWlC,IAAIX,YAAJ,CAAiB,4BAAjB,CAAX,CAAX;AACD;;AAED,OAAIwF,cAAJ;AACA,WAAQlJ,WAAWmJ,IAAnB;AACE,UAAK,MAAL;AACA,UAAK,WAAL;AACED,eAAQ,0BAAWlJ,UAAX,CAAR;AACA;AACF,UAAK,WAAL;AACEkJ,eAAQ,0BAAWlJ,UAAX,CAAR;AACA;AACF,UAAK,OAAL;AACEkJ,eAAQ,2BAAYlJ,UAAZ,CAAR;AACA;AACF,UAAK,SAAL;AACEkJ,eAAQ,0BAAWlJ,UAAX,CAAR;AACA;AACF,UAAK,SAAL;AACEkJ,eAAQ,0BAAWlJ,UAAX,CAAR;AACA;AAhBJ;;AAmBA;AACA;AACA,OAAIkJ,KAAJ,EAAW;AACT;AACAA,WAAM7F,YAAN,CAAmB,sBAAnB,EAA2CrD,WAAWgH,IAAtD;AACAkC,WAAM7F,YAAN,CAAmB,wBAAnB,EAA6CrD,WAAWmJ,IAAxD;AACAD,WAAM7F,YAAN,CAAmB,aAAnB,EAAkC,IAAlC;;AAEAgB,SAAI+B,WAAJ,CAAgByC,UAAUK,KAAV,EAAiBnD,QAAjB,CAAhB;AACD;;AAED,UAAOmD,KAAP;AACD;;;;;;;AClJD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,iCAAgC;AAChC;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAiB,QAAQ;AACzB;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH,mCAAkC;AAClC;AACA;AACA;;AAEA;AACA,GAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,iBAAgB,sBAAsB;AACtC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAkB,oBAAoB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;mBC/EwBE,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoB7I,CAApB,EAAuB;AACpC,OAAI8I,QAAQzH,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,GAAvD,CAAZ;AACA,gCAAcD,KAAd,EAAqB;AACnBE,aAAQ,8BAAehJ,EAAEiJ,KAAF,IAAW,MAA1B,CADW;AAEnBC,kBAAa;AAFM,IAArB;;AAKAlJ,KAAEmJ,UAAF,CAAa7J,OAAb,CAAqB,UAACgI,CAAD,EAAO;AAC1B,SAAI8B,OAAO/H,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,kCAAcK,IAAd,EAAoB;AAClBC,WAAI/B,EAAElE,CADY;AAElBkG,WAAIhC,EAAEjE,CAFY;AAGlBkG,WAAIjC,EAAElE,CAAF,GAAMkE,EAAEjC,KAHM;AAIlBmE,WAAIlC,EAAEjE;AAJY,MAApB;;AAOAyF,WAAMjD,WAAN,CAAkBuD,IAAlB;AACD,IAXD;;AAaA,UAAON,KAAP;AACD;;;;;;;;;;;;mBCXuBW,a;AApBxB,KAAMC,cAAc,QAApB;;AAEA;AACA,KAAMC,YAAY,CAChB,SADgB,CAAlB;;AAIA,KAAIC,UAAU,SAAVA,OAAU,CAACrK,GAAD,EAAS;AACrB,OAAIoK,UAAUE,OAAV,CAAkBtK,GAAlB,MAA2B,CAAC,CAAhC,EAAmC;AACjCA,WAAMA,IAAIsF,OAAJ,CAAY6E,WAAZ,EAAyB;AAAA,cAAS,MAAMI,MAAMtF,WAAN,EAAf;AAAA,MAAzB,CAAN;AACD;AACD,UAAOjF,GAAP;AACD,EALD;;AAOA;;;;;;AAMe,UAASkK,aAAT,CAAuB1G,IAAvB,EAA6BgH,UAA7B,EAAyC;AACtD3K,UAAOC,IAAP,CAAY0K,UAAZ,EAAwBzK,OAAxB,CAAgC,UAACC,GAAD,EAAS;AACvCwD,UAAKD,YAAL,CAAkB8G,QAAQrK,GAAR,CAAlB,EAAgCwK,WAAWxK,GAAX,CAAhC;AACD,IAFD;AAGD;;;;;;;;;;;;mBChBuByK,c;AARxB,KAAMC,qBAAqB,8BAA3B;;AAEA;;;;;;AAMe,UAASD,cAAT,CAAwBf,KAAxB,EAA+B;AAC5C,OAAIgB,mBAAmBhC,IAAnB,CAAwBgB,KAAxB,CAAJ,EAAoC;AAClCA,mBAAYA,KAAZ;AACD;AACD,UAAOA,KAAP;AACD;;;;;;;;;;;;mBCHuBiB,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoBlK,CAApB,EAAuB;AACpC,OAAImK,IAAI,EAAR;AACA,OAAI3B,OAAOnH,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,QAAK,IAAIvF,IAAE,CAAN,EAASC,IAAEzD,EAAEoK,KAAF,CAAQ1G,MAAxB,EAAgCF,IAAEC,CAAlC,EAAqCD,GAArC,EAA0C;AACxC,SAAI6G,KAAKrK,EAAEoK,KAAF,CAAQ5G,CAAR,CAAT;AACA,SAAI8G,KAAKtK,EAAEoK,KAAF,CAAQ5G,IAAE,CAAV,CAAT;AACA,SAAI8G,EAAJ,EAAQ;AACNH,SAAEzD,IAAF,OAAW2D,GAAG,CAAH,CAAX,SAAoBA,GAAG,CAAH,CAApB,SAA6BC,GAAG,CAAH,CAA7B,SAAsCA,GAAG,CAAH,CAAtC;AACD;AACF;;AAED,gCAAc9B,IAAd,EAAoB;AAClB2B,QAAMA,EAAEI,IAAF,CAAO,GAAP,CAAN,MADkB;AAElBvB,aAAQ,8BAAehJ,EAAEiJ,KAAF,IAAW,MAA1B,CAFU;AAGlBC,kBAAalJ,EAAEqF,KAAF,IAAW,CAHN;AAIlBmF,WAAM;AAJY,IAApB;;AAOA,UAAOhC,IAAP;AACD;;;;;;;;;;;;mBClBuBiC,W;;AAZxB;;;;;;AAEA,KAAMC,OAAO,EAAb;AACA,KAAMC,IAAI,6WAAV;;AAEA;;;;;;;AAOe,UAASF,WAAT,CAAqBzK,CAArB,EAAwB;AACrC,OAAI4K,WAAWvJ,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAf;AACA,OAAI8B,WAAWxJ,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAf;AACA,OAAInF,OAAOvC,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;AACA,OAAIP,OAAOnH,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,gCAAc6B,QAAd,EAAyB;AACvBvF,YAAOqF,IADgB;AAEvBtF,aAAQsF,IAFe;AAGvBtH,QAAGpD,EAAEoD,CAHkB;AAIvBC,QAAGrD,EAAEqD;AAJkB,IAAzB;;AAOA,gCAAcwH,QAAd,EAAwB;AACtBxF,YAAOqF,IADe;AAEtBtF,aAAQsF,IAFc;AAGtBtH,QAAG,CAHmB;AAItBC,QAAIqH,OAAO,IAAR,GAAgB,CAAC,CAJE;AAKtBI,cAAS;AALa,IAAxB;;AAQA,gCAAclH,IAAd,EAAoB;AAClByB,YAAOqF,IADW;AAElBtF,aAAQsF,IAFU;AAGlB1B,aAAQ,MAHU;AAIlBwB,WAAM;AAJY,IAApB;;AAOA,gCAAchC,IAAd,EAAoB;AAClB2B,QAAGQ,CADe;AAElBzB,kBAAa,EAFK;AAGlBF,aAAQ,MAHU;AAIlBwB,WAAM;AAJY,IAApB;;AAOAK,YAAShF,WAAT,CAAqB2C,IAArB;AACAoC,YAAS/E,WAAT,CAAqBjC,IAArB;AACAgH,YAAS/E,WAAT,CAAqBgF,QAArB;;AAEA,UAAOD,QAAP;AACD;;;;;;;;;;;;mBC1CuBG,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoB/K,CAApB,EAAuB;AACpC,OAAIA,EAAE4I,IAAF,KAAW,WAAf,EAA4B;AAC1B,SAAIE,QAAQzH,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,GAAvD,CAAZ;AACA,kCAAcD,KAAd,EAAqB;AACnB0B,aAAM,8BAAexK,EAAEiJ,KAAF,IAAW,MAA1B,CADa;AAEnB+B,oBAAa;AAFM,MAArB;;AAKAhL,OAAEmJ,UAAF,CAAa7J,OAAb,CAAqB,UAACgI,CAAD,EAAO;AAC1BwB,aAAMjD,WAAN,CAAkBoF,WAAW3D,CAAX,CAAlB;AACD,MAFD;;AAIA,YAAOwB,KAAP;AACD,IAZD,MAYO;AACL,SAAIlF,OAAOqH,WAAWjL,CAAX,CAAX;AACA,kCAAc4D,IAAd,EAAoB;AAClBoF,eAAQ,8BAAehJ,EAAEiJ,KAAF,IAAW,MAA1B,CADU;AAElBuB,aAAM;AAFY,MAApB;;AAKA,YAAO5G,IAAP;AACD;AACF;;AAED,UAASqH,UAAT,CAAoB3D,CAApB,EAAuB;AACrB,OAAI1D,OAAOvC,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,gCAAcnF,IAAd,EAAoB;AAClBR,QAAGkE,EAAElE,CADa;AAElBC,QAAGiE,EAAEjE,CAFa;AAGlBgC,YAAOiC,EAAEjC,KAHS;AAIlBD,aAAQkC,EAAElC;AAJQ,IAApB;;AAOA,UAAOxB,IAAP;AACD;;;;;;;;;;;;mBCnCuBsH,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoBlL,CAApB,EAAuB;AACpC,OAAImL,OAAO9J,SAAS0H,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,gCAAcoC,IAAd,EAAoB;AAClB/H,QAAGpD,EAAEoD,CADa;AAElBC,QAAGrD,EAAEqD,CAAF,GAAM8B,SAASnF,EAAEoL,IAAX,EAAiB,EAAjB,CAFS;AAGlBZ,WAAM,8BAAexK,EAAEiJ,KAAF,IAAW,MAA1B,CAHY;AAIlBoC,eAAUrL,EAAEoL;AAJM,IAApB;AAMAD,QAAKvD,SAAL,GAAiB5H,EAAEN,OAAnB;;AAEA,UAAOyL,IAAP;AACD;;;;;;;;;;;;mBCXuBG,uB;;AAXxB;;;;AACA;;;;;;AAEA;AACA;;AAEA;;;;;AAKe,UAASA,uBAAT,CAAiCvL,WAAjC,EAA8C;AAC3DA,iBAAc+H,MAAMC,OAAN,CAAchI,WAAd,IAA6BA,WAA7B,GAA2C,EAAzD;;AAEA;AACAX,UAAOC,IAAP,CAAYkM,UAAZ,EAAwBjM,OAAxB,CAAgC,UAACsJ,IAAD,EAAU;AACxC,SAAI4C,SAASD,WAAW3C,IAAX,CAAb;AACA7I,iBACGqG,MADH,CACU,UAACpG,CAAD;AAAA,cAAOA,EAAE4I,IAAF,KAAWA,IAAlB;AAAA,MADV,EAEG6C,IAFH,CAEQD,MAFR,EAGGlM,OAHH,CAGW,UAACU,CAAD,EAAIwD,CAAJ;AAAA,cAAU,sCAAuBxD,CAAvB,EAA0BwD,IAAI,CAA9B,CAAV;AAAA,MAHX;AAID,IAND;AAOD;;AAED;AACA;AACA;AACA,UAASkI,WAAT,CAAqB1L,CAArB,EAAwB2L,CAAxB,EAA2B;AACzB,OAAI3L,EAAEqD,CAAF,GAAMsI,EAAEtI,CAAZ,EAAe;AACb,YAAOrD,EAAEoD,CAAF,GAAMuI,EAAEvI,CAAf;AACD,IAFD,MAEO;AACL,YAAO,CAAP;AACD;AACF;;AAED;AACA,UAASwI,eAAT,CAAyB5L,CAAzB,EAA4B2L,CAA5B,EAA+B;AAC7B,UAAOD,YAAY1L,EAAEmJ,UAAF,CAAa,CAAb,CAAZ,EAA6BwC,EAAExC,UAAF,CAAa,CAAb,CAA7B,CAAP;AACD;;AAED;AACA,UAAS0C,eAAT,CAAyB7L,CAAzB,EAA4B2L,CAA5B,EAA+B;AAC7B,OAAIG,QAAQ9L,EAAEoK,KAAF,CAAQ,CAAR,CAAZ;AACA,OAAI2B,QAAQJ,EAAEvB,KAAF,CAAQ,CAAR,CAAZ;AACA,UAAOsB,YACL,EAACtI,GAAG0I,MAAM,CAAN,CAAJ,EAAczI,GAAGyI,MAAM,CAAN,CAAjB,EADK,EAEL,EAAC1I,GAAG2I,MAAM,CAAN,CAAJ,EAAc1I,GAAG0I,MAAM,CAAN,CAAjB,EAFK,CAAP;AAID;;AAED;AACA,KAAMR,aAAa;AACjB,gBAAaK,eADI;AAEjB,gBAAaA,eAFI;AAGjB,cAAWC,eAHM;AAIjB,cAAWH,WAJM;AAKjB,YAASA,WALQ;AAMjB,WAAQA;AANS,EAAnB;;;;;;;;;;;;mBCrCwBM,sB;;AAdxB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;AACA,KAAMC,gBAAgB,CAAC,WAAD,EAAc,OAAd,EAAuB,MAAvB,EAA+B,SAA/B,EAA0C,WAA1C,CAAtB;;AAEA;;;;;;AAMe,UAASD,sBAAT,CAAgCvM,UAAhC,EAAqD;AAAA,OAATyM,GAAS,uEAAH,CAAG;;AAClE,WAAQzM,WAAWmJ,IAAnB;AACE,UAAK,WAAL;AACA,UAAK,WAAL;AACE,WAAIuD,QAAQ1M,WAAW0J,UAAvB;AACA,WAAIiD,QAAQD,MAAM,CAAN,CAAZ;AACA,WAAIE,OAAOF,MAAMA,MAAMzI,MAAN,GAAe,CAArB,CAAX;;AAEA,iDACE,iDAAgCjE,WAAWmJ,IAA3C,oBAA8DsD,GAA9D,EAAqEzM,WAAWgH,IAAhF,CADF,EAEE2F,MAAMhJ,CAFR,EAEWgJ,MAAM/I,CAFjB,EAEoB5D,WAAW4G,IAF/B,EAEqC,IAFrC;;AAKA,iDACE,+CAA8B5G,WAAWmJ,IAAzC,oBAA4DsD,GAA5D,EAAsEzM,WAAWgH,IAAjF,UADF,EAEE4F,KAAKjJ,CAAL,GAASiJ,KAAKhH,KAFhB,EAEuBgH,KAAKhJ,CAF5B,EAE+B5D,WAAW4G,IAF1C,EAEgD,KAFhD;AAIA;;AAEF,UAAK,SAAL;AACA,UAAK,OAAL;AACE,WAAI8E,OAAO1L,WAAWmJ,IAAX,KAAoB,SAApB,mBAA8CnJ,WAAWC,OAAzD,SAAsE,EAAjF;;AAEA,kDACE,sCAA0BD,WAAWmJ,IAArC,oBAAwDsD,GAAxD,GAA8Df,IAA9D,EAAsE1L,WAAWgH,IAAjF,CADF,EAEEhH,WAAW2D,CAFb,EAEgB3D,WAAW4D,CAF3B,EAE8B5D,WAAW4G,IAFzC;AAIA;;AAEF,UAAK,SAAL;AACA,UAAK,MAAL;AACE,WAAIjD,IAAI,OAAO3D,WAAW2D,CAAlB,KAAwB,WAAxB,GAAsC3D,WAAW2D,CAAjD,GAAqD3D,WAAW2K,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAA7D;AACA,WAAI/G,IAAI,OAAO5D,WAAW4D,CAAlB,KAAwB,WAAxB,GAAsC5D,WAAW4D,CAAjD,GAAqD5D,WAAW2K,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAA7D;;AAEA,kDACE,2DAA4C3K,WAAWgH,IAAvD,CADF,EAEErD,CAFF,EAEKC,CAFL,EAEQ5D,WAAW4G,IAFnB;AAIA;AArCJ;;AAwCA;AACA,OAAI4F,cAAc1G,QAAd,CAAuB9F,WAAWmJ,IAAlC,CAAJ,EAA6C;AAC3C,+CAA2BnJ,WAAWT,UAAtC,EAAkDS,WAAWgH,IAA7D;AACD;AACF;;;;;;;;;;;;mBCpDuB6F,sB;AAPxB;;;;;;;AAOe,UAASA,sBAAT,CAAgC5M,OAAhC,EAAyCF,YAAzC,EAAuD;AACpE,OAAIuD,OAAO1B,SAASkL,aAAT,CAAuB,KAAvB,CAAX;AACA,OAAIpB,OAAO9J,SAASmL,cAAT,CAAwB9M,OAAxB,CAAX;AACAqD,QAAK8C,WAAL,CAAiBsF,IAAjB;AACApI,QAAKD,YAAL,CAAkB,IAAlB,iCAAqDtD,YAArD;AACAuD,QAAK0J,KAAL,CAAWC,QAAX,GAAsB,UAAtB;AACA3J,QAAK0J,KAAL,CAAWxI,IAAX,GAAkB,UAAlB;AACAlB,QAAK0J,KAAL,CAAW1I,GAAX,GAAiB,MAAjB;AACAhB,QAAK0J,KAAL,CAAWpH,KAAX,GAAmB,KAAnB;AACAtC,QAAK0J,KAAL,CAAWrH,MAAX,GAAoB,KAApB;AACArC,QAAK0J,KAAL,CAAWE,QAAX,GAAsB,QAAtB;AACA,UAAO5J,IAAP;AACD;;;;;;;;;;;;mBCJuB6J,2B;;AAfxB;;;;AACA;;;;;;AAGA;;;;;;;;;;;AAWe,UAASA,2BAAT,CAAqCjJ,EAArC,EAAyCP,CAAzC,EAA4CC,CAA5C,EAA+CpE,UAA/C,EAA2D;AACxE;AACA,OAAI,0CAA2B0E,EAA3B,EAA+BP,CAA/B,EAAkCC,CAAlC,EAAqCpE,UAArC,EAAiD,IAAjD,CAAJ,EAA4D;AAC1D,YAAO,IAAP;AACD;;AAED;AACA,OAAI6E,MAAMzC,SAASoH,aAAT,kCAAsDxJ,UAAtD,QAAV;AACA,OAAI2E,OAAOE,IAAID,qBAAJ,EAAX;AACA,OAAIgJ,qCAAY/I,IAAId,UAAJ,CAAeO,gBAAf,CAAgC,kBAAhC,CAAZ,EAAJ;;AAEAF,OAAI,oBAAQS,GAAR,EAAa,EAACT,IAAD,EAAb,EAAkBA,CAAlB,GAAsBO,KAAKG,GAA/B;AACAX,OAAI,oBAAQU,GAAR,EAAa,EAACV,IAAD,EAAb,EAAkBA,CAAlB,GAAsBQ,KAAKK,IAA/B;;AAEA;AACA,QAAK,IAAIT,IAAE,CAAN,EAASC,IAAEoJ,MAAMnJ,MAAtB,EAA8BF,IAAEC,CAAhC,EAAmCD,GAAnC,EAAwC;AACtC,SAAIkF,IAAImE,MAAMrJ,CAAN,CAAR;AACA,SAAI8D,IAAIoB,EAAE7E,qBAAF,EAAR;AACA,SAAIR,KAAKiE,EAAEvD,GAAX,EAAgB;AACd2E,SAAE1F,UAAF,CAAa8J,YAAb,CAA0BnJ,EAA1B,EAA8B+E,CAA9B;AACA,cAAO,IAAP;AACD;AACF;;AAED;AACA,OAAIqE,YAAYjJ,IAAId,UAAJ,CAAeyF,aAAf,CAA6B,YAA7B,CAAhB;AACA,OAAIsE,SAAJ,EAAe;AACb,SAAIC,WAAWD,UAAUlJ,qBAAV,EAAf;AACA,SAAI,gCAAoBT,CAApB,EAAuBC,CAAvB,EAA0B2J,QAA1B,CAAJ,EAAyC;AACvCD,iBAAUlH,WAAV,CAAsBlC,EAAtB;AACA,cAAO,IAAP;AACD;AACF;;AAED,UAAO,KAAP;AACD;;;;;;;;;;;;mBCjCuBsJ,0B;;AAjBxB;;;;AAMA;;;;;;;;;;;AAWe,UAASA,0BAAT,CAAoCtJ,EAApC,EAAwCP,CAAxC,EAA2CC,CAA3C,EAA8CpE,UAA9C,EAA0D6N,YAA1D,EAAwE;AACrF,OAAMI,gBAAgB,CAAtB;;AAEA;AACA;AACA;AACA;AACA9J,OAAImE,KAAK4F,GAAL,CAAS/J,IAAK8J,iBAAiBJ,eAAe,CAAf,GAAmB,CAAC,CAArC,CAAd,EAAwD,CAAxD,CAAJ;;AAEA,OAAI/J,OAAOqK,0BAA0BhK,CAA1B,EAA6BC,IAAI6J,aAAjC,EAAgDjO,UAAhD,CAAX;AACA,OAAI,CAAC8D,IAAL,EAAW;AACT,YAAO,KAAP;AACD;;AAED;AACA;AACA;AACAK,OAAIA,IAAK8J,iBAAiBJ,eAAe,CAAC,CAAhB,GAAoB,CAArC,CAAT;;AAEA,OAAIhJ,MAAMzC,SAASoH,aAAT,kCAAsDxJ,UAAtD,QAAV;AACA,OAAIgF,OAAO,sBAAUH,GAAV,EAAe,EAACG,MAAMlB,KAAKc,qBAAL,GAA6BI,IAApC,EAAf,EAA0DA,IAA1D,GAAiEH,IAAID,qBAAJ,GAA4BI,IAAxG;AACA,OAAIoJ,OAAOtK,KAAKuK,SAAL,CAAe,IAAf,CAAX;AACA,OAAI1H,OAAOyH,KAAKzF,SAAL,CAAe9C,KAAf,CAAqB,EAArB,CAAX;AACA,OAAIyI,OAAO,EAAX;;AAEA;AACAF,QAAKZ,KAAL,CAAWC,QAAX,GAAsB,UAAtB;AACAW,QAAKZ,KAAL,CAAW1I,GAAX,GAAiB,UAAjB;AACAsJ,QAAKZ,KAAL,CAAWxI,IAAX,GAAkB,UAAlB;AACA5C,YAASwB,IAAT,CAAcgD,WAAd,CAA0BwH,IAA1B;;AAEA,UAAOzH,KAAKlC,MAAZ,EAAoB;AAClB;AACA,SAAIkC,KAAKA,KAAKlC,MAAL,GAAc,CAAnB,MAA0B,GAA9B,EAAmC;AACjC,cAAMkC,KAAKlC,MAAX,EAAmB;AACjB6J,cAAKC,OAAL,CAAa5H,KAAK6H,GAAL,EAAb;AACA,aAAIF,KAAK,CAAL,MAAY,GAAhB,EAAqB;AACnB;AACD;AACF;AACF;;AAED;AACAF,UAAKzF,SAAL,GAAiBhC,KAAK2E,IAAL,CAAU,EAAV,CAAjB;AACA,SAAIlF,QAAQ,sBAAUvB,GAAV,EAAe,EAACuB,OAAOgI,KAAKxJ,qBAAL,GAA6BwB,KAArC,EAAf,EAA4DA,KAAxE;AACA,SAAIpB,OAAOoB,KAAP,IAAgBjC,CAApB,EAAuB;AACrB;AACD;AACDmK,UAAKC,OAAL,CAAa5H,KAAK6H,GAAL,EAAb;AACD;;AAED;AACA1K,QAAK6E,SAAL,GAAiBhC,KAAK2E,IAAL,CAAU,EAAV,IAAgB5G,GAAG+J,SAAnB,GAA+BH,KAAKhD,IAAL,CAAU,EAAV,CAAhD;AACA8C,QAAKrK,UAAL,CAAgB8C,WAAhB,CAA4BuH,IAA5B;;AAEA,UAAO,IAAP;AACD;;AAED;;;;;;;;AAQA,UAASD,yBAAT,CAAmChK,CAAnC,EAAsCC,CAAtC,EAAyCpE,UAAzC,EAAqD;AACnD,OAAI6E,MAAMzC,SAASoH,aAAT,kCAAsDxJ,UAAtD,QAAV;AACA,OAAI2E,OAAOE,IAAID,qBAAJ,EAAX;AACAR,OAAI,oBAAQS,GAAR,EAAa,EAACT,IAAD,EAAb,EAAkBA,CAAlB,GAAsBO,KAAKG,GAA/B;AACAX,OAAI,oBAAQU,GAAR,EAAa,EAACV,IAAD,EAAb,EAAkBA,CAAlB,GAAsBQ,KAAKK,IAA/B;AACA,UAAO,6BAAIH,IAAId,UAAJ,CAAeO,gBAAf,CAAgC,gCAAhC,CAAJ,GAAuE6C,MAAvE,CAA8E,UAACzC,EAAD,EAAQ;AAC3F,YAAO,gCAAoBP,CAApB,EAAuBC,CAAvB,EAA0BM,GAAGE,qBAAH,EAA1B,CAAP;AACD,IAFM,EAEJ,CAFI,CAAP;AAGD;;;;;;;;;;;;mBCjEuB8J,0B;;AA1BxB;;;;AACA;;;;;;AAEA;;;;;;;;;;;;;;;;;;;;;;;AAuBe,UAASA,0BAAT,CAAoC3O,UAApC,EAAgDQ,YAAhD,EAA8DoO,QAA9D,EAAwE;AACrF,OAAIC,gBAAJ;;AAEA,OAAI/F,MAAMC,OAAN,CAAc6F,QAAd,CAAJ,EAA6B;AAC3BC,eAAU5H,QAAQC,OAAR,CAAgB0H,QAAhB,CAAV;AACD,IAFD,MAEO;AACLC,eAAU,wBAAcnP,eAAd,GAAgCmI,WAAhC,CAA4C7H,UAA5C,EAAwDQ,YAAxD,CAAV;AACD;;AAED,UAAOqO,QAAQ/N,IAAR,CAAa,UAAC8N,QAAD,EAAc;AAChC;AACA;AACA,SAAI7K,OAAO1B,SAASyM,cAAT,gCAAqDtO,YAArD,CAAX;AACA,SAAIuD,IAAJ,EAAU;AACR,WAAIgL,OAAO1M,SAASkL,aAAT,CAAuB,IAAvB,CAAX;AACAwB,YAAKjL,YAAL,CAAkB,IAAlB,8CAAkEtD,YAAlE;AACAuO,YAAKjL,YAAL,CAAkB,YAAlB,EAAgC,UAAhC;AACAC,YAAK8C,WAAL,CAAiBkI,IAAjB;AACAH,gBAAStO,OAAT;AACD;AACF,IAXM,CAAP;AAYD;;;;;;;;;;;;mBC1CuB0O,yB;AALxB;;;;;AAKe,UAASA,yBAAT,CAAmCtN,OAAnC,EAA4C;AACzD,OAAI,CAACA,OAAL,EAAc;AACZ;AACD;;AAED,OAAIqN,OAAO1M,SAASoH,aAAT,iCAAqD/H,QAAQjB,UAA7D,SAAX;AACA,OAAIsO,IAAJ,EAAU;AACR,SAAIE,OAAO5M,SAASkL,aAAT,CAAuB,IAAvB,CAAX;AACA0B,UAAKnL,YAAL,CAAkB,IAAlB,yCAA6DpC,QAAQ+F,IAArE;AACAwH,UAAKpI,WAAL,CAAiBxE,SAASmL,cAAT,MAA2B9L,QAAQhB,OAAnC,CAAjB;AACAqO,UAAKlI,WAAL,CAAiBoI,IAAjB;AACD;AACF;;;;;;;;;;;;mBCPuBC,iB;;AAVxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;;;AAGe,UAASA,iBAAT,GAA6B;AAC1C,gCAAiB,gBAAjB,EAAmC,UAAClP,UAAD,EAAaC,UAAb,EAAyBQ,UAAzB,EAAwC;AACzE0O,8BAAyBnP,UAAzB,EAAqCC,UAArC,EAAiDQ,WAAWmJ,IAA5D;AACD,IAFD;AAGA,gCAAiB,iBAAjB,EAAoC,UAAC5J,UAAD,EAAaQ,YAAb,EAA2BC,UAA3B,EAA0C;AAC5E0O,8BAAyBnP,UAAzB,EAAqCS,WAAW4G,IAAhD,EAAsD5G,WAAWmJ,IAAjE;AACD,IAFD;AAGA,gCAAiB,mBAAjB,EAAsCwF,gBAAtC;AACA,gCAAiB,aAAjB,EAAgCC,aAAhC;AACA,gCAAiB,gBAAjB,EAAmCC,aAAnC;AACD;;AAED;;;;;;;AAOA,UAASH,wBAAT,CAAkCnP,UAAlC,EAA8CC,UAA9C,EAA0D2J,IAA1D,EAAgE;AAC9D,2BAAclK,eAAd,GAAgCK,cAAhC,CAA+CC,UAA/C,EAA2DC,UAA3D,EACGa,IADH,CACQ,UAACC,WAAD,EAAiB;AACrB,YAAOA,YAAYA,WAAZ,CAAwBqG,MAAxB,CAA+B,UAACpG,CAAD,EAAO;AAC3C,cAAOA,EAAE4I,IAAF,KAAWA,IAAlB;AACD,MAFM,CAAP;AAGD,IALH,EAMG9I,IANH,CAMQ,UAACC,WAAD,EAAiB;AACrBA,iBAAYT,OAAZ,CAAoB,UAACU,CAAD,EAAO;AACzBoO,wBAAiBpP,UAAjB,EAA6BgB,EAAEyG,IAA/B;AACD,MAFD;;AAIA,YAAO1G,WAAP;AACD,IAZH,EAaGD,IAbH;AAcD;;AAED;;;;;;AAMA,UAASsO,gBAAT,CAA0BpP,UAA1B,EAAsCQ,YAAtC,EAAoD;AAClD+O,oDAA+C/O,YAA/C;AACA+O,oDAA+C/O,YAA/C;AACD;;AAED;;;;;;;AAOA,UAAS6O,aAAT,CAAuBrP,UAAvB,EAAmCQ,YAAnC,EAAiDkB,OAAjD,EAA0D;AACxD,OAAIqN,OAAO1M,SAASoH,aAAT,6CAAiEjJ,YAAjE,CAAX;AACA,OAAIqO,gBAAJ;;AAEA,OAAI,CAACE,IAAL,EAAW;AACTF,eAAU,0CAA2B7O,UAA3B,EAAuCQ,YAAvC,EAAqD,EAArD,EAAyDM,IAAzD,CAA8D,YAAM;AAC5EiO,cAAO1M,SAASoH,aAAT,6CAAiEjJ,YAAjE,CAAP;AACA,cAAO,IAAP;AACD,MAHS,CAAV;AAID,IALD,MAKO;AACLqO,eAAU5H,QAAQC,OAAR,CAAgB,IAAhB,CAAV;AACD;;AAED2H,WAAQ/N,IAAR,CAAa,YAAM;AACjB,8CAA0BY,OAA1B;AACD,IAFD;AAGD;;AAED;;;;;;AAMA,UAAS4N,aAAT,CAAuBtP,UAAvB,EAAmCW,SAAnC,EAA8C;AAC5C4O,4DAAuD5O,SAAvD;AACD;;AAED;;;;;AAKA,UAAS4O,iBAAT,CAA2BC,SAA3B,EAAsC;AACpC,OAAI7K,KAAKtC,SAASyM,cAAT,CAAwBU,SAAxB,CAAT;AACA,OAAI7K,EAAJ,EAAQ;AACNA,QAAGX,UAAH,CAAc8C,WAAd,CAA0BnC,EAA1B;AACD;AACF;;;;;;;;;;;;;ACtGD;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;mBAEe;AACb1C,4CADa,EACKC,+CADL,EAC0BF,2BAD1B;AAEbyN,iCAFa,EAEAC,4BAFA,EAEYC,4BAFZ;AAGbC,8BAHa,EAGDC,yBAHC,EAGUC,mBAHV;AAIbC,oCAJa,EAICC,+BAJD;AAKbC,iCALa,EAKAC,4BALA;AAMbC,iCANa,EAMAC,4BANA,EAMYC,sBANZ;AAObC,+BAPa,EAODC;AAPC,E;;;;;;;;;;;;;;;SCgXCZ,U,GAAAA,U;SAOAD,U,GAAAA,U;SAUAD,W,GAAAA,W;;AAzYhB;;;;AAEA;;;;AACA;;AAIA;;;;;;AAYA,KAAIe,WAAW,KAAf;AACA,KAAIC,WAAW,IAAf;AACA,KAAIC,aAAa,KAAjB;AAAA,KAAwBC,gBAAxB;AACA,KAAIC,oBAAJ;AAAA,KAAiBC,oBAAjB;AAAA,KAA8BC,mBAA9B;AAAA,KAA0CC,mBAA1C;AACA,KAAMC,sBAAsB,CAA5B;;AAEA;;;;;AAKA,UAASC,iBAAT,CAA2BvO,MAA3B,EAAmC;;AAEjC,OAAG,CAACA,MAAD,IAAW,CAACA,OAAOsB,UAAtB,EAAkC;AAChC;AACD;;AAED;AACA,OAAG2M,OAAH,EAAY;;AAEV,SAAIO,YAAYP,QAAQxM,YAAR,CAAqB,gBAArB,CAAhB;AACA,SAAIgN,WAAWzO,OAAOyB,YAAP,CAAoB,sBAApB,CAAf;;AAEA,SAAI+M,cAAcC,QAAlB,EAA4B;AAC1B;AACD;AACF;;AAEDC;;AAEAT,aAAUtO,SAASkL,aAAT,CAAuB,KAAvB,CAAV;AACA,OAAI8D,SAAShP,SAASkL,aAAT,CAAuB,GAAvB,CAAb;AACA,OAAIvJ,aAAa,6BAAiBtB,MAAjB,EAAyBsB,UAA1C;AACA,OAAIsN,KAAK5O,OAAOyB,YAAP,CAAoB,sBAApB,CAAT;AACA,OAAIS,OAAO,8BAAkBlC,MAAlB,CAAX;AACA,OAAI6O,YAAY3M,KAAKK,IAAL,GAAY+L,mBAA5B;AACA,OAAIQ,WAAW5M,KAAKG,GAAL,GAAWiM,mBAA1B;;AAEAL,WAAQ7M,YAAR,CAAqB,IAArB,EAA2B,2BAA3B;AACA6M,WAAQ7M,YAAR,CAAqB,gBAArB,EAAuCwN,EAAvC;AACAX,WAAQlD,KAAR,CAAcgE,SAAd,GAA0B,aAA1B;AACAd,WAAQlD,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACAiD,WAAQlD,KAAR,CAAc1I,GAAd,GAAuByM,QAAvB;AACAb,WAAQlD,KAAR,CAAcxI,IAAd,GAAwBsM,SAAxB;AACAZ,WAAQlD,KAAR,CAAcpH,KAAd,GAAyBzB,KAAKyB,KAA9B;AACAsK,WAAQlD,KAAR,CAAcrH,MAAd,GAA0BxB,KAAKwB,MAA/B;AACAuK,WAAQlD,KAAR,CAAciE,MAAd,GAA0BV,mBAA1B;AACAL,WAAQlD,KAAR,CAAckE,YAAd,GAAgCX,mBAAhC;;AAEA,OAAIP,QAAJ,EAAc;AACZY,YAAOzI,SAAP,GAAmB,GAAnB;AACAyI,YAAOvN,YAAP,CAAoB,MAApB,EAA4B,eAA5B;AACAuN,YAAO5D,KAAP,CAAamE,UAAb,GAA0B,MAA1B;AACAP,YAAO5D,KAAP,CAAakE,YAAb,GAA4B,MAA5B;AACAN,YAAO5D,KAAP,CAAaiE,MAAb,GAAsB,gBAAtB;AACAL,YAAO5D,KAAP,CAAaxD,KAAb,GAAqB,MAArB;AACAoH,YAAO5D,KAAP,CAAapB,QAAb,GAAwB,MAAxB;AACAgF,YAAO5D,KAAP,CAAaoE,OAAb,GAAuB,KAAvB;AACAR,YAAO5D,KAAP,CAAaqE,SAAb,GAAyB,QAAzB;AACAT,YAAO5D,KAAP,CAAasE,cAAb,GAA8B,MAA9B;AACAV,YAAO5D,KAAP,CAAaC,QAAb,GAAwB,UAAxB;AACA2D,YAAO5D,KAAP,CAAa1I,GAAb,GAAmB,OAAnB;AACAsM,YAAO5D,KAAP,CAAavI,KAAb,GAAqB,OAArB;AACAmM,YAAO5D,KAAP,CAAapH,KAAb,GAAqB,MAArB;AACAgL,YAAO5D,KAAP,CAAarH,MAAb,GAAsB,MAAtB;;AAEAuK,aAAQ9J,WAAR,CAAoBwK,MAApB;;AAEAhP,cAASJ,gBAAT,CAA0B,OAA1B,EAAmCK,mBAAnC;AACAD,cAASJ,gBAAT,CAA0B,OAA1B,EAAmC+P,mBAAnC;AACA3P,cAASJ,gBAAT,CAA0B,WAA1B,EAAuCgQ,uBAAvC;AACAZ,YAAOpP,gBAAP,CAAwB,OAAxB,EAAiCX,gBAAjC;AACA+P,YAAOpP,gBAAP,CAAwB,WAAxB,EAAqC,YAAM;AACzCoP,cAAO5D,KAAP,CAAaxD,KAAb,GAAqB,SAArB;AACAoH,cAAO5D,KAAP,CAAayE,WAAb,GAA2B,MAA3B;AACAb,cAAO5D,KAAP,CAAa0E,SAAb,GAAyB,gBAAzB;AACD,MAJD;AAKAd,YAAOpP,gBAAP,CAAwB,UAAxB,EAAoC,YAAM;AACxCoP,cAAO5D,KAAP,CAAaxD,KAAb,GAAqB,MAArB;AACAoH,cAAO5D,KAAP,CAAayE,WAAb,GAA2B,MAA3B;AACAb,cAAO5D,KAAP,CAAa0E,SAAb,GAAyB,EAAzB;AACD,MAJD;AAKAxB,aAAQ1O,gBAAR,CAAyB,WAAzB,EAAsC,YAAM;AAC1C,WAAI,CAACyO,UAAL,EAAiB;AAAEW,gBAAO5D,KAAP,CAAa2E,OAAb,GAAuB,EAAvB;AAA4B;AAChD,MAFD;AAGAzB,aAAQ1O,gBAAR,CAAyB,UAAzB,EAAqC,YAAM;AACzCoP,cAAO5D,KAAP,CAAa2E,OAAb,GAAuB,MAAvB;AACD,MAFD;AAGD;;AAEDpO,cAAW6C,WAAX,CAAuB8J,OAAvB;AACD;;AAED;;;AAGA,UAASS,kBAAT,GAA8B;;AAE5B,OAAIT,WAAWA,QAAQ3M,UAAvB,EAAmC;AACjC2M,aAAQ3M,UAAR,CAAmB8C,WAAnB,CAA+B6J,OAA/B;AACD;AACDA,aAAU,IAAV;;AAEAtO,YAASH,mBAAT,CAA6B,OAA7B,EAAsCI,mBAAtC;AACAD,YAASH,mBAAT,CAA6B,OAA7B,EAAsC8P,mBAAtC;AACA3P,YAASH,mBAAT,CAA6B,WAA7B,EAA0C+P,uBAA1C;AACA5P,YAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACAhQ,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACA;AACD;;AAED;;;AAGA,UAAShR,gBAAT,GAA4B;AAC1B,OAAI,CAACqP,OAAL,EAAc;AAAE;AAAS;;AAEzB,OAAInQ,eAAemQ,QAAQxM,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAI0J,QAAQxL,SAASkC,gBAAT,6BAAoD/D,YAApD,QAAZ;AACA,OAAIsE,MAAM6L,QAAQ3M,UAAR,CAAmByF,aAAnB,CAAiC,qBAAjC,CAAV;;AAL0B,sBAML,wBAAY3E,GAAZ,CANK;AAAA,OAMpB9E,UANoB,gBAMpBA,UANoB;;AAQ1B,gCAAI6N,KAAJ,GAAWvN,OAAX,CAAmB,UAACoJ,CAAD,EAAO;AACxBA,OAAE1F,UAAF,CAAa8C,WAAb,CAAyB4C,CAAzB;AACD,IAFD;;AAIA,2BAAchK,eAAd,GAAgC4B,gBAAhC,CAAiDtB,UAAjD,EAA6DQ,YAA7D;;AAEA4Q;AACD;;AAED;;;;;AAKA,UAAS9O,mBAAT,CAA6BC,CAA7B,EAAgC;AAC9B,OAAI,CAAC,2BAAeA,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAL,EAA2C;AAAE;AAAS;;AAEtD;AACA,OAAIkO,UAAUtO,SAASyM,cAAT,CAAwB,2BAAxB,CAAd;AACA,OAAI6B,OAAJ,EAAa;AACX,SAAID,cAAcnO,EAAEG,MAAF,KAAaiO,OAA/B,EAAwC;AACtC;AACD;;AAEDS;AACD;AACF;;AAED;;;;;AAKA,UAASY,mBAAT,CAA6BzP,CAA7B,EAAgC;AAC9B,OAAIoO,WAAWpO,EAAEgQ,OAAF,KAAc,EAAzB,IACAhQ,EAAEG,MAAF,CAASuB,QAAT,CAAkBuB,WAAlB,OAAoC,UADpC,IAEAjD,EAAEG,MAAF,CAASuB,QAAT,CAAkBuB,WAAlB,OAAoC,OAFxC,EAEiD;AAC/ClE;AACD;AACF;;AAED;;;;;AAKA,UAAS2Q,uBAAT,CAAiC1P,CAAjC,EAAoC;AAClC,OAAIA,EAAEG,MAAF,KAAaiO,OAAjB,EAA0B;AAAE;AAAS;;AAErC;AACA;AACA,OAAInQ,eAAemQ,QAAQxM,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIzB,SAASL,SAASoH,aAAT,6BAAiDjJ,YAAjD,QAAb;AACA,OAAIoJ,OAAOlH,OAAOyB,YAAP,CAAoB,wBAApB,CAAX;;AAEA,OAAIyF,SAAS,WAAT,IAAwBA,SAAS,WAArC,EAAkD;AAAE;AAAS;;AAE7D8G,gBAAa,IAAb;AACAE,iBAAcrO,EAAEC,OAAhB;AACAqO,iBAActO,EAAEE,OAAhB;AACAqO,gBAAaH,QAAQxL,UAArB;AACA4L,gBAAaJ,QAAQvL,SAArB;;AAEAuL,WAAQlD,KAAR,CAAcmE,UAAd,GAA2B,0BAA3B;AACAjB,WAAQlD,KAAR,CAAc+E,MAAd,GAAuB,MAAvB;AACA7B,WAAQlH,aAAR,CAAsB,GAAtB,EAA2BgE,KAA3B,CAAiC2E,OAAjC,GAA2C,MAA3C;;AAEA/P,YAASJ,gBAAT,CAA0B,WAA1B,EAAuCoQ,uBAAvC;AACAhQ,YAASJ,gBAAT,CAA0B,SAA1B,EAAqCqQ,qBAArC;AACA;AACD;;AAED;;;;;AAKA,UAASD,uBAAT,CAAiC9P,CAAjC,EAAoC;AAClC,OAAI/B,eAAemQ,QAAQxM,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIH,aAAa2M,QAAQ3M,UAAzB;AACA,OAAIY,OAAOZ,WAAWa,qBAAX,EAAX;AACA,OAAIR,IAAK0M,cAAcxO,EAAEE,OAAF,GAAYoO,WAA1B,CAAT;AACA,OAAIzM,IAAK0M,cAAcvO,EAAEC,OAAF,GAAYoO,WAA1B,CAAT;AACA,OAAIjL,OAAO,CAAX;AACA,OAAIC,OAAOhB,KAAKwB,MAAhB;AACA,OAAIX,OAAO,CAAX;AACA,OAAIC,OAAOd,KAAKyB,KAAhB;;AAEA,OAAIhC,IAAIsB,IAAJ,IAAYtB,IAAIsM,QAAQ8B,YAAZ,GAA2B7M,IAA3C,EAAiD;AAC/C+K,aAAQlD,KAAR,CAAc1I,GAAd,GAAuBV,CAAvB;AACD;;AAED,OAAID,IAAIqB,IAAJ,IAAYrB,IAAIuM,QAAQ+B,WAAZ,GAA0BhN,IAA1C,EAAgD;AAC9CiL,aAAQlD,KAAR,CAAcxI,IAAd,GAAwBb,CAAxB;AACD;AACF;;AAED;;;;;AAKA,UAASkO,qBAAT,CAA+B/P,CAA/B,EAAkC;AAChC,OAAI/B,eAAemQ,QAAQxM,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIzB,SAASL,SAASkC,gBAAT,6BAAoD/D,YAApD,QAAb;AACA,OAAIoJ,OAAOlH,OAAO,CAAP,EAAUyB,YAAV,CAAuB,wBAAvB,CAAX;AACA,OAAIW,MAAM6L,QAAQ3M,UAAR,CAAmByF,aAAnB,CAAiC,qBAAjC,CAAV;;AAJgC,uBAKX,wBAAY3E,GAAZ,CALW;AAAA,OAK1B9E,UAL0B,iBAK1BA,UAL0B;;AAOhC2Q,WAAQlH,aAAR,CAAsB,GAAtB,EAA2BgE,KAA3B,CAAiC2E,OAAjC,GAA2C,EAA3C;;AAEA,YAASO,QAAT,CAAkBC,KAAlB,EAAyBC,KAAzB,EAAgC;AAC9B,YAAOC,UAAU3M,SAASzD,OAAO,CAAP,EAAUyB,YAAV,CAAuByO,KAAvB,CAAT,EAAwC,EAAxC,CAAV,EAAuDzM,SAASzD,OAAO,CAAP,EAAUyB,YAAV,CAAuB0O,KAAvB,CAAT,EAAwC,EAAxC,CAAvD,CAAP;AACD;;AAED,YAASC,SAAT,CAAmB1O,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,YAAO;AACL0O,eAAQ/B,sBAAsB,sBAAUlM,GAAV,EAAe,EAACV,GAAG4O,EAAErC,OAAF,EAAWjD,QAAX,GAAsBzI,IAA1B,EAAf,EAAiDb,CAAvE,GAA2EA,CAD9E;AAEL6O,eAAQjC,sBAAsB,sBAAUlM,GAAV,EAAe,EAACT,GAAG2O,EAAErC,OAAF,EAAWjD,QAAX,GAAsB3I,GAA1B,EAAf,EAAgDV,CAAtE,GAA0EA;AAF7E,MAAP;AAID;;AAED,2BAAc3E,eAAd,GAAgC6H,aAAhC,CAA8CvH,UAA9C,EAA0DQ,YAA1D,EAAwEM,IAAxE,CAA6E,UAACL,UAAD,EAAgB;;AAE3F;AACA,SAAG,CAACiC,MAAD,IAAW,CAACoC,GAAZ,IAAmB,CAACpC,OAAO,CAAP,CAApB,IAAiC,CAACA,OAAO,CAAP,EAAUsB,UAA/C,EAA2D;AACzD;AACD;;AAED,SAAI,CAAC,MAAD,EAAS,WAAT,EAAsB,OAAtB,EAA+B,SAA/B,EAA0C,WAA1C,EAAuDuC,QAAvD,CAAgEqD,IAAhE,CAAJ,EAA2E;AAAA,uBAChD+I,SAAS,GAAT,EAAc,GAAd,CADgD;AAAA,WACnEI,MADmE,aACnEA,MADmE;AAAA,WAC3DE,MAD2D,aAC3DA,MAD2D;;AAEzE,oCAAIvQ,MAAJ,GAAYpC,OAAZ,CAAoB,UAAC4S,CAAD,EAAI1O,CAAJ,EAAU;AAC5B,aAAIyO,WAAW,CAAf,EAAkB;AAChB,eAAIE,SAAShN,SAAS+M,EAAE/O,YAAF,CAAe,GAAf,CAAT,EAA8B,EAA9B,IAAoC8O,MAAjD;AACA,eAAIG,QAAQD,MAAZ;;AAEA,eAAIvJ,SAAS,SAAb,EAAwB;AACtBwJ,sBAAS3S,WAAW2L,IAApB;AACD;;AAED,eAAIxC,SAAS,OAAb,EAAsB;AACpBwJ,qBAAQ,oBAAQtO,GAAR,EAAa,EAAEsO,YAAF,EAAb,EAAwBA,KAAhC;AACD;;AAEDF,aAAEpP,YAAF,CAAe,GAAf,EAAoBsP,KAApB;AACA,eAAI3S,WAAW0J,UAAf,EAA2B;AACzB1J,wBAAW0J,UAAX,CAAsB3F,CAAtB,EAAyBH,CAAzB,GAA6B8O,MAA7B;AACD,YAFD,MAEO,IAAI1S,WAAW4D,CAAf,EAAkB;AACvB5D,wBAAW4D,CAAX,GAAe8O,MAAf;AACD;AACF;AACD,aAAIJ,WAAW,CAAf,EAAkB;AAChB,eAAIM,SAASlN,SAAS+M,EAAE/O,YAAF,CAAe,GAAf,CAAT,EAA8B,EAA9B,IAAoC4O,MAAjD;AACA,eAAIO,QAAQD,MAAZ;;AAEA,eAAIzJ,SAAS,OAAb,EAAsB;AACpB0J,qBAAQ,oBAAQxO,GAAR,EAAa,EAAEwO,YAAF,EAAb,EAAwBA,KAAhC;AACD;;AAEDJ,aAAEpP,YAAF,CAAe,GAAf,EAAoBwP,KAApB;AACA,eAAI7S,WAAW0J,UAAf,EAA2B;AACzB1J,wBAAW0J,UAAX,CAAsB3F,CAAtB,EAAyBJ,CAAzB,GAA6BiP,MAA7B;AACD,YAFD,MAEO,IAAI5S,WAAW2D,CAAf,EAAkB;AACvB3D,wBAAW2D,CAAX,GAAeiP,MAAf;AACD;AACF;;AAED,aAAGN,WAAW,CAAX,IAAgBE,WAAW,CAA9B,EAAiC;AAC/B,mCAAcvT,eAAd,GAAgC0B,cAAhC,CAA+CpB,UAA/C,EAA2DQ,YAA3D,EAAyEC,UAAzE;AACD;AACF,QAvCD;AAwCF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACC,MAxDD,MAwDO,IAAImJ,SAAS,SAAb,EAAwB;AAC7B,WAAIhF,OAAO,sBAAUE,GAAV,EAAe,8BAAkBpC,OAAO,CAAP,CAAlB,CAAf,CAAX;;AAD6B,+CAEJjC,WAAW2K,KAAX,CAAiB,CAAjB,CAFI;AAAA,WAExBmI,OAFwB;AAAA,WAEfC,OAFe;;AAAA,wBAGJV,UAAUS,OAAV,EAAmBC,OAAnB,CAHI;AAAA,WAGvBT,OAHuB,cAGvBA,MAHuB;AAAA,WAGfE,OAHe,cAGfA,MAHe;;AAK7B;AACA;;;AACAA,kBAAWO,UAAU5O,KAAKG,GAA1B;AACAgO,kBAAWQ,UAAU3O,KAAKK,IAA1B;;AAEAxE,kBAAW2K,KAAX,CAAiB9K,OAAjB,CAAyB,UAAC8J,IAAD,EAAO5F,CAAP,EAAa;AAAA,kDACvB/D,WAAW2K,KAAX,CAAiB5G,CAAjB,CADuB;AAAA,aAC/BJ,CAD+B;AAAA,aAC5BC,CAD4B;;AAEpC5D,oBAAW2K,KAAX,CAAiB5G,CAAjB,EAAoB,CAApB,IAAyBJ,IAAI2O,OAA7B;AACAtS,oBAAW2K,KAAX,CAAiB5G,CAAjB,EAAoB,CAApB,IAAyBH,IAAI4O,OAA7B;AACD,QAJD;;AAMAvQ,cAAO,CAAP,EAAUsB,UAAV,CAAqB8C,WAArB,CAAiCpE,OAAO,CAAP,CAAjC;AACA,kCAAYoC,GAAZ,EAAiBrE,UAAjB;;AAEA,WAAGsS,YAAW,CAAX,IAAgBE,YAAW,CAA9B,EAAiC;AAC/B,iCAAcvT,eAAd,GAAgC0B,cAAhC,CAA+CpB,UAA/C,EAA2DQ,YAA3D,EAAyEC,UAAzE;AACD;AACF;AACF,IAtFD;;AAwFAgT,cAAW,YAAM;AACf/C,kBAAa,KAAb;AACD,IAFD,EAEG,CAFH;;AAIAC,WAAQlD,KAAR,CAAcmE,UAAd,GAA2B,EAA3B;AACAjB,WAAQlD,KAAR,CAAc+E,MAAd,GAAuB,EAAvB;;AAEAnQ,YAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACAhQ,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACA;AACD;;AAED;;;;;AAKA,UAASoB,qBAAT,CAA+BhR,MAA/B,EAAuC;AACrCuO,qBAAkBvO,MAAlB;AACD;;AAED;;;;AAIO,UAASiN,UAAT,CAAoBgE,KAApB,EAA2B;AAChClD,cAAWkD,KAAX;AACD;;AAED;;;AAGO,UAASjE,UAAT,GAAuB;AAC5B,OAAIc,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACA,gCAAiB,kBAAjB,EAAqCkD,qBAArC;AACD;;AAED;;;AAGO,UAASjE,WAAT,GAAwB;AAC7B2B;;AAEA,OAAI,CAACZ,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACA,mCAAoB,kBAApB,EAAwCkD,qBAAxC;AACD,G;;;;;;;;;;;SCtRe5D,M,GAAAA,M;SAQAD,S,GAAAA,S;SAYAD,U,GAAAA,U;;AA9IhB;;;;AACA;;;;AACA;;;;AAQA,KAAIY,WAAW,KAAf;AACA,KAAIoD,iBAAJ;AACA,KAAIC,kBAAJ;AACA,KAAIrK,aAAJ;AACA,KAAI4B,cAAJ;;AAEA;;;AAGA,UAAS6G,uBAAT,GAAmC;AACjCzI,UAAO,IAAP;AACA4B,WAAQ,EAAR;;AAEA/I,YAASJ,gBAAT,CAA0B,WAA1B,EAAuCoQ,uBAAvC;AACAhQ,YAASJ,gBAAT,CAA0B,SAA1B,EAAqCqQ,qBAArC;AACD;;AAED;;;;;AAKA,UAASA,qBAAT,CAA+B/P,CAA/B,EAAkC;AAChC,OAAIuC,YAAJ;AACA,OAAIsG,MAAM1G,MAAN,GAAe,CAAf,KAAqBI,MAAM,2BAAevC,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAA3B,CAAJ,EAAsE;AAAA,wBACnC,wBAAYqC,GAAZ,CADmC;AAAA,SAC9D9E,UAD8D,gBAC9DA,UAD8D;AAAA,SAClDC,UADkD,gBAClDA,UADkD;;AAGpE,6BAAcP,eAAd,GAAgCwB,aAAhC,CAA8ClB,UAA9C,EAA0DC,UAA1D,EAAsE;AAClE2J,aAAM,SAD4D;AAElEvD,cAAOuN,QAF2D;AAGlE3J,cAAO4J,SAH2D;AAIlEzI;AAJkE,MAAtE,EAMEtK,IANF,CAMO,UAACL,UAAD,EAAgB;AACrB,WAAI+I,IAAJ,EAAU;AACR1E,aAAIgC,WAAJ,CAAgB0C,IAAhB;AACD;;AAED,kCAAY1E,GAAZ,EAAiBrE,UAAjB;AACD,MAZD;AAaD;;AAED4B,YAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACAhQ,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACD;;AAED;;;;;AAKA,UAASD,uBAAT,CAAiC9P,CAAjC,EAAoC;AAClCuR,aAAUvR,EAAEC,OAAZ,EAAqBD,EAAEE,OAAvB;AACD;;AAED;;;;;AAKA,UAASuP,mBAAT,CAA6BzP,CAA7B,EAAgC;AAC9B;AACA,OAAIA,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AACpBnH,aAAQ,IAAR;AACA5B,UAAKxF,UAAL,CAAgB8C,WAAhB,CAA4B0C,IAA5B;AACAnH,cAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACAhQ,cAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACD;AACF;;AAED;;;;;;AAMA,UAASwB,SAAT,CAAmB1P,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,OAAIS,MAAM,2BAAeV,CAAf,EAAkBC,CAAlB,CAAV;AACA,OAAI,CAACS,GAAL,EAAU;AACR;AACD;;AAED,OAAIF,OAAOE,IAAID,qBAAJ,EAAX;AACA,OAAIkP,QAAQ,sBAAUjP,GAAV,EAAe;AACzBV,QAAGA,IAAIQ,KAAKK,IADa;AAEzBZ,QAAGA,IAAIO,KAAKG;AAFa,IAAf,CAAZ;;AAKAqG,SAAM1D,IAAN,CAAW,CAACqM,MAAM3P,CAAP,EAAU2P,MAAM1P,CAAhB,CAAX;;AAEA,OAAI+G,MAAM1G,MAAN,IAAgB,CAApB,EAAuB;AACrB;AACD;;AAED,OAAI8E,IAAJ,EAAU;AACR1E,SAAIgC,WAAJ,CAAgB0C,IAAhB;AACD;;AAEDA,UAAO,2BAAY1E,GAAZ,EAAiB;AACtB8E,WAAM,SADgB;AAEtBK,YAAO4J,SAFe;AAGtBxN,YAAOuN,QAHe;AAItBxI;AAJsB,IAAjB,CAAP;AAMD;;AAED;;;;;;AAMO,UAAS0E,MAAT,GAAkD;AAAA,OAAlCkE,OAAkC,uEAAxB,CAAwB;AAAA,OAArBC,QAAqB,uEAAV,QAAU;;AACvDL,cAAWzN,SAAS6N,OAAT,EAAkB,EAAlB,CAAX;AACAH,eAAYI,QAAZ;AACD;;AAED;;;AAGO,UAASpE,SAAT,GAAqB;AAC1B,OAAIW,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAnO,YAASJ,gBAAT,CAA0B,WAA1B,EAAuCgQ,uBAAvC;AACA5P,YAASJ,gBAAT,CAA0B,OAA1B,EAAmC+P,mBAAnC;AACA;AACD;;AAED;;;AAGO,UAASpC,UAAT,GAAsB;AAC3B,OAAI,CAACY,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAnO,YAASH,mBAAT,CAA6B,WAA7B,EAA0C+P,uBAA1C;AACA5P,YAASH,mBAAT,CAA6B,OAA7B,EAAsC8P,mBAAtC;AACA;AACD,E;;;;;;;;;;;SCxCehC,W,GAAAA,W;SAUAD,Y,GAAAA,Y;;AAvHhB;;;;AACA;;;;AACA;;;;AAOA,KAAIS,WAAW,KAAf;AACA,KAAI0D,cAAJ;;AAEA;;;;;AAKA,UAAS5B,qBAAT,CAA+B/P,CAA/B,EAAkC;AAChC,OAAI2R,SAAS,CAAC,2BAAe3R,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAd,EAAoD;AAClD;AACD;;AAEDyR,WAAQ7R,SAASkL,aAAT,CAAuB,OAAvB,CAAR;AACA2G,SAAMpQ,YAAN,CAAmB,IAAnB,EAAyB,0BAAzB;AACAoQ,SAAMpQ,YAAN,CAAmB,aAAnB,EAAkC,eAAlC;AACAoQ,SAAMzG,KAAN,CAAYiE,MAAZ;AACAwC,SAAMzG,KAAN,CAAYkE,YAAZ,GAA2B,KAA3B;AACAuC,SAAMzG,KAAN,CAAYC,QAAZ,GAAuB,UAAvB;AACAwG,SAAMzG,KAAN,CAAY1I,GAAZ,GAAqBxC,EAAEE,OAAvB;AACAyR,SAAMzG,KAAN,CAAYxI,IAAZ,GAAsB1C,EAAEC,OAAxB;;AAEA0R,SAAMjS,gBAAN,CAAuB,MAAvB,EAA+BkS,eAA/B;AACAD,SAAMjS,gBAAN,CAAuB,OAAvB,EAAgCmS,gBAAhC;;AAEA/R,YAASwB,IAAT,CAAcgD,WAAd,CAA0BqN,KAA1B;AACAA,SAAMG,KAAN;AACD;;AAED;;;AAGA,UAASF,eAAT,GAA2B;AACzBL;AACD;;AAED;;;;;AAKA,UAASM,gBAAT,CAA0B7R,CAA1B,EAA6B;AAC3B,OAAIA,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AACpB+B;AACD,IAFD,MAEO,IAAI/R,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AAC3BuB;AACD;AACF;;AAED;;;AAGA,UAASA,SAAT,GAAqB;AACnB,OAAII,MAAMP,KAAN,CAAYY,IAAZ,GAAmB7P,MAAnB,GAA4B,CAAhC,EAAmC;AACjC,SAAIlC,UAAU2D,SAAS+N,MAAMzG,KAAN,CAAYxI,IAArB,EAA2B,EAA3B,CAAd;AACA,SAAIxC,UAAU0D,SAAS+N,MAAMzG,KAAN,CAAY1I,GAArB,EAA0B,EAA1B,CAAd;AACA,SAAIrE,UAAUwT,MAAMP,KAAN,CAAYY,IAAZ,EAAd;AACA,SAAIzP,MAAM,2BAAetC,OAAf,EAAwBC,OAAxB,CAAV;AACA,SAAI,CAACqC,GAAL,EAAU;AACR;AACD;;AAED,SAAIF,OAAOE,IAAID,qBAAJ,EAAX;;AATiC,wBAUA,wBAAYC,GAAZ,CAVA;AAAA,SAU3B9E,UAV2B,gBAU3BA,UAV2B;AAAA,SAUfC,UAVe,gBAUfA,UAVe;;AAWjC,SAAIQ,aAAaL,OAAOoU,MAAP,CAAc;AAC3B5K,aAAM;AADqB,MAAd,EAEZ,sBAAU9E,GAAV,EAAe;AAChBV,UAAG5B,UAAUoC,KAAKK,IADF;AAEhBZ,UAAG5B,UAAUmC,KAAKG;AAFF,MAAf,CAFY,CAAjB;;AAQA,6BAAcrF,eAAd,GAAgCwB,aAAhC,CAA8ClB,UAA9C,EAA0DC,UAA1D,EAAsEQ,UAAtE,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,+BAAcf,eAAd,GAAgC+B,UAAhC,CACEzB,UADF,EAEES,WAAWgH,IAFb,EAGE/G,OAHF;;AAMA,kCAAYoE,GAAZ,EAAiBrE,UAAjB;AACD,MATH;AAUD;;AAED6T;AACD;;AAED;;;AAGA,UAASA,UAAT,GAAsB;AACpBJ,SAAMhS,mBAAN,CAA0B,MAA1B,EAAkCiS,eAAlC;AACAD,SAAMhS,mBAAN,CAA0B,OAA1B,EAAmCkS,gBAAnC;AACA/R,YAASwB,IAAT,CAAciD,WAAd,CAA0BoN,KAA1B;AACAA,WAAQ,IAAR;AACD;;AAED;;;AAGO,UAASlE,WAAT,GAAuB;AAC5B,OAAIQ,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAnO,YAASJ,gBAAT,CAA0B,SAA1B,EAAqCqQ,qBAArC;AACD;;AAED;;;AAGO,UAASvC,YAAT,GAAwB;AAC7B,OAAI,CAACS,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAnO,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACD,E;;;;;;;;;;;SC6FepC,U,GAAAA,U;SAcAD,W,GAAAA,W;;AAvOhB;;;;AACA;;;;AACA;;;;;;AAWA,KAAIO,WAAW,KAAf;AACA,KAAIiE,cAAJ;AACA,KAAI9D,gBAAJ;AACA,KAAI6C,gBAAJ;AACA,KAAID,gBAAJ;;AAEA;;;;;AAKA,UAASmB,iBAAT,GAA6B;AAC3B,OAAI;AACF,SAAIC,YAAYC,OAAOC,YAAP,EAAhB;AACA,SAAIC,QAAQH,UAAUI,UAAV,CAAqB,CAArB,CAAZ;AACA,SAAI5H,QAAQ2H,MAAME,cAAN,EAAZ;;AAEA,SAAI7H,MAAMzI,MAAN,GAAe,CAAf,IACAyI,MAAM,CAAN,EAAS9G,KAAT,GAAiB,CADjB,IAEA8G,MAAM,CAAN,EAAS/G,MAAT,GAAkB,CAFtB,EAEyB;AACvB,cAAO+G,KAAP;AACD;AACF,IAVD,CAUE,OAAO5K,CAAP,EAAU,CAAE;;AAEd,UAAO,IAAP;AACD;;AAED;;;;;AAKA,UAAS0P,uBAAT,CAAiC1P,CAAjC,EAAoC;AAClC,OAAIuC,YAAJ;AACA,OAAI2P,UAAU,MAAV,IAAoB,EAAE3P,MAAM,2BAAevC,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAR,CAAxB,EAAuE;AACrE;AACD;;AAED,OAAImC,OAAOE,IAAID,qBAAJ,EAAX;AACA2O,aAAUjR,EAAEE,OAAZ;AACA8Q,aAAUhR,EAAEC,OAAZ;;AAEAmO,aAAUtO,SAASkL,aAAT,CAAuB,KAAvB,CAAV;AACAoD,WAAQlD,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACAiD,WAAQlD,KAAR,CAAc1I,GAAd,GAAuByO,UAAU5O,KAAKG,GAAtC;AACA4L,WAAQlD,KAAR,CAAcxI,IAAd,GAAwBsO,UAAU3O,KAAKK,IAAvC;AACA0L,WAAQlD,KAAR,CAAciE,MAAd;AACAf,WAAQlD,KAAR,CAAckE,YAAd,GAA6B,KAA7B;AACA7M,OAAId,UAAJ,CAAe6C,WAAf,CAA2B8J,OAA3B;;AAEAtO,YAASJ,gBAAT,CAA0B,WAA1B,EAAuCoQ,uBAAvC;AACA;AACD;;AAED;;;;;AAKA,UAASA,uBAAT,CAAiC9P,CAAjC,EAAoC;AAClC,OAAIuC,MAAM6L,QAAQ3M,UAAR,CAAmByF,aAAnB,CAAiC,qBAAjC,CAAV;AACA,OAAI7E,OAAOE,IAAID,qBAAJ,EAAX;;AAEA,OAAI0O,WAAWhR,EAAEC,OAAF,GAAY+Q,OAAvB,IAAkC3O,KAAKM,KAA3C,EAAkD;AAChDyL,aAAQlD,KAAR,CAAcpH,KAAd,GAAyB9D,EAAEC,OAAF,GAAY+Q,OAArC;AACD;;AAED,OAAIC,WAAWjR,EAAEE,OAAF,GAAY+Q,OAAvB,IAAkC5O,KAAKI,MAA3C,EAAmD;AACjD2L,aAAQlD,KAAR,CAAcrH,MAAd,GAA0B7D,EAAEE,OAAF,GAAY+Q,OAAtC;AACD;AACF;;AAED;;;;;AAKA,UAASlB,qBAAT,CAA+B/P,CAA/B,EAAkC;AAChC,OAAI4K,cAAJ;;AAEA;AACA,OAAI,CAAC,2BAAe5K,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAL,EAA2C;AACzC;AACD;;AAED,OAAIgS,UAAU,MAAV,KAAqBtH,QAAQuH,mBAA7B,CAAJ,EAAuD;AACrD,SAAI5P,MAAM,2BAAeqI,MAAM,CAAN,EAASlI,IAAxB,EAA8BkI,MAAM,CAAN,EAASpI,GAAvC,CAAV;AACAkQ,cAASR,KAAT,EAAgB,6BAAItH,KAAJ,GAAWjH,GAAX,CAAe,UAACoC,CAAD,EAAO;AACpC,cAAO;AACLvD,cAAKuD,EAAEvD,GADF;AAELE,eAAMqD,EAAErD,IAFH;AAGLoB,gBAAOiC,EAAEjC,KAHJ;AAILD,iBAAQkC,EAAElC;AAJL,QAAP;AAMD,MAPe,CAAhB;AAQD,IAVD,MAUO,IAAIqO,UAAU,MAAV,IAAoB9D,OAAxB,EAAiC;AACtC,SAAI7L,OAAM6L,QAAQ3M,UAAR,CAAmByF,aAAnB,CAAiC,qBAAjC,CAAV;AACA,SAAI7E,OAAOE,KAAID,qBAAJ,EAAX;AACAoQ,cAASR,KAAT,EAAgB,CAAC;AACf1P,YAAKoB,SAASwK,QAAQlD,KAAR,CAAc1I,GAAvB,EAA4B,EAA5B,IAAkCH,KAAKG,GAD7B;AAEfE,aAAMkB,SAASwK,QAAQlD,KAAR,CAAcxI,IAAvB,EAA6B,EAA7B,IAAmCL,KAAKK,IAF/B;AAGfoB,cAAOF,SAASwK,QAAQlD,KAAR,CAAcpH,KAAvB,EAA8B,EAA9B,CAHQ;AAIfD,eAAQD,SAASwK,QAAQlD,KAAR,CAAcrH,MAAvB,EAA+B,EAA/B;AAJO,MAAD,CAAhB;;AAOAuK,aAAQ3M,UAAR,CAAmB8C,WAAnB,CAA+B6J,OAA/B;AACAA,eAAU,IAAV;;AAEAtO,cAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACA;AACD;AACF;;AAED;;;;;AAKA,UAASL,mBAAT,CAA6BzP,CAA7B,EAAgC;AAC9B;AACA,OAAIA,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AACpB,SAAIoC,YAAYC,OAAOC,YAAP,EAAhB;AACAF,eAAUO,eAAV;AACA,SAAIvE,WAAWA,QAAQ3M,UAAvB,EAAmC;AACjC2M,eAAQ3M,UAAR,CAAmB8C,WAAnB,CAA+B6J,OAA/B;AACAA,iBAAU,IAAV;AACAtO,gBAASH,mBAAT,CAA6B,WAA7B,EAA0CmQ,uBAA1C;AACD;AACF;AACF;;AAED;;;;;;;AAOA,UAAS4C,QAAT,CAAkBrL,IAAlB,EAAwBuD,KAAxB,EAA+BlD,KAA/B,EAAsC;AACpC,OAAInF,MAAM,2BAAeqI,MAAM,CAAN,EAASlI,IAAxB,EAA8BkI,MAAM,CAAN,EAASpI,GAAvC,CAAV;AACA,OAAIhB,aAAJ;AACA,OAAItD,mBAAJ;;AAEA,OAAI,CAACqE,GAAL,EAAU;AACR;AACD;;AAED,OAAIqQ,eAAerQ,IAAID,qBAAJ,EAAnB;;AAEA,OAAI,CAACoF,KAAL,EAAY;AACV,SAAIL,SAAS,WAAb,EAA0B;AACxBK,eAAQ,QAAR;AACD,MAFD,MAEO,IAAIL,SAAS,WAAb,EAA0B;AAC/BK,eAAQ,QAAR;AACD;AACF;;AAED;AACAxJ,gBAAa;AACXmJ,eADW;AAEXK,iBAFW;AAGXE,iBAAY,6BAAIgD,KAAJ,GAAWjH,GAAX,CAAe,UAACoC,CAAD,EAAO;AAChC,WAAI8M,SAAS,CAAb;;AAEA,WAAIxL,SAAS,WAAb,EAA0B;AACxBwL,kBAAS9M,EAAElC,MAAF,GAAW,CAApB;AACD;;AAED,cAAO,sBAAUtB,GAAV,EAAe;AACpBT,YAAIiE,EAAEvD,GAAF,GAAQqQ,MAAT,GAAmBD,aAAapQ,GADf;AAEpBX,YAAGkE,EAAErD,IAAF,GAASkQ,aAAalQ,IAFL;AAGpBoB,gBAAOiC,EAAEjC,KAHW;AAIpBD,iBAAQkC,EAAElC;AAJU,QAAf,CAAP;AAMD,MAbW,EAaTgB,MAbS,CAaF,UAACkB,CAAD;AAAA,cAAOA,EAAEjC,KAAF,GAAU,CAAV,IAAeiC,EAAElC,MAAF,GAAW,CAA1B,IAA+BkC,EAAElE,CAAF,GAAM,CAAC,CAAtC,IAA2CkE,EAAEjE,CAAF,GAAM,CAAC,CAAzD;AAAA,MAbE;AAHD,IAAb;;AAmBA;AACA,OAAI5D,WAAW0J,UAAX,CAAsBzF,MAAtB,KAAiC,CAArC,EAAwC;AACtC;AACD;;AAED;AACA,OAAIkF,SAAS,MAAb,EAAqB;AACnB,SAAIhF,OAAOnE,WAAW0J,UAAX,CAAsB,CAAtB,CAAX;AACA,YAAO1J,WAAW0J,UAAlB;AACA1J,gBAAW2D,CAAX,GAAeQ,KAAKR,CAApB;AACA3D,gBAAW4D,CAAX,GAAeO,KAAKP,CAApB;AACA5D,gBAAW4F,KAAX,GAAmBzB,KAAKyB,KAAxB;AACA5F,gBAAW2F,MAAX,GAAoBxB,KAAKwB,MAAzB;AACD;;AApDmC,sBAsDH,wBAAYtB,GAAZ,CAtDG;AAAA,OAsD9B9E,UAtD8B,gBAsD9BA,UAtD8B;AAAA,OAsDlBC,UAtDkB,gBAsDlBA,UAtDkB;;AAwDpC;;;AACA,2BAAcP,eAAd,GAAgCwB,aAAhC,CAA8ClB,UAA9C,EAA0DC,UAA1D,EAAsEQ,UAAtE,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,gCAAYqE,GAAZ,EAAiBrE,UAAjB;AACD,IAHH;AAID;;AAED;;;AAGO,UAASyP,UAAT,CAAoBtG,IAApB,EAA0B;AAC/B6K,WAAQ7K,IAAR;;AAEA,OAAI4G,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAnO,YAASJ,gBAAT,CAA0B,SAA1B,EAAqCqQ,qBAArC;AACAjQ,YAASJ,gBAAT,CAA0B,WAA1B,EAAuCgQ,uBAAvC;AACA5P,YAASJ,gBAAT,CAA0B,OAA1B,EAAmC+P,mBAAnC;AACD;;AAED;;;AAGO,UAAS/B,WAAT,GAAuB;AAC5B,OAAI,CAACO,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAnO,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACAjQ,YAASH,mBAAT,CAA6B,WAA7B,EAA0C+P,uBAA1C;AACA5P,YAASH,mBAAT,CAA6B,OAA7B,EAAsC8P,mBAAtC;AACD,E;;;;;;;;;;;SC3He3B,O,GAAAA,O;SASAD,U,GAAAA,U;SAWAD,W,GAAAA,W;;AAvIhB;;;;AACA;;;;AACA;;;;AAOA,KAAIK,WAAW,KAAf;AACA,KAAI0D,cAAJ;AACA,KAAImB,kBAAJ;AACA,KAAIC,mBAAJ;;AAEA;;;;;AAKA,UAAShD,qBAAT,CAA+B/P,CAA/B,EAAkC;AAChC,OAAI2R,SAAS,CAAC,2BAAe3R,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAd,EAAoD;AAClD;AACD;;AAEDyR,WAAQ7R,SAASkL,aAAT,CAAuB,OAAvB,CAAR;AACA2G,SAAMpQ,YAAN,CAAmB,IAAnB,EAAyB,yBAAzB;AACAoQ,SAAMpQ,YAAN,CAAmB,aAAnB,EAAkC,YAAlC;AACAoQ,SAAMzG,KAAN,CAAYiE,MAAZ;AACAwC,SAAMzG,KAAN,CAAYkE,YAAZ,GAA2B,KAA3B;AACAuC,SAAMzG,KAAN,CAAYC,QAAZ,GAAuB,UAAvB;AACAwG,SAAMzG,KAAN,CAAY1I,GAAZ,GAAqBxC,EAAEE,OAAvB;AACAyR,SAAMzG,KAAN,CAAYxI,IAAZ,GAAsB1C,EAAEC,OAAxB;AACA0R,SAAMzG,KAAN,CAAYpB,QAAZ,GAA0BgJ,SAA1B;;AAEAnB,SAAMjS,gBAAN,CAAuB,MAAvB,EAA+BkS,eAA/B;AACAD,SAAMjS,gBAAN,CAAuB,OAAvB,EAAgCmS,gBAAhC;;AAEA/R,YAASwB,IAAT,CAAcgD,WAAd,CAA0BqN,KAA1B;AACAA,SAAMG,KAAN;AACD;;AAED;;;AAGA,UAASF,eAAT,GAA2B;AACzBoB;AACD;;AAED;;;;;AAKA,UAASnB,gBAAT,CAA0B7R,CAA1B,EAA6B;AAC3B,OAAIA,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AACpB+B;AACD,IAFD,MAEO,IAAI/R,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AAC3BgD;AACD;AACF;;AAED;;;AAGA,UAASA,QAAT,GAAoB;AAClB,OAAIrB,MAAMP,KAAN,CAAYY,IAAZ,GAAmB7P,MAAnB,GAA4B,CAAhC,EAAmC;AACjC,SAAIlC,UAAU2D,SAAS+N,MAAMzG,KAAN,CAAYxI,IAArB,EAA2B,EAA3B,CAAd;AACA,SAAIxC,UAAU0D,SAAS+N,MAAMzG,KAAN,CAAY1I,GAArB,EAA0B,EAA1B,CAAd;AACA,SAAID,MAAM,2BAAetC,OAAf,EAAwBC,OAAxB,CAAV;AACA,SAAI,CAACqC,GAAL,EAAU;AACR;AACD;;AANgC,wBAQA,wBAAYA,GAAZ,CARA;AAAA,SAQ3B9E,UAR2B,gBAQ3BA,UAR2B;AAAA,SAQfC,UARe,gBAQfA,UARe;;AASjC,SAAI2E,OAAOE,IAAID,qBAAJ,EAAX;AACA,SAAIpE,aAAaL,OAAOoU,MAAP,CAAc;AAC3B5K,aAAM,SADqB;AAE3BwC,aAAMiJ,SAFqB;AAG3BpL,cAAOqL,UAHoB;AAI3B5U,gBAASwT,MAAMP,KAAN,CAAYY,IAAZ;AAJkB,MAAd,EAKZ,sBAAUzP,GAAV,EAAe;AAChBV,UAAG5B,UAAUoC,KAAKK,IADF;AAEhBZ,UAAG5B,UAAWmC,KAAKG,GAFH;AAGhBsB,cAAO6N,MAAMxB,WAHG;AAIhBtM,eAAQ8N,MAAMzB;AAJE,MAAf,CALY,CAAjB;;AAaA,6BAAc/S,eAAd,GAAgCwB,aAAhC,CAA8ClB,UAA9C,EAA0DC,UAA1D,EAAsEQ,UAAtE,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,kCAAYqE,GAAZ,EAAiBrE,UAAjB;AACD,MAHH;AAID;;AAED6T;AACD;;AAED;;;AAGA,UAASA,UAAT,GAAsB;AACpB,OAAIJ,KAAJ,EAAW;AACTA,WAAMhS,mBAAN,CAA0B,MAA1B,EAAkCiS,eAAlC;AACAD,WAAMhS,mBAAN,CAA0B,OAA1B,EAAmCkS,gBAAnC;AACA/R,cAASwB,IAAT,CAAciD,WAAd,CAA0BoN,KAA1B;AACAA,aAAQ,IAAR;AACD;AACF;;AAED;;;;;;AAMO,UAAS7D,OAAT,GAAsD;AAAA,OAArCmF,QAAqC,uEAA1B,EAA0B;AAAA,OAAtBC,SAAsB,uEAAV,QAAU;;AAC3DJ,eAAYlP,SAASqP,QAAT,EAAmB,EAAnB,CAAZ;AACAF,gBAAaG,SAAb;AACD;;AAGD;;;AAGO,UAASrF,UAAT,GAAsB;AAC3B,OAAII,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAnO,YAASJ,gBAAT,CAA0B,SAA1B,EAAqCqQ,qBAArC;AACD;;AAGD;;;AAGO,UAASnC,WAAT,GAAuB;AAC5B,OAAI,CAACK,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAnO,YAASH,mBAAT,CAA6B,SAA7B,EAAwCoQ,qBAAxC;AACD,E;;;;;;;;;;;;;;SCxHehC,U,GAAAA,U;SA0BAC,U,GAAAA,U;;AA9ChB;;;;AACA;;;;;;AAEA;AACA,KAAMmF,sPAAN;;AAUA;;;;;;AAMO,UAASpF,UAAT,CAAoBrQ,UAApB,EAAgC;AACrC,OAAIoO,OAAOhM,SAASkL,aAAT,CAAuB,KAAvB,CAAX;AACAc,QAAKzF,SAAL,GAAiB8M,aAAjB;;AAEA,OAAIrO,OAAOgH,KAAKsH,QAAL,CAAc,CAAd,CAAX;AACA,OAAIC,SAASvO,KAAKoC,aAAL,CAAmB,QAAnB,CAAb;;AAEApC,QAAKvD,YAAL,CAAkB,IAAlB,oBAAwC7D,UAAxC;AACAoH,QAAKvD,YAAL,CAAkB,kBAAlB,EAAsC7D,UAAtC;;AAEA2V,UAAOC,SAAP,GAAmB,IAAnB;AACAD,UAAO9R,YAAP,CAAoB,IAApB,WAAiC7D,UAAjC;;AAEA,UAAOoH,IAAP;AACD;;AAED;;;;;;;;;;AAUO,UAASkJ,UAAT,CAAoBtQ,UAApB,EAAgC6V,aAAhC,EAA+C;AAAA,OAElD9V,UAFkD,GAMhD8V,aANgD,CAElD9V,UAFkD;AAAA,OAGlD+V,WAHkD,GAMhDD,aANgD,CAGlDC,WAHkD;AAAA,OAIlDtP,KAJkD,GAMhDqP,aANgD,CAIlDrP,KAJkD;AAAA,OAKlDuP,MALkD,GAMhDF,aANgD,CAKlDE,MALkD;;AAQpD;;AACA,UAAO/O,QAAQgP,GAAR,CAAY,CACjBF,YAAYG,OAAZ,CAAoBjW,UAApB,CADiB,EAEjB,wBAAcF,cAAd,CAA6BC,UAA7B,EAAyCC,UAAzC,CAFiB,CAAZ,EAGJa,IAHI,CAGC,gBAA4B;AAAA;AAAA,SAA1BqV,OAA0B;AAAA,SAAjBpV,WAAiB;;AAClC,SAAIsG,OAAOhF,SAASyM,cAAT,mBAAwC7O,UAAxC,CAAX;AACA,SAAI6E,MAAMuC,KAAKoC,aAAL,CAAmB,kBAAnB,CAAV;AACA,SAAImM,SAASvO,KAAKoC,aAAL,CAAmB,uBAAnB,CAAb;AACA,SAAI2M,gBAAgBR,OAAOS,UAAP,CAAkB,IAAlB,EAAwB,EAACC,OAAO,KAAR,EAAxB,CAApB;AACA,SAAI9P,WAAW2P,QAAQI,WAAR,CAAoB9P,KAApB,EAA2BuP,MAA3B,CAAf;AACA,SAAI1M,YAAYkN,UAAUvW,UAAV,EAAsBuG,QAAtB,EAAgC4P,aAAhC,CAAhB;;AAEA;AACA,YAAOnP,QAAQgP,GAAR,CAAY,CACjBE,QAAQrW,MAAR,CAAe,EAAEsW,4BAAF,EAAiB5P,kBAAjB,EAA2B8C,oBAA3B,EAAf,CADiB,EAEjB,wBAAcxJ,MAAd,CAAqBgF,GAArB,EAA0B0B,QAA1B,EAAoCzF,WAApC,CAFiB,CAAZ,EAGJD,IAHI,CAGC,YAAM;AACZ;AACA;AACA,cAAOqV,QAAQM,cAAR,CAAuB,EAACC,qBAAqB,IAAtB,EAAvB,EAAoD5V,IAApD,CAAyD,UAAC6V,WAAD,EAAiB;AAC/E,gBAAO,IAAI1P,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC;AACA,eAAI4G,YAAY1G,KAAKoC,aAAL,cAAhB;AACA,eAAImN,mBAAmB,IAAIxX,MAAMyX,uBAAV,EAAvB;AACA,eAAIC,mBAAmBF,iBAAiBG,sBAAjB,CAAwChJ,SAAxC,EAAmD9N,aAAY,CAA/D,EAAkEuG,QAAlE,CAAvB;AACAsQ,4BAAiBE,cAAjB,CAAgCL,WAAhC;AACAG,4BAAiBhX,MAAjB;;AAEA;AACA;AACA2T,sBAAW,YAAM;AACf,iBAAI;AACF,sDAAwB1S,YAAYA,WAApC;AACAmG;AACD,cAHD,CAGE,OAAO3E,CAAP,EAAU;AACV4E,sBAAO5E,CAAP;AACD;AACF,YAPD;AAQD,UAlBM,CAAP;AAmBD,QApBM,CAAP;AAqBD,MA3BM,EA2BJzB,IA3BI,CA2BC,YAAM;AACZ;AACAuG,YAAKvD,YAAL,CAAkB,aAAlB,EAAiC,MAAjC;;AAEA,cAAO,CAACqS,OAAD,EAAUpV,WAAV,CAAP;AACD,MAhCM,CAAP;AAiCD,IA7CM,CAAP;AA8CD;;AAED;;;;;;;;AAQA,UAASyV,SAAT,CAAmBvW,UAAnB,EAA+BuG,QAA/B,EAAyCyQ,OAAzC,EAAkD;AAChD,OAAI5P,OAAOhF,SAASyM,cAAT,mBAAwC7O,UAAxC,CAAX;AACA,OAAI2V,SAASvO,KAAKoC,aAAL,CAAmB,uBAAnB,CAAb;AACA,OAAI3E,MAAMuC,KAAKoC,aAAL,CAAmB,kBAAnB,CAAV;AACA,OAAIyN,UAAU7P,KAAKoC,aAAL,CAAmB,gBAAnB,CAAd;AACA,OAAIsE,YAAY1G,KAAKoC,aAAL,CAAmB,YAAnB,CAAhB;AACA,OAAI0N,cAAcC,eAAeH,OAAf,CAAlB;AACA,OAAI3N,YAAY,CAAC6N,YAAYE,MAAb,GAAsB,IAAtB,GAA6B,CAACF,YAAYG,EAAb,EAAiB,CAAjB,EAAoB,CAApB,EAAuBH,YAAYI,EAAnC,EAAuC,CAAvC,EAA0C,CAA1C,CAA7C;AACA,OAAIC,MAAMC,oBAAoBN,YAAYG,EAAhC,CAAV;AACA,OAAII,MAAMD,oBAAoBN,YAAYI,EAAhC,CAAV;;AAEA;AACAlQ,QAAKoG,KAAL,CAAWkK,UAAX,GAAwB,EAAxB;AACA/B,UAAOvP,KAAP,GAAeuR,cAAcpR,SAASH,KAAT,GAAiB8Q,YAAYG,EAA3C,EAA+CE,IAAI,CAAJ,CAA/C,CAAf;AACA5B,UAAOxP,MAAP,GAAgBwR,cAAcpR,SAASJ,MAAT,GAAkB+Q,YAAYI,EAA5C,EAAgDG,IAAI,CAAJ,CAAhD,CAAhB;AACA9B,UAAOnI,KAAP,CAAapH,KAAb,GAAqBuR,cAAcpR,SAASH,KAAvB,EAA8BmR,IAAI,CAAJ,CAA9B,IAAwC,IAA7D;AACA5B,UAAOnI,KAAP,CAAarH,MAAb,GAAsBwR,cAAcpR,SAASJ,MAAvB,EAA+BoR,IAAI,CAAJ,CAA/B,IAAyC,IAA/D;AACA1S,OAAIhB,YAAJ,CAAiB,OAAjB,EAA0B0C,SAASH,KAAnC;AACAvB,OAAIhB,YAAJ,CAAiB,QAAjB,EAA2B0C,SAASJ,MAApC;AACAtB,OAAI2I,KAAJ,CAAUpH,KAAV,GAAqBG,SAASH,KAA9B;AACAvB,OAAI2I,KAAJ,CAAUrH,MAAV,GAAsBI,SAASJ,MAA/B;AACAiB,QAAKoG,KAAL,CAAWpH,KAAX,GAAsBG,SAASH,KAA/B;AACAgB,QAAKoG,KAAL,CAAWrH,MAAX,GAAuBI,SAASJ,MAAhC;AACA8Q,WAAQzJ,KAAR,CAAcpH,KAAd,GAAyBG,SAASH,KAAlC;AACA6Q,WAAQzJ,KAAR,CAAcrH,MAAd,GAA0BI,SAASJ,MAAnC;AACA2H,aAAUN,KAAV,CAAgBpH,KAAhB,GAA2BG,SAASH,KAApC;AACA0H,aAAUN,KAAV,CAAgBrH,MAAhB,GAA4BI,SAASJ,MAArC;;AAEA,UAAOkD,SAAP;AACD;;AAED;;;;;;;;AAQA;;;;;;;;AAQA,UAASmO,mBAAT,CAA6BrT,CAA7B,EAAgC;AAC9B;AACA,OAAImE,KAAKsP,KAAL,CAAWzT,CAAX,MAAkBA,CAAtB,EAAyB;AACvB,YAAO,CAACA,CAAD,EAAI,CAAJ,CAAP;AACD;;AAED,OAAM0T,OAAO,IAAI1T,CAAjB;AACA,OAAM2T,QAAQ,CAAd;AACA,OAAID,OAAOC,KAAX,EAAkB;AAChB,YAAO,CAAC,CAAD,EAAIA,KAAJ,CAAP;AACD,IAFD,MAEO,IAAIxP,KAAKsP,KAAL,CAAWC,IAAX,MAAqBA,IAAzB,EAA+B;AACpC,YAAO,CAAC,CAAD,EAAIA,IAAJ,CAAP;AACD;;AAED,OAAME,KAAK5T,IAAI,CAAJ,GAAQ0T,IAAR,GAAe1T,CAA1B;;AAEA;AACA,OAAIpD,IAAI,CAAR;AAAA,OAAW2L,IAAI,CAAf;AAAA,OAAkBtE,IAAI,CAAtB;AAAA,OAAyB8C,IAAI,CAA7B;;AAEA;AACA,UAAO,IAAP,EAAa;AACX;AACA,SAAInF,IAAIhF,IAAIqH,CAAZ;AAAA,SAAe4P,IAAItL,IAAIxB,CAAvB;AACA,SAAI8M,IAAIF,KAAR,EAAe;AACb;AACD;AACD,SAAIC,MAAMhS,IAAIiS,CAAd,EAAiB;AACf5P,WAAIrC,CAAJ,CAAOmF,IAAI8M,CAAJ;AACR,MAFD,MAEO;AACLjX,WAAIgF,CAAJ,CAAO2G,IAAIsL,CAAJ;AACR;AACF;;AAED;AACA,OAAID,KAAKhX,IAAI2L,CAAT,GAAatE,IAAI8C,CAAJ,GAAQ6M,EAAzB,EAA6B;AAC3B,YAAOA,OAAO5T,CAAP,GAAW,CAACpD,CAAD,EAAI2L,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAI3L,CAAJ,CAA3B;AACD,IAFD,MAEO;AACL,YAAOgX,OAAO5T,CAAP,GAAW,CAACiE,CAAD,EAAI8C,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAI9C,CAAJ,CAA3B;AACD;AACF;;AAED,UAAS+O,cAAT,CAAwBc,GAAxB,EAA6B;AAC3B,OAAIC,mBAAmBvD,OAAOuD,gBAAP,IAA2B,CAAlD;AACA,OAAIC,oBAAoBF,IAAIG,4BAAJ,IACAH,IAAII,yBADJ,IAEAJ,IAAIK,wBAFJ,IAGAL,IAAIM,uBAHJ,IAIAN,IAAIO,sBAJJ,IAI8B,CAJtD;AAKA,OAAIC,aAAaP,mBAAmBC,iBAApC;AACA,UAAO;AACLd,SAAIoB,UADC;AAELnB,SAAImB,UAFC;AAGLrB,aAAQqB,eAAe;AAHlB,IAAP;AAKD;;AAED,UAASd,aAAT,CAAuBxT,CAAvB,EAA0BuU,GAA1B,EAA+B;AAC7B,OAAIrQ,IAAIlE,IAAIuU,GAAZ;AACA,UAAOrQ,MAAM,CAAN,GAAUlE,CAAV,GAAcmE,KAAKqQ,KAAL,CAAWxU,IAAIkE,CAAJ,GAAQqQ,GAAnB,CAArB;AACD,E;;;;;;;;;;;mBCrMuBrZ,e;AApBxB;AACA,KAAMuZ,SAAS,CACb,EAACC,KAAK,SAAN,EAAiBhX,MAAM,OAAvB,EADa,EAEb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,KAAvB,EAFa,EAGb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,MAAvB,EAHa,EAIb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,QAAvB,EAJa,EAKb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,aAAvB,EALa,EAMb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,QAAvB,EANa,EAOb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,MAAvB,EAPa,EAQb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,YAAvB,EARa,EASb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,MAAvB,EATa,EAUb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,MAAvB,EAVa,EAWb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,OAAvB,EAXa,EAYb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,aAAvB,EAZa,EAab,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,QAAvB,EAba,EAcb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,QAAvB,EAda,EAeb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,aAAvB,EAfa,EAgBb,EAACgX,KAAK,SAAN,EAAiBhX,MAAM,YAAvB,EAhBa,CAAf;;AAmBe,UAASxC,eAAT,CAAyBqF,EAAzB,EAA6BgP,KAA7B,EAAoCoF,QAApC,EAA8C;AAC3D,YAASC,QAAT,CAAkBrF,KAAlB,EAA8C;AAAA,SAArBsF,YAAqB,uEAAN,IAAM;;AAC5CC,oBAAevF,KAAf;AACA3S,OAAE8C,YAAF,CAAe,YAAf,EAA6B6P,KAA7B;AACA3S,OAAEyM,KAAF,CAAQmE,UAAR,GAAqB+B,KAArB;AACA,SAAIsF,gBAAgB,OAAOF,QAAP,KAAoB,UAAxC,EAAoD;AAClDA,gBAASpF,KAAT;AACD;AACDwF;AACD;;AAED,YAASC,YAAT,GAAwB;AACtB,SAAIC,YAAJ,EAAkB;AAChBF;AACD,MAFD,MAEO;AACLG;AACD;AACF;;AAED,YAASH,WAAT,GAAuB;AACrB9W,cAASH,mBAAT,CAA6B,OAA7B,EAAsC8P,mBAAtC;AACA,SAAIuH,UAAUA,OAAOvV,UAArB,EAAiC;AAC/BuV,cAAOvV,UAAP,CAAkB8C,WAAlB,CAA8ByS,MAA9B;AACD;AACDF,oBAAe,KAAf;AACArY,OAAEqT,KAAF;AACD;;AAED,YAASiF,UAAT,GAAsB;AACpB,SAAI,CAACC,MAAL,EAAa;AACXA,gBAASlX,SAASkL,aAAT,CAAuB,KAAvB,CAAT;AACAgM,cAAO9L,KAAP,CAAamE,UAAb,GAA0B,MAA1B;AACA2H,cAAO9L,KAAP,CAAaiE,MAAb,GAAsB,gBAAtB;AACA6H,cAAO9L,KAAP,CAAaoE,OAAb,GAAuB,KAAvB;AACA0H,cAAO9L,KAAP,CAAaC,QAAb,GAAwB,UAAxB;AACA6L,cAAO9L,KAAP,CAAapH,KAAb,GAAqB,OAArB;AACA1B,UAAG8I,KAAH,CAASC,QAAT,GAAoB,UAApB;;AAEAmL,cAAO3S,GAAP,CAAWsT,iBAAX,EAA8BlZ,OAA9B,CAAsC,UAAC+H,CAAD,EAAO;AAC3CA,WAAEoF,KAAF,CAAQgM,MAAR,GAAiB,KAAjB;AACApR,WAAEqR,OAAF,GAAY,YAAY;AAAEV,oBAAS3Q,EAAElE,YAAF,CAAe,YAAf,CAAT;AAAyC,UAAnE;AACAoV,gBAAO1S,WAAP,CAAmBwB,CAAnB;AACD,QAJD;AAKD;;AAEDhG,cAASJ,gBAAT,CAA0B,OAA1B,EAAmC+P,mBAAnC;AACArN,QAAGkC,WAAH,CAAe0S,MAAf;AACAF,oBAAe,IAAf;AACD;;AAED,YAASG,iBAAT,CAA2BvP,KAA3B,EAAkC;AAChC,SAAI1H,IAAIF,SAASkL,aAAT,CAAuB,GAAvB,CAAR;AACAhL,OAAEoX,SAAF,GAAc,OAAd;AACApX,OAAEuB,YAAF,CAAe,MAAf,EAAuB,eAAvB;AACAvB,OAAEuB,YAAF,CAAe,OAAf,EAAwBmG,MAAMnI,IAA9B;AACAS,OAAEuB,YAAF,CAAe,YAAf,EAA6BmG,MAAM6O,GAAnC;AACAvW,OAAEkL,KAAF,CAAQmE,UAAR,GAAqB3H,MAAM6O,GAA3B;AACA,YAAOvW,CAAP;AACD;;AAED,YAASyP,mBAAT,CAA6BzP,CAA7B,EAAgC;AAC9B,SAAIA,EAAEgQ,OAAF,KAAc,EAAlB,EAAsB;AACpB4G;AACD;AACF;;AAED,OAAII,eAAJ;AACA,OAAIF,eAAe,KAAnB;AACA,OAAIH,qBAAJ;AACA,OAAIlY,IAAIwY,kBAAkB,EAACV,KAAKnF,KAAN,EAAlB,CAAR;AACA3S,KAAE0Y,OAAF,GAAYN,YAAZ;AACAzU,MAAGkC,WAAH,CAAe7F,CAAf;AACAgY,YAASrF,KAAT,EAAgB,KAAhB;AACD;;;;;;;;;;;AC7FD;;;;;;;;;;;;;;AAcA;AACA;;;;AAIA;AACA,KAAI,OAAOvU,KAAP,KAAiB,WAArB,EAAkC;AAChC,IAAC,OAAOwV,MAAP,KAAkB,WAAlB,GAAgCA,MAAhC,YAAD,EAAgDxV,KAAhD,GAAwD,EAAxD;AACD;;AAED,EAAC,SAASwa,gBAAT,GAA4B;AAC3B;;AAGF,OAAIC,YAAY,OAAO,IAAvB;AACA,OAAIC,sBAAsB,MAA1B;AACA,OAAIC,gBAAgB,GAApB;AACA,OAAIC,gBAAgB,CAApB;AACA,OAAIC,iBAAiB,IAArB;AACA,OAAIC,oBAAoB,EAAxB;AACA,OAAIC,mBAAmB,CAAvB;;AAEA,YAASC,WAAT,CAAqBC,GAArB,EAA0B;AACxB,SAAIhJ,SAASgJ,IAAIxP,OAAJ,CAAY,GAAZ,CAAb;AACA,SAAIyP,QAAQD,IAAIxP,OAAJ,CAAY,GAAZ,CAAZ;AACA,SAAI0P,MAAMhS,KAAKiS,GAAL,CACRnJ,SAAS,CAAT,GAAaA,MAAb,GAAsBgJ,IAAI3V,MADlB,EAER4V,QAAQ,CAAR,GAAYA,KAAZ,GAAoBD,IAAI3V,MAFhB,CAAV;AAGA,YAAO2V,IAAII,SAAJ,CAAcJ,IAAIK,WAAJ,CAAgB,GAAhB,EAAqBH,GAArB,IAA4B,CAA1C,EAA6CA,GAA7C,CAAP;AACD;;AAED;;;;;;AAMA,YAASnD,cAAT,CAAwBc,GAAxB,EAA6B;AAC3B,SAAIC,mBAAmBvD,OAAOuD,gBAAP,IAA2B,CAAlD;AACA,SAAIC,oBAAoBF,IAAIG,4BAAJ,IACAH,IAAII,yBADJ,IAEAJ,IAAIK,wBAFJ,IAGAL,IAAIM,uBAHJ,IAIAN,IAAIO,sBAJJ,IAI8B,CAJtD;AAKA,SAAIC,aAAaP,mBAAmBC,iBAApC;AACA,YAAO;AACLd,WAAIoB,UADC;AAELnB,WAAImB,UAFC;AAGLrB,eAAQqB,eAAe;AAHlB,MAAP;AAKD;;AAED;;;;;;;;AAQA,YAASiC,cAAT,CAAwBC,OAAxB,EAAiCC,IAAjC,EAAuCC,0BAAvC,EAAmE;AACjE;AACA;AACA;AACA,SAAIC,SAASH,QAAQI,YAArB;AACA,SAAI,CAACD,MAAL,EAAa;AACXE,eAAQC,KAAR,CAAc,0CAAd;AACA;AACD;AACD,SAAIC,gBAAgBL,8BAA8B,KAAlD;AACA,SAAIM,UAAUR,QAAQxV,SAAR,GAAoBwV,QAAQS,SAA1C;AACA,SAAIC,UAAUV,QAAQzV,UAAR,GAAqByV,QAAQW,UAA3C;AACA,YAAOR,OAAOS,YAAP,KAAwBT,OAAOU,YAA/B,IACCN,iBAAiBO,iBAAiBX,MAAjB,EAAyBpN,QAAzB,KAAsC,QAD/D,EAC0E;AACxE,WAAIoN,OAAOY,OAAP,CAAeC,OAAnB,EAA4B;AAC1BR,oBAAWL,OAAOY,OAAP,CAAeC,OAA1B;AACAN,oBAAWP,OAAOY,OAAP,CAAeE,OAA1B;AACD;AACDT,kBAAWL,OAAO3V,SAAlB;AACAkW,kBAAWP,OAAO5V,UAAlB;AACA4V,gBAASA,OAAOC,YAAhB;AACA,WAAI,CAACD,MAAL,EAAa;AACX,gBADW,CACH;AACT;AACF;AACD,SAAIF,IAAJ,EAAU;AACR,WAAIA,KAAK9V,GAAL,KAAa+W,SAAjB,EAA4B;AAC1BV,oBAAWP,KAAK9V,GAAhB;AACD;AACD,WAAI8V,KAAK5V,IAAL,KAAc6W,SAAlB,EAA6B;AAC3BR,oBAAWT,KAAK5V,IAAhB;AACA8V,gBAAOpU,UAAP,GAAoB2U,OAApB;AACD;AACF;AACDP,YAAOrU,SAAP,GAAmB0U,OAAnB;AACD;;AAED;;;;AAIA,YAASW,WAAT,CAAqBC,eAArB,EAAsCC,QAAtC,EAAgD;AAC9C,SAAIC,iBAAiB,SAASA,cAAT,CAAwBC,GAAxB,EAA6B;AAChD,WAAIC,GAAJ,EAAS;AACP;AACD;AACD;AACAA,aAAMxH,OAAOyH,qBAAP,CAA6B,SAASC,uBAAT,GAAmC;AACpEF,eAAM,IAAN;;AAEA,aAAIG,WAAWP,gBAAgBtV,SAA/B;AACA,aAAI8V,QAAQC,MAAMD,KAAlB;AACA,aAAID,aAAaC,KAAjB,EAAwB;AACtBC,iBAAMC,IAAN,GAAaH,WAAWC,KAAxB;AACD;AACDC,eAAMD,KAAN,GAAcD,QAAd;AACAN,kBAASQ,KAAT;AACD,QAVK,CAAN;AAWD,MAhBD;;AAkBA,SAAIA,QAAQ;AACVC,aAAM,IADI;AAEVF,cAAOR,gBAAgBtV,SAFb;AAGViW,sBAAeT;AAHL,MAAZ;;AAMA,SAAIE,MAAM,IAAV;AACAJ,qBAAgB/Z,gBAAhB,CAAiC,QAAjC,EAA2Cia,cAA3C,EAA2D,IAA3D;AACA,YAAOO,KAAP;AACD;;AAED;;;AAGA,YAASG,gBAAT,CAA0BtC,KAA1B,EAAiC;AAC/B,SAAIuC,QAAQvC,MAAMxU,KAAN,CAAY,GAAZ,CAAZ;AACA,SAAIgX,SAAS,EAAb;AACA,UAAK,IAAItY,IAAI,CAAR,EAAWuY,KAAKF,MAAMnY,MAA3B,EAAmCF,IAAIuY,EAAvC,EAA2C,EAAEvY,CAA7C,EAAgD;AAC9C,WAAIwY,QAAQH,MAAMrY,CAAN,EAASsB,KAAT,CAAe,GAAf,CAAZ;AACA,WAAIvF,MAAMyc,MAAM,CAAN,EAASxX,WAAT,EAAV;AACA,WAAImO,QAAQqJ,MAAMtY,MAAN,GAAe,CAAf,GAAmBsY,MAAM,CAAN,CAAnB,GAA8B,IAA1C;AACAF,cAAOG,mBAAmB1c,GAAnB,CAAP,IAAkC0c,mBAAmBtJ,KAAnB,CAAlC;AACD;AACD,YAAOmJ,MAAP;AACD;;AAED;;;;;;;;;AASA,YAASI,qBAAT,CAA+BC,KAA/B,EAAsCC,SAAtC,EAAiD;AAC/C,SAAIC,WAAW,CAAf;AACA,SAAIC,WAAWH,MAAMzY,MAAN,GAAe,CAA9B;;AAEA,SAAIyY,MAAMzY,MAAN,KAAiB,CAAjB,IAAsB,CAAC0Y,UAAUD,MAAMG,QAAN,CAAV,CAA3B,EAAuD;AACrD,cAAOH,MAAMzY,MAAb;AACD;AACD,SAAI0Y,UAAUD,MAAME,QAAN,CAAV,CAAJ,EAAgC;AAC9B,cAAOA,QAAP;AACD;;AAED,YAAOA,WAAWC,QAAlB,EAA4B;AAC1B,WAAIC,eAAgBF,WAAWC,QAAZ,IAAyB,CAA5C;AACA,WAAIE,cAAcL,MAAMI,YAAN,CAAlB;AACA,WAAIH,UAAUI,WAAV,CAAJ,EAA4B;AAC1BF,oBAAWC,YAAX;AACD,QAFD,MAEO;AACLF,oBAAWE,eAAe,CAA1B;AACD;AACF;AACD,YAAOF,QAAP,CApB+C,CAoB9B;AAClB;;AAED;;;;;;;AAOA,YAAS5F,mBAAT,CAA6BrT,CAA7B,EAAgC;AAC9B;AACA,SAAImE,KAAKsP,KAAL,CAAWzT,CAAX,MAAkBA,CAAtB,EAAyB;AACvB,cAAO,CAACA,CAAD,EAAI,CAAJ,CAAP;AACD;AACD,SAAI0T,OAAO,IAAI1T,CAAf;AACA,SAAI2T,QAAQ,CAAZ;AACA,SAAID,OAAOC,KAAX,EAAkB;AAChB,cAAO,CAAC,CAAD,EAAIA,KAAJ,CAAP;AACD,MAFD,MAEQ,IAAIxP,KAAKsP,KAAL,CAAWC,IAAX,MAAqBA,IAAzB,EAA+B;AACrC,cAAO,CAAC,CAAD,EAAIA,IAAJ,CAAP;AACD;;AAED,SAAIE,KAAK5T,IAAI,CAAJ,GAAQ0T,IAAR,GAAe1T,CAAxB;AACA;AACA,SAAIpD,IAAI,CAAR;AAAA,SAAW2L,IAAI,CAAf;AAAA,SAAkBtE,IAAI,CAAtB;AAAA,SAAyB8C,IAAI,CAA7B;AACA;AACA,YAAO,IAAP,EAAa;AACX;AACA,WAAInF,IAAIhF,IAAIqH,CAAZ;AAAA,WAAe4P,IAAItL,IAAIxB,CAAvB;AACA,WAAI8M,IAAIF,KAAR,EAAe;AACb;AACD;AACD,WAAIC,MAAMhS,IAAIiS,CAAd,EAAiB;AACf5P,aAAIrC,CAAJ,CAAOmF,IAAI8M,CAAJ;AACR,QAFD,MAEO;AACLjX,aAAIgF,CAAJ,CAAO2G,IAAIsL,CAAJ;AACR;AACF;AACD;AACA,SAAID,KAAKhX,IAAI2L,CAAT,GAAatE,IAAI8C,CAAJ,GAAQ6M,EAAzB,EAA6B;AAC3B,cAAOA,OAAO5T,CAAP,GAAW,CAACpD,CAAD,EAAI2L,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAI3L,CAAJ,CAA3B;AACD,MAFD,MAEO;AACL,cAAOgX,OAAO5T,CAAP,GAAW,CAACiE,CAAD,EAAI8C,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAI9C,CAAJ,CAA3B;AACD;AACF;;AAED,YAASuP,aAAT,CAAuBxT,CAAvB,EAA0BuU,GAA1B,EAA+B;AAC7B,SAAIrQ,IAAIlE,IAAIuU,GAAZ;AACA,YAAOrQ,MAAM,CAAN,GAAUlE,CAAV,GAAcmE,KAAKqQ,KAAL,CAAWxU,IAAIkE,CAAJ,GAAQqQ,GAAnB,CAArB;AACD;;AAED;;;AAGA,YAAS8E,kBAAT,CAA4BC,QAA5B,EAAsCC,KAAtC,EAA6CC,gBAA7C,EAA+D;AAC7D,SAAI7Y,MAAM2Y,SAAShX,SAAnB;AAAA,SAA8B1B,SAASD,MAAM2Y,SAASlC,YAAtD;AACA,SAAIvW,OAAOyY,SAAS/W,UAApB;AAAA,SAAgCzB,QAAQD,OAAOyY,SAASG,WAAxD;;AAEA,cAASC,2BAAT,CAAqCC,IAArC,EAA2C;AACzC,WAAInD,UAAUmD,KAAKpF,GAAnB;AACA,WAAIqF,gBACFpD,QAAQxV,SAAR,GAAoBwV,QAAQS,SAA5B,GAAwCT,QAAQY,YADlD;AAEA,cAAOwC,gBAAgBjZ,GAAvB;AACD;;AAED,SAAIkZ,UAAU,EAAd;AAAA,SAAkBF,IAAlB;AAAA,SAAwBnD,OAAxB;AACA,SAAIsD,aAAJ,EAAmBC,UAAnB,EAA+BC,YAA/B,EAA6CC,aAA7C;AACA,SAAIC,YAAJ,EAAkBC,SAAlB;AACA,SAAIC,yBAA0Bb,MAAMjZ,MAAN,KAAiB,CAAlB,GAAuB,CAAvB,GAC3BwY,sBAAsBS,KAAtB,EAA6BG,2BAA7B,CADF;;AAGA,UAAK,IAAItZ,IAAIga,sBAAR,EAAgCzB,KAAKY,MAAMjZ,MAAhD,EAAwDF,IAAIuY,EAA5D,EAAgEvY,GAAhE,EAAqE;AACnEuZ,cAAOJ,MAAMnZ,CAAN,CAAP;AACAoW,iBAAUmD,KAAKpF,GAAf;AACAuF,uBAAgBtD,QAAQxV,SAAR,GAAoBwV,QAAQS,SAA5C;AACA8C,oBAAavD,QAAQY,YAArB;;AAEA,WAAI0C,gBAAgBlZ,MAApB,EAA4B;AAC1B;AACD;;AAEDsZ,sBAAe1D,QAAQzV,UAAR,GAAqByV,QAAQW,UAA5C;AACAgD,mBAAY3D,QAAQiD,WAApB;AACA,WAAIS,eAAeC,SAAf,GAA2BtZ,IAA3B,IAAmCqZ,eAAepZ,KAAtD,EAA6D;AAC3D;AACD;AACDkZ,sBAAe7V,KAAK4F,GAAL,CAAS,CAAT,EAAYpJ,MAAMmZ,aAAlB,IACb3V,KAAK4F,GAAL,CAAS,CAAT,EAAY+P,gBAAgBC,UAAhB,GAA6BnZ,MAAzC,CADF;AAEAqZ,uBAAiB,CAACF,aAAaC,YAAd,IAA8B,GAA9B,GAAoCD,UAArC,GAAmD,CAAnE;;AAEAF,eAAQvW,IAAR,CAAa;AACX4J,aAAIyM,KAAKzM,EADE;AAEXlN,YAAGka,YAFQ;AAGXja,YAAG6Z,aAHQ;AAIXH,eAAMA,IAJK;AAKXU,kBAASJ;AALE,QAAb;AAOD;;AAED,SAAIjR,QAAQ6Q,QAAQ,CAAR,CAAZ;AACA,SAAI5Q,OAAO4Q,QAAQA,QAAQvZ,MAAR,GAAiB,CAAzB,CAAX;;AAEA,SAAIkZ,gBAAJ,EAAsB;AACpBK,eAAQxR,IAAR,CAAa,UAASzL,CAAT,EAAY2L,CAAZ,EAAe;AAC1B,aAAI+R,KAAK1d,EAAEyd,OAAF,GAAY9R,EAAE8R,OAAvB;AACA,aAAIlW,KAAKoW,GAAL,CAASD,EAAT,IAAe,KAAnB,EAA0B;AACxB,kBAAO,CAACA,EAAR;AACD;AACD,gBAAO1d,EAAEsQ,EAAF,GAAO3E,EAAE2E,EAAhB,CAL0B,CAKN;AACrB,QAND;AAOD;AACD,YAAO,EAAClE,OAAOA,KAAR,EAAeC,MAAMA,IAArB,EAA2BsQ,OAAOM,OAAlC,EAAP;AACD;;AAED;;;AAGA,YAASW,oBAAT,CAA8Brc,CAA9B,EAAiC;AAC/BA,OAAEsc,cAAF;AACD;;AAED;;;;;AAKA,YAASC,qBAAT,CAA+BzE,GAA/B,EAAoC;AAClC,SAAI0E,QAAQ,oDAAZ;AACA;AACA;AACA,SAAIC,aAAa,gCAAjB;AACA,SAAIC,WAAWF,MAAMG,IAAN,CAAW7E,GAAX,CAAf;AACA,SAAI8E,oBAAoBH,WAAWE,IAAX,CAAgBD,SAAS,CAAT,CAAhB,KACCD,WAAWE,IAAX,CAAgBD,SAAS,CAAT,CAAhB,CADD,IAECD,WAAWE,IAAX,CAAgBD,SAAS,CAAT,CAAhB,CAFzB;AAGA,SAAIE,iBAAJ,EAAuB;AACrBA,2BAAoBA,kBAAkB,CAAlB,CAApB;AACA,WAAIA,kBAAkBtU,OAAlB,CAA0B,GAA1B,MAAmC,CAAC,CAAxC,EAA2C;AACzC;AACA,aAAI;AACFsU,+BACEH,WAAWE,IAAX,CAAgBjC,mBAAmBkC,iBAAnB,CAAhB,EAAuD,CAAvD,CADF;AAED,UAHD,CAGE,OAAM5c,CAAN,EAAS,CAAE;AACX;AACA;AACD;AACF;AACF;AACD,YAAO4c,qBAAqB,cAA5B;AACD;;AAED,OAAIC,cAAe,SAASC,kBAAT,GAA8B;;AAE/C,cAASC,KAAT,CAAe7W,CAAf,EAAkB+R,GAAlB,EAAuBrM,GAAvB,EAA4B;AAC1B,cAAO5F,KAAKiS,GAAL,CAASjS,KAAK4F,GAAL,CAAS1F,CAAT,EAAY+R,GAAZ,CAAT,EAA2BrM,GAA3B,CAAP;AACD;;AAED,cAASiR,WAAT,CAAqB9N,EAArB,EAAyBiO,IAAzB,EAA+B;AAC7B,YAAKtB,OAAL,GAAe,IAAf;;AAEA;AACA,YAAKtF,GAAL,GAAWtW,SAASoH,aAAT,CAAuB6H,KAAK,YAA5B,CAAX;;AAEA;AACA,YAAKkO,GAAL,GAAW,KAAK7G,GAAL,CAAS3U,UAApB;;AAEA;AACA,YAAKoC,MAAL,GAAcmZ,KAAKnZ,MAAL,IAAe,GAA7B;AACA,YAAKC,KAAL,GAAakZ,KAAKlZ,KAAL,IAAc,GAA3B;AACA,YAAKoZ,KAAL,GAAaF,KAAKE,KAAL,IAAc,GAA3B;;AAEA;AACA,YAAK9G,GAAL,CAASlL,KAAT,CAAerH,MAAf,GAAwB,KAAKA,MAAL,GAAc,KAAKqZ,KAA3C;AACA,YAAKhB,OAAL,GAAe,CAAf;AACD;;AAEDW,iBAAYM,SAAZ,GAAwB;;AAEtBC,kBAAW,SAASC,qBAAT,GAAiC;AAC1C,aAAI,KAAKC,cAAT,EAAyB;AACvB,gBAAKlH,GAAL,CAASmH,SAAT,CAAmBC,GAAnB,CAAuB,eAAvB;AACA,gBAAKpH,GAAL,CAASlL,KAAT,CAAepH,KAAf,GAAuB,KAAKA,KAAL,GAAa,KAAKoZ,KAAzC;AACA;AACD;;AAED,cAAK9G,GAAL,CAASmH,SAAT,CAAmBE,MAAnB,CAA0B,eAA1B;AACA,aAAIC,eAAe,KAAK5Z,KAAL,GAAa,KAAK6Z,QAAlB,GAA6B,GAAhD;AACA,cAAKvH,GAAL,CAASlL,KAAT,CAAepH,KAAf,GAAuB4Z,eAAe,KAAKR,KAA3C;AACD,QAZqB;;AActB,WAAIhB,OAAJ,GAAc;AACZ,gBAAO,KAAKyB,QAAZ;AACD,QAhBqB;;AAkBtB,WAAIzB,OAAJ,CAAY0B,GAAZ,EAAiB;AACf,cAAKN,cAAL,GAAsBO,MAAMD,GAAN,CAAtB;AACA,cAAKD,QAAL,GAAgBZ,MAAMa,GAAN,EAAW,CAAX,EAAc,GAAd,CAAhB;AACA,cAAKR,SAAL;AACD,QAtBqB;;AAwBtBU,iBAAU,SAASC,oBAAT,CAA8BC,MAA9B,EAAsC;AAC9C,aAAIA,MAAJ,EAAY;AACV,eAAIC,YAAYD,OAAOvc,UAAvB;AACA,eAAIyc,iBAAiBD,UAAU9N,WAAV,GAAwB6N,OAAO7N,WAApD;AACA,eAAI+N,iBAAiB,CAArB,EAAwB;AACtB,kBAAKjB,GAAL,CAAS1b,YAAT,CAAsB,OAAtB,EAA+B,wBACA2c,cADA,GACiB,MADhD;AAED;AACF;AACF,QAjCqB;;AAmCtBC,aAAM,SAASC,gBAAT,GAA4B;AAChC,aAAI,CAAC,KAAK1C,OAAV,EAAmB;AACjB;AACD;AACD,cAAKA,OAAL,GAAe,KAAf;AACA,cAAKuB,GAAL,CAASM,SAAT,CAAmBC,GAAnB,CAAuB,QAAvB;AACA1d,kBAASwB,IAAT,CAAcic,SAAd,CAAwBE,MAAxB,CAA+B,mBAA/B;AACD,QA1CqB;;AA4CtBY,aAAM,SAASC,gBAAT,GAA4B;AAChC,aAAI,KAAK5C,OAAT,EAAkB;AAChB;AACD;AACD,cAAKA,OAAL,GAAe,IAAf;AACA5b,kBAASwB,IAAT,CAAcic,SAAd,CAAwBC,GAAxB,CAA4B,mBAA5B;AACA,cAAKP,GAAL,CAASM,SAAT,CAAmBE,MAAnB,CAA0B,QAA1B;AACD;AAnDqB,MAAxB;;AAsDA,YAAOZ,WAAP;AACD,IAhFiB,EAAlB;;AAmFA;;;;;;AAMA,OAAI0B,iBAAkB,YAAY;AAChC;;;AAGA,cAASA,cAAT,GAA0B;AACxB,YAAKC,OAAL,GAAe,IAAf;AACA,YAAKhL,WAAL,GAAmB,IAAnB;AACA,YAAKiL,SAAL,GAAiB,IAAjB;AACA,YAAKC,UAAL,GAAkB,IAAlB;;AAEA,YAAKC,cAAL,GAAsB,IAAtB;AACD;;AAEDJ,oBAAepB,SAAf,GAA2B;AACzByB,oBAAa,SAASC,0BAAT,CAAoCrL,WAApC,EAAiDgL,OAAjD,EAA0D;AACrE,cAAKA,OAAL,GAAeA,OAAf;AACA,cAAKhL,WAAL,GAAmBA,WAAnB;AACA,cAAKmL,cAAL,GAAsB9gB,OAAOihB,MAAP,CAAc,IAAd,CAAtB;AACD,QALwB;;AAOzBC,kBAAW,SAASC,wBAAT,CAAkCP,SAAlC,EAA6C;AACtD,cAAKA,SAAL,GAAiBA,SAAjB;AACD,QATwB;;AAWzBQ,mBAAY,SAASC,yBAAT,CAAmCR,UAAnC,EAA+C;AACzD,cAAKA,UAAL,GAAkBA,UAAlB;AACD,QAbwB;;AAezB;;;AAGA,WAAIS,UAAJ,GAAiB;AACf,gBAAO,KAAK3L,WAAL,CAAiB4L,QAAxB;AACD,QApBwB;;AAsBzB;;;AAGA,WAAIta,IAAJ,GAAW;AACT,gBAAO,KAAK2Z,SAAL,CAAeY,iBAAtB;AACD,QA3BwB;;AA6BzB;;;AAGA,WAAIva,IAAJ,CAASsM,KAAT,EAAgB;AACd,cAAKqN,SAAL,CAAeY,iBAAf,GAAmCjO,KAAnC;AACD,QAlCwB;;AAoCzB;;;AAGAkO,mBAAY,SAASC,yBAAT,CAAmCC,IAAnC,EAAyC;AACnD,aAAIC,aAAa,EAAjB;AACA,aAAIC,OAAO,IAAX;;AAEA,aAAIC,kBAAkB,SAAlBA,eAAkB,CAASC,OAAT,EAAkB;AACtC;AACA,eAAIliB,aAAakiB,mBAAmB/hB,MAAnB,GACf6hB,KAAKf,cAAL,CAAoBiB,QAAQjV,GAAR,GAAc,GAAd,GAAoBiV,QAAQC,GAA5B,GAAkC,IAAtD,CADe,GAEdD,UAAU,CAFb;AAGA,eAAIliB,UAAJ,EAAgB;AACd,iBAAIA,aAAagiB,KAAKP,UAAtB,EAAkC;AAChCzhB,4BAAagiB,KAAKP,UAAlB;AACD;AACDO,kBAAKjB,SAAL,CAAeqB,kBAAf,CAAkCpiB,UAAlC,EAA8C8hB,IAA9C;;AAEA,iBAAIE,KAAKhB,UAAT,EAAqB;AACnB;AACAgB,oBAAKhB,UAAL,CAAgBvZ,IAAhB,CAAqB;AACnBqa,uBAAMA,IADa;AAEnBO,uBAAMN,UAFa;AAGnB3a,uBAAMpH;AAHa,gBAArB;AAKD;AACF,YAdD,MAcO;AACLgiB,kBAAKlM,WAAL,CAAiBwM,YAAjB,CAA8BJ,OAA9B,EAAuCrhB,IAAvC,CAA4C,UAAU0hB,SAAV,EAAqB;AAC/D,mBAAIC,UAAUD,YAAY,CAA1B;AACA,mBAAIE,WAAWP,QAAQjV,GAAR,GAAc,GAAd,GAAoBiV,QAAQC,GAA5B,GAAkC,IAAjD;AACAH,oBAAKf,cAAL,CAAoBwB,QAApB,IAAgCD,OAAhC;AACAP,+BAAgBC,OAAhB;AACD,cALD;AAMD;AACF,UA3BD;;AA6BA,aAAIQ,kBAAJ;AACA,aAAI,OAAOZ,IAAP,KAAgB,QAApB,EAA8B;AAC5BC,wBAAaD,IAAb;AACAY,gCAAqB,KAAK5M,WAAL,CAAiB6M,cAAjB,CAAgCb,IAAhC,CAArB;AACD,UAHD,MAGO;AACLY,gCAAqB1b,QAAQC,OAAR,CAAgB6a,IAAhB,CAArB;AACD;AACDY,4BAAmB7hB,IAAnB,CAAwB,UAAS+hB,WAAT,EAAsB;AAC5Cd,kBAAOc,WAAP;AACA,eAAI,EAAEA,uBAAuB/Z,KAAzB,CAAJ,EAAqC;AACnC,oBADmC,CAC3B;AACT;AACDoZ,2BAAgBW,YAAY,CAAZ,CAAhB;AACD,UAND;AAOD,QAtFwB;;AAwFzB;;;;AAIAC,2BAAoB,SAASC,iCAAT,CAA2ChB,IAA3C,EAAiD;AACnE,aAAI,OAAOA,IAAP,KAAgB,QAApB,EAA8B;AAC5B,kBAAO,KAAKiB,YAAL,CAAkB,MAAMC,OAAOlB,IAAP,CAAxB,CAAP;AACD;AACD,aAAIA,gBAAgBjZ,KAApB,EAA2B;AACzB,eAAIqZ,UAAUJ,KAAK,CAAL,CAAd,CADyB,CACF;AACvB,eAAI9hB,aAAakiB,mBAAmB/hB,MAAnB,GACf,KAAK8gB,cAAL,CAAoBiB,QAAQjV,GAAR,GAAc,GAAd,GAAoBiV,QAAQC,GAA5B,GAAkC,IAAtD,CADe,GAEdD,UAAU,CAFb;AAGA,eAAIliB,UAAJ,EAAgB;AACd,iBAAIijB,gBAAgB,KAAKF,YAAL,CAAkB,WAAW/iB,UAA7B,CAApB;AACA,iBAAIkjB,WAAWpB,KAAK,CAAL,CAAf;AACA,iBAAI,QAAOoB,QAAP,yCAAOA,QAAP,OAAoB,QAApB,IAAgC,UAAUA,QAA1C,IACAA,SAASrhB,IAAT,KAAkB,KADtB,EAC6B;AAC3B,mBAAI2E,QAASsb,KAAK,CAAL,KAAW,KAAKf,SAAL,CAAeoC,iBAAvC;AACA,mBAAIC,cAAcC,WAAW7c,KAAX,CAAlB;AACA,mBAAI4c,WAAJ,EAAiB;AACf5c,yBAAQ4c,cAAc,GAAtB;AACD;AACDH,gCAAiB,WAAWzc,KAA5B;AACA,mBAAIsb,KAAK,CAAL,KAAWA,KAAK,CAAL,CAAf,EAAwB;AACtBmB,kCAAiB,OAAOnB,KAAK,CAAL,KAAW,CAAlB,IAAuB,GAAvB,IAA8BA,KAAK,CAAL,KAAW,CAAzC,CAAjB;AACD;AACF;AACD,oBAAOmB,aAAP;AACD;AACF;AACD,gBAAO,KAAKF,YAAL,CAAkB,EAAlB,CAAP;AACD,QAxHwB;;AA0HzB;;;;;;AAMAA,qBAAc,SAASO,2BAAT,CAAqClS,MAArC,EAA6C;AACzD,gBAAO,CAAC,KAAK0P,OAAL,IAAgB,EAAjB,IAAuB1P,MAA9B;AACD,QAlIwB;;AAoIzB;;;AAGAmS,gBAAS,SAASC,sBAAT,CAAgCnB,IAAhC,EAAsC;AAC7C,aAAIA,KAAKzX,OAAL,CAAa,GAAb,KAAqB,CAAzB,EAA4B;AAC1B,eAAIiS,SAASF,iBAAiB0F,IAAjB,CAAb;AACA;AACA,eAAI,eAAexF,MAAnB,EAA2B;AACzB,iBAAI,KAAKmE,UAAT,EAAqB;AACnB,oBAAKA,UAAL,CAAgByC,mBAAhB,CAAoC5G,OAAO6G,SAA3C;AACD;AACD,kBAAK9B,UAAL,CAAgB/E,OAAO6G,SAAvB;AACA;AACD;AACD,eAAI1jB,UAAJ,EAAgB8hB,IAAhB;AACA,eAAI,UAAUjF,MAAd,EAAsB;AACpB7c,0BAAc6c,OAAOzV,IAAP,GAAc,CAAf,IAAqB,CAAlC;AACD;AACD,eAAI,UAAUyV,MAAd,EAAsB;AACpB;AACA,iBAAI8G,WAAW9G,OAAO+G,IAAP,CAAY/d,KAAZ,CAAkB,GAAlB,CAAf,CAFoB,CAEmB;AACvC,iBAAIge,UAAUF,SAAS,CAAT,CAAd;AACA,iBAAIG,gBAAgBT,WAAWQ,OAAX,CAApB;;AAEA,iBAAIA,QAAQjZ,OAAR,CAAgB,KAAhB,MAA2B,CAAC,CAAhC,EAAmC;AACjC;AACA;AACAkX,sBAAO,CAAC,IAAD,EAAO,EAAEjgB,MAAM,KAAR,EAAP,EACC8hB,SAASlf,MAAT,GAAkB,CAAlB,GAAuBkf,SAAS,CAAT,IAAc,CAArC,GAA0C,IAD3C,EAECA,SAASlf,MAAT,GAAkB,CAAlB,GAAuBkf,SAAS,CAAT,IAAc,CAArC,GAA0C,IAF3C,EAGEG,gBAAgBA,gBAAgB,GAAhC,GAAsCD,OAHxC,CAAP;AAID,cAPD,MAOO;AACL,mBAAIA,YAAY,KAAZ,IAAqBA,YAAY,MAArC,EAA6C;AAC3C/B,wBAAO,CAAC,IAAD,EAAO,EAAEjgB,MAAMgiB,OAAR,EAAP,CAAP;AACD,gBAFD,MAEO,IAAKA,YAAY,MAAZ,IAAsBA,YAAY,OAAnC,IACCA,YAAY,MAAZ,IAAsBA,YAAY,OADvC,EACiD;AACtD/B,wBAAO,CAAC,IAAD,EAAO,EAAEjgB,MAAMgiB,OAAR,EAAP,EACCF,SAASlf,MAAT,GAAkB,CAAlB,GAAuBkf,SAAS,CAAT,IAAc,CAArC,GAA0C,IAD3C,CAAP;AAED,gBAJM,MAIA,IAAIE,YAAY,MAAhB,EAAwB;AAC7B,qBAAIF,SAASlf,MAAT,KAAoB,CAAxB,EAA2B;AACzBuW,2BAAQC,KAAR,CAAc,6BACA,qCADd;AAED,kBAHD,MAGO;AACL6G,0BAAO,CAAC,IAAD,EAAO,EAAEjgB,MAAMgiB,OAAR,EAAP,EACEF,SAAS,CAAT,IAAc,CADhB,EACqBA,SAAS,CAAT,IAAc,CADnC,EAEEA,SAAS,CAAT,IAAc,CAFhB,EAEqBA,SAAS,CAAT,IAAc,CAFnC,CAAP;AAGD;AACF,gBATM,MASA;AACL3I,yBAAQC,KAAR,CAAc,+BAA+B4I,OAA/B,GACA,+BADd;AAED;AACF;AACF;AACD,eAAI/B,IAAJ,EAAU;AACR,kBAAKf,SAAL,CAAeqB,kBAAf,CAAkCpiB,cAAc,KAAKoH,IAArD,EAA2D0a,IAA3D;AACD,YAFD,MAEO,IAAI9hB,UAAJ,EAAgB;AACrB,kBAAKoH,IAAL,GAAYpH,UAAZ,CADqB,CACG;AACzB;AACD,eAAI,cAAc6c,MAAlB,EAA0B;AACxB,iBAAIkH,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,mBAAME,eAAN,CAAsB,UAAtB,EAAkC,IAAlC,EAAwC,IAAxC,EAA8C;AAC5CC,qBAAMrH,OAAOsH;AAD+B,cAA9C;AAGA,kBAAKpD,SAAL,CAAeR,SAAf,CAAyB6D,aAAzB,CAAuCL,KAAvC;AACD;AACF,UA7DD,MA6DO,IAAI,QAAQ/a,IAAR,CAAaqZ,IAAb,CAAJ,EAAwB;AAAE;AAC/B,gBAAKjb,IAAL,GAAYib,IAAZ;AACD,UAFM,MAEA;AAAE;AACP,eAAI,KAAKrB,UAAT,EAAqB;AACnB,kBAAKA,UAAL,CAAgByC,mBAAhB,CAAoCY,SAAShC,IAAT,CAApC;AACD;AACD,gBAAKT,UAAL,CAAgByC,SAAShC,IAAT,CAAhB;AACD;AACF,QA7MwB;;AA+MzB;;;AAGAiC,2BAAoB,SAASC,iCAAT,CAA2CC,MAA3C,EAAmD;AACrE;AACA,iBAAQA,MAAR;AACE,gBAAK,QAAL;AACE,iBAAI,KAAKxD,UAAT,EAAqB;AACnB,oBAAKA,UAAL,CAAgByD,IAAhB;AACD;AACD;;AAEF,gBAAK,WAAL;AACE,iBAAI,KAAKzD,UAAT,EAAqB;AACnB,oBAAKA,UAAL,CAAgB0D,OAAhB;AACD;AACD;;AAEF,gBAAK,UAAL;AACE,kBAAKtd,IAAL;AACA;;AAEF,gBAAK,UAAL;AACE,kBAAKA,IAAL;AACA;;AAEF,gBAAK,UAAL;AACE,kBAAKA,IAAL,GAAY,KAAKqa,UAAjB;AACA;;AAEF,gBAAK,WAAL;AACE,kBAAKra,IAAL,GAAY,CAAZ;AACA;;AAEF;AACE,mBA9BJ,CA8BW;AA9BX;;AAiCA,aAAI2c,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,eAAME,eAAN,CAAsB,aAAtB,EAAqC,IAArC,EAA2C,IAA3C,EAAiD;AAC/CO,mBAAQA;AADuC,UAAjD;AAGA,cAAKzD,SAAL,CAAeR,SAAf,CAAyB6D,aAAzB,CAAuCL,KAAvC;AACD,QA1PwB;;AA4PzB;;;;AAIAY,qBAAc,SAASC,2BAAT,CAAqCpC,OAArC,EAA8CqC,OAA9C,EAAuD;AACnE,aAAIC,SAASD,QAAQ5X,GAAR,GAAc,GAAd,GAAoB4X,QAAQ1C,GAA5B,GAAkC,IAA/C;AACA,cAAKlB,cAAL,CAAoB6D,MAApB,IAA8BtC,OAA9B;AACD;AAnQwB,MAA3B;;AAsQA,YAAO3B,cAAP;AACD,IApRoB,EAArB;;AAuRA,OAAIkE,wBAAwB;AAC1BC,cAAS,CADiB;AAE1BC,aAAQ,CAFkB;AAG1BC,eAAU,CAHgB;AAI1BC,iBAAY;AAJc,IAA5B;;AAOA,OAAIC,kCAAkC,KAAtC;AACA,OAAIC,qBAAqB,EAAzB;;AAGA,OAAIC,kBAAkB,KAAtB;;AAEA,OAAIC,kBAAkB;AACpBC,cAAS,CADW;AAEpBC,cAAS,CAFW;AAGpBC,aAAQ,CAHY;AAIpBC,eAAU;AAJU,IAAtB;;AAOA;;;;AAIA,OAAIC,oBAAqB,SAASC,wBAAT,GAAoC;AAC3D;;;AAGA,cAASD,iBAAT,GAA6B;AAC3B,YAAK7E,SAAL,GAAiB,IAAjB;AACA,YAAK+E,kBAAL,GAA0B,IAA1B;AACA,YAAKC,MAAL,GAAc,IAAd;;AAEA,YAAKC,mBAAL,GAA2B,IAA3B;AACA,YAAKC,WAAL,GAAmB,IAAnB;AACA,YAAKC,QAAL,GAAgB,KAAhB;AACA,YAAKC,sBAAL,GAA8B,KAA9B;AACD;;AAEDP,uBAAkBnG,SAAlB,GAA8B,yCAA0C;AACtE;;;AAGA4B,kBAAW,SAAS+E,2BAAT,CAAqCrF,SAArC,EAAgD;AACzD,cAAKA,SAAL,GAAiBA,SAAjB;AACD,QANqE;;AAQtE;;;AAGAsF,2BACI,SAASC,oCAAT,CAA8CR,kBAA9C,EAAkE;AACpE,cAAKA,kBAAL,GAA0BA,kBAA1B;AACD,QAdqE;;AAgBtE;;;;AAIAS,0BAAmB,SAASC,mCAAT,CAA6C1I,IAA7C,EAAmD;AACpE,gBAAO,KAAKkI,mBAAL,KAA6BlI,KAAK2I,WAAzC;AACD,QAtBqE;;AAwBtEC,8BAAuB,SACnBC,uCADmB,CACqBC,qBADrB,EAC4C;AACjE,aAAI,KAAKX,WAAT,EAAsB;AACpBY,wBAAa,KAAKZ,WAAlB;AACA,gBAAKA,WAAL,GAAmB,IAAnB;AACD;;AAED;AACA,aAAI,KAAKlF,SAAL,CAAe+F,cAAf,CAA8BF,qBAA9B,CAAJ,EAA0D;AACxD;AACD;AACD;AACA,aAAI,KAAKd,kBAAL,IAA2B,KAAKK,sBAApC,EAA4D;AAC1D,eAAI,KAAKL,kBAAL,CAAwBgB,cAAxB,EAAJ,EAA8C;AAC5C;AACD;AACF;;AAED,aAAI,KAAKZ,QAAT,EAAmB;AACjB;AACA;AACD;;AAED,aAAI,KAAKH,MAAT,EAAiB;AACf,gBAAKE,WAAL,GAAmBzS,WAAW,KAAKuS,MAAL,CAAYgB,IAAZ,CAAiB,IAAjB,CAAX,EAAmCzB,eAAnC,CAAnB;AACD;AACF,QAlDqE;;AAoDtE0B,2BAAoB,SAChBC,oCADgB,CACqBjJ,OADrB,EAC8BN,KAD9B,EACqCwJ,YADrC,EACmD;AACrE;AACA;AACA;AACA;AACA;AACA;AACA,aAAIC,eAAenJ,QAAQN,KAA3B;;AAEA,aAAI0J,aAAaD,aAAa1iB,MAA9B;AACA,aAAI2iB,eAAe,CAAnB,EAAsB;AACpB,kBAAO,KAAP;AACD;AACD,cAAK,IAAI7iB,IAAI,CAAb,EAAgBA,IAAI6iB,UAApB,EAAgC,EAAE7iB,CAAlC,EAAqC;AACnC,eAAIuZ,OAAOqJ,aAAa5iB,CAAb,EAAgBuZ,IAA3B;AACA,eAAI,CAAC,KAAKuJ,cAAL,CAAoBvJ,IAApB,CAAL,EAAgC;AAC9B,oBAAOA,IAAP;AACD;AACF;;AAED;AACA,aAAIoJ,YAAJ,EAAkB;AAChB,eAAII,gBAAgBtJ,QAAQ5Q,IAAR,CAAaiE,EAAjC;AACA;AACA,eAAIqM,MAAM4J,aAAN,KACA,CAAC,KAAKD,cAAL,CAAoB3J,MAAM4J,aAAN,CAApB,CADL,EACgD;AAC9C,oBAAO5J,MAAM4J,aAAN,CAAP;AACD;AACF,UAPD,MAOO;AACL,eAAIC,oBAAoBvJ,QAAQ7Q,KAAR,CAAckE,EAAd,GAAmB,CAA3C;AACA,eAAIqM,MAAM6J,iBAAN,KACF,CAAC,KAAKF,cAAL,CAAoB3J,MAAM6J,iBAAN,CAApB,CADH,EACkD;AAChD,oBAAO7J,MAAM6J,iBAAN,CAAP;AACD;AACF;AACD;AACA,gBAAO,IAAP;AACD,QA1FqE;;AA4FtE;;;;AAIAF,uBAAgB,SAASG,gCAAT,CAA0C1J,IAA1C,EAAgD;AAC9D,gBAAOA,KAAK2J,cAAL,KAAwBlC,gBAAgBI,QAA/C;AACD,QAlGqE;;AAoGtE;;;;;;AAMA+B,mBAAY,SAASC,4BAAT,CAAsC7J,IAAtC,EAA4C;AACtD,aAAItB,QAAQsB,KAAK2J,cAAjB;AACA,iBAAQjL,KAAR;AACE,gBAAK+I,gBAAgBI,QAArB;AACE,oBAAO,KAAP;AACF,gBAAKJ,gBAAgBG,MAArB;AACE,kBAAKM,mBAAL,GAA2BlI,KAAK2I,WAAhC;AACA3I,kBAAK8J,MAAL;AACA;AACF,gBAAKrC,gBAAgBE,OAArB;AACE,kBAAKO,mBAAL,GAA2BlI,KAAK2I,WAAhC;AACA;AACF,gBAAKlB,gBAAgBC,OAArB;AACE,kBAAKQ,mBAAL,GAA2BlI,KAAK2I,WAAhC;AACA,iBAAIoB,oBAAoB,YAAY;AAClC,oBAAKnB,qBAAL;AACD,cAFuB,CAEtBK,IAFsB,CAEjB,IAFiB,CAAxB;AAGAjJ,kBAAKgK,IAAL,GAAYjnB,IAAZ,CAAiBgnB,iBAAjB,EAAoCA,iBAApC;AACA;AAhBJ;AAkBA,gBAAO,IAAP;AACD;AA/HqE,MAAxE;;AAkIA,YAAOjC,iBAAP;AACD,IAlJuB,EAAxB;;AAqJA,OAAImC,0BAA0B,GAA9B,CA11B6B,CA01BM;;AAEnC;;;;;;;;;;;AAWA;;;;AAIA,OAAIC,cAAe,SAASC,kBAAT,GAA8B;AAC/C;;;;AAIA,cAASD,WAAT,CAAqBE,OAArB,EAA8B;AAC5B,WAAI3H,YAAY2H,QAAQ3H,SAAxB;AACA,WAAIlP,KAAK6W,QAAQ7W,EAAjB;AACA,WAAI7K,QAAQ0hB,QAAQ1hB,KAApB;AACA,WAAI2hB,kBAAkBD,QAAQC,eAA9B;AACA,WAAIC,iBAAiBF,QAAQE,cAA7B;AACA,WAAIzR,mBAAmBuR,QAAQvR,gBAA/B;AACA,WAAI0R,yBAAyBH,QAAQG,sBAArC;;AAEA,YAAKhX,EAAL,GAAUA,EAAV;AACA,YAAKoV,WAAL,GAAmB,SAASpV,EAA5B;;AAEA,YAAKjI,QAAL,GAAgB,CAAhB;AACA,YAAK5C,KAAL,GAAaA,SAASsT,aAAtB;AACA,YAAKvT,QAAL,GAAgB4hB,eAAhB;AACA,YAAKG,aAAL,GAAqBH,gBAAgB/e,QAArC;AACA,YAAKmf,oBAAL,GAA4B,KAA5B;;AAEA,YAAKH,cAAL,GAAsBA,cAAtB;AACA,YAAKzR,gBAAL,GAAwBA,gBAAxB;AACA,YAAK0R,sBAAL,GAA8BA,sBAA9B;;AAEA,YAAKZ,cAAL,GAAsBlC,gBAAgBC,OAAtC;AACA,YAAKoC,MAAL,GAAc,IAAd;;AAEA,YAAKY,YAAL,GAAoB,IAApB;AACA,YAAKC,WAAL,GAAmB,IAAnB;;AAEA,YAAK3a,SAAL,GAAiB,IAAjB;;AAEA,YAAK4a,SAAL,GAAiB,IAAjB;;AAEA,YAAKC,eAAL,GAAuB,IAAvB;;AAEA,WAAIjQ,MAAMtW,SAASkL,aAAT,CAAuB,KAAvB,CAAV;AACAoL,WAAIrH,EAAJ,GAAS,kBAAkB,KAAKA,EAAhC;AACAqH,WAAIgB,SAAJ,GAAgB,MAAhB;AACAhB,WAAIlL,KAAJ,CAAUpH,KAAV,GAAkBkC,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcH,KAAzB,IAAkC,IAApD;AACAsS,WAAIlL,KAAJ,CAAUrH,MAAV,GAAmBmC,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcJ,MAAzB,IAAmC,IAAtD;AACAuS,WAAI7U,YAAJ,CAAiB,kBAAjB,EAAqC,KAAKwN,EAA1C;AACA,YAAKqH,GAAL,GAAWA,GAAX;;AAEA6H,iBAAU3Z,WAAV,CAAsB8R,GAAtB;AACD;;AAEDsP,iBAAYvI,SAAZ,GAAwB;AACtBmJ,mBAAY,SAASC,sBAAT,CAAgC3S,OAAhC,EAAyC;AACnD,cAAKA,OAAL,GAAeA,OAAf;AACA,cAAKoS,aAAL,GAAqBpS,QAAQH,MAA7B;AACA,aAAI+S,gBAAgB,CAAC,KAAK1f,QAAL,GAAgB,KAAKkf,aAAtB,IAAuC,GAA3D;AACA,cAAK/hB,QAAL,GAAgB2P,QAAQI,WAAR,CAAoB,KAAK9P,KAAL,GAAaoT,SAAjC,EACoBkP,aADpB,CAAhB;AAEA,cAAKC,KAAL,GAAa7S,QAAQ6S,KAArB;AACA,cAAKC,KAAL;AACD,QATqB;;AAWtBC,gBAAS,SAASC,mBAAT,GAA+B;AACtC,cAAKR,SAAL,GAAiB,IAAjB;AACA,cAAKM,KAAL;AACA,aAAI,KAAK9S,OAAT,EAAkB;AAChB,gBAAKA,OAAL,CAAaiT,OAAb;AACD;AACF,QAjBqB;;AAmBtBH,cAAO,SAASI,iBAAT,CAA2BC,aAA3B,EAA0CC,eAA1C,EAA2D;AAChE,aAAI,KAAKC,UAAT,EAAqB;AACnB,gBAAKA,UAAL,CAAgBC,MAAhB;AACD;AACD,cAAK5B,MAAL,GAAc,IAAd;AACA,cAAKH,cAAL,GAAsBlC,gBAAgBC,OAAtC;;AAEA,aAAI9M,MAAM,KAAKA,GAAf;AACAA,aAAIlL,KAAJ,CAAUpH,KAAV,GAAkBkC,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcH,KAAzB,IAAkC,IAApD;AACAsS,aAAIlL,KAAJ,CAAUrH,MAAV,GAAmBmC,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcJ,MAAzB,IAAmC,IAAtD;;AAEA,aAAIsjB,aAAa/Q,IAAI+Q,UAArB;AACA,aAAIC,uBAAwBL,iBAAiB,KAAKX,SAAvB,IAAqC,IAAhE;AACA,aAAIiB,wBAAyBL,mBAAmB,KAAKX,eAAxB,IACA,KAAKA,eAAL,CAAqBjQ,GADtB,IAC8B,IAD1D;AAEA,cAAK,IAAInU,IAAIklB,WAAWhlB,MAAX,GAAoB,CAAjC,EAAoCF,KAAK,CAAzC,EAA4CA,GAA5C,EAAiD;AAC/C,eAAIT,OAAO2lB,WAAWllB,CAAX,CAAX;AACA,eAAImlB,yBAAyB5lB,IAAzB,IAAiC6lB,0BAA0B7lB,IAA/D,EAAqE;AACnE;AACD;AACD4U,eAAI7R,WAAJ,CAAgB/C,IAAhB;AACD;AACD4U,aAAI9P,eAAJ,CAAoB,aAApB;;AAEA,aAAI+gB,qBAAJ,EAA2B;AACzB;AACA;AACA,gBAAKhB,eAAL,CAAqBlI,IAArB;AACD,UAJD,MAIO;AACL,gBAAKkI,eAAL,GAAuB,IAAvB;AACD;;AAED,aAAI,KAAKhT,MAAL,IAAe,CAAC+T,oBAApB,EAA0C;AACxC;AACA;AACA,gBAAK/T,MAAL,CAAYvP,KAAZ,GAAoB,CAApB;AACA,gBAAKuP,MAAL,CAAYxP,MAAZ,GAAqB,CAArB;AACA,kBAAO,KAAKwP,MAAZ;AACD;;AAED,cAAKiU,cAAL,GAAsBxnB,SAASkL,aAAT,CAAuB,KAAvB,CAAtB;AACA,cAAKsc,cAAL,CAAoBlQ,SAApB,GAAgC,aAAhC;AACAhB,aAAI9R,WAAJ,CAAgB,KAAKgjB,cAArB;AACD,QA9DqB;;AAgEtBC,eAAQ,SAASC,kBAAT,CAA4BtjB,KAA5B,EAAmC4C,QAAnC,EAA6C;AACnD,cAAK5C,KAAL,GAAaA,SAAS,KAAKA,KAA3B;;AAEA,aAAI,OAAO4C,QAAP,KAAoB,WAAxB,EAAqC;AACnC,gBAAKA,QAAL,GAAgBA,QAAhB;AACD;;AAED,aAAI0f,gBAAgB,CAAC,KAAK1f,QAAL,GAAgB,KAAKkf,aAAtB,IAAuC,GAA3D;AACA,cAAK/hB,QAAL,GAAgB,KAAKA,QAAL,CAAcwjB,KAAd,CAAoB;AAClCvjB,kBAAO,KAAKA,KAAL,GAAaoT,SADc;AAElCxQ,qBAAU0f;AAFwB,UAApB,CAAhB;;AAKA,aAAIkB,sBAAsB,KAA1B;AACA,aAAI,KAAKrU,MAAL,IAAexW,MAAM8qB,eAAN,GAAwB,CAA3C,EAA8C;AAC5C,eAAI/S,cAAc,KAAKA,WAAvB;AACA,eAAIgT,mBAAmB,KAAK3jB,QAAL,CAAcH,KAAd,GAAsB,KAAKG,QAAL,CAAcJ,MAA3D;AACA,eAAIgkB,WAAW7hB,KAAK8hB,IAAL,CAAUjrB,MAAM8qB,eAAN,GAAwBC,gBAAlC,CAAf;AACA,eAAI,CAAE5hB,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcH,KAAzB,IAAkC8Q,YAAYG,EAA/C,GAAqD,CAAtD,KACE/O,KAAKsP,KAAL,CAAW,KAAKrR,QAAL,CAAcJ,MAAzB,IAAmC+Q,YAAYI,EAAhD,GAAsD,CADvD,IAEAnY,MAAM8qB,eAFV,EAE2B;AACzBD,mCAAsB,IAAtB;AACD;AACF;;AAED,aAAI,KAAKrU,MAAT,EAAiB;AACf,eAAIxW,MAAMkrB,cAAN,IACC,KAAK9B,oBAAL,IAA6ByB,mBADlC,EACwD;AACtD,kBAAKM,YAAL,CAAkB,KAAK3U,MAAvB,EAA+B,IAA/B;;AAEA,iBAAIoO,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,mBAAME,eAAN,CAAsB,cAAtB,EAAsC,IAAtC,EAA4C,IAA5C,EAAkD;AAChDjkB,2BAAY,KAAKqR,EAD+B;AAEhDiZ,6BAAc;AAFkC,cAAlD;AAIA,kBAAK5R,GAAL,CAAS0L,aAAT,CAAuBL,KAAvB;;AAEA;AACD;AACD,eAAI,CAAC,KAAK2E,SAAV,EAAqB;AACnB,kBAAKA,SAAL,GAAiB,KAAK/S,MAAL,CAAY5R,UAA7B;AACA,kBAAK2kB,SAAL,CAAelb,KAAf,CAAqBC,QAArB,GAAgC,UAAhC;AACD;AACF;AACD,aAAI,KAAKib,SAAT,EAAoB;AAClB,gBAAK4B,YAAL,CAAkB,KAAK5B,SAAL,CAAe6B,UAAjC;AACD;AACD,cAAKvB,KAAL,EAAW,qBAAsB,IAAjC,EAAuC,uBAAwB,IAA/D;AACD,QAhHqB;;AAkHtB;;;AAGAwB,uBAAgB,SAASC,0BAAT,GAAsC;AACpD,aAAI,KAAK3c,SAAT,EAAoB;AAClB,gBAAKA,SAAL,CAAejO,MAAf,CAAsBkoB,uBAAtB;AACD;AACF,QAzHqB;;AA2HtBuC,qBAAc,SAASI,qBAAT,CAA+B/U,MAA/B,EAAuCgV,iBAAvC,EAA0D;AACtE,aAAIC,cAAczrB,MAAMyrB,WAAxB;;AAEA;AACA,aAAIxkB,QAAQ,KAAKG,QAAL,CAAcH,KAA1B;AACA,aAAID,SAAS,KAAKI,QAAL,CAAcJ,MAA3B;AACA,aAAIuS,MAAM,KAAKA,GAAf;AACA/C,gBAAOnI,KAAP,CAAapH,KAAb,GAAqBuP,OAAO5R,UAAP,CAAkByJ,KAAlB,CAAwBpH,KAAxB,GAAgCsS,IAAIlL,KAAJ,CAAUpH,KAAV,GACnDkC,KAAKsP,KAAL,CAAWxR,KAAX,IAAoB,IADtB;AAEAuP,gBAAOnI,KAAP,CAAarH,MAAb,GAAsBwP,OAAO5R,UAAP,CAAkByJ,KAAlB,CAAwBrH,MAAxB,GAAiCuS,IAAIlL,KAAJ,CAAUrH,MAAV,GACrDmC,KAAKsP,KAAL,CAAWzR,MAAX,IAAqB,IADvB;AAEA;AACA,aAAI0kB,mBAAmB,KAAKtkB,QAAL,CAAc6C,QAAd,GAAyBuM,OAAOmV,SAAP,CAAiB1hB,QAAjE;AACA,aAAI2hB,cAAcziB,KAAKoW,GAAL,CAASmM,gBAAT,CAAlB;AACA,aAAIG,SAAS,CAAb;AAAA,aAAgBC,SAAS,CAAzB;AACA,aAAIF,gBAAgB,EAAhB,IAAsBA,gBAAgB,GAA1C,EAA+C;AAC7C;AACAC,oBAAS7kB,SAASC,KAAlB;AACA6kB,oBAAS7kB,QAAQD,MAAjB;AACD;AACD,aAAImkB,eAAe,YAAYO,gBAAZ,GAA+B,OAA/B,GACjB,QADiB,GACNG,MADM,GACG,GADH,GACSC,MADT,GACkB,GADrC;AAEAL,qBAAYM,OAAZ,CAAoB,WAApB,EAAiCvV,MAAjC,EAAyC2U,YAAzC;;AAEA,aAAI,KAAKxc,SAAT,EAAoB;AAClB;AACA;AACA;AACA;AACA,eAAIqd,oBAAoB,KAAKrd,SAAL,CAAevH,QAAvC;AACA,eAAI6kB,uBAAuB,KAAK7kB,QAAL,CAAc6C,QAAd,GACzB+hB,kBAAkB/hB,QADpB;AAEA,eAAIiiB,kBAAkB/iB,KAAKoW,GAAL,CAAS0M,oBAAT,CAAtB;AACA,eAAI5kB,QAAQJ,QAAQ+kB,kBAAkB/kB,KAAtC;AACA,eAAIilB,oBAAoB,EAApB,IAA0BA,oBAAoB,GAAlD,EAAuD;AACrD7kB,qBAAQJ,QAAQ+kB,kBAAkBhlB,MAAlC;AACD;AACD,eAAImlB,eAAe,KAAKxd,SAAL,CAAewd,YAAlC;AACA,eAAIC,MAAJ,EAAYC,MAAZ;AACA,mBAAQH,eAAR;AACE,kBAAK,CAAL;AACEE,wBAASC,SAAS,CAAlB;AACA;AACF,kBAAK,EAAL;AACED,wBAAS,CAAT;AACAC,wBAAS,MAAMF,aAAa9d,KAAb,CAAmBrH,MAAlC;AACA;AACF,kBAAK,GAAL;AACEolB,wBAAS,MAAMD,aAAa9d,KAAb,CAAmBpH,KAAlC;AACAolB,wBAAS,MAAMF,aAAa9d,KAAb,CAAmBrH,MAAlC;AACA;AACF,kBAAK,GAAL;AACEolB,wBAAS,MAAMD,aAAa9d,KAAb,CAAmBpH,KAAlC;AACAolB,wBAAS,CAAT;AACA;AACF;AACExQ,uBAAQC,KAAR,CAAc,qBAAd;AACA;AAlBJ;AAoBA2P,uBAAYM,OAAZ,CAAoB,WAApB,EAAiCI,YAAjC,EACI,YAAYD,eAAZ,GAA8B,OAA9B,GACA,QADA,GACW7kB,KADX,GACmB,IADnB,GAC0BA,KAD1B,GACkC,IADlC,GAEA,YAFA,GAEe+kB,MAFf,GAEwB,IAFxB,GAE+BC,MAF/B,GAEwC,GAH5C;AAIAZ,uBAAYM,OAAZ,CAAoB,iBAApB,EAAuCI,YAAvC,EAAqD,OAArD;AACD;;AAED,aAAIX,qBAAqB,KAAKhC,eAA9B,EAA+C;AAC7C,gBAAKA,eAAL,CAAqB9oB,MAArB,CAA4B,KAAK0G,QAAjC,EAA2C,SAA3C;AACD;AACF,QAhMqB;;AAkMtB,WAAIH,KAAJ,GAAY;AACV,gBAAO,KAAKG,QAAL,CAAcH,KAArB;AACD,QApMqB;;AAsMtB,WAAID,MAAJ,GAAa;AACX,gBAAO,KAAKI,QAAL,CAAcJ,MAArB;AACD,QAxMqB;;AA0MtBslB,qBAAc,SAASC,wBAAT,CAAkCvnB,CAAlC,EAAqCC,CAArC,EAAwC;AACpD,gBAAO,KAAKmC,QAAL,CAAcolB,iBAAd,CAAgCxnB,CAAhC,EAAmCC,CAAnC,CAAP;AACD,QA5MqB;;AA8MtB0jB,aAAM,SAAS8D,gBAAT,GAA4B;AAChC,aAAI,KAAKnE,cAAL,KAAwBlC,gBAAgBC,OAA5C,EAAqD;AACnDxK,mBAAQC,KAAR,CAAc,qCAAd;AACD;;AAED,cAAKwM,cAAL,GAAsBlC,gBAAgBE,OAAtC;;AAEA,aAAIvP,UAAU,KAAKA,OAAnB;AACA,aAAI3P,WAAW,KAAKA,QAApB;AACA,aAAImS,MAAM,KAAKA,GAAf;AACA;AACA;AACA,aAAImT,gBAAgBzpB,SAASkL,aAAT,CAAuB,KAAvB,CAApB;AACAue,uBAAcre,KAAd,CAAoBpH,KAApB,GAA4BsS,IAAIlL,KAAJ,CAAUpH,KAAtC;AACAylB,uBAAcre,KAAd,CAAoBrH,MAApB,GAA6BuS,IAAIlL,KAAJ,CAAUrH,MAAvC;AACA0lB,uBAAchM,SAAd,CAAwBC,GAAxB,CAA4B,eAA5B;;AAEA,aAAInK,SAASvT,SAASkL,aAAT,CAAuB,QAAvB,CAAb;AACAqI,gBAAOtE,EAAP,GAAY,SAAS,KAAKA,EAA1B;AACA;AACA;AACAsE,gBAAO9R,YAAP,CAAoB,QAApB,EAA8B,QAA9B;AACA,aAAIioB,iBAAiB,IAArB;;AAEAD,uBAAcjlB,WAAd,CAA0B+O,MAA1B;AACA,aAAI,KAAKgT,eAAL,IAAwB,KAAKA,eAAL,CAAqBjQ,GAAjD,EAAsD;AACpD;AACAA,eAAI7K,YAAJ,CAAiBge,aAAjB,EAAgC,KAAKlD,eAAL,CAAqBjQ,GAArD;AACD,UAHD,MAGO;AACLA,eAAI9R,WAAJ,CAAgBilB,aAAhB;AACD;AACD,cAAKlW,MAAL,GAAcA,MAAd;;AAEA,aAAIsC,MAAMtC,OAAOS,UAAP,CAAkB,IAAlB,EAAwB,EAACC,OAAO,KAAR,EAAxB,CAAV;AACA,aAAIa,cAAcC,eAAec,GAAf,CAAlB;AACA,cAAKf,WAAL,GAAmBA,WAAnB;;AAEA,aAAI/X,MAAMkrB,cAAV,EAA0B;AACxB,eAAI0B,qBAAqBxlB,SAASwjB,KAAT,CAAe,EAACvjB,OAAOoT,SAAR,EAAf,CAAzB;AACA;AACA;AACA1C,uBAAYG,EAAZ,IAAkB0U,mBAAmB3lB,KAAnB,GAA2BG,SAASH,KAAtD;AACA8Q,uBAAYI,EAAZ,IAAkByU,mBAAmB5lB,MAAnB,GAA4BI,SAASJ,MAAvD;AACA+Q,uBAAYE,MAAZ,GAAqB,IAArB;AACD;;AAED,aAAIjY,MAAM8qB,eAAN,GAAwB,CAA5B,EAA+B;AAC7B,eAAIC,mBAAmB3jB,SAASH,KAAT,GAAiBG,SAASJ,MAAjD;AACA,eAAIgkB,WAAW7hB,KAAK8hB,IAAL,CAAUjrB,MAAM8qB,eAAN,GAAwBC,gBAAlC,CAAf;AACA,eAAIhT,YAAYG,EAAZ,GAAiB8S,QAAjB,IAA6BjT,YAAYI,EAAZ,GAAiB6S,QAAlD,EAA4D;AAC1DjT,yBAAYG,EAAZ,GAAiB8S,QAAjB;AACAjT,yBAAYI,EAAZ,GAAiB6S,QAAjB;AACAjT,yBAAYE,MAAZ,GAAqB,IAArB;AACA,kBAAKmR,oBAAL,GAA4B,IAA5B;AACD,YALD,MAKO;AACL,kBAAKA,oBAAL,GAA4B,KAA5B;AACD;AACF;;AAED,aAAIhR,MAAMC,oBAAoBN,YAAYG,EAAhC,CAAV;AACA,aAAII,MAAMD,oBAAoBN,YAAYI,EAAhC,CAAV;AACA3B,gBAAOvP,KAAP,GAAeuR,cAAcpR,SAASH,KAAT,GAAiB8Q,YAAYG,EAA3C,EAA+CE,IAAI,CAAJ,CAA/C,CAAf;AACA5B,gBAAOxP,MAAP,GAAgBwR,cAAcpR,SAASJ,MAAT,GAAkB+Q,YAAYI,EAA5C,EAAgDG,IAAI,CAAJ,CAAhD,CAAhB;AACA9B,gBAAOnI,KAAP,CAAapH,KAAb,GAAqBuR,cAAcpR,SAASH,KAAvB,EAA8BmR,IAAI,CAAJ,CAA9B,IAAwC,IAA7D;AACA5B,gBAAOnI,KAAP,CAAarH,MAAb,GAAsBwR,cAAcpR,SAASJ,MAAvB,EAA+BsR,IAAI,CAAJ,CAA/B,IAAyC,IAA/D;AACA;AACA9B,gBAAOmV,SAAP,GAAmBvkB,QAAnB;;AAEA,aAAI+kB,eAAe,IAAnB;AACA,aAAIxd,YAAY,IAAhB;AACA,aAAI,KAAK6I,gBAAT,EAA2B;AACzB2U,0BAAelpB,SAASkL,aAAT,CAAuB,KAAvB,CAAf;AACAge,wBAAa5R,SAAb,GAAyB,WAAzB;AACA4R,wBAAa9d,KAAb,CAAmBpH,KAAnB,GAA2BylB,cAAcre,KAAd,CAAoBpH,KAA/C;AACAklB,wBAAa9d,KAAb,CAAmBrH,MAAnB,GAA4B0lB,cAAcre,KAAd,CAAoBrH,MAAhD;AACA,eAAI,KAAKwiB,eAAL,IAAwB,KAAKA,eAAL,CAAqBjQ,GAAjD,EAAsD;AACpD;AACAA,iBAAI7K,YAAJ,CAAiByd,YAAjB,EAA+B,KAAK3C,eAAL,CAAqBjQ,GAApD;AACD,YAHD,MAGO;AACLA,iBAAI9R,WAAJ,CAAgB0kB,YAAhB;AACD;;AAEDxd,uBAAY,KAAK6I,gBAAL,CAAsBG,sBAAtB,CAA6CwU,YAA7C,EAC6C,KAAKja,EAAL,GAAU,CADvD,EAE6C,KAAK9K,QAFlD,CAAZ;AAGD;AACD,cAAKuH,SAAL,GAAiBA,SAAjB;;AAEA,aAAIke,oBAAJ,EAA0BC,mBAA1B;AACA,aAAIrd,UAAU,IAAI5H,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACnD8kB,kCAAuB/kB,OAAvB;AACAglB,iCAAsB/kB,MAAtB;AACD,UAHa,CAAd;;AAKA;;AAEA,aAAI8a,OAAO,IAAX;AACA,kBAASkK,oBAAT,CAA8BjR,KAA9B,EAAqC;AACnC;AACA;AACA;AACA,eAAIsO,eAAevH,KAAKuH,UAAxB,EAAoC;AAClCvH,kBAAKuH,UAAL,GAAkB,IAAlB;AACD;;AAED,eAAItO,UAAU,WAAd,EAA2B;AACzBgR,iCAAoBhR,KAApB;AACA;AACD;;AAED+G,gBAAKyF,cAAL,GAAsBlC,gBAAgBI,QAAtC;;AAEA,eAAImG,cAAJ,EAAoB;AAClB9J,kBAAKrM,MAAL,CAAY/M,eAAZ,CAA4B,QAA5B;AACAkjB,8BAAiB,KAAjB;AACD;;AAED,eAAI9J,KAAK4H,cAAT,EAAyB;AACvBlR,iBAAI7R,WAAJ,CAAgBmb,KAAK4H,cAArB;AACA,oBAAO5H,KAAK4H,cAAZ;AACD;;AAED,eAAI5H,KAAK0G,SAAT,EAAoB;AAClB;AACA;AACA,iBAAIyD,kBAAkBnK,KAAK0G,SAAL,CAAe6B,UAArC;AACA4B,6BAAgB/lB,KAAhB,GAAwB,CAAxB;AACA+lB,6BAAgBhmB,MAAhB,GAAyB,CAAzB;;AAEAuS,iBAAI7R,WAAJ,CAAgBmb,KAAK0G,SAArB;AACA1G,kBAAK0G,SAAL,GAAiB,IAAjB;AACD;;AAED1G,gBAAK/G,KAAL,GAAaA,KAAb;AACA+G,gBAAK+G,KAAL,GAAa7S,QAAQ6S,KAArB;AACA,eAAI/G,KAAKyG,WAAT,EAAsB;AACpBzG,kBAAKyG,WAAL;AACD;AACD,eAAI1E,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,iBAAME,eAAN,CAAsB,cAAtB,EAAsC,IAAtC,EAA4C,IAA5C,EAAkD;AAChDjkB,yBAAYgiB,KAAK3Q,EAD+B;AAEhDiZ,2BAAc;AAFkC,YAAlD;AAIA5R,eAAI0L,aAAJ,CAAkBL,KAAlB;;AAEA,eAAI,CAAC9I,KAAL,EAAY;AACV+Q,kCAAqBnQ,SAArB;AACD,YAFD,MAEO;AACLoQ,iCAAoBhR,KAApB;AACD;AACF;;AAED,aAAImR,yBAAyB,IAA7B;AACA,aAAI,KAAKhE,cAAT,EAAyB;AACvBgE,oCAAyB,SAASA,sBAAT,CAAgCC,IAAhC,EAAsC;AAC7D,iBAAI,CAACrK,KAAKoG,cAAL,CAAoB7B,iBAApB,CAAsCvE,IAAtC,CAAL,EAAkD;AAChDA,oBAAKyF,cAAL,GAAsBlC,gBAAgBG,MAAtC;AACA1D,oBAAK4F,MAAL,GAAc,SAAS0E,cAAT,GAA0B;AACtCtK,sBAAKyF,cAAL,GAAsBlC,gBAAgBE,OAAtC;AACA4G;AACD,gBAHD;AAIA;AACD;AACD,iBAAIP,cAAJ,EAAoB;AAClB9J,oBAAKrM,MAAL,CAAY/M,eAAZ,CAA4B,QAA5B;AACAkjB,gCAAiB,KAAjB;AACD;AACDO;AACD,YAdD;AAeD;;AAED,aAAIhjB,YAAY,CAAC6N,YAAYE,MAAb,GAAsB,IAAtB,GACd,CAACF,YAAYG,EAAb,EAAiB,CAAjB,EAAoB,CAApB,EAAuBH,YAAYI,EAAnC,EAAuC,CAAvC,EAA0C,CAA1C,CADF;AAEA,aAAIiV,gBAAgB;AAClBpW,0BAAe8B,GADG;AAElB5O,sBAAWA,SAFO;AAGlB9C,qBAAU,KAAKA;AAHG,UAApB;AAMA,aAAIgjB,aAAa,KAAKA,UAAL,GAAkB,KAAKrT,OAAL,CAAarW,MAAb,CAAoB0sB,aAApB,CAAnC;AACAhD,oBAAWiD,UAAX,GAAwBJ,sBAAxB;;AAEA,cAAK7C,UAAL,CAAgB3a,OAAhB,CAAwB/N,IAAxB,CACE,SAAS4rB,qBAAT,GAAiC;AAC/BP,gCAAqB,IAArB;AACA,eAAIpe,SAAJ,EAAe;AACbkU,kBAAK9L,OAAL,CAAaM,cAAb,CAA4B,EAAEC,qBAAqB,IAAvB,EAA5B,EAA2D5V,IAA3D,CACE,SAAS6rB,mBAAT,CAA6BhW,WAA7B,EAA0C;AACxC5I,yBAAUiJ,cAAV,CAAyBL,WAAzB;AACA5I,yBAAUjO,MAAV,CAAiBkoB,uBAAjB;AACD,cAJH;AAMD;AACF,UAXH,EAYE,SAAS4E,kBAAT,CAA4B1R,KAA5B,EAAmC;AACjCiR,gCAAqBjR,KAArB;AACD,UAdH;;AAiBA,aAAI,KAAKoN,sBAAT,EAAiC;AAC/B,eAAI,CAAC,KAAKM,eAAV,EAA2B;AACzB,kBAAKA,eAAL,GAAuB,KAAKN,sBAAL,CACrBuE,4BADqB,CACQlU,GADR,EACa,KAAKxC,OADlB,CAAvB;AAED;AACD,gBAAKyS,eAAL,CAAqB9oB,MAArB,CAA4B,KAAK0G,QAAjC,EAA2C,SAA3C;AACD;AACDmS,aAAI7U,YAAJ,CAAiB,aAAjB,EAAgC,IAAhC;;AAEA,aAAIme,KAAKwG,YAAT,EAAuB;AACrBxG,gBAAKwG,YAAL;AACD;AACD,gBAAO5Z,OAAP;AACD,QAlaqB;;AAoatBie,oBAAa,SAASC,uBAAT,GAAmC;AAC9C,aAAIlC,cAAczrB,MAAMyrB,WAAxB;AACA,aAAI1U,UAAU,KAAKA,OAAnB;;AAEA,aAAI3P,WAAW2P,QAAQI,WAAR,CAAoB,CAApB,CAAf;AACA;AACA;AACA,aAAIyW,qBAAqB,CAAzB;AACA,aAAIpX,SAASvT,SAASkL,aAAT,CAAuB,QAAvB,CAAb;;AAEA;AACAqI,gBAAOvP,KAAP,GAAekC,KAAKsP,KAAL,CAAWrR,SAASH,KAApB,IAA6B2mB,kBAA5C;AACApX,gBAAOxP,MAAP,GAAgBmC,KAAKsP,KAAL,CAAWrR,SAASJ,MAApB,IAA8B4mB,kBAA9C;;AAEA;AACApX,gBAAOnI,KAAP,CAAapH,KAAb,GAAsB2mB,qBAAqB,GAAtB,GAA6B,GAAlD;AACApX,gBAAOnI,KAAP,CAAarH,MAAb,GAAuB4mB,qBAAqB,GAAtB,GAA6B,GAAnD;;AAEA,aAAIC,WAAW,WAAY,IAAID,kBAAhB,GAAsC,IAAtC,GACY,IAAIA,kBADhB,GACsC,GADrD;AAEAnC,qBAAYM,OAAZ,CAAoB,WAApB,EAAkCvV,MAAlC,EAA0CqX,QAA1C;AACApC,qBAAYM,OAAZ,CAAoB,iBAApB,EAAwCvV,MAAxC,EAAgD,OAAhD;;AAEA,aAAIsX,iBAAiB7qB,SAASyM,cAAT,CAAwB,gBAAxB,CAArB;AACA,aAAIgd,gBAAgBzpB,SAASkL,aAAT,CAAuB,KAAvB,CAApB;AACAue,uBAAcre,KAAd,CAAoBpH,KAApB,GAA4BG,SAASH,KAAT,GAAiB,IAA7C;AACAylB,uBAAcre,KAAd,CAAoBrH,MAApB,GAA6BI,SAASJ,MAAT,GAAkB,IAA/C;AACA0lB,uBAAcjlB,WAAd,CAA0B+O,MAA1B;AACAsX,wBAAermB,WAAf,CAA2BilB,aAA3B;;AAEAlW,gBAAOuX,gBAAP,GAA0B,UAASC,GAAT,EAAc;AACtC,eAAIlV,MAAMkV,IAAInW,OAAd;;AAEAiB,eAAImV,IAAJ;AACAnV,eAAIoV,SAAJ,GAAgB,oBAAhB;AACApV,eAAIqV,QAAJ,CAAa,CAAb,EAAgB,CAAhB,EAAmB3X,OAAOvP,KAA1B,EAAiCuP,OAAOxP,MAAxC;AACA8R,eAAIsV,OAAJ;AACA;AACAtV,eAAIuV,gBAAJ,GACE,CAACT,kBAAD,EAAqB,CAArB,EAAwB,CAAxB,EAA2BA,kBAA3B,EAA+C,CAA/C,EAAkD,CAAlD,CADF;AAEA9U,eAAIzR,KAAJ,CAAUumB,kBAAV,EAA8BA,kBAA9B;;AAEA,eAAIR,gBAAgB;AAClBpW,4BAAe8B,GADG;AAElB1R,uBAAUA,QAFQ;AAGlBknB,qBAAQ;AAHU,YAApB;;AAMAvX,mBAAQrW,MAAR,CAAe0sB,aAAf,EAA8B3d,OAA9B,CAAsC/N,IAAtC,CAA2C,YAAW;AACpD;AACAssB,iBAAIO,IAAJ;AACD,YAHD,EAGG,UAASzS,KAAT,EAAgB;AACjBD,qBAAQC,KAAR,CAAcA,KAAd;AACA;AACA;AACA,iBAAI,WAAWkS,GAAf,EAAoB;AAClBA,mBAAIQ,KAAJ;AACD,cAFD,MAEO;AACLR,mBAAIO,IAAJ;AACD;AACF,YAZD;AAaD,UA/BD;AAgCD;AAleqB,MAAxB;;AAqeA,YAAO1F,WAAP;AACD,IAxhBiB,EAAlB;;AA2hBA;;;;;;;;AAQA;;;;;;;AAOA,OAAI4F,mBAAoB,SAASC,uBAAT,GAAmC;AACzD,cAASD,gBAAT,CAA0B1F,OAA1B,EAAmC;AACjC,YAAKoD,YAAL,GAAoBpD,QAAQoD,YAA5B;AACA,YAAKwC,aAAL,GAAqB,KAArB;AACA,YAAKC,cAAL,GAAsB,KAAtB;AACA,YAAKC,OAAL,GAAe9F,QAAQ3F,SAAvB;AACA,YAAKviB,UAAL,GAAkB,KAAKguB,OAAL,GAAe,CAAjC;AACA,YAAKC,OAAL,GAAe,EAAf;AACA,YAAK1nB,QAAL,GAAgB2hB,QAAQ3hB,QAAxB;AACA,YAAK2nB,QAAL,GAAgB,EAAhB;AACA,YAAKC,cAAL,GAAsBjG,QAAQiG,cAAR,IAA0B,IAAhD;AACA,YAAKC,mBAAL,GAA2B,IAA3B;AACA,YAAKC,UAAL;AACD;;AAEDT,sBAAiBnO,SAAjB,GAA6B;AAC3B6O,yBAAkB,SAASC,gCAAT,GAA4C;AAC5D,cAAKT,aAAL,GAAqB,IAArB;;AAEA,aAAIU,eAAepsB,SAASkL,aAAT,CAAuB,KAAvB,CAAnB;AACAkhB,sBAAa9U,SAAb,GAAyB,cAAzB;AACA,cAAK4R,YAAL,CAAkB1kB,WAAlB,CAA8B4nB,YAA9B;;AAEA,aAAIzK,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,eAAME,eAAN,CAAsB,mBAAtB,EAA2C,IAA3C,EAAiD,IAAjD,EAAuD;AACrDjkB,uBAAY,KAAKA;AADoC,UAAvD;AAGA,cAAKsrB,YAAL,CAAkBlH,aAAlB,CAAgCL,KAAhC;AACD,QAb0B;;AAe3B;;;;;AAKAlkB,eAAQ,SAAS4uB,uBAAT,CAAiCC,OAAjC,EAA0C;AAChD,aAAI,CAAC,KAAKX,cAAN,IAAwB,KAAKD,aAAjC,EAAgD;AAC9C;AACD;;AAED,aAAI,KAAKM,mBAAT,EAA8B;AAC5B,gBAAKA,mBAAL,CAAyB5E,MAAzB;AACA,gBAAK4E,mBAAL,GAA2B,IAA3B;AACD;;AAED,cAAKF,QAAL,GAAgB,EAAhB;AACA,aAAIS,gBAAgBvsB,SAASwsB,sBAAT,EAApB;AACA,cAAKR,mBAAL,GAA2BjvB,MAAM0vB,eAAN,CAAsB;AAC/CnY,wBAAa,KAAKA,WAD6B;AAE/C6J,sBAAWoO,aAFoC;AAG/CpoB,qBAAU,KAAKA,QAHgC;AAI/C2nB,qBAAU,KAAKA,QAJgC;AAK/CQ,oBAASA;AALsC,UAAtB,CAA3B;AAOA,cAAKN,mBAAL,CAAyBxf,OAAzB,CAAiC/N,IAAjC,CAAsC,YAAY;AAChD,gBAAKyqB,YAAL,CAAkB1kB,WAAlB,CAA8B+nB,aAA9B;AACA,gBAAKL,gBAAL;AACA,gBAAKQ,aAAL;AACD,UAJqC,CAIpC/H,IAJoC,CAI/B,IAJ+B,CAAtC,EAIc,UAAUgI,MAAV,EAAkB;AAC9B;AACD,UAND;AAOD,QA9C0B;;AAgD3BhY,uBAAgB,SAASiY,+BAAT,CAAyCtY,WAAzC,EAAsD;AACpE,aAAI,KAAK0X,mBAAT,EAA8B;AAC5B,gBAAKA,mBAAL,CAAyB5E,MAAzB;AACA,gBAAK4E,mBAAL,GAA2B,IAA3B;AACD;AACD,cAAK1X,WAAL,GAAmBA,WAAnB;AACA,cAAKqX,cAAL,GAAsB,IAAtB;AACD,QAvD0B;;AAyD3BkB,uBAAgB,SAASC,+BAAT,CAAyCjB,OAAzC,EAAkD;AAChE,aAAI1pB,IAAI,CAAR;AACA,aAAI4qB,SAAS,CAAb;AACA,aAAIC,YAAY,KAAK1Y,WAAL,CAAiBwG,KAAjC;AACA,aAAI5C,MAAM8U,UAAU3qB,MAAV,GAAmB,CAA7B;AACA,aAAI4qB,WAAY,KAAKlB,cAAL,KAAwB,IAAxB,GACA,CADA,GACI,KAAKA,cAAL,CAAoB3R,KAApB,CAA0BnC,KAA1B,CAAgC5V,MADpD;AAEA,aAAI6qB,MAAM,EAAV;;AAEA,cAAK,IAAIC,IAAI,CAAR,EAAWC,MAAMvB,QAAQxpB,MAA9B,EAAsC8qB,IAAIC,GAA1C,EAA+CD,GAA/C,EAAoD;AAClD;AACA,eAAIE,WAAWxB,QAAQsB,CAAR,CAAf;;AAEA;AACA,kBAAOhrB,MAAM+V,GAAN,IAAamV,YAAaN,SAASC,UAAU7qB,CAAV,EAAamrB,GAAb,CAAiBjrB,MAA3D,EAAoE;AAClE0qB,uBAAUC,UAAU7qB,CAAV,EAAamrB,GAAb,CAAiBjrB,MAA3B;AACAF;AACD;;AAED,eAAIA,MAAM6qB,UAAU3qB,MAApB,EAA4B;AAC1BuW,qBAAQC,KAAR,CAAc,mCAAd;AACD;;AAED,eAAIpQ,QAAQ;AACV8kB,oBAAO;AACLC,uBAAQrrB,CADH;AAEL4Q,uBAAQsa,WAAWN;AAFd;AADG,YAAZ;;AAOA;AACAM,uBAAYJ,QAAZ;;AAEA;AACA;AACA,kBAAO9qB,MAAM+V,GAAN,IAAamV,WAAYN,SAASC,UAAU7qB,CAAV,EAAamrB,GAAb,CAAiBjrB,MAA1D,EAAmE;AACjE0qB,uBAAUC,UAAU7qB,CAAV,EAAamrB,GAAb,CAAiBjrB,MAA3B;AACAF;AACD;;AAEDsG,iBAAMyP,GAAN,GAAY;AACVsV,qBAAQrrB,CADE;AAEV4Q,qBAAQsa,WAAWN;AAFT,YAAZ;AAIAG,eAAI7nB,IAAJ,CAASoD,KAAT;AACD;;AAED,gBAAOykB,GAAP;AACD,QAzG0B;;AA2G3BO,sBAAe,SAASC,8BAAT,CAAwC7B,OAAxC,EAAiD;AAC9D;AACA,aAAIA,QAAQxpB,MAAR,KAAmB,CAAvB,EAA0B;AACxB;AACD;;AAED,aAAI2qB,YAAY,KAAK1Y,WAAL,CAAiBwG,KAAjC;AACA,aAAIgR,WAAW,KAAKA,QAApB;AACA,aAAI6B,UAAU,IAAd;AACA,aAAI/B,UAAU,KAAKA,OAAnB;AACA,aAAIgC,iBAAkB,KAAK7B,cAAL,KAAwB,IAAxB,GACpB,KADoB,GACXH,YAAY,KAAKG,cAAL,CAAoB8B,QAApB,CAA6BjC,OADpD;AAEA,aAAIkC,mBAAoB,KAAK/B,cAAL,KAAwB,IAAxB,GACA,CAAC,CADD,GACK,KAAKA,cAAL,CAAoB8B,QAApB,CAA6BR,QAD1D;AAEA,aAAIU,eAAgB,KAAKhC,cAAL,KAAwB,IAAxB,GACA,KADA,GACQ,KAAKA,cAAL,CAAoB3R,KAApB,CAA0B2T,YADtD;AAEA,aAAIC,WAAW;AACbR,mBAAQ,CAAC,CADI;AAEbza,mBAAQ0G;AAFK,UAAf;;AAKA,kBAASwU,SAAT,CAAmBV,KAAnB,EAA0BjW,SAA1B,EAAqC;AACnC,eAAIkW,SAASD,MAAMC,MAAnB;AACA1B,oBAAS0B,MAAT,EAAiBlZ,WAAjB,GAA+B,EAA/B;AACA4Z,2BAAgBV,MAAhB,EAAwB,CAAxB,EAA2BD,MAAMxa,MAAjC,EAAyCuE,SAAzC;AACD;;AAED,kBAAS4W,eAAT,CAAyBV,MAAzB,EAAiCW,UAAjC,EAA6CC,QAA7C,EAAuD9W,SAAvD,EAAkE;AAChE,eAAIhB,MAAMwV,SAAS0B,MAAT,CAAV;AACA,eAAInvB,UAAU2uB,UAAUQ,MAAV,EAAkBF,GAAlB,CAAsBlV,SAAtB,CAAgC+V,UAAhC,EAA4CC,QAA5C,CAAd;AACA,eAAI1sB,OAAO1B,SAASmL,cAAT,CAAwB9M,OAAxB,CAAX;AACA,eAAIiZ,SAAJ,EAAe;AACb,iBAAI+W,OAAOruB,SAASkL,aAAT,CAAuB,MAAvB,CAAX;AACAmjB,kBAAK/W,SAAL,GAAiBA,SAAjB;AACA+W,kBAAK7pB,WAAL,CAAiB9C,IAAjB;AACA4U,iBAAI9R,WAAJ,CAAgB6pB,IAAhB;AACA;AACD;AACD/X,eAAI9R,WAAJ,CAAgB9C,IAAhB;AACD;;AAED,aAAI4sB,KAAKR,gBAAT;AAAA,aAA2BS,KAAKD,KAAK,CAArC;AACA,aAAIP,YAAJ,EAAkB;AAChBO,gBAAK,CAAL;AACAC,gBAAK1C,QAAQxpB,MAAb;AACD,UAHD,MAGO,IAAI,CAACurB,cAAL,EAAqB;AAC1B;AACA;AACD;;AAED,cAAK,IAAIzrB,IAAImsB,EAAb,EAAiBnsB,IAAIosB,EAArB,EAAyBpsB,GAAzB,EAA8B;AAC5B,eAAIsG,QAAQojB,QAAQ1pB,CAAR,CAAZ;AACA,eAAIorB,QAAQ9kB,MAAM8kB,KAAlB;AACA,eAAIrV,MAAMzP,MAAMyP,GAAhB;AACA,eAAIsW,aAAcZ,kBAAkBzrB,MAAM2rB,gBAA1C;AACA,eAAIW,kBAAmBD,aAAa,WAAb,GAA2B,EAAlD;;AAEA,eAAI,KAAKzC,cAAT,EAAyB;AACvB,kBAAKA,cAAL,CAAoB2C,mBAApB,CAAwC9C,OAAxC,EAAiDzpB,CAAjD,EAAoD2pB,QAApD,EACwCyB,MAAMC,MAD9C,EACsDtV,IAAIsV,MAD1D;AAED;;AAED;AACA,eAAI,CAACG,OAAD,IAAYJ,MAAMC,MAAN,KAAiBG,QAAQH,MAAzC,EAAiD;AAC/C;AACA,iBAAIG,YAAY,IAAhB,EAAsB;AACpBO,+BAAgBP,QAAQH,MAAxB,EAAgCG,QAAQ5a,MAAxC,EAAgDib,SAASjb,MAAzD;AACD;AACD;AACAkb,uBAAUV,KAAV;AACD,YAPD,MAOO;AACLW,6BAAgBP,QAAQH,MAAxB,EAAgCG,QAAQ5a,MAAxC,EAAgDwa,MAAMxa,MAAtD;AACD;;AAED,eAAIwa,MAAMC,MAAN,KAAiBtV,IAAIsV,MAAzB,EAAiC;AAC/BU,6BAAgBX,MAAMC,MAAtB,EAA8BD,MAAMxa,MAApC,EAA4CmF,IAAInF,MAAhD,EACgB,cAAc0b,eAD9B;AAED,YAHD,MAGO;AACLP,6BAAgBX,MAAMC,MAAtB,EAA8BD,MAAMxa,MAApC,EAA4Cib,SAASjb,MAArD,EACgB,oBAAoB0b,eADpC;AAEA,kBAAK,IAAIE,KAAKpB,MAAMC,MAAN,GAAe,CAAxB,EAA2BoB,KAAK1W,IAAIsV,MAAzC,EAAiDmB,KAAKC,EAAtD,EAA0DD,IAA1D,EAAgE;AAC9D7C,wBAAS6C,EAAT,EAAarX,SAAb,GAAyB,qBAAqBmX,eAA9C;AACD;AACDR,uBAAU/V,GAAV,EAAe,kBAAkBuW,eAAjC;AACD;AACDd,qBAAUzV,GAAV;AACD;;AAED,aAAIyV,OAAJ,EAAa;AACXO,2BAAgBP,QAAQH,MAAxB,EAAgCG,QAAQ5a,MAAxC,EAAgDib,SAASjb,MAAzD;AACD;AACF,QAtM0B;;AAwM3B2Z,sBAAe,SAASmC,8BAAT,GAA0C;AACvD;AACA,aAAI,CAAC,KAAKnD,aAAV,EAAyB;AACvB;AACD;;AAED;AACA,aAAIG,UAAU,KAAKA,OAAnB;AACA,aAAIC,WAAW,KAAKA,QAApB;AACA,aAAIkB,YAAY,KAAK1Y,WAAL,CAAiBwG,KAAjC;AACA,aAAIgU,qBAAqB,CAAC,CAA1B;;AAEA;AACA,cAAK,IAAI3sB,IAAI,CAAR,EAAWirB,MAAMvB,QAAQxpB,MAA9B,EAAsCF,IAAIirB,GAA1C,EAA+CjrB,GAA/C,EAAoD;AAClD,eAAIsG,QAAQojB,QAAQ1pB,CAAR,CAAZ;AACA,eAAIorB,QAAQrnB,KAAK4F,GAAL,CAASgjB,kBAAT,EAA6BrmB,MAAM8kB,KAAN,CAAYC,MAAzC,CAAZ;AACA,gBAAK,IAAInmB,IAAIkmB,KAAR,EAAerV,MAAMzP,MAAMyP,GAAN,CAAUsV,MAApC,EAA4CnmB,KAAK6Q,GAAjD,EAAsD7Q,GAAtD,EAA2D;AACzD,iBAAIiP,MAAMwV,SAASzkB,CAAT,CAAV;AACAiP,iBAAIhC,WAAJ,GAAkB0Y,UAAU3lB,CAAV,EAAaimB,GAA/B;AACAhX,iBAAIgB,SAAJ,GAAgB,EAAhB;AACD;AACDwX,gCAAqBrmB,MAAMyP,GAAN,CAAUsV,MAAV,GAAmB,CAAxC;AACD;;AAED,aAAI,KAAKzB,cAAL,KAAwB,IAAxB,IAAgC,CAAC,KAAKA,cAAL,CAAoBgD,MAAzD,EAAiE;AAC/D;AACD;;AAED;AACA;AACA,cAAKlD,OAAL,GAAe,KAAKgB,cAAL,CAAoB,KAAKd,cAAL,KAAwB,IAAxB,GACjC,EADiC,GAC3B,KAAKA,cAAL,CAAoBiD,WAApB,CAAgC,KAAKpD,OAArC,KAAiD,EAD1C,CAAf;AAEA,cAAK6B,aAAL,CAAmB,KAAK5B,OAAxB;AACD,QAzO0B;;AA2O3B;;;;;AAKAI,mBAAY,SAASgD,0BAAT,GAAsC;AAChD,aAAI3Y,MAAM,KAAK4S,YAAf;AACA5S,aAAI1W,gBAAJ,CAAqB,WAArB,EAAkC,UAAUM,CAAV,EAAa;AAC7C,eAAIgY,MAAM5B,IAAIlP,aAAJ,CAAkB,eAAlB,CAAV;AACA,eAAI,CAAC8Q,GAAL,EAAU;AACR;AACD;AACD;AACA;AACA;AACA;AACA,eAAIgX,YAAYhvB,EAAEG,MAAF,KAAaiW,GAA7B;AACA,eAAI4Y,SAAJ,EAAe;AACb,iBAAIC,YAAY7Y,IAAI9T,qBAAJ,EAAhB;AACA,iBAAIyD,IAAIC,KAAK4F,GAAL,CAAS,CAAT,EAAY,CAAC5L,EAAEkvB,KAAF,GAAUD,UAAUzsB,GAArB,IAA4BysB,UAAUprB,MAAlD,CAAR;AACAmU,iBAAI9M,KAAJ,CAAU1I,GAAV,GAAgB,CAACuD,IAAI,GAAL,EAAUopB,OAAV,CAAkB,CAAlB,IAAuB,GAAvC;AACD;AACDnX,eAAIuF,SAAJ,CAAcC,GAAd,CAAkB,QAAlB;AACD,UAhBD;AAiBApH,aAAI1W,gBAAJ,CAAqB,SAArB,EAAgC,UAAUM,CAAV,EAAa;AAC3C,eAAIgY,MAAM5B,IAAIlP,aAAJ,CAAkB,eAAlB,CAAV;AACA,eAAI,CAAC8Q,GAAL,EAAU;AACR;AACD;AACDA,eAAI9M,KAAJ,CAAU1I,GAAV,GAAgB,EAAhB;AACAwV,eAAIuF,SAAJ,CAAcE,MAAd,CAAqB,QAArB;AACD,UAPD;AAQD;AA3Q0B,MAA7B;AA6QA,YAAO6N,gBAAP;AACD,IA7RsB,EAAvB;;AA+RA;;;;AAIA,YAAShX,uBAAT,GAAmC,CAAE;AACrCA,2BAAwB6I,SAAxB,GAAoC;AAClC;;;;;;AAMA3I,6BAAwB,gCAAUwU,YAAV,EAAwB/I,SAAxB,EAAmChc,QAAnC,EAA6C;AACnE,cAAO,IAAIqnB,gBAAJ,CAAqB;AAC1BtC,uBAAcA,YADY;AAE1B/I,oBAAWA,SAFe;AAG1Bhc,mBAAUA;AAHgB,QAArB,CAAP;AAKD;AAbiC,IAApC;;AAiBA;;;;;;;AAOA;;;AAGA,OAAImrB,yBAA0B,SAASC,6BAAT,GAAyC;AACrE;;;;AAIA,cAASD,sBAAT,CAAgCxJ,OAAhC,EAAyC;AACvC,YAAK0J,OAAL,GAAe1J,QAAQ0J,OAAvB;AACA,YAAK1b,OAAL,GAAegS,QAAQhS,OAAvB;AACA,YAAK2b,WAAL,GAAmB3J,QAAQ2J,WAA3B;;AAEA,YAAKnZ,GAAL,GAAW,IAAX;AACD;;AAEDgZ,4BAAuBjS,SAAvB;AACI,mDAA+C;;AAEjD;;;;AAIA5f,eAAQ,SAASiyB,6BAAT,CAAuCvrB,QAAvC,EAAiDknB,MAAjD,EAAyD;AAC/D,aAAIzL,OAAO,IAAX;AACA,aAAI+P,aAAa;AACftE,mBAASA,WAAW5R,SAAX,GAAuB,SAAvB,GAAmC4R;AAD7B,UAAjB;;AAIA,cAAKvX,OAAL,CAAapW,cAAb,CAA4BiyB,UAA5B,EAAwClxB,IAAxC,CAA6C,UAAUC,WAAV,EAAuB;AAClEyF,sBAAWA,SAASwjB,KAAT,CAAe,EAAEiI,UAAU,IAAZ,EAAf,CAAX;AACAD,wBAAa;AACXxrB,uBAAUA,QADC;AAEXmS,kBAAKsJ,KAAKtJ,GAFC;AAGX5X,0BAAaA,WAHF;AAIXsG,mBAAM4a,KAAK9L,OAJA;AAKX2b,0BAAa7P,KAAK6P;AALP,YAAb;;AAQA,eAAI7P,KAAKtJ,GAAT,EAAc;AACZ;AACA;AACAvZ,mBAAM8yB,eAAN,CAAsBpI,MAAtB,CAA6BkI,UAA7B;AACD,YAJD,MAIO;AACL;AACA;AACA,iBAAIjxB,YAAY2D,MAAZ,KAAuB,CAA3B,EAA8B;AAC5B;AACD;;AAEDud,kBAAKtJ,GAAL,GAAWtW,SAASkL,aAAT,CAAuB,KAAvB,CAAX;AACA0U,kBAAKtJ,GAAL,CAASgB,SAAT,GAAqB,iBAArB;AACAsI,kBAAK4P,OAAL,CAAahrB,WAAb,CAAyBob,KAAKtJ,GAA9B;AACAqZ,wBAAWrZ,GAAX,GAAiBsJ,KAAKtJ,GAAtB;;AAEAvZ,mBAAM8yB,eAAN,CAAsBpyB,MAAtB,CAA6BkyB,UAA7B;AACA,iBAAI,OAAOG,OAAP,KAAmB,WAAvB,EAAoC;AAClCA,uBAAQC,SAAR,CAAkBnQ,KAAKtJ,GAAvB;AACD;AACF;AACF,UA/BD;AAgCD,QA5CgD;;AA8CjD+H,aAAM,SAAS2R,2BAAT,GAAuC;AAC3C,aAAI,CAAC,KAAK1Z,GAAV,EAAe;AACb;AACD;AACD,cAAKA,GAAL,CAAS7U,YAAT,CAAsB,QAAtB,EAAgC,MAAhC;AACD;AAnDgD,MADnD;;AAuDA,YAAO6tB,sBAAP;AACD,IArE4B,EAA7B;;AAuEA;;;;AAIA,YAASW,6BAAT,GAAyC,CAAE;AAC3CA,iCAA8B5S,SAA9B,GAA0C;AACxC;;;;;AAKAmN,mCAA8B,sCAAUgF,OAAV,EAAmB1b,OAAnB,EAA4B;AACxD,cAAO,IAAIwb,sBAAJ,CAA2B;AAChCE,kBAASA,OADuB;AAEhC1b,kBAASA,OAFuB;AAGhC2b,sBAAa,IAAIS,iBAAJ;AAHmB,QAA3B,CAAP;AAKD;AAZuC,IAA1C;;AAgBA;;;;;;;;;;;AAWA;;;;;AAKA,OAAIC,YAAa,SAASxR,SAAT,GAAqB;AACpC,cAASyR,iBAAT,CAA2BrmB,IAA3B,EAAiC;AAC/B,WAAIzD,OAAO,EAAX;AACA,YAAKjB,IAAL,GAAY,SAASgrB,SAAT,CAAmB3U,IAAnB,EAAyB;AACnC,aAAIvZ,IAAImE,KAAKkC,OAAL,CAAakT,IAAb,CAAR;AACA,aAAIvZ,KAAK,CAAT,EAAY;AACVmE,gBAAK5C,MAAL,CAAYvB,CAAZ,EAAe,CAAf;AACD;AACDmE,cAAKjB,IAAL,CAAUqW,IAAV;AACA,aAAIpV,KAAKjE,MAAL,GAAc0H,IAAlB,EAAwB;AACtBzD,gBAAKgqB,KAAL,GAAazJ,OAAb;AACD;AACF,QATD;AAUA,YAAK0J,MAAL,GAAc,UAAUC,OAAV,EAAmB;AAC/BzmB,gBAAOymB,OAAP;AACA,gBAAOlqB,KAAKjE,MAAL,GAAc0H,IAArB,EAA2B;AACzBzD,gBAAKgqB,KAAL,GAAazJ,OAAb;AACD;AACF,QALD;AAMD;;AAED,cAAS4J,WAAT,CAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;AACvC,WAAIA,aAAaD,QAAjB,EAA2B;AACzB,gBAAO,IAAP;AACD;AACD,WAAIxqB,KAAKoW,GAAL,CAASqU,WAAWD,QAApB,IAAgC,KAApC,EAA2C;AACzC;AACA;AACA,gBAAO,IAAP;AACD;AACD,cAAO,KAAP;AACD;;AAED;;;;AAIA,cAASP,SAAT,CAAmBrK,OAAnB,EAA4B;AAC1B,YAAK3H,SAAL,GAAiB2H,QAAQ3H,SAAzB;AACA,YAAKD,MAAL,GAAc4H,QAAQ5H,MAAR,IAAkB4H,QAAQ3H,SAAR,CAAkByS,iBAAlD;AACA,YAAKnB,WAAL,GAAmB3J,QAAQ2J,WAAR,IAAuB,IAAIS,iBAAJ,EAA1C;AACA,YAAKW,iBAAL,GAAyB/K,QAAQ+K,iBAAR,IAA6B,KAAtD;;AAEA,YAAKC,qBAAL,GAA6B,CAAChL,QAAQE,cAAtC;AACA,WAAI,KAAK8K,qBAAT,EAAgC;AAC9B;AACA,cAAK9K,cAAL,GAAsB,IAAIxC,iBAAJ,EAAtB;AACA,cAAKwC,cAAL,CAAoB/G,SAApB,CAA8B,IAA9B;AACD,QAJD,MAIO;AACL,cAAK+G,cAAL,GAAsBF,QAAQE,cAA9B;AACD;;AAED,YAAK+K,MAAL,GAAcrX,YAAY,KAAKyE,SAAjB,EAA4B,KAAK6S,aAAL,CAAmBrM,IAAnB,CAAwB,IAAxB,CAA5B,CAAd;AACA,YAAKsM,gBAAL,GAAwB,KAAxB;AACA,YAAKC,qBAAL,GAA6BvO,sBAAsBC,OAAnD;AACA,YAAKuO,UAAL;;AAEA,WAAI,KAAKN,iBAAT,EAA4B;AAC1B,cAAK3S,MAAL,CAAYT,SAAZ,CAAsBC,GAAtB,CAA0B,mBAA1B;AACD;AACF;;AAEDyS,eAAU9S,SAAV,GAAsB,iCAAiC;AACrD,WAAIgC,UAAJ,GAAiB;AACf,gBAAO,KAAK+R,MAAL,CAAY/uB,MAAnB;AACD,QAHoD;;AAKrDgvB,oBAAa,qBAAU9rB,KAAV,EAAiB;AAC5B,gBAAO,KAAK6rB,MAAL,CAAY7rB,KAAZ,CAAP;AACD,QAPoD;;AASrD,WAAIga,iBAAJ,GAAwB;AACtB,gBAAO,KAAK+R,kBAAZ;AACD,QAXoD;;AAarD,WAAI/R,iBAAJ,CAAsBzB,GAAtB,EAA2B;AACzB,aAAI,CAAC,KAAKpK,WAAV,EAAuB;AACrB,gBAAK4d,kBAAL,GAA0BxT,GAA1B;AACA;AACD;;AAED,aAAI6D,QAAQ3hB,SAAS4hB,WAAT,CAAqB,UAArB,CAAZ;AACAD,eAAM4P,WAAN,CAAkB,YAAlB,EAAgC,IAAhC,EAAsC,IAAtC,EAA4Chf,MAA5C,EAAoD,CAApD;AACAoP,eAAMsP,gBAAN,GAAyB,KAAKA,gBAA9B;;AAEA,aAAI,EAAE,IAAInT,GAAJ,IAAWA,OAAO,KAAKuB,UAAzB,CAAJ,EAA0C;AACxCsC,iBAAM/jB,UAAN,GAAmB,KAAK0zB,kBAAxB;AACA3P,iBAAM6P,kBAAN,GAA2B1T,GAA3B;AACA,gBAAKK,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;AACA;AACD;;AAEDA,eAAM6P,kBAAN,GAA2B,KAAKF,kBAAhC;AACA,cAAKA,kBAAL,GAA0BxT,GAA1B;AACA6D,eAAM/jB,UAAN,GAAmBkgB,GAAnB;AACA,cAAKK,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;;AAEA;AACA,aAAI,KAAKsP,gBAAT,EAA2B;AACzB;AACD;AACD,cAAKjR,kBAAL,CAAwBlC,GAAxB;AACD,QAxCoD;;AA0CrD;;;AAGA,WAAI2T,YAAJ,GAAmB;AACjB,gBAAO,KAAKC,aAAL,KAAuB/Z,aAAvB,GAAuC,KAAK+Z,aAA5C,GACuCha,aAD9C;AAED,QAhDoD;;AAkDrD;;;AAGA,WAAI+Z,YAAJ,CAAiB3T,GAAjB,EAAsB;AACpB,aAAIC,MAAMD,GAAN,CAAJ,EAAiB;AACf,iBAAM,IAAIpe,KAAJ,CAAU,uBAAV,CAAN;AACD;AACD,aAAI,CAAC,KAAKgU,WAAV,EAAuB;AACrB,gBAAKge,aAAL,GAAqB5T,GAArB;AACA,gBAAK6T,kBAAL,GAA0B7T,QAAQnG,aAAR,GAAwBmG,IAAIzX,QAAJ,EAAxB,GAAyC,IAAnE;AACA;AACD;AACD,cAAKurB,SAAL,CAAe9T,GAAf,EAAoB,KAApB;AACD,QA/DoD;;AAiErD;;;AAGA,WAAIiD,iBAAJ,GAAwB;AACtB,gBAAO,KAAK4Q,kBAAZ;AACD,QAtEoD;;AAwErD;;;AAGA,WAAI5Q,iBAAJ,CAAsBjD,GAAtB,EAA2B;AACzB,aAAI,CAAC,KAAKpK,WAAV,EAAuB;AACrB,gBAAKge,aAAL,GAAqB3T,MAAMD,GAAN,IAAanG,aAAb,GAA6BmG,GAAlD;AACA,gBAAK6T,kBAAL,GAA0B7T,GAA1B;AACA;AACD;AACD,cAAK8T,SAAL,CAAe9T,GAAf,EAAoB,KAApB;AACD,QAlFoD;;AAoFrD;;;AAGA,WAAI+T,aAAJ,GAAoB;AAClB,gBAAO,KAAKC,cAAZ;AACD,QAzFoD;;AA2FrD;;;AAGA,WAAID,aAAJ,CAAkB7qB,QAAlB,EAA4B;AAC1B,cAAK8qB,cAAL,GAAsB9qB,QAAtB;;AAEA,cAAK,IAAI7E,IAAI,CAAR,EAAWC,IAAI,KAAKgvB,MAAL,CAAY/uB,MAAhC,EAAwCF,IAAIC,CAA5C,EAA+CD,GAA/C,EAAoD;AAClD,eAAI4vB,WAAW,KAAKX,MAAL,CAAYjvB,CAAZ,CAAf;AACA4vB,oBAAStK,MAAT,CAAgBsK,SAAS3tB,KAAzB,EAAgC4C,QAAhC;AACD;;AAED,cAAK4qB,SAAL,CAAe,KAAKD,kBAApB,EAAwC,IAAxC;;AAEA,aAAI,KAAKb,qBAAT,EAAgC;AAC9B,gBAAKrJ,MAAL;AACD;AACF,QA3GoD;;AA6GrD;;;AAGA3I,oBAAa,qBAAUpL,WAAV,EAAuB;AAClC,aAAI,KAAKA,WAAT,EAAsB;AACpB,gBAAKyd,UAAL;AACD;;AAED,cAAKzd,WAAL,GAAmBA,WAAnB;AACA,aAAI,CAACA,WAAL,EAAkB;AAChB;AACD;;AAED,aAAI2L,aAAa3L,YAAY4L,QAA7B;AACA,aAAIM,OAAO,IAAX;;AAEA,aAAIoS,mBAAJ;AACA,aAAIC,eAAe,IAAIrtB,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AAChDmtB,iCAAsBntB,OAAtB;AACD,UAFkB,CAAnB;AAGA,cAAKotB,YAAL,GAAoBA,YAApB;AACAA,sBAAaxzB,IAAb,CAAkB,YAAY;AAC5B,eAAIkjB,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,iBAAME,eAAN,CAAsB,aAAtB,EAAqC,IAArC,EAA2C,IAA3C,EAAiD;AAC/CxC,yBAAYA;AADmC,YAAjD;AAGAO,gBAAKzB,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;AACD,UAND;;AAQA,aAAIuQ,4BAA4B,KAAhC;AACA,aAAIC,yBAAyB,IAA7B;AACA,aAAIC,kBAAkB,IAAIxtB,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AACnDstB,oCAAyBttB,OAAzB;AACD,UAFqB,CAAtB;AAGA,cAAKutB,eAAL,GAAuBA,eAAvB;;AAEA,aAAIC,2BAA2B,SAA3BA,wBAA2B,CAAUN,QAAV,EAAoB;AACjDA,oBAAS3L,YAAT,GAAwB,SAASkM,uBAAT,GAAmC;AACzD;AACA;AACA;AACA1S,kBAAK2S,OAAL,CAAaltB,IAAb,CAAkB,IAAlB;AACD,YALD;AAMA;AACA0sB,oBAAS1L,WAAT,GAAuB,SAASmM,sBAAT,GAAkC;AACvD,iBAAI,CAACN,yBAAL,EAAgC;AAC9BA,2CAA4B,IAA5B;AACAC;AACD;AACF,YALD;AAMD,UAdD;;AAgBA,aAAIM,mBAAmB/e,YAAYG,OAAZ,CAAoB,CAApB,CAAvB;AACA,cAAK4e,gBAAL,GAAwBA,gBAAxB;;AAEA;AACA;AACA,gBAAOA,iBAAiBh0B,IAAjB,CAAsB,UAASqV,OAAT,EAAkB;AAC7C,eAAI1P,QAAQ,KAAKqtB,YAAjB;AACA,eAAIttB,WAAW2P,QAAQI,WAAR,CAAoB9P,QAAQoT,SAA5B,CAAf;AACA,gBAAK,IAAI4I,UAAU,CAAnB,EAAsBA,WAAWf,UAAjC,EAA6C,EAAEe,OAA/C,EAAwD;AACtD,iBAAI7L,mBAAmB,IAAvB;AACA,iBAAI,CAACxX,MAAM21B,gBAAX,EAA6B;AAC3Bne,kCAAmB,IAAnB;AACD;AACD,iBAAIwd,WAAW,IAAInM,WAAJ,CAAgB;AAC7BzH,0BAAW,KAAKD,MADa;AAE7BjP,mBAAImR,OAFyB;AAG7Bhc,sBAAOA,KAHsB;AAI7B2hB,gCAAiB5hB,SAASwjB,KAAT,EAJY;AAK7B3B,+BAAgB,KAAKA,cALQ;AAM7BzR,iCAAkBA,gBANW;AAO7B0R,uCAAwB;AAPK,cAAhB,CAAf;AASAoM,sCAAyBN,QAAzB;AACA,kBAAKX,MAAL,CAAY/rB,IAAZ,CAAiB0sB,QAAjB;AACD;;AAED,eAAItC,cAAc,KAAKA,WAAvB;;AAEA;AACA;AACA;AACA2C,2BAAgB3zB,IAAhB,CAAqB,YAAY;AAC/B,iBAAI,CAAC1B,MAAM41B,gBAAX,EAA6B;AAC3B,mBAAIC,eAAevT,UAAnB;AACA,oBAAK,IAAIe,UAAU,CAAnB,EAAsBA,WAAWf,UAAjC,EAA6C,EAAEe,OAA/C,EAAwD;AACtD1M,6BAAYG,OAAZ,CAAoBuM,OAApB,EAA6B3hB,IAA7B,CAAkC,UAAU2hB,OAAV,EAAmBtM,OAAnB,EAA4B;AAC5D,uBAAIie,WAAWnS,KAAKwR,MAAL,CAAYhR,UAAU,CAAtB,CAAf;AACA,uBAAI,CAAC2R,SAASje,OAAd,EAAuB;AACrBie,8BAASvL,UAAT,CAAoB1S,OAApB;AACD;AACD2b,+BAAYlN,YAAZ,CAAyBnC,OAAzB,EAAkCtM,QAAQ+e,GAA1C;AACAD;AACA,uBAAI,CAACA,YAAL,EAAmB;AACjBZ;AACD;AACF,kBAViC,CAUhCrN,IAVgC,CAU3B,IAV2B,EAUrBvE,OAVqB,CAAlC;AAWD;AACF,cAfD,MAeO;AACL;AACA4R;AACD;AACF,YApBD;;AAsBA,eAAIrQ,QAAQ3hB,SAAS4hB,WAAT,CAAqB,aAArB,CAAZ;AACAD,iBAAME,eAAN,CAAsB,WAAtB,EAAmC,IAAnC,EAAyC,IAAzC,EAA+C,IAA/C;AACAjC,gBAAKzB,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;;AAEA,eAAI,KAAKmP,qBAAT,EAAgC;AAC9B,kBAAKrJ,MAAL;AACD;;AAED,eAAI,KAAKsE,cAAT,EAAyB;AACvB,kBAAKA,cAAL,CAAoB+G,gBAApB;AACD;AACF,UA3D4B,CA2D3BnO,IA3D2B,CA2DtB,IA3DsB,CAAtB,CAAP;AA4DD,QAlOoD;;AAoOrDwM,mBAAY,sBAAY;AACtB,cAAKC,MAAL,GAAc,EAAd;AACA,cAAKE,kBAAL,GAA0B,CAA1B;AACA,cAAKI,aAAL,GAAqB/Z,aAArB;AACA,cAAKga,kBAAL,GAA0B,IAA1B;AACA,cAAKY,OAAL,GAAe,IAAInC,iBAAJ,CAAsBnN,kBAAtB,CAAf;AACA,cAAK8P,SAAL,GAAiB,IAAjB;AACA,cAAKjB,cAAL,GAAsB,CAAtB;AACA,cAAKkB,cAAL,GAAsB,EAAtB;;AAEA,aAAI7U,YAAY,KAAKD,MAArB;AACA,gBAAOC,UAAU8U,aAAV,EAAP,EAAkC;AAChC9U,qBAAU1Z,WAAV,CAAsB0Z,UAAU+U,SAAhC;AACD;AACF,QAlPoD;;AAoPrDlC,sBAAe,SAASmC,sBAAT,GAAkC;AAC/C,aAAI,KAAK9T,UAAL,KAAoB,CAAxB,EAA2B;AACzB;AACD;AACD,cAAKoI,MAAL;AACA,cAAK,IAAItlB,IAAI,CAAR,EAAWuY,KAAK,KAAK0W,MAAL,CAAY/uB,MAAjC,EAAyCF,IAAIuY,EAA7C,EAAiDvY,GAAjD,EAAsD;AACpD,gBAAKivB,MAAL,CAAYjvB,CAAZ,EAAeimB,cAAf;AACD;AACF,QA5PoD;;AA8PrDgL,+BAAwB,SAASC,+BAAT,CACpB1C,QADoB,EACV2C,QADU,EACAC,MADA,EACQ;AAC9B,aAAI5R,QAAQ3hB,SAAS4hB,WAAT,CAAqB,UAArB,CAAZ;AACAD,eAAM4P,WAAN,CAAkB,aAAlB,EAAiC,IAAjC,EAAuC,IAAvC,EAA6Chf,MAA7C,EAAqD,CAArD;AACAoP,eAAMvd,KAAN,GAAcusB,QAAd;AACA,aAAI4C,MAAJ,EAAY;AACV5R,iBAAM6R,WAAN,GAAoBF,QAApB;AACD;AACD,cAAKnV,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;AACD,QAvQoD;;AAyQrD8R,6BAAsB,SAASC,6BAAT,CAClB/C,QADkB,EACR2C,QADQ,EACEK,QADF,EACYJ,MADZ,EACoB;AACxC,cAAK5B,kBAAL,GAA0B2B,QAA1B;;AAEA,aAAI7C,YAAY,KAAKiB,aAAjB,EAAgCf,QAAhC,CAAJ,EAA+C;AAC7C,eAAI4C,MAAJ,EAAY;AACV,kBAAKH,sBAAL,CAA4BzC,QAA5B,EAAsC2C,QAAtC,EAAgD,IAAhD;AACD;AACD;AACD;;AAED,cAAK,IAAInxB,IAAI,CAAR,EAAWuY,KAAK,KAAK0W,MAAL,CAAY/uB,MAAjC,EAAyCF,IAAIuY,EAA7C,EAAiDvY,GAAjD,EAAsD;AACpD,gBAAKivB,MAAL,CAAYjvB,CAAZ,EAAeslB,MAAf,CAAsBkJ,QAAtB;AACD;AACD,cAAKe,aAAL,GAAqBf,QAArB;;AAEA,aAAI,CAACgD,QAAL,EAAe;AACb,eAAI3uB,OAAO,KAAKssB,kBAAhB;AAAA,eAAoC5R,IAApC;AACA,eAAI,KAAKqT,SAAL,IAAkB,CAAC/P,+BAAnB,IACA,EAAE,KAAK4Q,oBAAL,IAA6B,KAAKC,0BAApC,CADJ,EACqE;AACnE7uB,oBAAO,KAAK+tB,SAAL,CAAen1B,UAAtB;AACA8hB,oBAAO,CAAC,IAAD,EAAO,EAAEjgB,MAAM,KAAR,EAAP,EAAwB,KAAKszB,SAAL,CAAenwB,IAAvC,EACC,KAAKmwB,SAAL,CAAerwB,GADhB,EACqB,IADrB,CAAP;AAED;AACD,gBAAKsd,kBAAL,CAAwBhb,IAAxB,EAA8B0a,IAA9B;AACD;;AAED,cAAK0T,sBAAL,CAA4BzC,QAA5B,EAAsC2C,QAAtC,EAAgDC,MAAhD;;AAEA,aAAI,KAAKzC,qBAAT,EAAgC;AAC9B,gBAAKrJ,MAAL;AACD;AACF,QAzSoD;;AA2SrDmK,kBAAW,SAASkC,kBAAT,CAA4BxiB,KAA5B,EAAmCqiB,QAAnC,EAA6C;AACtD,aAAIvvB,QAAQ6c,WAAW3P,KAAX,CAAZ;;AAEA,aAAIlN,QAAQ,CAAZ,EAAe;AACb,gBAAKqvB,oBAAL,CAA0BrvB,KAA1B,EAAiCkN,KAAjC,EAAwCqiB,QAAxC,EAAkD,KAAlD;AACD,UAFD,MAEO;AACL,eAAII,cAAc,KAAK3C,MAAL,CAAY,KAAKE,kBAAL,GAA0B,CAAtC,CAAlB;AACA,eAAI,CAACyC,WAAL,EAAkB;AAChB;AACD;AACD,eAAIC,WAAY,KAAKJ,oBAAL,IAA6B,KAAK/C,iBAAnC,GACb,CADa,GACThZ,iBADN;AAEA,eAAIoc,WAAY,KAAKL,oBAAL,IAA6B,KAAK/C,iBAAnC,GACb,CADa,GACT/Y,gBADN;AAEA,eAAIoc,iBAAiB,CAAC,KAAK/V,SAAL,CAAe3C,WAAf,GAA6BwY,QAA9B,IACAD,YAAY/vB,KADZ,GACoB+vB,YAAY3vB,KADrD;AAEA,eAAI+vB,kBAAkB,CAAC,KAAKhW,SAAL,CAAehF,YAAf,GAA8B8a,QAA/B,IACAF,YAAYhwB,MADZ,GACqBgwB,YAAY3vB,KADvD;AAEA,mBAAQkN,KAAR;AACE,kBAAK,aAAL;AACElN,uBAAQ,CAAR;AACA;AACF,kBAAK,YAAL;AACEA,uBAAQ8vB,cAAR;AACA;AACF,kBAAK,aAAL;AACE9vB,uBAAQ+vB,eAAR;AACA;AACF,kBAAK,UAAL;AACE/vB,uBAAQ8B,KAAKiS,GAAL,CAAS+b,cAAT,EAAyBC,eAAzB,CAAR;AACA;AACF,kBAAK,MAAL;AACE,mBAAIC,cAAeL,YAAY/vB,KAAZ,GAAoB+vB,YAAYhwB,MAAnD;AACA;AACA;AACA,mBAAIswB,kBAAkBD,cACpBluB,KAAKiS,GAAL,CAASgc,eAAT,EAA0BD,cAA1B,CADoB,GACwBA,cAD9C;AAEA9vB,uBAAQ8B,KAAKiS,GAAL,CAASP,cAAT,EAAyByc,eAAzB,CAAR;AACA;AACF;AACEzb,uBAAQC,KAAR,CAAc,wBAAwBvH,KAAxB,GACZ,8BADF;AAEA;AAxBJ;AA0BA,gBAAKmiB,oBAAL,CAA0BrvB,KAA1B,EAAiCkN,KAAjC,EAAwCqiB,QAAxC,EAAkD,IAAlD;AACD;AACF,QAzVoD;;AA2VrD;;;;;;AAMA3T,2BAAoB,SAASsU,4BAAT,CAAsC12B,UAAtC,EACsC8hB,IADtC,EAC4C;AAC9D,aAAI,CAAC,KAAKhM,WAAV,EAAuB;AACrB;AACD;;AAED,aAAIqe,WAAW,KAAKX,MAAL,CAAYxzB,aAAa,CAAzB,CAAf;;AAEA,aAAI,KAAKg2B,oBAAT,EAA+B;AAC7B,eAAI,KAAKtC,kBAAL,KAA4BS,SAAS9iB,EAAzC,EAA6C;AAC3C;AACA,kBAAKsQ,iBAAL,GAAyBwS,SAAS9iB,EAAlC;AACA;AACD;AACDyQ,kBAAO,IAAP;AACA;AACA,gBAAKkS,SAAL,CAAe,KAAKD,kBAApB,EAAwC,IAAxC;AACD;AACD,aAAI,CAACjS,IAAL,EAAW;AACTpH,0BAAeyZ,SAASzb,GAAxB;AACA;AACD;;AAED,aAAIvU,IAAI,CAAR;AAAA,aAAWC,IAAI,CAAf;AACA,aAAIgC,QAAQ,CAAZ;AAAA,aAAeD,SAAS,CAAxB;AAAA,aAA2BwwB,UAA3B;AAAA,aAAuCC,WAAvC;AACA,aAAIC,oBAAqB1C,SAAS/qB,QAAT,GAAoB,GAApB,KAA4B,CAA5B,GAAgC,KAAhC,GAAwC,IAAjE;AACA,aAAI0tB,YAAY,CAACD,oBAAoB1C,SAAShuB,MAA7B,GAAsCguB,SAAS/tB,KAAhD,IACd+tB,SAAS3tB,KADK,GACGoT,SADnB;AAEA,aAAImd,aAAa,CAACF,oBAAoB1C,SAAS/tB,KAA7B,GAAqC+tB,SAAShuB,MAA/C,IACfguB,SAAS3tB,KADM,GACEoT,SADnB;AAEA,aAAIpT,QAAQ,CAAZ;AACA,iBAAQsb,KAAK,CAAL,EAAQjgB,IAAhB;AACE,gBAAK,KAAL;AACEsC,iBAAI2d,KAAK,CAAL,CAAJ;AACA1d,iBAAI0d,KAAK,CAAL,CAAJ;AACAtb,qBAAQsb,KAAK,CAAL,CAAR;AACA;AACA;AACA;AACA;AACA3d,iBAAIA,MAAM,IAAN,GAAaA,CAAb,GAAiB,CAArB;AACAC,iBAAIA,MAAM,IAAN,GAAaA,CAAb,GAAiB2yB,UAArB;AACA;AACF,gBAAK,KAAL;AACA,gBAAK,MAAL;AACEvwB,qBAAQ,UAAR;AACA;AACF,gBAAK,MAAL;AACA,gBAAK,OAAL;AACEpC,iBAAI0d,KAAK,CAAL,CAAJ;AACAtb,qBAAQ,YAAR;AACA;AACA;AACA,iBAAIpC,MAAM,IAAN,IAAc,KAAK+wB,SAAvB,EAAkC;AAChChxB,mBAAI,KAAKgxB,SAAL,CAAenwB,IAAnB;AACAZ,mBAAI,KAAK+wB,SAAL,CAAerwB,GAAnB;AACD;AACD;AACF,gBAAK,MAAL;AACA,gBAAK,OAAL;AACEX,iBAAI2d,KAAK,CAAL,CAAJ;AACA1b,qBAAQ0wB,SAAR;AACA3wB,sBAAS4wB,UAAT;AACAvwB,qBAAQ,aAAR;AACA;AACF,gBAAK,MAAL;AACErC,iBAAI2d,KAAK,CAAL,CAAJ;AACA1d,iBAAI0d,KAAK,CAAL,CAAJ;AACA1b,qBAAQ0b,KAAK,CAAL,IAAU3d,CAAlB;AACAgC,sBAAS2b,KAAK,CAAL,IAAU1d,CAAnB;AACA,iBAAIgyB,WAAW,KAAKnD,iBAAL,GAAyB,CAAzB,GAA6BhZ,iBAA5C;AACA,iBAAIoc,WAAW,KAAKpD,iBAAL,GAAyB,CAAzB,GAA6B/Y,gBAA5C;;AAEAyc,0BAAa,CAAC,KAAKpW,SAAL,CAAe3C,WAAf,GAA6BwY,QAA9B,IACXhwB,KADW,GACHwT,SADV;AAEAgd,2BAAc,CAAC,KAAKrW,SAAL,CAAehF,YAAf,GAA8B8a,QAA/B,IACZlwB,MADY,GACHyT,SADX;AAEApT,qBAAQ8B,KAAKiS,GAAL,CAASjS,KAAKoW,GAAL,CAASiY,UAAT,CAAT,EAA+BruB,KAAKoW,GAAL,CAASkY,WAAT,CAA/B,CAAR;AACA;AACF;AACE;AAjDJ;;AAoDA,aAAIpwB,SAASA,UAAU,KAAKstB,aAA5B,EAA2C;AACzC,gBAAK3Q,iBAAL,GAAyB3c,KAAzB;AACD,UAFD,MAEO,IAAI,KAAKstB,aAAL,KAAuB/Z,aAA3B,EAA0C;AAC/C,gBAAKoJ,iBAAL,GAAyBtJ,mBAAzB;AACD;;AAED,aAAIrT,UAAU,UAAV,IAAwB,CAACsb,KAAK,CAAL,CAA7B,EAAsC;AACpCpH,0BAAeyZ,SAASzb,GAAxB;AACA;AACD;;AAED,aAAIxD,eAAe,CACjBif,SAAS5tB,QAAT,CAAkBywB,sBAAlB,CAAyC7yB,CAAzC,EAA4CC,CAA5C,CADiB,EAEjB+vB,SAAS5tB,QAAT,CAAkBywB,sBAAlB,CAAyC7yB,IAAIiC,KAA7C,EAAoDhC,IAAI+B,MAAxD,CAFiB,CAAnB;AAIA,aAAInB,OAAOsD,KAAKiS,GAAL,CAASrF,aAAa,CAAb,EAAgB,CAAhB,CAAT,EAA6BA,aAAa,CAAb,EAAgB,CAAhB,CAA7B,CAAX;AACA,aAAIpQ,MAAMwD,KAAKiS,GAAL,CAASrF,aAAa,CAAb,EAAgB,CAAhB,CAAT,EAA6BA,aAAa,CAAb,EAAgB,CAAhB,CAA7B,CAAV;;AAEAwF,wBAAeyZ,SAASzb,GAAxB,EAA6B,EAAE1T,MAAMA,IAAR,EAAcF,KAAKA,GAAnB,EAA7B;AACD,QAvcoD;;AAycrDmyB,wBAAiB,yBAAUC,SAAV,EAAqB;AACpC,aAAIrD,eAAe,KAAKC,aAAxB;AACA,aAAI3Q,oBAAoB,KAAK4Q,kBAA7B;AACA,aAAIoD,uBACF9T,WAAWF,iBAAX,MAAkC0Q,YAAlC,GACAvrB,KAAKqQ,KAAL,CAAWkb,eAAe,KAA1B,IAAmC,GADnC,GACyC1Q,iBAF3C;;AAIA,aAAInjB,aAAak3B,UAAU7lB,EAA3B;AACA,aAAI4R,gBAAgB,WAAWjjB,UAA/B;AACAijB,0BAAiB,WAAWkU,oBAA5B;AACA,aAAIC,kBAAkB,KAAK5D,MAAL,CAAYxzB,aAAa,CAAzB,CAAtB;AACA,aAAIugB,YAAY,KAAKA,SAArB;AACA,aAAI8W,UAAUD,gBAAgB3L,YAAhB,CACXlL,UAAU7Z,UAAV,GAAuBwwB,UAAU/yB,CADtB,EAEXoc,UAAU9Z,SAAV,GAAsBywB,UAAU9yB,CAFrB,CAAd;AAGA,aAAIkzB,UAAUhvB,KAAKqQ,KAAL,CAAW0e,QAAQ,CAAR,CAAX,CAAd;AACA,aAAIE,SAASjvB,KAAKqQ,KAAL,CAAW0e,QAAQ,CAAR,CAAX,CAAb;AACApU,0BAAiB,MAAMqU,OAAN,GAAgB,GAAhB,GAAsBC,MAAvC;;AAEA,cAAKpC,SAAL,GAAiB;AACfn1B,uBAAYA,UADG;AAEfwG,kBAAO2wB,oBAFQ;AAGfryB,gBAAKyyB,MAHU;AAIfvyB,iBAAMsyB,OAJS;AAKfrU,0BAAeA;AALA,UAAjB;AAOD,QAneoD;;AAqerD4G,eAAQ,SAAS2N,gBAAT,GAA4B;AAClC,aAAIxZ,UAAU,KAAKyZ,gBAAL,EAAd;AACA,aAAIC,eAAe1Z,QAAQN,KAA3B;AACA,aAAIga,aAAajzB,MAAb,KAAwB,CAA5B,EAA+B;AAC7B;AACD;;AAED,cAAK4uB,gBAAL,GAAwB,IAAxB;;AAEA,aAAIsE,qBAAqBrvB,KAAK4F,GAAL,CAASmX,kBAAT,EACrB,IAAIqS,aAAajzB,MAAjB,GAA0B,CADL,CAAzB;AAEA,cAAKkwB,OAAL,CAAahC,MAAb,CAAoBgF,kBAApB;;AAEA,cAAKvP,cAAL,CAAoB1B,qBAApB,CAA0C1I,OAA1C;;AAEA,aAAI4Z,YAAY,KAAKlE,kBAArB;AACA,aAAIwD,YAAYlZ,QAAQ7Q,KAAxB;;AAEA,cAAK,IAAI5I,IAAI,CAAR,EAAWuY,KAAK4a,aAAajzB,MAA7B,EAAqCozB,oBAAoB,KAA9D,EACKtzB,IAAIuY,EADT,EACa,EAAEvY,CADf,EACkB;AAChB,eAAI6C,OAAOswB,aAAanzB,CAAb,CAAX;;AAEA,eAAI6C,KAAKoX,OAAL,GAAe,GAAnB,EAAwB;AACtB;AACD;AACD,eAAIpX,KAAKiK,EAAL,KAAYumB,SAAhB,EAA2B;AACzBC,iCAAoB,IAApB;AACA;AACD;AACF;;AAED,aAAI,CAACA,iBAAL,EAAwB;AACtBD,uBAAYF,aAAa,CAAb,EAAgBrmB,EAA5B;AACD;;AAED,aAAI,CAAC,KAAK2kB,oBAAV,EAAgC;AAC9B,gBAAKrU,iBAAL,GAAyBiW,SAAzB;AACD;;AAED,cAAKX,eAAL,CAAqBC,SAArB;;AAEA,cAAK7D,gBAAL,GAAwB,KAAxB;;AAEA,aAAItP,QAAQ3hB,SAAS4hB,WAAT,CAAqB,UAArB,CAAZ;AACAD,eAAM4P,WAAN,CAAkB,gBAAlB,EAAoC,IAApC,EAA0C,IAA1C,EAAgDhf,MAAhD,EAAwD,CAAxD;AACAoP,eAAM+T,QAAN,GAAiB,KAAK3C,SAAtB;AACA,cAAK5U,SAAL,CAAe6D,aAAf,CAA6BL,KAA7B;AACD,QAphBoD;;AAshBrDgU,wBAAiB,yBAAUpd,OAAV,EAAmB;AAClC,gBAAO,KAAK4F,SAAL,CAAeyX,QAAf,CAAwBrd,OAAxB,CAAP;AACD,QAxhBoD;;AA0hBrDvG,cAAO,iBAAY;AACjB,cAAKmM,SAAL,CAAenM,KAAf;AACD,QA5hBoD;;AA8hBrD,WAAI4hB,oBAAJ,GAA2B;AACzB,gBAAO,KAAK1C,qBAAL,KAA+BvO,sBAAsBI,UAA5D;AACD,QAhiBoD;;AAkiBrD,WAAI8Q,0BAAJ,GAAiC;AAC/B,gBAAO,KAAK3C,qBAAL,KAA+BvO,sBAAsBG,QAA5D;AACD,QApiBoD;;AAsiBrD,WAAI+S,4BAAJ,GAAmC;AACjC,gBAAQ,KAAKjC,oBAAL,GACN,KADM,GACG,KAAKzV,SAAL,CAAe2X,WAAf,GAA6B,KAAK3X,SAAL,CAAe3C,WADvD;AAED,QAziBoD;;AA2iBrD6Z,yBAAkB,4BAAY;AAC5B,aAAI,CAAC,KAAKzB,oBAAV,EAAgC;AAC9B,kBAAOxY,mBAAmB,KAAK+C,SAAxB,EAAmC,KAAKiT,MAAxC,EAAgD,IAAhD,CAAP;AACD,UAFD,MAEO;AACL;AACA;AACA,eAAIxV,UAAU,EAAd;AACA,eAAImY,cAAc,KAAK3C,MAAL,CAAY,KAAKE,kBAAL,GAA0B,CAAtC,CAAlB;AACA1V,mBAAQvW,IAAR,CAAa,EAAE4J,IAAI8kB,YAAY9kB,EAAlB,EAAsByM,MAAMqY,WAA5B,EAAb;AACA,kBAAO,EAAEhpB,OAAOgpB,WAAT,EAAsB/oB,MAAM+oB,WAA5B,EAAyCzY,OAAOM,OAAhD,EAAP;AACD;AACF,QAtjBoD;;AAwjBrDmL,gBAAS,mBAAY;AACnB,cAAK,IAAI5kB,IAAI,CAAR,EAAWuY,KAAK,KAAK0W,MAAL,CAAY/uB,MAAjC,EAAyCF,IAAIuY,EAA7C,EAAiDvY,GAAjD,EAAsD;AACpD,eAAI,KAAKivB,MAAL,CAAYjvB,CAAZ,KACA,KAAKivB,MAAL,CAAYjvB,CAAZ,EAAekjB,cAAf,KAAkClC,gBAAgBI,QADtD,EACgE;AAC9D,kBAAK6N,MAAL,CAAYjvB,CAAZ,EAAeykB,KAAf;AACD;AACF;AACF,QA/jBoD;;AAikBrD;;;;;AAKAmP,6BAAsB,8BAAUhE,QAAV,EAAoB;AACxC,aAAIA,SAASje,OAAb,EAAsB;AACpB,kBAAOlP,QAAQC,OAAR,CAAgBktB,SAASje,OAAzB,CAAP;AACD;AACD,aAAIlW,aAAam0B,SAAS9iB,EAA1B;AACA,aAAI,KAAK+jB,cAAL,CAAoBp1B,UAApB,CAAJ,EAAqC;AACnC,kBAAO,KAAKo1B,cAAL,CAAoBp1B,UAApB,CAAP;AACD;AACD,aAAI4O,UAAU,KAAKkH,WAAL,CAAiBG,OAAjB,CAAyBjW,UAAzB,EAAqCa,IAArC,CACV,UAAUqV,OAAV,EAAmB;AACrBie,oBAASvL,UAAT,CAAoB1S,OAApB;AACA,gBAAKkf,cAAL,CAAoBp1B,UAApB,IAAkC,IAAlC;AACA,kBAAOkW,OAAP;AACD,UAJG,CAIF6Q,IAJE,CAIG,IAJH,CADU,CAAd;AAMA,cAAKqO,cAAL,CAAoBp1B,UAApB,IAAkC4O,OAAlC;AACA,gBAAOA,OAAP;AACD,QAtlBoD;;AAwlBrDkY,uBAAgB,wBAAUF,qBAAV,EAAiC;AAC/C,aAAI8Q,eAAe9Q,yBAAyB,KAAK6Q,gBAAL,EAA5C;AACA,aAAItD,WAAW,KAAK/L,cAAL,CAAoBpB,kBAApB,CAAuC0Q,YAAvC,EACuC,KAAKlE,MAD5C,EAEuC,KAAKL,MAAL,CAAY1W,IAFnD,CAAf;AAGA,aAAI0X,QAAJ,EAAc;AACZ,gBAAKgE,oBAAL,CAA0BhE,QAA1B,EAAoCtzB,IAApC,CAAyC,YAAY;AACnD,kBAAKunB,cAAL,CAAoBV,UAApB,CAA+ByM,QAA/B;AACD,YAFwC,CAEvCpN,IAFuC,CAElC,IAFkC,CAAzC;AAGA,kBAAO,IAAP;AACD;AACD,gBAAO,KAAP;AACD,QApmBoD;;AAsmBrDqR,2BAAoB,4BAAU7V,SAAV,EAAqB;AACvC,gBAAO,KAAKzM,WAAL,CAAiBG,OAAjB,CAAyBsM,YAAY,CAArC,EAAwC1hB,IAAxC,CAA6C,UAAUuG,IAAV,EAAgB;AAClE,kBAAOA,KAAKoP,cAAL,CAAoB,EAAEC,qBAAqB,IAAvB,EAApB,CAAP;AACD,UAFM,CAAP;AAGD,QA1mBoD;;AA4mBrD;;;;;;AAMAK,+BAAwB,gCAAUwU,YAAV,EAAwB/I,SAAxB,EAAmChc,QAAnC,EAA6C;AACnE,gBAAO,IAAIqnB,gBAAJ,CAAqB;AAC1BtC,yBAAcA,YADY;AAE1B/I,sBAAWA,SAFe;AAG1Bhc,qBAAUA,QAHgB;AAI1B4nB,2BAAgB,KAAK6H,oBAAL,GAA4B,IAA5B,GAAmC,KAAK7H;AAJ9B,UAArB,CAAP;AAMD,QAznBoD;;AA2nBrD;;;;;AAKAvB,qCAA8B,sCAAUgF,OAAV,EAAmB1b,OAAnB,EAA4B;AACxD,gBAAO,IAAIwb,sBAAJ,CAA2B;AAChCE,oBAASA,OADuB;AAEhC1b,oBAASA,OAFuB;AAGhC2b,wBAAa,KAAKA;AAHc,UAA3B,CAAP;AAKD,QAtoBoD;;AAwoBrDwG,0BAAmB,2BAAUlK,cAAV,EAA0B;AAC3C,cAAKA,cAAL,GAAsBA,cAAtB;AACD;AA1oBoD,MAAvD;;AA6oBA,YAAOoE,SAAP;AACD,IA5sBe,EAAhB;;AA8sBA,OAAID,oBAAqB,SAASgG,wBAAT,GAAoC;AAC3D,cAAShG,iBAAT,GAA6B,CAAE;;AAE/BA,uBAAkB7S,SAAlB,GAA8B;AAC5B;;;AAGA,WAAIrY,IAAJ,GAAW;AACT,gBAAO,CAAP;AACD,QAN2B;AAO5B;;;AAGA,WAAIA,IAAJ,CAASsM,KAAT,EAAgB,CAAE,CAVU;AAW5B;;;AAGAkO,mBAAY,oBAAUE,IAAV,EAAgB,CAAE,CAdF;AAe5B;;;;AAIAe,2BAAoB,4BAAUf,IAAV,EAAgB;AAClC,gBAAO,GAAP;AACD,QArB2B;AAsB5B;;;;AAIAiB,qBAAc,sBAAUV,IAAV,EAAgB;AAC5B,gBAAO,GAAP;AACD,QA5B2B;AA6B5B;;;AAGAkB,gBAAS,iBAAUlB,IAAV,EAAgB,CAAE,CAhCC;AAiC5B;;;AAGAiC,2BAAoB,4BAAUE,MAAV,EAAkB,CAAE,CApCZ;AAqC5B;;;;AAIAG,qBAAc,sBAAUnC,OAAV,EAAmBqC,OAAnB,EAA4B,CAAE;AAzChB,MAA9B;AA2CA,YAAOyN,iBAAP;AACD,IA/CuB,EAAxB;;AAkDA,OAAIiG,aAAc,YAAY;AAC5B,cAASA,UAAT,CAAoBrQ,OAApB,EAA6B;AAC3B,YAAK2J,WAAL,GAAmB3J,QAAQ2J,WAA3B;;AAEA,YAAK2G,WAAL,GAAmB,KAAnB;AACA,YAAKC,kBAAL,GAA0B,IAA1B;AACA,YAAKC,eAAL,GAAuB,IAAvB;AACD;;AAEDH,gBAAW9Y,SAAX,GAAuB;AACrB;;;;AAIAkZ,mBAAY,SAASC,oBAAT,CAA8BC,WAA9B,EAA2C;AACrD,cAAKL,WAAL,GAAmB,IAAnB;AACA,cAAKM,aAAL,GAAqB,KAArB;AACA,cAAKC,eAAL,GAAuB,IAAvB;AACA,cAAKC,eAAL,GAAuB,IAAvB;AACA,cAAKC,0BAAL,GAAkC,KAAlC;;AAEA,cAAKC,YAAL,GAAoBvkB,OAAOmjB,QAAP,CAAgBzV,IAAhB,CAAqB7H,SAArB,CAA+B,CAA/B,CAApB;AACA,cAAK2e,eAAL,GAAuB,EAAvB;AACA,cAAKhD,WAAL,GAAmB,CAAnB;AACA,cAAKiD,sBAAL,GAA8B,KAA9B;AACA,cAAKC,gBAAL,GAAwB,EAAxB;AACA,cAAKC,YAAL,GAAoB,CAApB;AACA,cAAKC,aAAL,GAAqB,EAArB;;AAEA,cAAKV,WAAL,GAAmBA,WAAnB;AACA,cAAKW,UAAL,GAAkB,KAAKC,GAAL,GAAW,CAA7B;AACA,cAAKC,OAAL,GAAe,EAAf;;AAEA,aAAIld,QAAQ7H,OAAOglB,OAAP,CAAend,KAA3B;AACA,aAAI,KAAKod,qBAAL,CAA2Bpd,KAA3B,CAAJ,EAAuC;AACrC;AACA;AACA,eAAIA,MAAM/Z,MAAN,CAAaqf,IAAjB,EAAuB;AACrB,kBAAK2W,kBAAL,GAA0Bjc,MAAM/Z,MAAN,CAAaqf,IAAvC;AACD,YAFD,MAEO;AACL,kBAAK4W,eAAL,GAAuBlc,MAAM/Z,MAAN,CAAa4f,IAApC;AACD;AACD,gBAAKmX,UAAL,GAAkBhd,MAAMid,GAAxB;AACA,gBAAKA,GAAL,GAAWjd,MAAMid,GAAN,GAAY,CAAvB;AACA,gBAAKC,OAAL,GAAeld,MAAM/Z,MAArB;AACD,UAXD,MAWO;AACL;AACA,eAAI+Z,SAASA,MAAMqc,WAAf,IACF,KAAKA,WAAL,KAAqBrc,MAAMqc,WAD7B,EAC0C;AACxC;AACA;AACA,kBAAKC,aAAL,GAAqB,IAArB;AACD;AACD,gBAAKe,mBAAL,CAAyB,EAAChB,aAAa,KAAKA,WAAnB,EAAzB,EAA0D,IAA1D;AACD;;AAED,aAAI7W,OAAO,IAAX;AACArN,gBAAO3S,gBAAP,CAAwB,UAAxB,EAAoC,SAAS83B,kBAAT,CAA4B5d,GAA5B,EAAiC;AACnE,eAAI,CAAC8F,KAAKgX,eAAV,EAA2B;AACzB;AACD;AACD,eAAI9c,IAAIM,KAAR,EAAe;AACb;AACAwF,kBAAK+X,KAAL,CAAW7d,IAAIM,KAAf;AACA;AACD;;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,eAAIwF,KAAKyX,GAAL,KAAa,CAAjB,EAAoB;AAClB;AACA,iBAAIO,iBAAkBhY,KAAKkX,YAAL,IAAqBlX,KAAKmX,eAA1B,IACpBnX,KAAKkX,YAAL,KAAsBlX,KAAKmX,eADR,GAEnB,EAAC9W,MAAML,KAAKmX,eAAZ,EAA6B/xB,MAAM4a,KAAKmU,WAAxC,EAFmB,GAGnB,EAAC/uB,MAAM,CAAP,EAHF;AAIA6yB,yCAA4BD,cAA5B,EAA4C,YAAW;AACrDE;AACD,cAFD;AAGD,YATD,MASO;AACLA;AACD;AACF,UA/BD,EA+BG,KA/BH;;AAkCA,kBAASA,4BAAT,GAAwC;AACtClY,gBAAKkX,YAAL,GAAoBvkB,OAAOmjB,QAAP,CAAgBzV,IAAhB,CAAqB8X,KAArB,CAA2B,CAA3B,CAApB;AACAnY,gBAAKoY,cAAL,CAAoB,EAAC/X,MAAML,KAAKkX,YAAZ,EAApB,EAA+C,KAA/C,EAAsD,IAAtD;AACAlX,gBAAKqY,uBAAL;AACD;;AAED,kBAASJ,2BAAT,CAAqCpd,MAArC,EAA6Cb,QAA7C,EAAuD;AACrD;AACA;AACA;AACA;AACA;AACA;AACAgG,gBAAKgX,eAAL,GAAuB,KAAvB;;AAEA;AACA;AACAhX,gBAAK+W,eAAL,GAAuB,KAAvB;AACApkB,kBAAO3S,gBAAP,CAAwB,UAAxB,EAAoCs4B,uBAApC;AACAX,mBAAQlV,IAAR;;AAEA,oBAAS6V,uBAAT,GAAmC;AACjC3lB,oBAAO1S,mBAAP,CAA2B,UAA3B,EAAuCq4B,uBAAvC;AACA3lB,oBAAO3S,gBAAP,CAAwB,UAAxB,EAAoCu4B,0BAApC;AACAvY,kBAAKoY,cAAL,CAAoBvd,MAApB,EAA4B,KAA5B,EAAmC,IAAnC;AACA8c,qBAAQjV,OAAR;AACD;AACD,oBAAS6V,0BAAT,GAAsC;AACpC5lB,oBAAO1S,mBAAP,CAA2B,UAA3B,EAAuCs4B,0BAAvC;AACAvY,kBAAK+W,eAAL,GAAuB,IAAvB;AACA/W,kBAAKgX,eAAL,GAAuB,IAAvB;AACAhd;AACD;AACF;;AAED,kBAASwe,sBAAT,GAAkC;AAChC,eAAIR,iBAAiBhY,KAAKyY,kBAAL,CAAwB,IAAxB,EAA8B,IAA9B,CAArB;AACA,eAAIT,cAAJ,EAAoB;AAClB,iBAAIU,kBAAmB,CAAC1Y,KAAK0X,OAAL,CAAa5X,IAAd,IACvBE,KAAK0X,OAAL,CAAarX,IAAb,KAAsBL,KAAKkX,YAD3B;AAEAlX,kBAAKoY,cAAL,CAAoBJ,cAApB,EAAoC,KAApC,EAA2CU,eAA3C;AACA1Y,kBAAKqY,uBAAL;AACD;AACD;AACA;AACA1lB,kBAAO1S,mBAAP,CAA2B,cAA3B,EAA2Cu4B,sBAA3C,EAC2B,KAD3B;AAED;;AAED7lB,gBAAO3S,gBAAP,CAAwB,cAAxB,EAAwCw4B,sBAAxC,EAAgE,KAAhE;;AAEA7lB,gBAAO3S,gBAAP,CAAwB,UAAxB,EAAoC,SAAS24B,kBAAT,CAA4Bze,GAA5B,EAAiC;AACnE;AACA;AACA;AACAvH,kBAAO3S,gBAAP,CAAwB,cAAxB,EAAwCw4B,sBAAxC,EAAgE,KAAhE;AACD,UALD,EAKG,KALH;;AAOA7lB,gBAAO3S,gBAAP,CAAwB,yBAAxB,EAAmD,UAASM,CAAT,EAAY;AAC7D0f,gBAAKiX,0BAAL,GAAkC,CAAC,CAAC32B,EAAEs4B,MAAF,CAASzJ,MAA7C;AACD,UAFD;AAGD,QA/IoB;;AAiJrB0J,0BAAmB,SAASC,4BAAT,GAAwC;AACzD,cAAKjB,mBAAL,CAAyB,IAAzB,EAA+B,IAA/B;AACD,QAnJoB;;AAqJrBD,8BAAuB,SAASmB,+BAAT,CAAyCve,KAAzC,EAAgD;AACrE,gBAAQA,SAASA,MAAMid,GAAN,IAAa,CAAtB,IACRjd,MAAMqc,WADE,IACa,KAAKA,WAAL,KAAqBrc,MAAMqc,WADxC,IAERrc,MAAM/Z,MAFE,IAEQ+Z,MAAM/Z,MAAN,CAAa4f,IAFtB,GAE8B,IAF9B,GAEqC,KAF5C;AAGD,QAzJoB;;AA2JrBwX,4BAAqB,SAASmB,6BAAT,CAAuCC,QAAvC,EACuCr1B,OADvC,EACgD;AACnE,aAAIA,OAAJ,EAAa;AACb+O,kBAAOglB,OAAP,CAAeuB,YAAf,CAA4BD,QAA5B,EAAsC,EAAtC;AACC,UAFD,MAEO;AACPtmB,kBAAOglB,OAAP,CAAewB,SAAf,CAAyBF,QAAzB,EAAmC,EAAnC;AACC;AACF,QAlKoB;;AAoKrB,WAAIG,oBAAJ,GAA2B;AACzB,aAAI,CAAC,KAAK5C,WAAV,EAAuB;AACrB,kBAAO,IAAP;AACD;AACD,gBAAO,KAAKO,eAAZ;AACD,QAzKoB;;AA2KrBsB,gCAAyB,SAASgB,iCAAT,GAA6C;AACpE,aAAI,KAAKjC,sBAAL,IACF,KAAKD,eADH,IACsB,KAAKhD,WAD/B,EAC4C;AAC1C,gBAAKkD,gBAAL,GAAwB,KAAKF,eAA7B;AACA,gBAAKG,YAAL,GAAoB,KAAKnD,WAAzB;AACA,gBAAKiD,sBAAL,GAA8B,KAA9B;AACD;AACF,QAlLoB;;AAoLrBkC,8BAAuB,SAASC,+BAAT,CAAyCC,QAAzC,EACyChZ,OADzC,EACkD;AACvE,aAAI,KAAKgW,WAAT,EAAsB;AACpB,gBAAKW,eAAL,GAAuBqC,SAAShhB,SAAT,CAAmB,CAAnB,CAAvB;AACA,gBAAK2b,WAAL,GAAmB3T,UAAU,CAA7B;AACA,gBAAK6X,uBAAL;AACD;AACF,QA3LoB;;AA6LrB5W,4BAAqB,SAASgY,6BAAT,CAAuC1e,KAAvC,EAA8C;AACjE,aAAI,KAAKyb,WAAT,EAAsB;AACpB,gBAAKe,aAAL,GAAqBxc,KAArB;AACD;AACF,QAjMoB;;AAmMrBtV,aAAM,SAASi0B,cAAT,CAAwB7e,MAAxB,EAAgC8e,iBAAhC,EAAmD;AACvD,aAAI,EAAE,KAAKnD,WAAL,IAAoB,KAAKQ,eAA3B,CAAJ,EAAiD;AAC/C;AACD;AACD,aAAInc,OAAOiF,IAAP,IAAe,CAACjF,OAAOwF,IAA3B,EAAiC;AAC/BxF,kBAAOwF,IAAP,GAAe,KAAKqX,OAAL,CAAarX,IAAb,IAAqB,KAAKqX,OAAL,CAAa5X,IAAlC,IACf,KAAK4X,OAAL,CAAa5X,IAAb,KAAsBjF,OAAOiF,IADf,GAEZ,KAAK4X,OAAL,CAAarX,IAFD,GAGZ,KAAKwP,WAAL,CAAiBhP,kBAAjB,CAAoChG,OAAOiF,IAA3C,EAAiDjc,KAAjD,CAAuD,GAAvD,EAA4D,CAA5D,CAHF;AAID;AACD,aAAIgX,OAAOzV,IAAX,EAAiB;AACfyV,kBAAOzV,IAAP,IAAe,CAAf;AACD;AACD,aAAIu0B,iBAAJ,EAAuB;AACrB,eAAIl5B,SAASkS,OAAOglB,OAAP,CAAend,KAAf,CAAqB/Z,MAAlC;AACA,eAAI,CAACA,MAAL,EAAa;AACX;AACA;AACA,kBAAK23B,cAAL,CAAoBvd,MAApB,EAA4B,KAA5B;AACA,kBAAKqc,YAAL,GAAoBvkB,OAAOmjB,QAAP,CAAgBzV,IAAhB,CAAqB7H,SAArB,CAA+B,CAA/B,CAApB;AACD;AACD,gBAAK4e,sBAAL,GAA8B,KAAKG,aAAL,GAAqB,KAArB,GAA6B,IAA3D;AACA,eAAI92B,MAAJ,EAAY;AACV;AACA;AACA,kBAAK43B,uBAAL;AACD;AACD;AACD;AACD,aAAI,KAAKd,aAAT,EAAwB;AACtB,eAAI,KAAKA,aAAL,KAAuB1c,OAAOwF,IAAlC,EAAwC;AACtC,kBAAKkX,aAAL,GAAqB,IAArB;AACA,kBAAKH,sBAAL,GAA8B,IAA9B;AACA;AACD,YAJD,MAIO;AACL,kBAAKG,aAAL,GAAqB,IAArB;AACD;AACF;;AAED,aAAI1c,OAAOwF,IAAX,EAAiB;AACf,eAAI,KAAKqX,OAAL,CAAarX,IAAjB,EAAuB;AACrB,iBAAI,KAAKqX,OAAL,CAAarX,IAAb,KAAsBxF,OAAOwF,IAAjC,EAAuC;AACrC,oBAAK+X,cAAL,CAAoBvd,MAApB,EAA4B,IAA5B;AACD,cAFD,MAEO;AACL,mBAAI,CAAC,KAAK6c,OAAL,CAAatyB,IAAd,IAAsByV,OAAOzV,IAAjC,EAAuC;AACrC,sBAAKgzB,cAAL,CAAoBvd,MAApB,EAA4B,KAA5B,EAAmC,IAAnC;AACD;AACD,oBAAKuc,sBAAL,GAA8B,IAA9B;AACD;AACF,YATD,MASO;AACL,kBAAKgB,cAAL,CAAoBvd,MAApB,EAA4B,IAA5B;AACD;AACF,UAbD,MAaO,IAAI,KAAK6c,OAAL,CAAatyB,IAAb,IAAqByV,OAAOzV,IAA5B,IACT,KAAKsyB,OAAL,CAAatyB,IAAb,KAAsByV,OAAOzV,IADxB,EAC8B;AACnC,gBAAKgzB,cAAL,CAAoBvd,MAApB,EAA4B,IAA5B;AACD;AACF,QA3PoB;;AA6PrB4d,2BAAoB,SAASmB,4BAAT,CAAsCC,aAAtC,EACsCC,YADtC,EACoD;AACtE,aAAI,EAAE,KAAK3C,eAAL,IAAwB,KAAKhD,WAA/B,CAAJ,EAAiD;AAC/C,kBAAO,IAAP;AACD,UAFD,MAEO,IAAI,KAAKiD,sBAAT,EAAiC;AACtC,gBAAKA,sBAAL,GAA8B,KAA9B;AACD;AACD,aAAI,KAAKK,GAAL,GAAW,CAAX,IAAgB,EAAE,KAAKJ,gBAAL,IAAyB,KAAKC,YAAhC,CAApB,EAAmE;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAO,IAAP;AACD;AACD,aAAK,CAAC,KAAKI,OAAL,CAAa5X,IAAd,IAAsB,CAAC+Z,aAAxB,IAA0CC,YAA9C,EAA4D;AAC1D,eAAI,KAAKzC,gBAAL,KAA0B,KAAKF,eAAnC,EAAoD;AAClD,oBAAO,IAAP;AACD;AACF,UAJD,MAIO,IAAI,KAAKO,OAAL,CAAatyB,IAAb,IAAqBy0B,aAAzB,EAAwC;AAC7C,eAAI,KAAKvC,YAAL,KAAsB,KAAKnD,WAA/B,EAA4C;AAC1C,oBAAO,IAAP;AACD;AACF,UAJM,MAIA;AACL,kBAAO,IAAP;AACD;AACD,aAAItZ,SAAS,EAACwF,MAAM,KAAK8W,eAAZ,EAA6B/xB,MAAM,KAAK+uB,WAAxC,EAAb;AACA,aAAI,KAAK8C,0BAAT,EAAqC;AACnCpc,kBAAOwF,IAAP,GAAc,IAAd;AACD;AACD,gBAAOxF,MAAP;AACD,QApSoB;;AAsSrBkf,kBAAW,SAASC,mBAAT,CAA6Bnf,MAA7B,EAAqC;AAC9C,gBAAO,EAACgc,aAAa,KAAKA,WAAnB,EAAgCY,KAAK,KAAKA,GAA1C,EAA+Ch3B,QAAQoa,MAAvD,EAAP;AACD,QAxSoB;;AA0SrBud,uBAAgB,SAAS6B,wBAAT,CAAkCpf,MAAlC,EACkCqf,WADlC,EAC+CC,SAD/C,EAC0D;AACxE,aAAI,CAAC,KAAK3D,WAAV,EAAuB;AACrB;AACD;AACD,aAAI,CAAC3b,OAAOwF,IAAR,IAAgBxF,OAAOzV,IAA3B,EAAiC;AAC/ByV,kBAAOwF,IAAP,GAAe,UAAUxF,OAAOzV,IAAhC;AACD;AACD,aAAI80B,eAAe,CAACC,SAApB,EAA+B;AAC7B,eAAInC,iBAAiB,KAAKS,kBAAL,EAArB;AACA,eAAIT,cAAJ,EAAoB;AAClB,iBAAIU,kBAAmB,CAAC,KAAKhB,OAAL,CAAa5X,IAAd,IACvB,KAAK4X,OAAL,CAAarX,IAAb,KAAsB,KAAK6W,YAD3B;AAEA,kBAAKkB,cAAL,CAAoBJ,cAApB,EAAoC,KAApC,EAA2CU,eAA3C;AACD;AACF;AACD,cAAKb,mBAAL,CAAyB,KAAKkC,SAAL,CAAelf,MAAf,CAAzB,EACGsf,aAAa,KAAK1C,GAAL,KAAa,CAD7B;AAEA,cAAKD,UAAL,GAAkB,KAAKC,GAAL,EAAlB;AACA,cAAKC,OAAL,GAAe7c,MAAf;AACA,cAAKuc,sBAAL,GAA8B,IAA9B;AACD,QA/ToB;;AAiUrBW,cAAO,SAASqC,eAAT,CAAyB5f,KAAzB,EAAgC;AACrC,aAAI,EAAE,KAAKgc,WAAL,IAAoB,KAAKQ,eAAzB,IACJ,KAAKY,qBAAL,CAA2Bpd,KAA3B,CADE,CAAJ,EACsC;AACpC;AACD;AACD,aAAI,CAAC,KAAKsc,aAAN,IAAuBtc,MAAMid,GAAN,GAAY,KAAKD,UAA5C,EAAwD;AACtD,eAAIQ,iBAAiB,KAAKS,kBAAL,CAAwB,IAAxB,CAArB;AACA,eAAIT,cAAJ,EAAoB;AAClB,kBAAKI,cAAL,CAAoB,KAAKV,OAAzB,EAAkC,KAAlC;AACA,kBAAKU,cAAL,CAAoBJ,cAApB,EAAoC,KAApC;AACA,kBAAKR,UAAL,GAAkBhd,MAAMid,GAAxB;AACA9kB,oBAAOglB,OAAP,CAAelV,IAAf;AACA;AACD;AACF;AACD,cAAKuU,eAAL,GAAuB,KAAvB;;AAEA,aAAIxc,MAAM/Z,MAAN,CAAaqf,IAAjB,EAAuB;AACrB,gBAAK+P,WAAL,CAAiBjQ,UAAjB,CAA4BpF,MAAM/Z,MAAN,CAAaqf,IAAzC;AACD,UAFD,MAEO;AACL,gBAAK+P,WAAL,CAAiBtO,OAAjB,CAAyB/G,MAAM/Z,MAAN,CAAa4f,IAAtC;AACD;AACD,cAAKmX,UAAL,GAAkBhd,MAAMid,GAAxB;AACA,aAAIjd,MAAMid,GAAN,GAAY,KAAKA,GAArB,EAA0B;AACxB,gBAAKA,GAAL,GAAWjd,MAAMid,GAAjB;AACD;AACD,cAAKC,OAAL,GAAeld,MAAM/Z,MAArB;AACA,cAAK22B,sBAAL,GAA8B,IAA9B;;AAEA,aAAIiD,cAAc1nB,OAAOmjB,QAAP,CAAgBzV,IAAhB,CAAqB7H,SAArB,CAA+B,CAA/B,CAAlB;AACA,aAAI,KAAK0e,YAAL,KAAsBmD,WAA1B,EAAuC;AACrC,gBAAKtD,eAAL,GAAuB,KAAvB;AACD;AACD,cAAKG,YAAL,GAAoBmD,WAApB;;AAEA,cAAKrD,eAAL,GAAuB,IAAvB;AACD,QArWoB;;AAuWrBvU,aAAM,SAAS6X,cAAT,GAA0B;AAC9B,cAAKC,EAAL,CAAQ,CAAC,CAAT;AACD,QAzWoB;;AA2WrB7X,gBAAS,SAAS8X,iBAAT,GAA6B;AACpC,cAAKD,EAAL,CAAQ,CAAR;AACD,QA7WoB;;AA+WrBA,WAAI,SAASE,YAAT,CAAsBC,SAAtB,EAAiC;AACnC,aAAI,KAAKlE,WAAL,IAAoB,KAAKQ,eAA7B,EAA8C;AAC5C,eAAIxc,QAAQ7H,OAAOglB,OAAP,CAAend,KAA3B;AACA,eAAIkgB,cAAc,CAAC,CAAf,IAAoBlgB,KAApB,IAA6BA,MAAMid,GAAN,GAAY,CAA7C,EAAgD;AAC9C9kB,oBAAOglB,OAAP,CAAelV,IAAf;AACD,YAFD,MAEO,IAAIiY,cAAc,CAAd,IAAmBlgB,KAAnB,IAA4BA,MAAMid,GAAN,GAAa,KAAKA,GAAL,GAAW,CAAxD,EAA4D;AACjE9kB,oBAAOglB,OAAP,CAAejV,OAAf;AACD;AACF;AACF;AAxXoB,MAAvB;;AA2XA,YAAO6T,UAAP;AACD,IArYgB,EAAjB;;AAwYEp5B,SAAMozB,SAAN,GAAkBA,SAAlB;AACApzB,SAAM6oB,WAAN,GAAoBA,WAApB;AACA7oB,SAAM0hB,cAAN,GAAuBA,cAAvB;AACA1hB,SAAMyuB,gBAAN,GAAyBA,gBAAzB;AACAzuB,SAAMyX,uBAAN,GAAgCA,uBAAhC;AACAzX,SAAMuyB,sBAAN,GAA+BA,sBAA/B;AACAvyB,SAAMkzB,6BAAN,GAAsCA,6BAAtC;AACAlzB,SAAMo5B,UAAN,GAAmBA,UAAnB;;AAEAp5B,SAAMgb,WAAN,GAAoBA,WAApB;AACAhb,SAAMggB,WAAN,GAAoBA,WAApB;AACD,EAn9FD,EAm9FGwd,IAn9FH,CAm9FS,OAAOhoB,MAAP,KAAkB,WAAnB,eAAyCA,MAn9FjD,E","file":"dist/pdf-annotate.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 04f8acd06b152d962753\n **/","import PDFJSAnnotate from './src/PDFJSAnnotate';\n\nexport default PDFJSAnnotate;\n\n\n\n/** WEBPACK FOOTER **\n ** ./index.js\n **/","import StoreAdapter from './adapter/StoreAdapter';\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\nimport render from './render';\nimport UI from './UI';\nimport initColorPicker from '../shared/initColorPicker';\n\n\nvar PDFJS = require('../shared/pdf_viewer');\n\nexport default {\n\n  initColorPicker,\n\n  /**\n   * Abstract class that needs to be defined so PDFJSAnnotate\n   * knows how to communicate with your server.\n   */\n  StoreAdapter,\n\n  /**\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\n   */\n  LocalStoreAdapter,\n\n  /**\n   * Abstract instance of StoreAdapter\n   */\n  __storeAdapter: new StoreAdapter(),\n\n  /**\n   * Getter for the underlying StoreAdapter property\n   *\n   * @return {StoreAdapter}\n   */\n  getStoreAdapter() {\n    return this.__storeAdapter;\n  },\n\n  /**\n   * Setter for the underlying StoreAdapter property\n   *\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\n   */\n  setStoreAdapter(adapter) {\n    // TODO this throws an error when bundled\n    // if (!(adapter instanceof StoreAdapter)) {\n    //   throw new Error('adapter must be an instance of StoreAdapter');\n    // }\n\n    this.__storeAdapter = adapter;\n  },\n\n  /**\n   * UI is a helper for instrumenting UI interactions for creating,\n   * editing, and deleting annotations in the browser.\n   */\n  UI,\n\n  /**\n   * Render the annotations for a page in the PDF Document\n   *\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\n   * @param {PageViewport} viewport The PDFPage.getViewport data\n   * @param {Object} data The StoreAdapter.getAnnotations data\n   * @return {Promise}\n   */\n  render,\n\n  /**\n   * Convenience method for getting annotation data\n   *\n   * @alias StoreAdapter.getAnnotations\n   * @param {String} documentId The ID of the document\n   * @param {String} pageNumber The page number\n   * @return {Promise}\n   */\n  getAnnotations(documentId, pageNumber) {\n    return this.getStoreAdapter().getAnnotations(...arguments);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/PDFJSAnnotate.js\n **/","import abstractFunction from '../utils/abstractFunction';\nimport { fireEvent } from '../UI/event';\n\n// Adapter should never be invoked publicly\nexport default class StoreAdapter {\n  /**\n   * Create a new StoreAdapter instance\n   *\n   * @param {Object} [definition] The definition to use for overriding abstract methods\n   */\n  constructor(definition = {}) {\n    // Copy each function from definition if it is a function we know about\n    Object.keys(definition).forEach((key) => {\n      if (typeof definition[key] === 'function' &&\n          typeof this[key] === 'function') {\n        this[key] = definition[key];\n      }\n    });\n  }\n\n  /**\n   * Get all the annotations for a given document and page number.\n   *\n   * @param {String} documentId The ID for the document the annotations belong to\n   * @param {Number} pageNumber The number of the page the annotations belong to\n   * @return {Promise}\n   */\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\n  get getAnnotations() { return this.__getAnnotations; }\n  set getAnnotations(fn) {\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\n      return fn(...arguments).then((annotations) => {\n        // TODO may be best to have this happen on the server\n        if (annotations.annotations) {\n          annotations.annotations.forEach((a) => {\n            a.documentId = documentId;\n          });\n        }\n        return annotations;\n      });\n    };\n  }\n\n  /**\n   * Get the definition for a specific annotation.\n   *\n   * @param {String} documentId The ID for the document the annotation belongs to\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\n\n  /**\n   * Add an annotation\n   *\n   * @param {String} documentId The ID for the document to add the annotation to\n   * @param {String} pageNumber The page number to add the annotation to\n   * @param {Object} annotation The definition for the new annotation\n   * @return {Promise}\n   */\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\n  get addAnnotation() { return this.__addAnnotation; }\n  set addAnnotation(fn) {\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Edit an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} pageNumber the page number of the annotation\n   * @param {Object} annotation The definition of the modified annotation\n   * @return {Promise}\n   */\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\n  get editAnnotation() { return this.__editAnnotation; }\n  set editAnnotation(fn) {\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Delete an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\n  get deleteAnnotation() { return this.__deleteAnnotation; }\n  set deleteAnnotation(fn) {\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('annotation:delete', documentId, annotationId);\n        }\n        return success;\n      });\n    };\n  }\n\n  /**\n   * Get all the comments for an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\n\n  /**\n   * Add a new comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @param {Object} content The definition of the comment\n   * @return {Promise}\n   */\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\n  get addComment() { return this.__addComment; }\n  set addComment(fn) {\n    this.__addComment = function addComment(documentId, annotationId, content) {\n      return fn(...arguments).then((comment) => {\n        fireEvent('comment:add', documentId, annotationId, comment);\n        return comment;\n      });\n    };\n  }\n\n  /**\n   * Delete a comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} commentId The ID for the comment\n   * @return {Promise}\n   */\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\n  get deleteComment() { return this.__deleteComment; }\n  set deleteComment(fn) {\n    this.__deleteComment = function deleteComment(documentId, commentId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('comment:delete', documentId, commentId);\n        }\n        return success;\n      });\n    };\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/adapter/StoreAdapter.js\n **/","/**\n * Throw an Error for an abstract function that hasn't been implemented.\n *\n * @param {String} name The name of the abstract function\n */\nexport default function abstractFunction(name) {\n  throw new Error(name + ' is not implemented');\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/abstractFunction.js\n **/","import EventEmitter from 'events';\nimport {\n  findAnnotationAtPoint,\n  findSVGAtPoint\n} from './utils';\n\nconst emitter = new EventEmitter;\n\nlet clickNode;\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event to be handled\n */\ndocument.addEventListener('click', function handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\n\n  // Emit annotation:blur if clickNode is no longer clicked\n  if (clickNode && clickNode !== target) {\n    emitter.emit('annotation:blur', clickNode, e);\n  }\n\n  // Emit annotation:click if target was clicked\n  if (target) {\n    emitter.emit('annotation:click', target, e);\n  }\n\n  clickNode = target;\n});\n\n// let mouseOverNode;\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\n//\n//   // Emit annotation:mouseout if target was mouseout'd\n//   if (mouseOverNode && !target) {\n//     emitter.emit('annotation:mouseout', mouseOverNode);\n//   }\n//\n//   // Emit annotation:mouseover if target was mouseover'd\n//   if (target && mouseOverNode !== target) {\n//     emitter.emit('annotation:mouseover', target);\n//   }\n//\n//   mouseOverNode = target;\n// });\n\nexport function fireEvent() { emitter.emit(...arguments); };\nexport function addEventListener() { emitter.on(...arguments); };\nexport function removeEventListener() { emitter.removeListener(...arguments); };\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/event.js\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/events/events.js\n ** module id = 5\n ** module chunks = 0\n **/","import createStyleSheet from 'create-stylesheet';\n\nexport const BORDER_COLOR = '#00BFFF';\n\nconst userSelectStyleSheet = createStyleSheet({\n  body: {\n    '-webkit-user-select': 'none',\n       '-moz-user-select': 'none',\n        '-ms-user-select': 'none',\n            'user-select': 'none'\n  }\n});\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\n\n/**\n * Find the SVGElement that contains all the annotations for a page\n *\n * @param {Element} node An annotation within that container\n * @return {SVGElement} The container SVG or null if it can't be found\n */\nexport function findSVGContainer(node) {\n  let parentNode = node;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\n      return parentNode;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an SVGElement container at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {SVGElement} The container SVG or null if one can't be found\n */\nexport function findSVGAtPoint(x, y) {\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\n\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    let rect = el.getBoundingClientRect();\n\n    if (pointIntersectsRect(x, y, rect)) {\n\n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an Element that represents an annotation at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {Element} The annotation element or null if one can't be found\n */\nexport function findAnnotationAtPoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) { return; }\n  let elements = svg.querySelectorAll('[data-pdf-annotate-type]');\n\n  // Find a target element within SVG\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    if (pointIntersectsRect(x, y, getOffsetAnnotationRect(el))) {   \n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Determine if a point intersects a rect\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\n * @return {Boolean} True if a collision occurs, otherwise false\n */\nexport function pointIntersectsRect(x, y, rect) {\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\n}\n\n/**\n * Get the rect of an annotation element accounting for offset.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getOffsetAnnotationRect(el) {\n  let rect = getAnnotationRect(el);\n  let { offsetLeft, offsetTop } = getOffset(el);\n  return {\n    top: rect.top + offsetTop,\n    left: rect.left + offsetLeft,\n    right: rect.right + offsetLeft,\n    bottom: rect.bottom + offsetTop\n  };\n}\n\n/**\n * Get the rect of an annotation element.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getAnnotationRect(el) {\n  let h = 0, w = 0, x = 0, y = 0;\n  let rect = el.getBoundingClientRect();\n  // TODO this should be calculated somehow\n  const LINE_OFFSET = 16;\n\n  switch (el.nodeName.toLowerCase()) {\n    case 'path':\n    let minX, maxX, minY, maxY;\n\n    el.getAttribute('d').replace(/Z/, '').split('M').splice(1).forEach((p) => {\n      var s = p.split(' ').map(i => parseInt(i, 10));\n\n      if (typeof minX === 'undefined' || s[0] < minX) { minX = s[0]; }\n      if (typeof maxX === 'undefined' || s[2] > maxX) { maxX = s[2]; }\n      if (typeof minY === 'undefined' || s[1] < minY) { minY = s[1]; }\n      if (typeof maxY === 'undefined' || s[3] > maxY) { maxY = s[3]; }\n    });\n\n    h = maxY - minY;\n    w = maxX - minX;\n    x = minX;\n    y = minY;\n    break;\n\n    case 'line':\n    h = parseInt(el.getAttribute('y2'), 10) - parseInt(el.getAttribute('y1'), 10);\n    w = parseInt(el.getAttribute('x2'), 10) - parseInt(el.getAttribute('x1'), 10);\n    x = parseInt(el.getAttribute('x1'), 10);\n    y = parseInt(el.getAttribute('y1'), 10);\n\n    if (h === 0) {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'text':\n    h = rect.height;\n    w = rect.width;\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10) - h;\n    break;\n\n    case 'g':\n    let { offsetLeft, offsetTop } = getOffset(el);\n    h = rect.height;\n    w = rect.width;\n    x = rect.left - offsetLeft;\n    y = rect.top - offsetTop;\n\n    if (el.getAttribute('data-pdf-annotate-type') === 'strikeout') {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'rect':\n    case 'svg':\n    h = parseInt(el.getAttribute('height'), 10);\n    w = parseInt(el.getAttribute('width'), 10);\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10);\n    break;\n  }\n\n  // Result provides same properties as getBoundingClientRect\n  let result = {\n    top: y,\n    left: x,\n    width: w,\n    height: h,\n    right: x + w,\n    bottom: y + h\n  };\n\n  // For the case of nested SVG (point annotations) and grouped\n  // lines or rects no adjustment needs to be made for scale.\n  // I assume that the scale is already being handled\n  // natively by virtue of the `transform` attribute.\n  if (!['svg', 'g'].includes(el.nodeName.toLowerCase())) {\n    result = scaleUp(findSVGAtPoint(rect.left, rect.top), result);\n  }\n\n  return result;\n}\n\n/**\n * Adjust scale from normalized scale (100%) to rendered scale.\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled up\n */\nexport function scaleUp(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] * viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Adjust scale from rendered scale to a normalized scale (100%).\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled down\n */\nexport function scaleDown(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] / viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Get the scroll position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the scroll position for\n * @return {Object} The scrollTop and scrollLeft position\n */\nexport function getScroll(el) {\n  let scrollTop = 0;\n  let scrollLeft = 0;\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    scrollTop += parentNode.scrollTop;\n    scrollLeft += parentNode.scrollLeft;\n  }\n\n  return { scrollTop, scrollLeft };\n}\n\n/**\n * Get the offset position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the offset position for\n * @return {Object} The offsetTop and offsetLeft position\n */\nexport function getOffset(el) {\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\n      break;\n    }\n  }\n\n  let rect = parentNode.getBoundingClientRect();\n\n  return { offsetLeft: rect.left, offsetTop: rect.top };\n}\n\n/**\n * Disable user ability to select text on page\n */\nexport function disableUserSelect() {\n  if (!userSelectStyleSheet.parentNode) {\n    document.head.appendChild(userSelectStyleSheet);\n  }\n}\n\n\n/**\n * Enable user ability to select text on page\n */\nexport function enableUserSelect() {\n  if (userSelectStyleSheet.parentNode) {\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\n  }\n}\n\n/**\n * Get the metadata for a SVG container\n *\n * @param {SVGElement} svg The SVG container to get metadata for\n */\nexport function getMetadata(svg) {\n  return {\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\n  };\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/utils.js\n **/","module.exports = function createStyleSheet(blocks) {\n  var style = document.createElement('style');\n  var text = Object.keys(blocks).map(function (selector) {\n    return processRuleSet(selector, blocks[selector]);\n  }).join('\\n');\n  \n  style.setAttribute('type', 'text/css');\n  style.appendChild(document.createTextNode(text));\n\n  return style;\n}\n\nfunction processRuleSet(selector, block) {\n  return selector + ' {\\n' + processDeclarationBlock(block) + '\\n}';\n}\n\nfunction processDeclarationBlock(block) {\n  return Object.keys(block).map(function (prop) {\n    return processDeclaration(prop, block[prop]);\n  }).join('\\n');\n}\n\nfunction processDeclaration(prop, value) {\n  if (!isNaN(value) && value != 0) {\n    value = value + 'px';\n  }\n\n  return hyphenate(prop) + ': ' + value + ';';\n}\n\nfunction hyphenate(prop) {\n  return prop.replace(/[A-Z]/g, function (match) {\n    return '-' + match.toLowerCase();\n  });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/create-stylesheet/index.js\n ** module id = 7\n ** module chunks = 0\n **/","import uuid from '../utils/uuid';\nimport StoreAdapter from './StoreAdapter';\n\n// StoreAdapter for working with localStorage\n// This is ideal for testing, examples, and prototyping\nexport default class LocalStoreAdapter extends StoreAdapter {\n  constructor() {\n    super({\n      getAnnotations(documentId, pageNumber) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId).filter((i) => {\n            return i.page === pageNumber && i.class === 'Annotation';\n          });\n\n          resolve({\n            documentId,\n            pageNumber,\n            annotations\n          });\n        });\n      },\n\n      getAnnotation(documentId, annotationId) {\n        return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\n      },\n\n      addAnnotation(documentId, pageNumber, annotation) {\n        return new Promise((resolve, reject) => {\n          annotation.class = 'Annotation';\n          annotation.uuid = uuid();\n          annotation.page = pageNumber;\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(annotation);\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      editAnnotation(documentId, annotationId, annotation) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId);\n          annotations[findAnnotation(documentId, annotationId)] = annotation;\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      deleteAnnotation(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          let index = findAnnotation(documentId, annotationId);\n          if (index > -1) {\n            let annotations = getAnnotations(documentId);\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      },\n\n      getComments(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          resolve(getAnnotations(documentId).filter((i) => {\n            return i.class === 'Comment' && parseInt(i.annotation) === parseInt(annotationId);\n          }));\n        });\n      },\n\n      addComment(documentId, annotationId, content) {\n        return new Promise((resolve, reject) => {\n          let comment = {\n            class: 'Comment',\n            uuid: uuid(),\n            annotation: annotationId,\n            content: content\n          };\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(comment);\n          updateAnnotations(documentId, annotations);\n\n          resolve(comment);\n        });\n      },\n\n      deleteComment(documentId, commentId) {\n        return new Promise((resolve, reject) => {\n          getAnnotations(documentId);\n          let index = -1;\n          let annotations = getAnnotations(documentId);\n          for (let i=0, l=annotations.length; i<l; i++) {\n            if (annotations[i].uuid === commentId) {\n              index = i;\n              break;\n            }\n          }\n\n          if (index > -1) {\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      }\n    });\n  }\n}\n\nfunction getAnnotations(documentId) {\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\n}\n\nfunction updateAnnotations(documentId, annotations) {\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\n}\n\nfunction findAnnotation(documentId, annotationId) {\n  let index = -1;\n  let annotations = getAnnotations(documentId);\n  for (let i=0, l=annotations.length; i<l; i++) {\n    if (annotations[i].uuid === annotationId) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/adapter/LocalStoreAdapter.js\n **/","const REGEXP = /[xy]/g\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n\nfunction replacement(c) {\n  let r = Math.random()*16|0;\n  let v = c == 'x' ? r : (r&0x3|0x8);\n  return v.toString(16);\n}\n\n/**\n * Generate a univierally unique identifier\n *\n * @return {String}\n */\nexport default function uuid() {\n  return PATTERN.replace(REGEXP, replacement);\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/uuid.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from './appendChild';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n/**\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\n *\n * @param {SVGElement} svg The SVG element to render the annotations to\n * @param {Object} viewport The page viewport data\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: SVGElement\n *    - rejected: Error\n */\nexport default function render(svg, viewport, data) {\n  return new Promise((resolve, reject) => {\n    // Reset the content of the SVG\n    svg.innerHTML = ''; \n    svg.setAttribute('data-pdf-annotate-container', true);\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\n    svg.removeAttribute('data-pdf-annotate-document');\n    svg.removeAttribute('data-pdf-annotate-page');\n\n    // If there's no data nothing can be done\n    if (!data) {\n      return resolve(svg);\n    }\n\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\n  \n    // Make sure annotations is an array\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\n      return resolve(svg);\n    }\n\n    // Append annotation to svg\n    data.annotations.forEach((a) => {\n      appendChild(svg, a, viewport);\n    });\n\n    resolve(svg);\n  });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/index.js\n **/","import objectAssign from 'object-assign';\nimport renderLine from './renderLine';\nimport renderPath from './renderPath';\nimport renderPoint from './renderPoint';\nimport renderRect from './renderRect';\nimport renderText from './renderText';\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\n/**\n * Get the x/y translation to be used for transforming the annotations\n * based on the rotation of the viewport.\n *\n * @param {Object} viewport The viewport data from the page\n * @return {Object}\n */\nfunction getTranslation(viewport) {\n  let x;\n  let y;\n\n  // Modulus 360 on the rotation so that we only\n  // have to worry about four possible values.\n  switch(viewport.rotation % 360) {\n    case 0:\n      x = y = 0;\n      break;\n    case 90:\n      x = 0;\n      y = (viewport.width / viewport.scale) * -1;\n      break;\n    case 180:\n      x = (viewport.width / viewport.scale) * -1;\n      y = (viewport.height / viewport.scale) * -1;\n      break;\n    case 270:\n      x = (viewport.height / viewport.scale) * -1;\n      y = 0;\n      break;\n  }\n\n  return { x, y };\n}\n\n/**\n * Transform the rotation and scale of a node using SVG's native transform attribute.\n *\n * @param {Node} node The node to be transformed\n * @param {Object} viewport The page's viewport data\n * @return {Node}\n */\nfunction transform(node, viewport) {\n  let trans = getTranslation(viewport);\n\n  // Let SVG natively transform the element\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\n  \n  // Manually adjust x/y for nested SVG nodes\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\n\n    let x = parseInt(node.getAttribute('x', 10));\n    let y = parseInt(node.getAttribute('y', 10));\n    let width = parseInt(node.getAttribute('width'), 10);\n    let height = parseInt(node.getAttribute('height'), 10);\n    let path = node.querySelector('path');\n    let svg = path.parentNode;\n   \n    // Scale width/height\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\n    });\n\n    // Transform path but keep scale at 100% since it will be handled natively\n    transform(path, objectAssign({}, viewport, { scale: 1 }));\n    \n    switch(viewport.rotation % 360) {\n      case 90:\n        node.setAttribute('x', viewport.width - y - width);\n        node.setAttribute('y', x);\n        svg.setAttribute('x', 1);\n        svg.setAttribute('y', 0);\n        break;\n      case 180:\n        node.setAttribute('x', viewport.width - x - width);\n        node.setAttribute('y', viewport.height - y - height);\n        svg.setAttribute('y', 2);\n        break;\n      case 270:\n        node.setAttribute('x', y);\n        node.setAttribute('y', viewport.height - x - height);\n        svg.setAttribute('x', -1);\n        svg.setAttribute('y', 0);\n        break;\n    }\n  }\n\n  return node;\n}\n\n/**\n * Append an annotation as a child of an SVG.\n *\n * @param {SVGElement} svg The SVG element to append the annotation to\n * @param {Object} annotation The annotation definition to render and append\n * @param {Object} viewport The page's viewport data\n * @return {SVGElement} A node that was created and appended by this function\n */\nexport default function appendChild(svg, annotation, viewport) {\n  if (!viewport) {\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\n  }\n  \n  let child;\n  switch (annotation.type) {\n    case 'area':\n    case 'highlight':\n      child = renderRect(annotation);\n      break;\n    case 'strikeout':\n      child = renderLine(annotation);\n      break;\n    case 'point':\n      child = renderPoint(annotation);\n      break;\n    case 'textbox':\n      child = renderText(annotation);\n      break;\n    case 'drawing':\n      child = renderPath(annotation);\n      break;\n  }\n\n  // If no type was provided for an annotation it will result in node being null.\n  // Skip appending/transforming if node doesn't exist.\n  if (child) {\n    // Set attributes\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\n    child.setAttribute('aria-hidden', true);\n\n    svg.appendChild(transform(child, viewport));\n  }\n\n  return child;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/appendChild.js\n **/","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/object-assign/index.js\n ** module id = 12\n ** module chunks = 0\n **/","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGLineElements from an annotation definition.\n * This is used for anntations of type `strikeout`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement} A group of all lines to be rendered\n */\nexport default function renderLine(a) {\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  setAttributes(group, {\n    stroke: normalizeColor(a.color || '#f00'),\n    strokeWidth: 1\n  });\n\n  a.rectangles.forEach((r) => {\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\n    setAttributes(line, {\n      x1: r.x,\n      y1: r.y,\n      x2: r.x + r.width,\n      y2: r.y,\n    });\n\n    group.appendChild(line);\n  });\n\n  return group;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderLine.js\n **/","const UPPER_REGEX = /[A-Z]/g;\n\n// Don't convert these attributes from camelCase to hyphenated-attributes\nconst BLACKLIST = [\n  'viewBox'\n];\n\nlet keyCase = (key) => {\n  if (BLACKLIST.indexOf(key) === -1) {\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\n  }\n  return key;\n}\n\n/**\n * Set attributes for a node from a map\n *\n * @param {Node} node The node to set attributes on\n * @param {Object} attributes The map of key/value pairs to use for attributes\n */\nexport default function setAttributes(node, attributes) {\n  Object.keys(attributes).forEach((key) => {\n    node.setAttribute(keyCase(key), attributes[key]);\n  });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/setAttributes.js\n **/","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\n\n/**\n * Normalize a color value\n *\n * @param {String} color The color to normalize\n * @return {String}\n */\nexport default function normalizeColor(color) {\n  if (REGEX_HASHLESS_HEX.test(color)) {\n    color = `#${color}`;\n  }\n  return color;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/normalizeColor.js\n **/","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGPathElement from an annotation definition.\n * This is used for anntations of type `drawing`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGPathElement} The path to be rendered\n */\nexport default function renderPath(a) {\n  let d = [];\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n  \n  for (let i=0, l=a.lines.length; i<l; i++) {\n    var p1 = a.lines[i];\n    var p2 = a.lines[i+1];\n    if (p2) {\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\n    }\n  }\n  \n  setAttributes(path, {\n    d: `${d.join(' ')}Z`,\n    stroke: normalizeColor(a.color || '#000'),\n    strokeWidth: a.width || 1,\n    fill: 'none'\n  });\n\n  return path;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderPath.js\n **/","import setAttributes from '../utils/setAttributes';\n\nconst SIZE = 25;\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\n\n/**\n * Create SVGElement from an annotation definition.\n * This is used for anntations of type `comment`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGElement} A svg to be rendered\n */\nexport default function renderPoint(a) {\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n  setAttributes(outerSVG,  {\n    width: SIZE,\n    height: SIZE,\n    x: a.x,\n    y: a.y\n  });\n\n  setAttributes(innerSVG, {\n    width: SIZE,\n    height: SIZE,\n    x: 0,\n    y: (SIZE * 0.05) * -1,\n    viewBox: '0 0 1000 1000'\n  });\n\n  setAttributes(rect, {\n    width: SIZE,\n    height: SIZE,\n    stroke: '#000',\n    fill: '#ff0'\n  });\n\n  setAttributes(path, {\n    d: D,\n    strokeWidth: 50,\n    stroke: '#000',\n    fill: '#fff'\n  });\n\n  innerSVG.appendChild(path);\n  outerSVG.appendChild(rect);\n  outerSVG.appendChild(innerSVG);\n\n  return outerSVG;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderPoint.js\n **/","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGRectElements from an annotation definition.\n * This is used for anntations of type `area` and `highlight`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\n */\nexport default function renderRect(a) {\n  if (a.type === 'highlight') {\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    setAttributes(group, {\n      fill: normalizeColor(a.color || '#ff0'),\n      fillOpacity: 0.2\n    });\n    \n    a.rectangles.forEach((r) => {\n      group.appendChild(createRect(r));\n    });\n\n    return group;\n  } else {\n    let rect = createRect(a);\n    setAttributes(rect, {\n      stroke: normalizeColor(a.color || '#f00'),\n      fill: 'none'\n    });\n\n    return rect;\n  }\n}\n\nfunction createRect(r) {\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n  setAttributes(rect, {\n    x: r.x,\n    y: r.y,\n    width: r.width,\n    height: r.height\n  });\n\n  return rect;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderRect.js\n **/","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGTextElement from an annotation definition.\n * This is used for anntations of type `textbox`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGTextElement} A text to be rendered\n */\nexport default function renderText(a) {\n  var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n\n  setAttributes(text, {\n    x: a.x,\n    y: a.y + parseInt(a.size, 10),\n    fill: normalizeColor(a.color || '#000'),\n    fontSize: a.size\n  });\n  text.innerHTML = a.content;\n\n  return text;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderText.js\n **/","import insertScreenReaderHint from './insertScreenReaderHint';\nimport initEventHandlers from './initEventHandlers';\n\n// TODO This is not the right place for this to live\ninitEventHandlers();\n\n/**\n * Insert hints into the DOM for screen readers.\n *\n * @param {Array} annotations The annotations that hints are inserted for\n */\nexport default function renderScreenReaderHints(annotations) {\n  annotations = Array.isArray(annotations) ? annotations : [];\n\n  // Insert hints for each type\n  Object.keys(SORT_TYPES).forEach((type) => {\n    let sortBy = SORT_TYPES[type];\n    annotations\n      .filter((a) => a.type === type)\n      .sort(sortBy)\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\n  });\n}\n\n// Sort annotations first by y, then by x.\n// This allows hints to be injected in the order they appear,\n// which makes numbering them easier.\nfunction sortByPoint(a, b) {\n  if (a.y < b.y) {\n    return a.x - b.x;\n  } else {\n    return 1;\n  }\n}\n\n// Sort annotation by it's first rectangle\nfunction sortByRectPoint(a, b) {\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\n}\n\n// Sort annotation by it's first line\nfunction sortByLinePoint(a, b) {\n  let lineA = a.lines[0];\n  let lineB = b.lines[0];\n  return sortByPoint(\n    {x: lineA[0], y: lineA[1]},\n    {x: lineB[0], y: lineB[1]}\n  );\n}\n\n// Arrange supported types and associated sort methods\nconst SORT_TYPES = {\n  'highlight': sortByRectPoint,\n  'strikeout': sortByRectPoint,\n  'drawing': sortByLinePoint,\n  'textbox': sortByPoint,\n  'point': sortByPoint,\n  'area': sortByPoint\n};\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/renderScreenReaderHints.js\n **/","import createScreenReaderOnly from './createScreenReaderOnly';\nimport insertElementWithinChildren from './insertElementWithinChildren';\nimport insertElementWithinElement from './insertElementWithinElement';\nimport renderScreenReaderComments from './renderScreenReaderComments';\n\n// Annotation types that support comments\nconst COMMENT_TYPES = ['highlight', 'point', 'area', 'drawing', 'strikeout'];\n\n/**\n * Insert a hint into the DOM for screen readers for a specific annotation.\n *\n * @param {Object} annotation The annotation to insert a hint for\n * @param {Number} num The number of the annotation out of all annotations of the same type\n */\nexport default function insertScreenReaderHint(annotation, num = 0) {\n  switch (annotation.type) {\n    case 'highlight':\n    case 'strikeout':\n      let rects = annotation.rectangles;\n      let first = rects[0];\n      let last = rects[rects.length - 1];\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\n        first.x, first.y, annotation.page, true\n      );\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\n        last.x + last.width, last.y, annotation.page, false\n      );\n      break;\n\n    case 'textbox':\n    case 'point':\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\n        annotation.x, annotation.y, annotation.page\n      );\n      break;\n\n    case 'drawing':\n    case 'area':\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\n        x, y, annotation.page\n      );\n      break;\n  }\n\n  // Include comments in screen reader hint\n  if (COMMENT_TYPES.includes(annotation.type)) {\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertScreenReaderHint.js\n **/","/**\n * Create a node that is only visible to screen readers\n *\n * @param {String} content The text content that should be read by screen reader\n * @param {String} [annotationId] The ID of the annotation assocaited\n * @return {Element} An Element that is only visible to screen readers\n */\nexport default function createScreenReaderOnly(content, annotationId) {\n  let node = document.createElement('div');\n  let text = document.createTextNode(content);\n  node.appendChild(text);\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\n  node.style.position = 'absolute';\n  node.style.left = '-10000px';\n  node.style.top = 'auto';\n  node.style.width = '1px';\n  node.style.height = '1px';\n  node.style.overflow = 'hidden';\n  return node;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/createScreenReaderOnly.js\n **/","import insertElementWithinElement from './insertElementWithinElement';\nimport { pointIntersectsRect } from '../UI/utils';\nimport { scaleUp } from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will try to insert between elements if possible.\n * It will however use `insertElementWithinElement` if it is more accurate.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\n  // Try and use most accurate method of inserting within an element\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\n    return true;\n  }\n\n  // Fall back to inserting between elements\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  let nodes = [...svg.parentNode.querySelectorAll('.textLayer > div')];\n\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n\n  // Find the best node to insert before\n  for (let i=0, l=nodes.length; i<l; i++) {\n    let n = nodes[i];\n    let r = n.getBoundingClientRect();\n    if (y <= r.top) {\n      n.parentNode.insertBefore(el, n);\n      return true;\n    }\n  }\n\n  // If all else fails try to append to the bottom\n  let textLayer = svg.parentNode.querySelector('.textLayer');\n  if (textLayer) {\n    let textRect = textLayer.getBoundingClientRect();\n    if (pointIntersectsRect(x, y, textRect)) {\n      textLayer.appendChild(el);\n      return true;\n    }\n  }\n\n  return false;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertElementWithinChildren.js\n **/","import {\n  pointIntersectsRect,\n  scaleUp,\n  scaleDown\n} from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will only insert within an element amidst it's text content.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\n  const OFFSET_ADJUST = 2;\n\n  // If inserting before adjust `x` by looking for element a few px to the right\n  // Otherwise adjust a few px to the left\n  // This is to allow a little tolerance by searching within the box, instead\n  // of getting a false negative by testing right on the border.\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\n\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\n  if (!node) {\n    return false;\n  }\n  \n  // Now that node has been found inverse the adjustment for `x`.\n  // This is done to accomodate tolerance by cutting off on the outside of the\n  // text boundary, instead of missing a character by cutting off within.\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\n\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\n  let temp = node.cloneNode(true);\n  let head = temp.innerHTML.split('');\n  let tail = [];\n\n  // Insert temp off screen\n  temp.style.position = 'absolute';\n  temp.style.top = '-10000px';\n  temp.style.left = '-10000px';\n  document.body.appendChild(temp);\n\n  while (head.length) {\n    // Don't insert within HTML tags\n    if (head[head.length - 1] === '>') {\n      while(head.length) {\n        tail.unshift(head.pop());\n        if (tail[0] === '<') {\n          break;\n        }\n      }\n    }\n    \n    // Check if width of temp based on current head value satisfies x\n    temp.innerHTML = head.join('');\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\n    if (left + width <= x) {\n      break;\n    }\n    tail.unshift(head.pop());\n  }\n  \n  // Update original node with new markup, including element to be inserted\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\n  temp.parentNode.removeChild(temp);\n\n  return true;\n}\n\n/**\n * Get a text layer element at a given point on a page\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page to limit elements to\n * @return {Element} First text layer element found at the point\n */\nfunction textLayerElementFromPoint(x, y, pageNumber) {\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n  return [...svg.parentNode.querySelectorAll('.textLayer [data-canvas-width]')].filter((el) => {\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\n  })[0];\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertElementWithinElement.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport insertScreenReaderComment from './insertScreenReaderComment';\n\n/**\n * Insert the comments into the DOM to be available by screen reader\n *\n * Example output:\n *   <div class=\"screenReaderOnly\">\n *    <div>Begin highlight 1</div>\n *    <ol aria-label=\"Comments\">\n *      <li>Foo</li>\n *      <li>Bar</li>\n *      <li>Baz</li>\n *      <li>Qux</li>\n *    </ol>\n *  </div>\n *  <div>Some highlighted text goes here...</div>\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\n *\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of the annotation\n * @param {Array} [comments] Optionally preloaded comments to be rendered\n * @return {Promise}\n */\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\n  let promise;\n\n  if (Array.isArray(comments)) {\n    promise = Promise.resolve(comments);\n  } else {\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\n  }\n\n  return promise.then((comments) => {\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\n    if (node) { \n      let list = document.createElement('ol');\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\n      list.setAttribute('aria-label', 'Comments');\n      node.appendChild(list);\n      comments.forEach(insertScreenReaderComment);\n    }\n  });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/renderScreenReaderComments.js\n **/","/**\n * Insert a comment into the DOM to be available by screen reader\n *\n * @param {Object} comment The comment to be inserted\n */\nexport default function insertScreenReaderComment(comment) {\n  if (!comment) {\n    return;\n  }\n\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\n  if (list) {\n    let item = document.createElement('li');\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\n    item.appendChild(document.createTextNode(`${comment.content}`));\n    list.appendChild(item);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertScreenReaderComment.js\n **/","import insertScreenReaderHint from './insertScreenReaderHint';\nimport renderScreenReaderHints from './renderScreenReaderHints';\nimport insertScreenReaderComment from './insertScreenReaderComment';\nimport renderScreenReaderComments from './renderScreenReaderComments';\nimport { addEventListener } from '../UI/event';\nimport PDFJSAnnotate from '../PDFJSAnnotate';\n\n/**\n * Initialize the event handlers for keeping screen reader hints synced with data\n */\nexport default function initEventHandlers() {\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\n  });\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\n  });\n  addEventListener('annotation:delete', removeAnnotation);\n  addEventListener('comment:add', insertComment);\n  addEventListener('comment:delete', removeComment);\n}\n\n/**\n * Reorder the annotation numbers by annotation type\n *\n * @param {String} documentId The ID of the document\n * @param {Number} pageNumber The page number of the annotations\n * @param {Strig} type The annotation type\n */\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\n    .then((annotations) => {\n      return annotations.annotations.filter((a) => {\n        return a.type === type;\n      });\n    })\n    .then((annotations) => {\n      annotations.forEach((a) => {\n        removeAnnotation(documentId, a.uuid);\n      });\n\n      return annotations;\n    })\n    .then(renderScreenReaderHints);\n}\n\n/**\n * Remove the screen reader hint for an annotation\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The Id of the annotation\n */\nfunction removeAnnotation(documentId, annotationId) {\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\n}\n\n/**\n * Insert a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of tha assocated annotation\n * @param {Object} comment The comment to insert a hint for\n */\nfunction insertComment(documentId, annotationId, comment) {\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n  let promise;\n\n  if (!list) {\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n      return true;\n    });\n  } else {\n    promise = Promise.resolve(true);\n  }\n\n  promise.then(() => {\n    insertScreenReaderComment(comment);\n  });\n}\n\n/**\n * Remove a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} commentId The ID of the comment\n */\nfunction removeComment(documentId, commentId) {\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\n}\n\n/**\n * Remove an element from the DOM by it's ID if it exists\n *\n * @param {String} elementID The ID of the element to be removed\n */\nfunction removeElementById(elementId) {\n  let el = document.getElementById(elementId);\n  if (el) {\n    el.parentNode.removeChild(el);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/initEventHandlers.js\n **/","import { addEventListener, removeEventListener, fireEvent } from './event';\nimport { disableEdit, enableEdit, setCanEdit } from './edit';\nimport { disablePen, enablePen, setPen } from './pen';\nimport { disablePoint, enablePoint } from './point';\nimport { disableRect, enableRect } from './rect';\nimport { disableText, enableText, setText } from './text';\nimport { createPage, renderPage } from './page';\n\nexport default {\n  addEventListener, removeEventListener, fireEvent,\n  disableEdit, enableEdit, setCanEdit,\n  disablePen, enablePen, setPen,\n  disablePoint, enablePoint,\n  disableRect, enableRect,\n  disableText, enableText, setText,\n  createPage, renderPage\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/index.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\n\nimport appendChild from '../render/appendChild';\nimport {\n  addEventListener,\n  removeEventListener\n} from './event';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGContainer,\n  findSVGAtPoint,\n  getAnnotationRect,\n  getMetadata,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet _canEdit = true;\nlet isDragging = false, overlay;\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\nconst OVERLAY_BORDER_SIZE = 3;\n\n/**\n * Create an overlay for editing an annotation.\n *\n * @param {Element} target The annotation element to apply overlay for\n */\nfunction createEditOverlay(target) {\n\n  if(!target || !target.parentNode) {\n    return;\n  }\n\n  // check if we are clicking on same Annotation, and if yes, exit early\n  if(overlay) {\n\n    var overlayId = overlay.getAttribute('data-target-id');\n    var targetId = target.getAttribute('data-pdf-annotate-id');\n\n    if (overlayId === targetId) {\n      return;\n    }\n  }\n\n  destroyEditOverlay();\n\n  overlay = document.createElement('div');\n  let anchor = document.createElement('a');\n  let parentNode = findSVGContainer(target).parentNode;\n  let id = target.getAttribute('data-pdf-annotate-id');\n  let rect = getAnnotationRect(target);\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\n  \n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\n  overlay.setAttribute('data-target-id', id);\n  overlay.style.boxSizing = 'content-box';\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${styleTop}px`;\n  overlay.style.left = `${styleLeft}px`;\n  overlay.style.width = `${rect.width}px`;\n  overlay.style.height = `${rect.height}px`;\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\n\n  if (_canEdit) {\n    anchor.innerHTML = '';\n    anchor.setAttribute('href', 'javascript://');\n    anchor.style.background = '#fff';\n    anchor.style.borderRadius = '20px';\n    anchor.style.border = '1px solid #bbb';\n    anchor.style.color = '#bbb';\n    anchor.style.fontSize = '16px';\n    anchor.style.padding = '2px';\n    anchor.style.textAlign = 'center';\n    anchor.style.textDecoration = 'none';\n    anchor.style.position = 'absolute';\n    anchor.style.top = '-13px';\n    anchor.style.right = '-13px';\n    anchor.style.width = '25px';\n    anchor.style.height = '25px';\n    \n    overlay.appendChild(anchor);\n    \n    document.addEventListener('click', handleDocumentClick);\n    document.addEventListener('keyup', handleDocumentKeyup);\n    document.addEventListener('mousedown', handleDocumentMousedown);\n    anchor.addEventListener('click', deleteAnnotation);\n    anchor.addEventListener('mouseover', () => {\n      anchor.style.color = '#35A4DC';\n      anchor.style.borderColor = '#999';\n      anchor.style.boxShadow = '0 1px 1px #ccc';\n    });\n    anchor.addEventListener('mouseout', () => {\n      anchor.style.color = '#bbb';\n      anchor.style.borderColor = '#bbb';\n      anchor.style.boxShadow = '';\n    });\n    overlay.addEventListener('mouseover', () => {\n      if (!isDragging) { anchor.style.display = ''; }\n    });\n    overlay.addEventListener('mouseout', () => {\n      anchor.style.display = 'none';\n    });\n  }\n\n  parentNode.appendChild(overlay);\n}\n\n/**\n * Destroy the edit overlay if it exists.\n */\nfunction destroyEditOverlay() {\n\n  if (overlay && overlay.parentNode) {\n    overlay.parentNode.removeChild(overlay);\n  }\n  overlay = null;\n\n  document.removeEventListener('click', handleDocumentClick);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Delete currently selected annotation\n */\nfunction deleteAnnotation() {\n  if (!overlay) { return; }\n\n  let annotationId = overlay.getAttribute('data-target-id');\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n\n  [...nodes].forEach((n) => {\n    n.parentNode.removeChild(n);\n  });\n  \n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\n\n  destroyEditOverlay();\n}\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  // Remove current overlay\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\n  if (overlay) {\n    if (isDragging || e.target === overlay) {\n      return;\n    }\n\n    destroyEditOverlay();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentKeyup(e) {\n  if (overlay && e.keyCode === 46 &&\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\n      e.target.nodeName.toLowerCase() !== 'input') {\n    deleteAnnotation();\n  }\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousedown(e) {\n  if (e.target !== overlay) { return; }\n\n  // Highlight and strikeout annotations are bound to text within the document.\n  // It doesn't make sense to allow repositioning these types of annotations.\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target.getAttribute('data-pdf-annotate-type');\n\n  if (type === 'highlight' || type === 'strikeout') { return; }\n\n  isDragging = true;\n  dragOffsetX = e.clientX;\n  dragOffsetY = e.clientY;\n  dragStartX = overlay.offsetLeft;\n  dragStartY = overlay.offsetTop;\n\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\n  overlay.style.cursor = 'move';\n  overlay.querySelector('a').style.display = 'none';\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousemove(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let parentNode = overlay.parentNode;\n  let rect = parentNode.getBoundingClientRect();\n  let y = (dragStartY + (e.clientY - dragOffsetY));\n  let x = (dragStartX + (e.clientX - dragOffsetX));\n  let minY = 0;\n  let maxY = rect.height;\n  let minX = 0;\n  let maxX = rect.width;\n\n  if (y > minY && y + overlay.offsetHeight < maxY) {\n    overlay.style.top = `${y}px`;\n  }\n\n  if (x > minX && x + overlay.offsetWidth < maxX) {\n    overlay.style.left = `${x}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target[0].getAttribute('data-pdf-annotate-type');\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n  \n  overlay.querySelector('a').style.display = '';\n\n  function getDelta(propX, propY) {\n    return calcDelta(parseInt(target[0].getAttribute(propX), 10), parseInt(target[0].getAttribute(propY), 10));\n  }\n\n  function calcDelta(x, y) {\n    return {\n      deltaX: OVERLAY_BORDER_SIZE + scaleDown(svg, {x: $(overlay).position().left }).x - x,\n      deltaY: OVERLAY_BORDER_SIZE + scaleDown(svg, {y: $(overlay).position().top }).y - y\n    };\n  }\n\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\n    \n    // exit early if those are not present (happens with Spammy clicking)\n    if(!target || !svg || !target[0] || !target[0].parentNode) {\n      return;\n    }\n\n    if (['area', 'highlight', 'point', 'textbox', 'strikeout'].includes(type)) {\n      let { deltaX, deltaY } = getDelta('x', 'y');\n      [...target].forEach((t, i) => {\n        if (deltaY !== 0) {\n          let modelY = parseInt(t.getAttribute('y'), 10) + deltaY;\n          let viewY = modelY;\n\n          if (type === 'textbox') {\n            viewY += annotation.size;\n          }\n\n          if (type === 'point') {\n            viewY = scaleUp(svg, { viewY }).viewY;\n          }\n\n          t.setAttribute('y', viewY);\n          if (annotation.rectangles) {\n            annotation.rectangles[i].y = modelY;\n          } else if (annotation.y) {\n            annotation.y = modelY;\n          }\n        }\n        if (deltaX !== 0) {\n          let modelX = parseInt(t.getAttribute('x'), 10) + deltaX;\n          let viewX = modelX;\n\n          if (type === 'point') {\n            viewX = scaleUp(svg, { viewX }).viewX;\n          }\n\n          t.setAttribute('x', viewX);\n          if (annotation.rectangles) {\n            annotation.rectangles[i].x = modelX;\n          } else if (annotation.x) {\n            annotation.x = modelX;\n          }\n        }\n\n        if(deltaX !== 0 || deltaY !== 0) {\n          PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\n        }\n      });\n    // } else if (type === 'strikeout') {\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\n    //   [...target].forEach(target, (t, i) => {\n    //     if (deltaY !== 0) {\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\n    //     }\n    //     if (deltaX !== 0) {\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\n    //     }\n    //   });\n    } else if (type === 'drawing') {\n      let rect = scaleDown(svg, getAnnotationRect(target[0]));\n      let [originX, originY] = annotation.lines[0];\n      let { deltaX, deltaY } = calcDelta(originX, originY);\n\n      // origin isn't necessarily at 0/0 in relation to overlay x/y\n      // adjust the difference between overlay and drawing coords\n      deltaY += (originY - rect.top);\n      deltaX += (originX - rect.left);\n\n      annotation.lines.forEach((line, i) => {\n        let [x, y] = annotation.lines[i];\n        annotation.lines[i][0] = x + deltaX;\n        annotation.lines[i][1] = y + deltaY;\n      });\n\n      target[0].parentNode.removeChild(target[0]);\n      appendChild(svg, annotation);\n\n      if(deltaX !== 0 || deltaY !== 0) {\n        PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\n      }\n    }\n  });\n\n  setTimeout(() => {\n    isDragging = false;\n  }, 0);\n\n  overlay.style.background = '';\n  overlay.style.cursor = '';\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Handle annotation.click event\n *\n * @param {Element} e The annotation element that was clicked\n */\nfunction handleAnnotationClick(target) {\n  createEditOverlay(target);\n}\n\n/**\n * Added to disable movement and deletion of annotations while still\n * allowing selection\n */\nexport function setCanEdit(value) {\n  _canEdit = value;\n}\n\n/**\n * Enable edit mode behavior.\n */\nexport function enableEdit () {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  addEventListener('annotation:click', handleAnnotationClick);\n};\n\n/**\n * Disable edit mode behavior.\n */\nexport function disableEdit () {\n  destroyEditOverlay();\n\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  removeEventListener('annotation:click', handleAnnotationClick);\n};\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/edit.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet _penSize;\nlet _penColor;\nlet path;\nlet lines;\n\n/**\n * Handle document.mousedown event\n */\nfunction handleDocumentMousedown() {\n  path = null;\n  lines = [];\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let svg;\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    let { documentId, pageNumber } = getMetadata(svg);\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\n        type: 'drawing',\n        width: _penSize,\n        color: _penColor,\n        lines\n      }\n    ).then((annotation) => {\n      if (path) {\n        svg.removeChild(path);\n      }\n\n      appendChild(svg, annotation);\n    });\n  }\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMousemove(e) {\n  savePoint(e.clientX, e.clientY);\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    lines = null;\n    path.parentNode.removeChild(path);\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    document.removeEventListener('mouseup', handleDocumentMouseup);\n  }\n}\n\n/**\n * Save a point to the line being drawn.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n */\nfunction savePoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let point = scaleDown(svg, {\n    x: x - rect.left,\n    y: y - rect.top\n  });\n\n  lines.push([point.x, point.y]);\n\n  if (lines.length <= 1) {\n    return;\n  }\n\n  if (path) {\n    svg.removeChild(path);\n  }\n\n  path = appendChild(svg, {\n    type: 'drawing',\n    color: _penColor,\n    width: _penSize,\n    lines\n  });\n}\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} penSize The size of the lines drawn by the pen\n * @param {String} penColor The color of the lines drawn by the pen\n */\nexport function setPen(penSize = 1, penColor = '000000') {\n  _penSize = parseInt(penSize, 10);\n  _penColor = penColor;\n}\n\n/**\n * Enable the pen behavior\n */\nexport function enablePen() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  disableUserSelect();\n}\n\n/**\n * Disable the pen behavior\n */\nexport function disablePen() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  enableUserSelect();\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/pen.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return\n  }\n  \n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-point-input');\n  input.setAttribute('placeholder', 'Enter comment');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  savePoint();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13) {\n    savePoint();\n  }\n}\n\n/**\n * Save a new point annotation from input\n */\nfunction savePoint() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let content = input.value.trim();\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let rect = svg.getBoundingClientRect();\n    let { documentId, pageNumber } = getMetadata(svg);\n    let annotation = Object.assign({\n        type: 'point'\n      }, scaleDown(svg, {\n        x: clientX - rect.left,\n        y: clientY - rect.top\n      })\n    );\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        PDFJSAnnotate.getStoreAdapter().addComment(\n          documentId,\n          annotation.uuid,\n          content\n        );\n\n        appendChild(svg, annotation);\n      });\n  }\n\n  closeInput();\n}\n\n/**\n * Close the input element\n */\nfunction closeInput() {\n  input.removeEventListener('blur', handleInputBlur);\n  input.removeEventListener('keyup', handleInputKeyup);\n  document.body.removeChild(input);\n  input = null;\n}\n\n/**\n * Enable point annotation behavior\n */\nexport function enablePoint() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Disable point annotation behavior\n */\nexport function disablePoint() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/point.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  getOffset,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet _type;\nlet overlay;\nlet originY;\nlet originX;\n\n/**\n * Get the current window selection as rects\n *\n * @return {Array} An Array of rects\n */\nfunction getSelectionRects() {\n  try {\n    let selection = window.getSelection();\n    let range = selection.getRangeAt(0);\n    let rects = range.getClientRects();\n\n    if (rects.length > 0 &&\n        rects[0].width > 0 &&\n        rects[0].height > 0) {\n      return rects;\n    }\n  } catch (e) {}\n  \n  return null;\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousedown(e) {\n  let svg;\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  originY = e.clientY;\n  originX = e.clientX;\n\n  overlay = document.createElement('div');\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${originY - rect.top}px`;\n  overlay.style.left = `${originX - rect.left}px`;\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = '3px';\n  svg.parentNode.appendChild(overlay);\n  \n  document.addEventListener('mousemove', handleDocumentMousemove);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousemove(e) {\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let rect = svg.getBoundingClientRect();\n\n  if (originX + (e.clientX - originX) < rect.right) {\n    overlay.style.width = `${e.clientX - originX}px`;\n  }\n\n  if (originY + (e.clientY - originY) < rect.bottom) {\n    overlay.style.height = `${e.clientY - originY}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  let rects;\n\n  // TODO: Pamoja: temp fix (mrbrdo) - fix problem if creating highlight annotation and then clicking arrow icon (would duplicate annotation because of this function call)\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n    \n  if (_type !== 'area' && (rects = getSelectionRects())) {\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n    saveRect(_type, [...rects].map((r) => {\n      return {\n        top: r.top,\n        left: r.left,\n        width: r.width,\n        height: r.height\n      };\n    }));\n  } else if (_type === 'area' && overlay) {\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n    let rect = svg.getBoundingClientRect();\n    saveRect(_type, [{\n      top: parseInt(overlay.style.top, 10) + rect.top,\n      left: parseInt(overlay.style.left, 10) + rect.left,\n      width: parseInt(overlay.style.width, 10),\n      height: parseInt(overlay.style.height, 10)\n    }]);\n\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    enableUserSelect();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    let selection = window.getSelection();\n    selection.removeAllRanges();\n    if (overlay && overlay.parentNode) {\n      overlay.parentNode.removeChild(overlay);\n      overlay = null;\n      document.removeEventListener('mousemove', handleDocumentMousemove);\n    }\n  }\n}\n\n/**\n * Save a rect annotation\n *\n * @param {String} type The type of rect (area, highlight, strikeout)\n * @param {Array} rects The rects to use for annotation\n * @param {String} color The color of the rects\n */\nfunction saveRect(type, rects, color) {\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n  let node;\n  let annotation;\n\n  if (!svg) {\n    return;\n  }\n\n  let boundingRect = svg.getBoundingClientRect();\n\n  if (!color) {\n    if (type === 'highlight') {\n      color = 'FFFF00';\n    } else if (type === 'strikeout') {\n      color = 'FF0000';\n    }\n  }\n\n  // Initialize the annotation\n  annotation = {\n    type,\n    color,\n    rectangles: [...rects].map((r) => {\n      let offset = 0;\n\n      if (type === 'strikeout') {\n        offset = r.height / 2;\n      }\n\n      return scaleDown(svg, {\n        y: (r.top + offset) - boundingRect.top,\n        x: r.left - boundingRect.left,\n        width: r.width,\n        height: r.height\n      });\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\n  };\n  \n  // Short circuit if no rectangles exist\n  if (annotation.rectangles.length === 0) {\n    return;\n  }\n\n  // Special treatment for area as it only supports a single rect\n  if (type === 'area') {\n    let rect = annotation.rectangles[0];\n    delete annotation.rectangles;\n    annotation.x = rect.x;\n    annotation.y = rect.y;\n    annotation.width = rect.width;\n    annotation.height = rect.height;\n  }\n\n  let { documentId, pageNumber } = getMetadata(svg);\n\n  // Add the annotation\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n    });\n}\n\n/**\n * Enable rect behavior\n */\nexport function enableRect(type) {\n  _type = type;\n  \n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n}\n\n/**\n * Disable rect behavior\n */\nexport function disableRect() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/rect.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\nlet _textSize;\nlet _textColor;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n\n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-text-input');\n  input.setAttribute('placeholder', 'Enter text');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n  input.style.fontSize = `${_textSize}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  saveText();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13) {\n    saveText();\n  }\n}\n\n/**\n * Save a text annotation from input\n */\nfunction saveText() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let { documentId, pageNumber } = getMetadata(svg);\n    let rect = svg.getBoundingClientRect();\n    let annotation = Object.assign({\n        type: 'textbox',\n        size: _textSize,\n        color: _textColor,\n        content: input.value.trim()\n      }, scaleDown(svg, {\n        x: clientX - rect.left,\n        y: clientY -  rect.top,\n        width: input.offsetWidth,\n        height: input.offsetHeight\n      })\n    );\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        appendChild(svg, annotation);\n      });\n  }\n  \n  closeInput();\n}\n\n/**\n * Close the input\n */\nfunction closeInput() {\n  if (input) {\n    input.removeEventListener('blur', handleInputBlur);\n    input.removeEventListener('keyup', handleInputKeyup);\n    document.body.removeChild(input);\n    input = null;\n  }\n}\n\n/**\n * Set the text attributes\n *\n * @param {Number} textSize The size of the text\n * @param {String} textColor The color of the text\n */\nexport function setText(textSize = 12, textColor = '000000') {\n  _textSize = parseInt(textSize, 10);\n  _textColor = textColor;\n}\n\n\n/**\n * Enable text behavior\n */\nexport function enableText() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n\n/**\n * Disable text behavior\n */\nexport function disableText() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/text.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n// Template for creating a new page\nconst PAGE_TEMPLATE = `\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\n    <div class=\"canvasWrapper\">\n      <canvas></canvas>\n    </div>\n    <svg class=\"annotationLayer\"></svg>\n    <div class=\"textLayer\"></div>\n  </div>\n`;\n\n/**\n * Create a new page to be appended to the DOM.\n *\n * @param {Number} pageNumber The page number that is being created\n * @return {HTMLElement}\n */\nexport function createPage(pageNumber) {\n  let temp = document.createElement('div');\n  temp.innerHTML = PAGE_TEMPLATE;\n\n  let page = temp.children[0];\n  let canvas = page.querySelector('canvas');\n\n  page.setAttribute('id', `pageContainer${pageNumber}`);\n  page.setAttribute('data-page-number', pageNumber);\n\n  canvas.mozOpaque = true;\n  canvas.setAttribute('id', `page${pageNumber}`);\n\n  return page;\n}\n\n/**\n * Render a page that has already been created.\n *\n * @param {Number} pageNumber The page number to be rendered\n * @param {Object} renderOptions The options for rendering\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: [pdfPage, annotations]\n *    - rejected: Error\n */\nexport function renderPage(pageNumber, renderOptions) {\n  let {\n    documentId,\n    pdfDocument,\n    scale,\n    rotate\n  } = renderOptions;\n\n  // Load the page and annotations\n  return Promise.all([\n    pdfDocument.getPage(pageNumber),\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\n  ]).then(([pdfPage, annotations]) => {\n    let page = document.getElementById(`pageContainer${pageNumber}`);\n    let svg = page.querySelector('.annotationLayer');\n    let canvas = page.querySelector('.canvasWrapper canvas');\n    let canvasContext = canvas.getContext('2d', {alpha: false});\n    let viewport = pdfPage.getViewport(scale, rotate);\n    let transform = scalePage(pageNumber, viewport, canvasContext);\n\n    // Render the page\n    return Promise.all([\n      pdfPage.render({ canvasContext, viewport, transform }),\n      PDFJSAnnotate.render(svg, viewport, annotations)\n    ]).then(() => {\n      // Text content is needed for a11y, but is also necessary for creating\n      // highlight and strikeout annotations which require selecting text.\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\n        return new Promise((resolve, reject) => {\n          // Render text layer for a11y of text content\n          let textLayer = page.querySelector(`.textLayer`);\n          let textLayerFactory = new PDFJS.DefaultTextLayerFactory();\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(textLayer, pageNumber -1, viewport);\n          textLayerBuilder.setTextContent(textContent);\n          textLayerBuilder.render();\n\n          // Enable a11y for annotations\n          // Timeout is needed to wait for `textLayerBuilder.render`\n          setTimeout(() => {\n            try {\n              renderScreenReaderHints(annotations.annotations);\n              resolve();\n            } catch (e) {\n              reject(e);\n            }\n          });\n        });\n      });\n    }).then(() => {\n      // Indicate that the page was loaded\n      page.setAttribute('data-loaded', 'true');\n\n      return [pdfPage, annotations];\n    });\n  });\n}\n\n/**\n * Scale the elements of a page.\n *\n * @param {Number} pageNumber The page number to be scaled\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\n * @param {Object} context The canvas context that the PDF page is rendered to\n * @return {Array} The transform data for rendering the PDF page\n */\nfunction scalePage(pageNumber, viewport, context) {\n  let page = document.getElementById(`pageContainer${pageNumber}`);\n  let canvas = page.querySelector('.canvasWrapper canvas');\n  let svg = page.querySelector('.annotationLayer');\n  let wrapper = page.querySelector('.canvasWrapper');\n  let textLayer = page.querySelector('.textLayer');\n  let outputScale = getOutputScale(context);\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\n  let sfx = approximateFraction(outputScale.sx);\n  let sfy = approximateFraction(outputScale.sy);\n\n  // Adjust width/height for scale\n  page.style.visibility = '';\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\n  svg.setAttribute('width', viewport.width);\n  svg.setAttribute('height', viewport.height);\n  svg.style.width = `${viewport.width}px`;\n  svg.style.height = `${viewport.height}px`;\n  page.style.width = `${viewport.width}px`;\n  page.style.height = `${viewport.height}px`;\n  wrapper.style.width = `${viewport.width}px`;\n  wrapper.style.height = `${viewport.height}px`;\n  textLayer.style.width = `${viewport.width}px`;\n  textLayer.style.height = `${viewport.height}px`;\n\n  return transform;\n}\n\n/**\n * The following methods are taken from mozilla/pdf.js and as such fall under\n * the Apache License (http://www.apache.org/licenses/).\n *\n * Original source can be found at mozilla/pdf.js:\n * https://github.com/mozilla/pdf.js/blob/master/web/ui_utils.js\n */\n\n/**\n * Approximates a float number as a fraction using Farey sequence (max order\n * of 8).\n *\n * @param {Number} x Positive float number\n * @return {Array} Estimated fraction: the first array item is a numerator,\n *                 the second one is a denominator.\n */\nfunction approximateFraction(x) {\n  // Fast path for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n\n  const xinv = 1 / x;\n  const limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  const x_ = x > 1 ? xinv : x;\n  \n  // a/b and c/d are neighbours in Farey sequence.\n  let a = 0, b = 1, c = 1, d = 1;\n  \n  // Limit search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    let p = a + c, q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p; d = q;\n    } else {\n      a = p; b = q;\n    }\n  }\n\n  // Select closest of neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    return x_ === x ? [a, b] : [b, a];\n  } else {\n    return x_ === x ? [c, d] : [d, c];\n  }\n}\n\nfunction getOutputScale(ctx) {\n  let devicePixelRatio = window.devicePixelRatio || 1;\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\n                          ctx.mozBackingStorePixelRatio ||\n                          ctx.msBackingStorePixelRatio ||\n                          ctx.oBackingStorePixelRatio ||\n                          ctx.backingStorePixelRatio || 1;\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\n  return {\n    sx: pixelRatio,\n    sy: pixelRatio,\n    scaled: pixelRatio !== 1\n  };\n}\n\nfunction roundToDivide(x, div) {\n  let r = x % div;\n  return r === 0 ? x : Math.round(x - r + div);\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/page.js\n **/","// Color picker component\nconst COLORS = [\n  {hex: '#000000', name: 'Black'},\n  {hex: '#EF4437', name: 'Red'},\n  {hex: '#E71F63', name: 'Pink'},\n  {hex: '#8F3E97', name: 'Purple'},\n  {hex: '#65499D', name: 'Deep Purple'},\n  {hex: '#4554A4', name: 'Indigo'},\n  {hex: '#2083C5', name: 'Blue'},\n  {hex: '#35A4DC', name: 'Light Blue'},\n  {hex: '#09BCD3', name: 'Cyan'},\n  {hex: '#009688', name: 'Teal'},\n  {hex: '#43A047', name: 'Green'},\n  {hex: '#8BC34A', name: 'Light Green'},\n  {hex: '#FDC010', name: 'Yellow'},\n  {hex: '#F8971C', name: 'Orange'},\n  {hex: '#F0592B', name: 'Deep Orange'},\n  {hex: '#F06291', name: 'Light Pink'}\n];\n\nexport default function initColorPicker(el, value, onChange) {\n  function setColor(value, fireOnChange = true) {\n    currentValue = value;\n    a.setAttribute('data-color', value);\n    a.style.background = value;\n    if (fireOnChange && typeof onChange === 'function') {\n      onChange(value);\n    }\n    closePicker();\n  }\n\n  function togglePicker() {\n    if (isPickerOpen) {\n      closePicker();\n    } else {\n      openPicker();\n    }\n  }\n\n  function closePicker() {\n    document.removeEventListener('keyup', handleDocumentKeyup);\n    if (picker && picker.parentNode) {\n      picker.parentNode.removeChild(picker);\n    }\n    isPickerOpen = false;\n    a.focus();\n  }\n\n  function openPicker() {\n    if (!picker) {\n      picker = document.createElement('div');\n      picker.style.background = '#fff';\n      picker.style.border = '1px solid #ccc';\n      picker.style.padding = '2px';\n      picker.style.position = 'absolute';\n      picker.style.width = '122px';\n      el.style.position = 'relative';\n\n      COLORS.map(createColorOption).forEach((c) => {\n        c.style.margin = '2px';\n        c.onclick = function () { setColor(c.getAttribute('data-color')); };\n        picker.appendChild(c);\n      });\n    }\n\n    document.addEventListener('keyup', handleDocumentKeyup);\n    el.appendChild(picker);\n    isPickerOpen = true;\n  }\n\n  function createColorOption(color) {\n    let e = document.createElement('a');\n    e.className = 'color';\n    e.setAttribute('href', 'javascript://');\n    e.setAttribute('title', color.name);\n    e.setAttribute('data-color', color.hex);\n    e.style.background = color.hex;\n    return e;\n  }\n\n  function handleDocumentKeyup(e) {\n    if (e.keyCode === 27) {\n      closePicker();\n    }\n  }\n\n  let picker;\n  let isPickerOpen = false;\n  let currentValue;\n  let a = createColorOption({hex: value});\n  a.onclick = togglePicker;\n  el.appendChild(a);\n  setColor(value, false);\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./shared/initColorPicker.js\n **/","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/*jshint globalstrict: false */\n/* globals PDFJS, PDFViewer, PDFPageView, TextLayerBuilder, PDFLinkService,\n           DefaultTextLayerFactory, AnnotationLayerBuilder, PDFHistory,\n           DefaultAnnotationLayerFactory, getFileName, ProgressBar */\n\n// Initializing PDFJS global object (if still undefined)\nif (typeof PDFJS === 'undefined') {\n  (typeof window !== 'undefined' ? window : this).PDFJS = {};\n}\n\n(function pdfViewerWrapper() {\n  'use strict';\n\n\nvar CSS_UNITS = 96.0 / 72.0;\nvar DEFAULT_SCALE_VALUE = 'auto';\nvar DEFAULT_SCALE = 1.0;\nvar UNKNOWN_SCALE = 0;\nvar MAX_AUTO_SCALE = 1.25;\nvar SCROLLBAR_PADDING = 40;\nvar VERTICAL_PADDING = 5;\n\nfunction getFileName(url) {\n  var anchor = url.indexOf('#');\n  var query = url.indexOf('?');\n  var end = Math.min(\n    anchor > 0 ? anchor : url.length,\n    query > 0 ? query : url.length);\n  return url.substring(url.lastIndexOf('/', end) + 1, end);\n}\n\n/**\n * Returns scale factor for the canvas. It makes sense for the HiDPI displays.\n * @return {Object} The object with horizontal (sx) and vertical (sy)\n                    scales. The scaled property is set to false if scaling is\n                    not required, true otherwise.\n */\nfunction getOutputScale(ctx) {\n  var devicePixelRatio = window.devicePixelRatio || 1;\n  var backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\n                          ctx.mozBackingStorePixelRatio ||\n                          ctx.msBackingStorePixelRatio ||\n                          ctx.oBackingStorePixelRatio ||\n                          ctx.backingStorePixelRatio || 1;\n  var pixelRatio = devicePixelRatio / backingStoreRatio;\n  return {\n    sx: pixelRatio,\n    sy: pixelRatio,\n    scaled: pixelRatio !== 1\n  };\n}\n\n/**\n * Scrolls specified element into view of its parent.\n * @param {Object} element - The element to be visible.\n * @param {Object} spot - An object with optional top and left properties,\n *   specifying the offset from the top left edge.\n * @param {boolean} skipOverflowHiddenElements - Ignore elements that have\n *   the CSS rule `overflow: hidden;` set. The default is false.\n */\nfunction scrollIntoView(element, spot, skipOverflowHiddenElements) {\n  // Assuming offsetParent is available (it's not available when viewer is in\n  // hidden iframe or object). We have to scroll: if the offsetParent is not set\n  // producing the error. See also animationStartedClosure.\n  var parent = element.offsetParent;\n  if (!parent) {\n    console.error('offsetParent is not set -- cannot scroll');\n    return;\n  }\n  var checkOverflow = skipOverflowHiddenElements || false;\n  var offsetY = element.offsetTop + element.clientTop;\n  var offsetX = element.offsetLeft + element.clientLeft;\n  while (parent.clientHeight === parent.scrollHeight ||\n         (checkOverflow && getComputedStyle(parent).overflow === 'hidden')) {\n    if (parent.dataset._scaleY) {\n      offsetY /= parent.dataset._scaleY;\n      offsetX /= parent.dataset._scaleX;\n    }\n    offsetY += parent.offsetTop;\n    offsetX += parent.offsetLeft;\n    parent = parent.offsetParent;\n    if (!parent) {\n      return; // no need to scroll\n    }\n  }\n  if (spot) {\n    if (spot.top !== undefined) {\n      offsetY += spot.top;\n    }\n    if (spot.left !== undefined) {\n      offsetX += spot.left;\n      parent.scrollLeft = offsetX;\n    }\n  }\n  parent.scrollTop = offsetY;\n}\n\n/**\n * Helper function to start monitoring the scroll event and converting them into\n * PDF.js friendly one: with scroll debounce and scroll direction.\n */\nfunction watchScroll(viewAreaElement, callback) {\n  var debounceScroll = function debounceScroll(evt) {\n    if (rAF) {\n      return;\n    }\n    // schedule an invocation of scroll for next animation frame.\n    rAF = window.requestAnimationFrame(function viewAreaElementScrolled() {\n      rAF = null;\n\n      var currentY = viewAreaElement.scrollTop;\n      var lastY = state.lastY;\n      if (currentY !== lastY) {\n        state.down = currentY > lastY;\n      }\n      state.lastY = currentY;\n      callback(state);\n    });\n  };\n\n  var state = {\n    down: true,\n    lastY: viewAreaElement.scrollTop,\n    _eventHandler: debounceScroll\n  };\n\n  var rAF = null;\n  viewAreaElement.addEventListener('scroll', debounceScroll, true);\n  return state;\n}\n\n/**\n * Helper function to parse query string (e.g. ?param1=value&parm2=...).\n */\nfunction parseQueryString(query) {\n  var parts = query.split('&');\n  var params = {};\n  for (var i = 0, ii = parts.length; i < ii; ++i) {\n    var param = parts[i].split('=');\n    var key = param[0].toLowerCase();\n    var value = param.length > 1 ? param[1] : null;\n    params[decodeURIComponent(key)] = decodeURIComponent(value);\n  }\n  return params;\n}\n\n/**\n * Use binary search to find the index of the first item in a given array which\n * passes a given condition. The items are expected to be sorted in the sense\n * that if the condition is true for one item in the array, then it is also true\n * for all following items.\n *\n * @returns {Number} Index of the first array element to pass the test,\n *                   or |items.length| if no such element exists.\n */\nfunction binarySearchFirstItem(items, condition) {\n  var minIndex = 0;\n  var maxIndex = items.length - 1;\n\n  if (items.length === 0 || !condition(items[maxIndex])) {\n    return items.length;\n  }\n  if (condition(items[minIndex])) {\n    return minIndex;\n  }\n\n  while (minIndex < maxIndex) {\n    var currentIndex = (minIndex + maxIndex) >> 1;\n    var currentItem = items[currentIndex];\n    if (condition(currentItem)) {\n      maxIndex = currentIndex;\n    } else {\n      minIndex = currentIndex + 1;\n    }\n  }\n  return minIndex; /* === maxIndex */\n}\n\n/**\n *  Approximates float number as a fraction using Farey sequence (max order\n *  of 8).\n *  @param {number} x - Positive float number.\n *  @returns {Array} Estimated fraction: the first array item is a numerator,\n *                   the second one is a denominator.\n */\nfunction approximateFraction(x) {\n  // Fast paths for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n  var xinv = 1 / x;\n  var limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else  if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  var x_ = x > 1 ? xinv : x;\n  // a/b and c/d are neighbours in Farey sequence.\n  var a = 0, b = 1, c = 1, d = 1;\n  // Limiting search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    var p = a + c, q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p; d = q;\n    } else {\n      a = p; b = q;\n    }\n  }\n  // Select closest of the neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    return x_ === x ? [a, b] : [b, a];\n  } else {\n    return x_ === x ? [c, d] : [d, c];\n  }\n}\n\nfunction roundToDivide(x, div) {\n  var r = x % div;\n  return r === 0 ? x : Math.round(x - r + div);\n}\n\n/**\n * Generic helper to find out what elements are visible within a scroll pane.\n */\nfunction getVisibleElements(scrollEl, views, sortByVisibility) {\n  var top = scrollEl.scrollTop, bottom = top + scrollEl.clientHeight;\n  var left = scrollEl.scrollLeft, right = left + scrollEl.clientWidth;\n\n  function isElementBottomBelowViewTop(view) {\n    var element = view.div;\n    var elementBottom =\n      element.offsetTop + element.clientTop + element.clientHeight;\n    return elementBottom > top;\n  }\n\n  var visible = [], view, element;\n  var currentHeight, viewHeight, hiddenHeight, percentHeight;\n  var currentWidth, viewWidth;\n  var firstVisibleElementInd = (views.length === 0) ? 0 :\n    binarySearchFirstItem(views, isElementBottomBelowViewTop);\n\n  for (var i = firstVisibleElementInd, ii = views.length; i < ii; i++) {\n    view = views[i];\n    element = view.div;\n    currentHeight = element.offsetTop + element.clientTop;\n    viewHeight = element.clientHeight;\n\n    if (currentHeight > bottom) {\n      break;\n    }\n\n    currentWidth = element.offsetLeft + element.clientLeft;\n    viewWidth = element.clientWidth;\n    if (currentWidth + viewWidth < left || currentWidth > right) {\n      continue;\n    }\n    hiddenHeight = Math.max(0, top - currentHeight) +\n      Math.max(0, currentHeight + viewHeight - bottom);\n    percentHeight = ((viewHeight - hiddenHeight) * 100 / viewHeight) | 0;\n\n    visible.push({\n      id: view.id,\n      x: currentWidth,\n      y: currentHeight,\n      view: view,\n      percent: percentHeight\n    });\n  }\n\n  var first = visible[0];\n  var last = visible[visible.length - 1];\n\n  if (sortByVisibility) {\n    visible.sort(function(a, b) {\n      var pc = a.percent - b.percent;\n      if (Math.abs(pc) > 0.001) {\n        return -pc;\n      }\n      return a.id - b.id; // ensure stability\n    });\n  }\n  return {first: first, last: last, views: visible};\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenuHandler(e) {\n  e.preventDefault();\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * url {String} The original PDF location.\n * @return {String} Guessed PDF file name.\n */\nfunction getPDFFileNameFromURL(url) {\n  var reURI = /^(?:([^:]+:)?\\/\\/[^\\/]+)?([^?#]*)(\\?[^#]*)?(#.*)?$/;\n  //            SCHEME      HOST         1.PATH  2.QUERY   3.REF\n  // Pattern to get last matching NAME.pdf\n  var reFilename = /[^\\/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n  var splitURI = reURI.exec(url);\n  var suggestedFilename = reFilename.exec(splitURI[1]) ||\n                           reFilename.exec(splitURI[2]) ||\n                           reFilename.exec(splitURI[3]);\n  if (suggestedFilename) {\n    suggestedFilename = suggestedFilename[0];\n    if (suggestedFilename.indexOf('%') !== -1) {\n      // URL-encoded %2Fpath%2Fto%2Ffile.pdf should be file.pdf\n      try {\n        suggestedFilename =\n          reFilename.exec(decodeURIComponent(suggestedFilename))[0];\n      } catch(e) { // Possible (extremely rare) errors:\n        // URIError \"Malformed URI\", e.g. for \"%AA.pdf\"\n        // TypeError \"null has no properties\", e.g. for \"%2F.pdf\"\n      }\n    }\n  }\n  return suggestedFilename || 'document.pdf';\n}\n\nvar ProgressBar = (function ProgressBarClosure() {\n\n  function clamp(v, min, max) {\n    return Math.min(Math.max(v, min), max);\n  }\n\n  function ProgressBar(id, opts) {\n    this.visible = true;\n\n    // Fetch the sub-elements for later.\n    this.div = document.querySelector(id + ' .progress');\n\n    // Get the loading bar element, so it can be resized to fit the viewer.\n    this.bar = this.div.parentNode;\n\n    // Get options, with sensible defaults.\n    this.height = opts.height || 100;\n    this.width = opts.width || 100;\n    this.units = opts.units || '%';\n\n    // Initialize heights.\n    this.div.style.height = this.height + this.units;\n    this.percent = 0;\n  }\n\n  ProgressBar.prototype = {\n\n    updateBar: function ProgressBar_updateBar() {\n      if (this._indeterminate) {\n        this.div.classList.add('indeterminate');\n        this.div.style.width = this.width + this.units;\n        return;\n      }\n\n      this.div.classList.remove('indeterminate');\n      var progressSize = this.width * this._percent / 100;\n      this.div.style.width = progressSize + this.units;\n    },\n\n    get percent() {\n      return this._percent;\n    },\n\n    set percent(val) {\n      this._indeterminate = isNaN(val);\n      this._percent = clamp(val, 0, 100);\n      this.updateBar();\n    },\n\n    setWidth: function ProgressBar_setWidth(viewer) {\n      if (viewer) {\n        var container = viewer.parentNode;\n        var scrollbarWidth = container.offsetWidth - viewer.offsetWidth;\n        if (scrollbarWidth > 0) {\n          this.bar.setAttribute('style', 'width: calc(100% - ' +\n                                         scrollbarWidth + 'px);');\n        }\n      }\n    },\n\n    hide: function ProgressBar_hide() {\n      if (!this.visible) {\n        return;\n      }\n      this.visible = false;\n      this.bar.classList.add('hidden');\n      document.body.classList.remove('loadingInProgress');\n    },\n\n    show: function ProgressBar_show() {\n      if (this.visible) {\n        return;\n      }\n      this.visible = true;\n      document.body.classList.add('loadingInProgress');\n      this.bar.classList.remove('hidden');\n    }\n  };\n\n  return ProgressBar;\n})();\n\n\n/**\n * Performs navigation functions inside PDF, such as opening specified page,\n * or destination.\n * @class\n * @implements {IPDFLinkService}\n */\nvar PDFLinkService = (function () {\n  /**\n   * @constructs PDFLinkService\n   */\n  function PDFLinkService() {\n    this.baseUrl = null;\n    this.pdfDocument = null;\n    this.pdfViewer = null;\n    this.pdfHistory = null;\n\n    this._pagesRefCache = null;\n  }\n\n  PDFLinkService.prototype = {\n    setDocument: function PDFLinkService_setDocument(pdfDocument, baseUrl) {\n      this.baseUrl = baseUrl;\n      this.pdfDocument = pdfDocument;\n      this._pagesRefCache = Object.create(null);\n    },\n\n    setViewer: function PDFLinkService_setViewer(pdfViewer) {\n      this.pdfViewer = pdfViewer;\n    },\n\n    setHistory: function PDFLinkService_setHistory(pdfHistory) {\n      this.pdfHistory = pdfHistory;\n    },\n\n    /**\n     * @returns {number}\n     */\n    get pagesCount() {\n      return this.pdfDocument.numPages;\n    },\n\n    /**\n     * @returns {number}\n     */\n    get page() {\n      return this.pdfViewer.currentPageNumber;\n    },\n\n    /**\n     * @param {number} value\n     */\n    set page(value) {\n      this.pdfViewer.currentPageNumber = value;\n    },\n\n    /**\n     * @param dest - The PDF destination object.\n     */\n    navigateTo: function PDFLinkService_navigateTo(dest) {\n      var destString = '';\n      var self = this;\n\n      var goToDestination = function(destRef) {\n        // dest array looks like that: <page-ref> </XYZ|FitXXX> <args..>\n        var pageNumber = destRef instanceof Object ?\n          self._pagesRefCache[destRef.num + ' ' + destRef.gen + ' R'] :\n          (destRef + 1);\n        if (pageNumber) {\n          if (pageNumber > self.pagesCount) {\n            pageNumber = self.pagesCount;\n          }\n          self.pdfViewer.scrollPageIntoView(pageNumber, dest);\n\n          if (self.pdfHistory) {\n            // Update the browsing history.\n            self.pdfHistory.push({\n              dest: dest,\n              hash: destString,\n              page: pageNumber\n            });\n          }\n        } else {\n          self.pdfDocument.getPageIndex(destRef).then(function (pageIndex) {\n            var pageNum = pageIndex + 1;\n            var cacheKey = destRef.num + ' ' + destRef.gen + ' R';\n            self._pagesRefCache[cacheKey] = pageNum;\n            goToDestination(destRef);\n          });\n        }\n      };\n\n      var destinationPromise;\n      if (typeof dest === 'string') {\n        destString = dest;\n        destinationPromise = this.pdfDocument.getDestination(dest);\n      } else {\n        destinationPromise = Promise.resolve(dest);\n      }\n      destinationPromise.then(function(destination) {\n        dest = destination;\n        if (!(destination instanceof Array)) {\n          return; // invalid destination\n        }\n        goToDestination(destination[0]);\n      });\n    },\n\n    /**\n     * @param dest - The PDF destination object.\n     * @returns {string} The hyperlink to the PDF object.\n     */\n    getDestinationHash: function PDFLinkService_getDestinationHash(dest) {\n      if (typeof dest === 'string') {\n        return this.getAnchorUrl('#' + escape(dest));\n      }\n      if (dest instanceof Array) {\n        var destRef = dest[0]; // see navigateTo method for dest format\n        var pageNumber = destRef instanceof Object ?\n          this._pagesRefCache[destRef.num + ' ' + destRef.gen + ' R'] :\n          (destRef + 1);\n        if (pageNumber) {\n          var pdfOpenParams = this.getAnchorUrl('#page=' + pageNumber);\n          var destKind = dest[1];\n          if (typeof destKind === 'object' && 'name' in destKind &&\n              destKind.name === 'XYZ') {\n            var scale = (dest[4] || this.pdfViewer.currentScaleValue);\n            var scaleNumber = parseFloat(scale);\n            if (scaleNumber) {\n              scale = scaleNumber * 100;\n            }\n            pdfOpenParams += '&zoom=' + scale;\n            if (dest[2] || dest[3]) {\n              pdfOpenParams += ',' + (dest[2] || 0) + ',' + (dest[3] || 0);\n            }\n          }\n          return pdfOpenParams;\n        }\n      }\n      return this.getAnchorUrl('');\n    },\n\n    /**\n     * Prefix the full url on anchor links to make sure that links are resolved\n     * relative to the current URL instead of the one defined in <base href>.\n     * @param {String} anchor The anchor hash, including the #.\n     * @returns {string} The hyperlink to the PDF object.\n     */\n    getAnchorUrl: function PDFLinkService_getAnchorUrl(anchor) {\n      return (this.baseUrl || '') + anchor;\n    },\n\n    /**\n     * @param {string} hash\n     */\n    setHash: function PDFLinkService_setHash(hash) {\n      if (hash.indexOf('=') >= 0) {\n        var params = parseQueryString(hash);\n        // borrowing syntax from \"Parameters for Opening PDF Files\"\n        if ('nameddest' in params) {\n          if (this.pdfHistory) {\n            this.pdfHistory.updateNextHashParam(params.nameddest);\n          }\n          this.navigateTo(params.nameddest);\n          return;\n        }\n        var pageNumber, dest;\n        if ('page' in params) {\n          pageNumber = (params.page | 0) || 1;\n        }\n        if ('zoom' in params) {\n          // Build the destination array.\n          var zoomArgs = params.zoom.split(','); // scale,left,top\n          var zoomArg = zoomArgs[0];\n          var zoomArgNumber = parseFloat(zoomArg);\n\n          if (zoomArg.indexOf('Fit') === -1) {\n            // If the zoomArg is a number, it has to get divided by 100. If it's\n            // a string, it should stay as it is.\n            dest = [null, { name: 'XYZ' },\n                    zoomArgs.length > 1 ? (zoomArgs[1] | 0) : null,\n                    zoomArgs.length > 2 ? (zoomArgs[2] | 0) : null,\n                    (zoomArgNumber ? zoomArgNumber / 100 : zoomArg)];\n          } else {\n            if (zoomArg === 'Fit' || zoomArg === 'FitB') {\n              dest = [null, { name: zoomArg }];\n            } else if ((zoomArg === 'FitH' || zoomArg === 'FitBH') ||\n                       (zoomArg === 'FitV' || zoomArg === 'FitBV')) {\n              dest = [null, { name: zoomArg },\n                      zoomArgs.length > 1 ? (zoomArgs[1] | 0) : null];\n            } else if (zoomArg === 'FitR') {\n              if (zoomArgs.length !== 5) {\n                console.error('PDFLinkService_setHash: ' +\n                              'Not enough parameters for \\'FitR\\'.');\n              } else {\n                dest = [null, { name: zoomArg },\n                        (zoomArgs[1] | 0), (zoomArgs[2] | 0),\n                        (zoomArgs[3] | 0), (zoomArgs[4] | 0)];\n              }\n            } else {\n              console.error('PDFLinkService_setHash: \\'' + zoomArg +\n                            '\\' is not a valid zoom value.');\n            }\n          }\n        }\n        if (dest) {\n          this.pdfViewer.scrollPageIntoView(pageNumber || this.page, dest);\n        } else if (pageNumber) {\n          this.page = pageNumber; // simple page\n        }\n        if ('pagemode' in params) {\n          var event = document.createEvent('CustomEvent');\n          event.initCustomEvent('pagemode', true, true, {\n            mode: params.pagemode,\n          });\n          this.pdfViewer.container.dispatchEvent(event);\n        }\n      } else if (/^\\d+$/.test(hash)) { // page number\n        this.page = hash;\n      } else { // named destination\n        if (this.pdfHistory) {\n          this.pdfHistory.updateNextHashParam(unescape(hash));\n        }\n        this.navigateTo(unescape(hash));\n      }\n    },\n\n    /**\n     * @param {string} action\n     */\n    executeNamedAction: function PDFLinkService_executeNamedAction(action) {\n      // See PDF reference, table 8.45 - Named action\n      switch (action) {\n        case 'GoBack':\n          if (this.pdfHistory) {\n            this.pdfHistory.back();\n          }\n          break;\n\n        case 'GoForward':\n          if (this.pdfHistory) {\n            this.pdfHistory.forward();\n          }\n          break;\n\n        case 'NextPage':\n          this.page++;\n          break;\n\n        case 'PrevPage':\n          this.page--;\n          break;\n\n        case 'LastPage':\n          this.page = this.pagesCount;\n          break;\n\n        case 'FirstPage':\n          this.page = 1;\n          break;\n\n        default:\n          break; // No action according to spec\n      }\n\n      var event = document.createEvent('CustomEvent');\n      event.initCustomEvent('namedaction', true, true, {\n        action: action\n      });\n      this.pdfViewer.container.dispatchEvent(event);\n    },\n\n    /**\n     * @param {number} pageNum - page number.\n     * @param {Object} pageRef - reference to the page.\n     */\n    cachePageRef: function PDFLinkService_cachePageRef(pageNum, pageRef) {\n      var refStr = pageRef.num + ' ' + pageRef.gen + ' R';\n      this._pagesRefCache[refStr] = pageNum;\n    }\n  };\n\n  return PDFLinkService;\n})();\n\n\nvar PresentationModeState = {\n  UNKNOWN: 0,\n  NORMAL: 1,\n  CHANGING: 2,\n  FULLSCREEN: 3,\n};\n\nvar IGNORE_CURRENT_POSITION_ON_ZOOM = false;\nvar DEFAULT_CACHE_SIZE = 10;\n\n\nvar CLEANUP_TIMEOUT = 30000;\n\nvar RenderingStates = {\n  INITIAL: 0,\n  RUNNING: 1,\n  PAUSED: 2,\n  FINISHED: 3\n};\n\n/**\n * Controls rendering of the views for pages and thumbnails.\n * @class\n */\nvar PDFRenderingQueue = (function PDFRenderingQueueClosure() {\n  /**\n   * @constructs\n   */\n  function PDFRenderingQueue() {\n    this.pdfViewer = null;\n    this.pdfThumbnailViewer = null;\n    this.onIdle = null;\n\n    this.highestPriorityPage = null;\n    this.idleTimeout = null;\n    this.printing = false;\n    this.isThumbnailViewEnabled = false;\n  }\n\n  PDFRenderingQueue.prototype = /** @lends PDFRenderingQueue.prototype */ {\n    /**\n     * @param {PDFViewer} pdfViewer\n     */\n    setViewer: function PDFRenderingQueue_setViewer(pdfViewer) {\n      this.pdfViewer = pdfViewer;\n    },\n\n    /**\n     * @param {PDFThumbnailViewer} pdfThumbnailViewer\n     */\n    setThumbnailViewer:\n        function PDFRenderingQueue_setThumbnailViewer(pdfThumbnailViewer) {\n      this.pdfThumbnailViewer = pdfThumbnailViewer;\n    },\n\n    /**\n     * @param {IRenderableView} view\n     * @returns {boolean}\n     */\n    isHighestPriority: function PDFRenderingQueue_isHighestPriority(view) {\n      return this.highestPriorityPage === view.renderingId;\n    },\n\n    renderHighestPriority: function\n        PDFRenderingQueue_renderHighestPriority(currentlyVisiblePages) {\n      if (this.idleTimeout) {\n        clearTimeout(this.idleTimeout);\n        this.idleTimeout = null;\n      }\n\n      // Pages have a higher priority than thumbnails, so check them first.\n      if (this.pdfViewer.forceRendering(currentlyVisiblePages)) {\n        return;\n      }\n      // No pages needed rendering so check thumbnails.\n      if (this.pdfThumbnailViewer && this.isThumbnailViewEnabled) {\n        if (this.pdfThumbnailViewer.forceRendering()) {\n          return;\n        }\n      }\n\n      if (this.printing) {\n        // If printing is currently ongoing do not reschedule cleanup.\n        return;\n      }\n\n      if (this.onIdle) {\n        this.idleTimeout = setTimeout(this.onIdle.bind(this), CLEANUP_TIMEOUT);\n      }\n    },\n\n    getHighestPriority: function\n        PDFRenderingQueue_getHighestPriority(visible, views, scrolledDown) {\n      // The state has changed figure out which page has the highest priority to\n      // render next (if any).\n      // Priority:\n      // 1 visible pages\n      // 2 if last scrolled down page after the visible pages\n      // 2 if last scrolled up page before the visible pages\n      var visibleViews = visible.views;\n\n      var numVisible = visibleViews.length;\n      if (numVisible === 0) {\n        return false;\n      }\n      for (var i = 0; i < numVisible; ++i) {\n        var view = visibleViews[i].view;\n        if (!this.isViewFinished(view)) {\n          return view;\n        }\n      }\n\n      // All the visible views have rendered, try to render next/previous pages.\n      if (scrolledDown) {\n        var nextPageIndex = visible.last.id;\n        // ID's start at 1 so no need to add 1.\n        if (views[nextPageIndex] &&\n            !this.isViewFinished(views[nextPageIndex])) {\n          return views[nextPageIndex];\n        }\n      } else {\n        var previousPageIndex = visible.first.id - 2;\n        if (views[previousPageIndex] &&\n          !this.isViewFinished(views[previousPageIndex])) {\n          return views[previousPageIndex];\n        }\n      }\n      // Everything that needs to be rendered has been.\n      return null;\n    },\n\n    /**\n     * @param {IRenderableView} view\n     * @returns {boolean}\n     */\n    isViewFinished: function PDFRenderingQueue_isViewFinished(view) {\n      return view.renderingState === RenderingStates.FINISHED;\n    },\n\n    /**\n     * Render a page or thumbnail view. This calls the appropriate function\n     * based on the views state. If the view is already rendered it will return\n     * false.\n     * @param {IRenderableView} view\n     */\n    renderView: function PDFRenderingQueue_renderView(view) {\n      var state = view.renderingState;\n      switch (state) {\n        case RenderingStates.FINISHED:\n          return false;\n        case RenderingStates.PAUSED:\n          this.highestPriorityPage = view.renderingId;\n          view.resume();\n          break;\n        case RenderingStates.RUNNING:\n          this.highestPriorityPage = view.renderingId;\n          break;\n        case RenderingStates.INITIAL:\n          this.highestPriorityPage = view.renderingId;\n          var continueRendering = function () {\n            this.renderHighestPriority();\n          }.bind(this);\n          view.draw().then(continueRendering, continueRendering);\n          break;\n      }\n      return true;\n    },\n  };\n\n  return PDFRenderingQueue;\n})();\n\n\nvar TEXT_LAYER_RENDER_DELAY = 200; // ms\n\n/**\n * @typedef {Object} PDFPageViewOptions\n * @property {HTMLDivElement} container - The viewer element.\n * @property {number} id - The page unique ID (normally its number).\n * @property {number} scale - The page scale display.\n * @property {PageViewport} defaultViewport - The page viewport.\n * @property {PDFRenderingQueue} renderingQueue - The rendering queue object.\n * @property {IPDFTextLayerFactory} textLayerFactory\n * @property {IPDFAnnotationLayerFactory} annotationLayerFactory\n */\n\n/**\n * @class\n * @implements {IRenderableView}\n */\nvar PDFPageView = (function PDFPageViewClosure() {\n  /**\n   * @constructs PDFPageView\n   * @param {PDFPageViewOptions} options\n   */\n  function PDFPageView(options) {\n    var container = options.container;\n    var id = options.id;\n    var scale = options.scale;\n    var defaultViewport = options.defaultViewport;\n    var renderingQueue = options.renderingQueue;\n    var textLayerFactory = options.textLayerFactory;\n    var annotationLayerFactory = options.annotationLayerFactory;\n\n    this.id = id;\n    this.renderingId = 'page' + id;\n\n    this.rotation = 0;\n    this.scale = scale || DEFAULT_SCALE;\n    this.viewport = defaultViewport;\n    this.pdfPageRotate = defaultViewport.rotation;\n    this.hasRestrictedScaling = false;\n\n    this.renderingQueue = renderingQueue;\n    this.textLayerFactory = textLayerFactory;\n    this.annotationLayerFactory = annotationLayerFactory;\n\n    this.renderingState = RenderingStates.INITIAL;\n    this.resume = null;\n\n    this.onBeforeDraw = null;\n    this.onAfterDraw = null;\n\n    this.textLayer = null;\n\n    this.zoomLayer = null;\n\n    this.annotationLayer = null;\n\n    var div = document.createElement('div');\n    div.id = 'pageContainer' + this.id;\n    div.className = 'page';\n    div.style.width = Math.floor(this.viewport.width) + 'px';\n    div.style.height = Math.floor(this.viewport.height) + 'px';\n    div.setAttribute('data-page-number', this.id);\n    this.div = div;\n\n    container.appendChild(div);\n  }\n\n  PDFPageView.prototype = {\n    setPdfPage: function PDFPageView_setPdfPage(pdfPage) {\n      this.pdfPage = pdfPage;\n      this.pdfPageRotate = pdfPage.rotate;\n      var totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n      this.viewport = pdfPage.getViewport(this.scale * CSS_UNITS,\n                                          totalRotation);\n      this.stats = pdfPage.stats;\n      this.reset();\n    },\n\n    destroy: function PDFPageView_destroy() {\n      this.zoomLayer = null;\n      this.reset();\n      if (this.pdfPage) {\n        this.pdfPage.cleanup();\n      }\n    },\n\n    reset: function PDFPageView_reset(keepZoomLayer, keepAnnotations) {\n      if (this.renderTask) {\n        this.renderTask.cancel();\n      }\n      this.resume = null;\n      this.renderingState = RenderingStates.INITIAL;\n\n      var div = this.div;\n      div.style.width = Math.floor(this.viewport.width) + 'px';\n      div.style.height = Math.floor(this.viewport.height) + 'px';\n\n      var childNodes = div.childNodes;\n      var currentZoomLayerNode = (keepZoomLayer && this.zoomLayer) || null;\n      var currentAnnotationNode = (keepAnnotations && this.annotationLayer &&\n                                   this.annotationLayer.div) || null;\n      for (var i = childNodes.length - 1; i >= 0; i--) {\n        var node = childNodes[i];\n        if (currentZoomLayerNode === node || currentAnnotationNode === node) {\n          continue;\n        }\n        div.removeChild(node);\n      }\n      div.removeAttribute('data-loaded');\n\n      if (currentAnnotationNode) {\n        // Hide annotationLayer until all elements are resized\n        // so they are not displayed on the already-resized page\n        this.annotationLayer.hide();\n      } else {\n        this.annotationLayer = null;\n      }\n\n      if (this.canvas && !currentZoomLayerNode) {\n        // Zeroing the width and height causes Firefox to release graphics\n        // resources immediately, which can greatly reduce memory consumption.\n        this.canvas.width = 0;\n        this.canvas.height = 0;\n        delete this.canvas;\n      }\n\n      this.loadingIconDiv = document.createElement('div');\n      this.loadingIconDiv.className = 'loadingIcon';\n      div.appendChild(this.loadingIconDiv);\n    },\n\n    update: function PDFPageView_update(scale, rotation) {\n      this.scale = scale || this.scale;\n\n      if (typeof rotation !== 'undefined') {\n        this.rotation = rotation;\n      }\n\n      var totalRotation = (this.rotation + this.pdfPageRotate) % 360;\n      this.viewport = this.viewport.clone({\n        scale: this.scale * CSS_UNITS,\n        rotation: totalRotation\n      });\n\n      var isScalingRestricted = false;\n      if (this.canvas && PDFJS.maxCanvasPixels > 0) {\n        var outputScale = this.outputScale;\n        var pixelsInViewport = this.viewport.width * this.viewport.height;\n        var maxScale = Math.sqrt(PDFJS.maxCanvasPixels / pixelsInViewport);\n        if (((Math.floor(this.viewport.width) * outputScale.sx) | 0) *\n            ((Math.floor(this.viewport.height) * outputScale.sy) | 0) >\n            PDFJS.maxCanvasPixels) {\n          isScalingRestricted = true;\n        }\n      }\n\n      if (this.canvas) {\n        if (PDFJS.useOnlyCssZoom ||\n            (this.hasRestrictedScaling && isScalingRestricted)) {\n          this.cssTransform(this.canvas, true);\n\n          var event = document.createEvent('CustomEvent');\n          event.initCustomEvent('pagerendered', true, true, {\n            pageNumber: this.id,\n            cssTransform: true,\n          });\n          this.div.dispatchEvent(event);\n\n          return;\n        }\n        if (!this.zoomLayer) {\n          this.zoomLayer = this.canvas.parentNode;\n          this.zoomLayer.style.position = 'absolute';\n        }\n      }\n      if (this.zoomLayer) {\n        this.cssTransform(this.zoomLayer.firstChild);\n      }\n      this.reset(/* keepZoomLayer = */ true, /* keepAnnotations = */ true);\n    },\n\n    /**\n     * Called when moved in the parent's container.\n     */\n    updatePosition: function PDFPageView_updatePosition() {\n      if (this.textLayer) {\n        this.textLayer.render(TEXT_LAYER_RENDER_DELAY);\n      }\n    },\n\n    cssTransform: function PDFPageView_transform(canvas, redrawAnnotations) {\n      var CustomStyle = PDFJS.CustomStyle;\n\n      // Scale canvas, canvas wrapper, and page container.\n      var width = this.viewport.width;\n      var height = this.viewport.height;\n      var div = this.div;\n      canvas.style.width = canvas.parentNode.style.width = div.style.width =\n        Math.floor(width) + 'px';\n      canvas.style.height = canvas.parentNode.style.height = div.style.height =\n        Math.floor(height) + 'px';\n      // The canvas may have been originally rotated, rotate relative to that.\n      var relativeRotation = this.viewport.rotation - canvas._viewport.rotation;\n      var absRotation = Math.abs(relativeRotation);\n      var scaleX = 1, scaleY = 1;\n      if (absRotation === 90 || absRotation === 270) {\n        // Scale x and y because of the rotation.\n        scaleX = height / width;\n        scaleY = width / height;\n      }\n      var cssTransform = 'rotate(' + relativeRotation + 'deg) ' +\n        'scale(' + scaleX + ',' + scaleY + ')';\n      CustomStyle.setProp('transform', canvas, cssTransform);\n\n      if (this.textLayer) {\n        // Rotating the text layer is more complicated since the divs inside the\n        // the text layer are rotated.\n        // TODO: This could probably be simplified by drawing the text layer in\n        // one orientation then rotating overall.\n        var textLayerViewport = this.textLayer.viewport;\n        var textRelativeRotation = this.viewport.rotation -\n          textLayerViewport.rotation;\n        var textAbsRotation = Math.abs(textRelativeRotation);\n        var scale = width / textLayerViewport.width;\n        if (textAbsRotation === 90 || textAbsRotation === 270) {\n          scale = width / textLayerViewport.height;\n        }\n        var textLayerDiv = this.textLayer.textLayerDiv;\n        var transX, transY;\n        switch (textAbsRotation) {\n          case 0:\n            transX = transY = 0;\n            break;\n          case 90:\n            transX = 0;\n            transY = '-' + textLayerDiv.style.height;\n            break;\n          case 180:\n            transX = '-' + textLayerDiv.style.width;\n            transY = '-' + textLayerDiv.style.height;\n            break;\n          case 270:\n            transX = '-' + textLayerDiv.style.width;\n            transY = 0;\n            break;\n          default:\n            console.error('Bad rotation value.');\n            break;\n        }\n        CustomStyle.setProp('transform', textLayerDiv,\n            'rotate(' + textAbsRotation + 'deg) ' +\n            'scale(' + scale + ', ' + scale + ') ' +\n            'translate(' + transX + ', ' + transY + ')');\n        CustomStyle.setProp('transformOrigin', textLayerDiv, '0% 0%');\n      }\n\n      if (redrawAnnotations && this.annotationLayer) {\n        this.annotationLayer.render(this.viewport, 'display');\n      }\n    },\n\n    get width() {\n      return this.viewport.width;\n    },\n\n    get height() {\n      return this.viewport.height;\n    },\n\n    getPagePoint: function PDFPageView_getPagePoint(x, y) {\n      return this.viewport.convertToPdfPoint(x, y);\n    },\n\n    draw: function PDFPageView_draw() {\n      if (this.renderingState !== RenderingStates.INITIAL) {\n        console.error('Must be in new state before drawing');\n      }\n\n      this.renderingState = RenderingStates.RUNNING;\n\n      var pdfPage = this.pdfPage;\n      var viewport = this.viewport;\n      var div = this.div;\n      // Wrap the canvas so if it has a css transform for highdpi the overflow\n      // will be hidden in FF.\n      var canvasWrapper = document.createElement('div');\n      canvasWrapper.style.width = div.style.width;\n      canvasWrapper.style.height = div.style.height;\n      canvasWrapper.classList.add('canvasWrapper');\n\n      var canvas = document.createElement('canvas');\n      canvas.id = 'page' + this.id;\n      // Keep the canvas hidden until the first draw callback, or until drawing\n      // is complete when `!this.renderingQueue`, to prevent black flickering.\n      canvas.setAttribute('hidden', 'hidden');\n      var isCanvasHidden = true;\n\n      canvasWrapper.appendChild(canvas);\n      if (this.annotationLayer && this.annotationLayer.div) {\n        // annotationLayer needs to stay on top\n        div.insertBefore(canvasWrapper, this.annotationLayer.div);\n      } else {\n        div.appendChild(canvasWrapper);\n      }\n      this.canvas = canvas;\n\n      var ctx = canvas.getContext('2d', {alpha: false});\n      var outputScale = getOutputScale(ctx);\n      this.outputScale = outputScale;\n\n      if (PDFJS.useOnlyCssZoom) {\n        var actualSizeViewport = viewport.clone({scale: CSS_UNITS});\n        // Use a scale that will make the canvas be the original intended size\n        // of the page.\n        outputScale.sx *= actualSizeViewport.width / viewport.width;\n        outputScale.sy *= actualSizeViewport.height / viewport.height;\n        outputScale.scaled = true;\n      }\n\n      if (PDFJS.maxCanvasPixels > 0) {\n        var pixelsInViewport = viewport.width * viewport.height;\n        var maxScale = Math.sqrt(PDFJS.maxCanvasPixels / pixelsInViewport);\n        if (outputScale.sx > maxScale || outputScale.sy > maxScale) {\n          outputScale.sx = maxScale;\n          outputScale.sy = maxScale;\n          outputScale.scaled = true;\n          this.hasRestrictedScaling = true;\n        } else {\n          this.hasRestrictedScaling = false;\n        }\n      }\n\n      var sfx = approximateFraction(outputScale.sx);\n      var sfy = approximateFraction(outputScale.sy);\n      canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\n      canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\n      canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\n      canvas.style.height = roundToDivide(viewport.height, sfy[1]) + 'px';\n      // Add the viewport so it's known what it was originally drawn with.\n      canvas._viewport = viewport;\n\n      var textLayerDiv = null;\n      var textLayer = null;\n      if (this.textLayerFactory) {\n        textLayerDiv = document.createElement('div');\n        textLayerDiv.className = 'textLayer';\n        textLayerDiv.style.width = canvasWrapper.style.width;\n        textLayerDiv.style.height = canvasWrapper.style.height;\n        if (this.annotationLayer && this.annotationLayer.div) {\n          // annotationLayer needs to stay on top\n          div.insertBefore(textLayerDiv, this.annotationLayer.div);\n        } else {\n          div.appendChild(textLayerDiv);\n        }\n\n        textLayer = this.textLayerFactory.createTextLayerBuilder(textLayerDiv,\n                                                                 this.id - 1,\n                                                                 this.viewport);\n      }\n      this.textLayer = textLayer;\n\n      var resolveRenderPromise, rejectRenderPromise;\n      var promise = new Promise(function (resolve, reject) {\n        resolveRenderPromise = resolve;\n        rejectRenderPromise = reject;\n      });\n\n      // Rendering area\n\n      var self = this;\n      function pageViewDrawCallback(error) {\n        // The renderTask may have been replaced by a new one, so only remove\n        // the reference to the renderTask if it matches the one that is\n        // triggering this callback.\n        if (renderTask === self.renderTask) {\n          self.renderTask = null;\n        }\n\n        if (error === 'cancelled') {\n          rejectRenderPromise(error);\n          return;\n        }\n\n        self.renderingState = RenderingStates.FINISHED;\n\n        if (isCanvasHidden) {\n          self.canvas.removeAttribute('hidden');\n          isCanvasHidden = false;\n        }\n\n        if (self.loadingIconDiv) {\n          div.removeChild(self.loadingIconDiv);\n          delete self.loadingIconDiv;\n        }\n\n        if (self.zoomLayer) {\n          // Zeroing the width and height causes Firefox to release graphics\n          // resources immediately, which can greatly reduce memory consumption.\n          var zoomLayerCanvas = self.zoomLayer.firstChild;\n          zoomLayerCanvas.width = 0;\n          zoomLayerCanvas.height = 0;\n\n          div.removeChild(self.zoomLayer);\n          self.zoomLayer = null;\n        }\n\n        self.error = error;\n        self.stats = pdfPage.stats;\n        if (self.onAfterDraw) {\n          self.onAfterDraw();\n        }\n        var event = document.createEvent('CustomEvent');\n        event.initCustomEvent('pagerendered', true, true, {\n          pageNumber: self.id,\n          cssTransform: false,\n        });\n        div.dispatchEvent(event);\n\n        if (!error) {\n          resolveRenderPromise(undefined);\n        } else {\n          rejectRenderPromise(error);\n        }\n      }\n\n      var renderContinueCallback = null;\n      if (this.renderingQueue) {\n        renderContinueCallback = function renderContinueCallback(cont) {\n          if (!self.renderingQueue.isHighestPriority(self)) {\n            self.renderingState = RenderingStates.PAUSED;\n            self.resume = function resumeCallback() {\n              self.renderingState = RenderingStates.RUNNING;\n              cont();\n            };\n            return;\n          }\n          if (isCanvasHidden) {\n            self.canvas.removeAttribute('hidden');\n            isCanvasHidden = false;\n          }\n          cont();\n        };\n      }\n\n      var transform = !outputScale.scaled ? null :\n        [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\n      var renderContext = {\n        canvasContext: ctx,\n        transform: transform,\n        viewport: this.viewport,\n        // intent: 'default', // === 'display'\n      };\n      var renderTask = this.renderTask = this.pdfPage.render(renderContext);\n      renderTask.onContinue = renderContinueCallback;\n\n      this.renderTask.promise.then(\n        function pdfPageRenderCallback() {\n          pageViewDrawCallback(null);\n          if (textLayer) {\n            self.pdfPage.getTextContent({ normalizeWhitespace: true }).then(\n              function textContentResolved(textContent) {\n                textLayer.setTextContent(textContent);\n                textLayer.render(TEXT_LAYER_RENDER_DELAY);\n              }\n            );\n          }\n        },\n        function pdfPageRenderError(error) {\n          pageViewDrawCallback(error);\n        }\n      );\n\n      if (this.annotationLayerFactory) {\n        if (!this.annotationLayer) {\n          this.annotationLayer = this.annotationLayerFactory.\n            createAnnotationLayerBuilder(div, this.pdfPage);\n        }\n        this.annotationLayer.render(this.viewport, 'display');\n      }\n      div.setAttribute('data-loaded', true);\n\n      if (self.onBeforeDraw) {\n        self.onBeforeDraw();\n      }\n      return promise;\n    },\n\n    beforePrint: function PDFPageView_beforePrint() {\n      var CustomStyle = PDFJS.CustomStyle;\n      var pdfPage = this.pdfPage;\n\n      var viewport = pdfPage.getViewport(1);\n      // Use the same hack we use for high dpi displays for printing to get\n      // better output until bug 811002 is fixed in FF.\n      var PRINT_OUTPUT_SCALE = 2;\n      var canvas = document.createElement('canvas');\n\n      // The logical size of the canvas.\n      canvas.width = Math.floor(viewport.width) * PRINT_OUTPUT_SCALE;\n      canvas.height = Math.floor(viewport.height) * PRINT_OUTPUT_SCALE;\n\n      // The rendered size of the canvas, relative to the size of canvasWrapper.\n      canvas.style.width = (PRINT_OUTPUT_SCALE * 100) + '%';\n      canvas.style.height = (PRINT_OUTPUT_SCALE * 100) + '%';\n\n      var cssScale = 'scale(' + (1 / PRINT_OUTPUT_SCALE) + ', ' +\n                                (1 / PRINT_OUTPUT_SCALE) + ')';\n      CustomStyle.setProp('transform' , canvas, cssScale);\n      CustomStyle.setProp('transformOrigin' , canvas, '0% 0%');\n\n      var printContainer = document.getElementById('printContainer');\n      var canvasWrapper = document.createElement('div');\n      canvasWrapper.style.width = viewport.width + 'pt';\n      canvasWrapper.style.height = viewport.height + 'pt';\n      canvasWrapper.appendChild(canvas);\n      printContainer.appendChild(canvasWrapper);\n\n      canvas.mozPrintCallback = function(obj) {\n        var ctx = obj.context;\n\n        ctx.save();\n        ctx.fillStyle = 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n        ctx.restore();\n        // Used by the mozCurrentTransform polyfill in src/display/canvas.js.\n        ctx._transformMatrix =\n          [PRINT_OUTPUT_SCALE, 0, 0, PRINT_OUTPUT_SCALE, 0, 0];\n        ctx.scale(PRINT_OUTPUT_SCALE, PRINT_OUTPUT_SCALE);\n\n        var renderContext = {\n          canvasContext: ctx,\n          viewport: viewport,\n          intent: 'print'\n        };\n\n        pdfPage.render(renderContext).promise.then(function() {\n          // Tell the printEngine that rendering this canvas/page has finished.\n          obj.done();\n        }, function(error) {\n          console.error(error);\n          // Tell the printEngine that rendering this canvas/page has failed.\n          // This will make the print proces stop.\n          if ('abort' in obj) {\n            obj.abort();\n          } else {\n            obj.done();\n          }\n        });\n      };\n    },\n  };\n\n  return PDFPageView;\n})();\n\n\n/**\n * @typedef {Object} TextLayerBuilderOptions\n * @property {HTMLDivElement} textLayerDiv - The text layer container.\n * @property {number} pageIndex - The page index.\n * @property {PageViewport} viewport - The viewport of the text layer.\n * @property {PDFFindController} findController\n */\n\n/**\n * TextLayerBuilder provides text-selection functionality for the PDF.\n * It does this by creating overlay divs over the PDF text. These divs\n * contain text that matches the PDF text they are overlaying. This object\n * also provides a way to highlight text that is being searched for.\n * @class\n */\nvar TextLayerBuilder = (function TextLayerBuilderClosure() {\n  function TextLayerBuilder(options) {\n    this.textLayerDiv = options.textLayerDiv;\n    this.renderingDone = false;\n    this.divContentDone = false;\n    this.pageIdx = options.pageIndex;\n    this.pageNumber = this.pageIdx + 1;\n    this.matches = [];\n    this.viewport = options.viewport;\n    this.textDivs = [];\n    this.findController = options.findController || null;\n    this.textLayerRenderTask = null;\n    this._bindMouse();\n  }\n\n  TextLayerBuilder.prototype = {\n    _finishRendering: function TextLayerBuilder_finishRendering() {\n      this.renderingDone = true;\n\n      var endOfContent = document.createElement('div');\n      endOfContent.className = 'endOfContent';\n      this.textLayerDiv.appendChild(endOfContent);\n\n      var event = document.createEvent('CustomEvent');\n      event.initCustomEvent('textlayerrendered', true, true, {\n        pageNumber: this.pageNumber\n      });\n      this.textLayerDiv.dispatchEvent(event);\n    },\n\n    /**\n     * Renders the text layer.\n     * @param {number} timeout (optional) if specified, the rendering waits\n     *   for specified amount of ms.\n     */\n    render: function TextLayerBuilder_render(timeout) {\n      if (!this.divContentDone || this.renderingDone) {\n        return;\n      }\n\n      if (this.textLayerRenderTask) {\n        this.textLayerRenderTask.cancel();\n        this.textLayerRenderTask = null;\n      }\n\n      this.textDivs = [];\n      var textLayerFrag = document.createDocumentFragment();\n      this.textLayerRenderTask = PDFJS.renderTextLayer({\n        textContent: this.textContent,\n        container: textLayerFrag,\n        viewport: this.viewport,\n        textDivs: this.textDivs,\n        timeout: timeout\n      });\n      this.textLayerRenderTask.promise.then(function () {\n        this.textLayerDiv.appendChild(textLayerFrag);\n        this._finishRendering();\n        this.updateMatches();\n      }.bind(this), function (reason) {\n        // canceled or failed to render text layer -- skipping errors\n      });\n    },\n\n    setTextContent: function TextLayerBuilder_setTextContent(textContent) {\n      if (this.textLayerRenderTask) {\n        this.textLayerRenderTask.cancel();\n        this.textLayerRenderTask = null;\n      }\n      this.textContent = textContent;\n      this.divContentDone = true;\n    },\n\n    convertMatches: function TextLayerBuilder_convertMatches(matches) {\n      var i = 0;\n      var iIndex = 0;\n      var bidiTexts = this.textContent.items;\n      var end = bidiTexts.length - 1;\n      var queryLen = (this.findController === null ?\n                      0 : this.findController.state.query.length);\n      var ret = [];\n\n      for (var m = 0, len = matches.length; m < len; m++) {\n        // Calculate the start position.\n        var matchIdx = matches[m];\n\n        // Loop over the divIdxs.\n        while (i !== end && matchIdx >= (iIndex + bidiTexts[i].str.length)) {\n          iIndex += bidiTexts[i].str.length;\n          i++;\n        }\n\n        if (i === bidiTexts.length) {\n          console.error('Could not find a matching mapping');\n        }\n\n        var match = {\n          begin: {\n            divIdx: i,\n            offset: matchIdx - iIndex\n          }\n        };\n\n        // Calculate the end position.\n        matchIdx += queryLen;\n\n        // Somewhat the same array as above, but use > instead of >= to get\n        // the end position right.\n        while (i !== end && matchIdx > (iIndex + bidiTexts[i].str.length)) {\n          iIndex += bidiTexts[i].str.length;\n          i++;\n        }\n\n        match.end = {\n          divIdx: i,\n          offset: matchIdx - iIndex\n        };\n        ret.push(match);\n      }\n\n      return ret;\n    },\n\n    renderMatches: function TextLayerBuilder_renderMatches(matches) {\n      // Early exit if there is nothing to render.\n      if (matches.length === 0) {\n        return;\n      }\n\n      var bidiTexts = this.textContent.items;\n      var textDivs = this.textDivs;\n      var prevEnd = null;\n      var pageIdx = this.pageIdx;\n      var isSelectedPage = (this.findController === null ?\n        false : (pageIdx === this.findController.selected.pageIdx));\n      var selectedMatchIdx = (this.findController === null ?\n                              -1 : this.findController.selected.matchIdx);\n      var highlightAll = (this.findController === null ?\n                          false : this.findController.state.highlightAll);\n      var infinity = {\n        divIdx: -1,\n        offset: undefined\n      };\n\n      function beginText(begin, className) {\n        var divIdx = begin.divIdx;\n        textDivs[divIdx].textContent = '';\n        appendTextToDiv(divIdx, 0, begin.offset, className);\n      }\n\n      function appendTextToDiv(divIdx, fromOffset, toOffset, className) {\n        var div = textDivs[divIdx];\n        var content = bidiTexts[divIdx].str.substring(fromOffset, toOffset);\n        var node = document.createTextNode(content);\n        if (className) {\n          var span = document.createElement('span');\n          span.className = className;\n          span.appendChild(node);\n          div.appendChild(span);\n          return;\n        }\n        div.appendChild(node);\n      }\n\n      var i0 = selectedMatchIdx, i1 = i0 + 1;\n      if (highlightAll) {\n        i0 = 0;\n        i1 = matches.length;\n      } else if (!isSelectedPage) {\n        // Not highlighting all and this isn't the selected page, so do nothing.\n        return;\n      }\n\n      for (var i = i0; i < i1; i++) {\n        var match = matches[i];\n        var begin = match.begin;\n        var end = match.end;\n        var isSelected = (isSelectedPage && i === selectedMatchIdx);\n        var highlightSuffix = (isSelected ? ' selected' : '');\n\n        if (this.findController) {\n          this.findController.updateMatchPosition(pageIdx, i, textDivs,\n                                                  begin.divIdx, end.divIdx);\n        }\n\n        // Match inside new div.\n        if (!prevEnd || begin.divIdx !== prevEnd.divIdx) {\n          // If there was a previous div, then add the text at the end.\n          if (prevEnd !== null) {\n            appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n          }\n          // Clear the divs and set the content until the starting point.\n          beginText(begin);\n        } else {\n          appendTextToDiv(prevEnd.divIdx, prevEnd.offset, begin.offset);\n        }\n\n        if (begin.divIdx === end.divIdx) {\n          appendTextToDiv(begin.divIdx, begin.offset, end.offset,\n                          'highlight' + highlightSuffix);\n        } else {\n          appendTextToDiv(begin.divIdx, begin.offset, infinity.offset,\n                          'highlight begin' + highlightSuffix);\n          for (var n0 = begin.divIdx + 1, n1 = end.divIdx; n0 < n1; n0++) {\n            textDivs[n0].className = 'highlight middle' + highlightSuffix;\n          }\n          beginText(end, 'highlight end' + highlightSuffix);\n        }\n        prevEnd = end;\n      }\n\n      if (prevEnd) {\n        appendTextToDiv(prevEnd.divIdx, prevEnd.offset, infinity.offset);\n      }\n    },\n\n    updateMatches: function TextLayerBuilder_updateMatches() {\n      // Only show matches when all rendering is done.\n      if (!this.renderingDone) {\n        return;\n      }\n\n      // Clear all matches.\n      var matches = this.matches;\n      var textDivs = this.textDivs;\n      var bidiTexts = this.textContent.items;\n      var clearedUntilDivIdx = -1;\n\n      // Clear all current matches.\n      for (var i = 0, len = matches.length; i < len; i++) {\n        var match = matches[i];\n        var begin = Math.max(clearedUntilDivIdx, match.begin.divIdx);\n        for (var n = begin, end = match.end.divIdx; n <= end; n++) {\n          var div = textDivs[n];\n          div.textContent = bidiTexts[n].str;\n          div.className = '';\n        }\n        clearedUntilDivIdx = match.end.divIdx + 1;\n      }\n\n      if (this.findController === null || !this.findController.active) {\n        return;\n      }\n\n      // Convert the matches on the page controller into the match format\n      // used for the textLayer.\n      this.matches = this.convertMatches(this.findController === null ?\n        [] : (this.findController.pageMatches[this.pageIdx] || []));\n      this.renderMatches(this.matches);\n    },\n\n    /**\n     * Fixes text selection: adds additional div where mouse was clicked.\n     * This reduces flickering of the content if mouse slowly dragged down/up.\n     * @private\n     */\n    _bindMouse: function TextLayerBuilder_bindMouse() {\n      var div = this.textLayerDiv;\n      div.addEventListener('mousedown', function (e) {\n        var end = div.querySelector('.endOfContent');\n        if (!end) {\n          return;\n        }\n        // On non-Firefox browsers, the selection will feel better if the height\n        // of the endOfContent div will be adjusted to start at mouse click\n        // location -- this will avoid flickering when selections moves up.\n        // However it does not work when selection started on empty space.\n        var adjustTop = e.target !== div;\n        if (adjustTop) {\n          var divBounds = div.getBoundingClientRect();\n          var r = Math.max(0, (e.pageY - divBounds.top) / divBounds.height);\n          end.style.top = (r * 100).toFixed(2) + '%';\n        }\n        end.classList.add('active');\n      });\n      div.addEventListener('mouseup', function (e) {\n        var end = div.querySelector('.endOfContent');\n        if (!end) {\n          return;\n        }\n        end.style.top = '';\n        end.classList.remove('active');\n      });\n    },\n  };\n  return TextLayerBuilder;\n})();\n\n/**\n * @constructor\n * @implements IPDFTextLayerFactory\n */\nfunction DefaultTextLayerFactory() {}\nDefaultTextLayerFactory.prototype = {\n  /**\n   * @param {HTMLDivElement} textLayerDiv\n   * @param {number} pageIndex\n   * @param {PageViewport} viewport\n   * @returns {TextLayerBuilder}\n   */\n  createTextLayerBuilder: function (textLayerDiv, pageIndex, viewport) {\n    return new TextLayerBuilder({\n      textLayerDiv: textLayerDiv,\n      pageIndex: pageIndex,\n      viewport: viewport\n    });\n  }\n};\n\n\n/**\n * @typedef {Object} AnnotationLayerBuilderOptions\n * @property {HTMLDivElement} pageDiv\n * @property {PDFPage} pdfPage\n * @property {IPDFLinkService} linkService\n */\n\n/**\n * @class\n */\nvar AnnotationLayerBuilder = (function AnnotationLayerBuilderClosure() {\n  /**\n   * @param {AnnotationLayerBuilderOptions} options\n   * @constructs AnnotationLayerBuilder\n   */\n  function AnnotationLayerBuilder(options) {\n    this.pageDiv = options.pageDiv;\n    this.pdfPage = options.pdfPage;\n    this.linkService = options.linkService;\n\n    this.div = null;\n  }\n\n  AnnotationLayerBuilder.prototype =\n      /** @lends AnnotationLayerBuilder.prototype */ {\n\n    /**\n     * @param {PageViewport} viewport\n     * @param {string} intent (default value is 'display')\n     */\n    render: function AnnotationLayerBuilder_render(viewport, intent) {\n      var self = this;\n      var parameters = {\n        intent: (intent === undefined ? 'display' : intent),\n      };\n\n      this.pdfPage.getAnnotations(parameters).then(function (annotations) {\n        viewport = viewport.clone({ dontFlip: true });\n        parameters = {\n          viewport: viewport,\n          div: self.div,\n          annotations: annotations,\n          page: self.pdfPage,\n          linkService: self.linkService\n        };\n\n        if (self.div) {\n          // If an annotationLayer already exists, refresh its children's\n          // transformation matrices.\n          PDFJS.AnnotationLayer.update(parameters);\n        } else {\n          // Create an annotation layer div and render the annotations\n          // if there is at least one annotation.\n          if (annotations.length === 0) {\n            return;\n          }\n\n          self.div = document.createElement('div');\n          self.div.className = 'annotationLayer';\n          self.pageDiv.appendChild(self.div);\n          parameters.div = self.div;\n\n          PDFJS.AnnotationLayer.render(parameters);\n          if (typeof mozL10n !== 'undefined') {\n            mozL10n.translate(self.div);\n          }\n        }\n      });\n    },\n\n    hide: function AnnotationLayerBuilder_hide() {\n      if (!this.div) {\n        return;\n      }\n      this.div.setAttribute('hidden', 'true');\n    }\n  };\n\n  return AnnotationLayerBuilder;\n})();\n\n/**\n * @constructor\n * @implements IPDFAnnotationLayerFactory\n */\nfunction DefaultAnnotationLayerFactory() {}\nDefaultAnnotationLayerFactory.prototype = {\n  /**\n   * @param {HTMLDivElement} pageDiv\n   * @param {PDFPage} pdfPage\n   * @returns {AnnotationLayerBuilder}\n   */\n  createAnnotationLayerBuilder: function (pageDiv, pdfPage) {\n    return new AnnotationLayerBuilder({\n      pageDiv: pageDiv,\n      pdfPage: pdfPage,\n      linkService: new SimpleLinkService(),\n    });\n  }\n};\n\n\n/**\n * @typedef {Object} PDFViewerOptions\n * @property {HTMLDivElement} container - The container for the viewer element.\n * @property {HTMLDivElement} viewer - (optional) The viewer element.\n * @property {IPDFLinkService} linkService - The navigation/linking service.\n * @property {PDFRenderingQueue} renderingQueue - (optional) The rendering\n *   queue object.\n * @property {boolean} removePageBorders - (optional) Removes the border shadow\n *   around the pages. The default is false.\n */\n\n/**\n * Simple viewer control to display PDF content/pages.\n * @class\n * @implements {IRenderableView}\n */\nvar PDFViewer = (function pdfViewer() {\n  function PDFPageViewBuffer(size) {\n    var data = [];\n    this.push = function cachePush(view) {\n      var i = data.indexOf(view);\n      if (i >= 0) {\n        data.splice(i, 1);\n      }\n      data.push(view);\n      if (data.length > size) {\n        data.shift().destroy();\n      }\n    };\n    this.resize = function (newSize) {\n      size = newSize;\n      while (data.length > size) {\n        data.shift().destroy();\n      }\n    };\n  }\n\n  function isSameScale(oldScale, newScale) {\n    if (newScale === oldScale) {\n      return true;\n    }\n    if (Math.abs(newScale - oldScale) < 1e-15) {\n      // Prevent unnecessary re-rendering of all pages when the scale\n      // changes only because of limited numerical precision.\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * @constructs PDFViewer\n   * @param {PDFViewerOptions} options\n   */\n  function PDFViewer(options) {\n    this.container = options.container;\n    this.viewer = options.viewer || options.container.firstElementChild;\n    this.linkService = options.linkService || new SimpleLinkService();\n    this.removePageBorders = options.removePageBorders || false;\n\n    this.defaultRenderingQueue = !options.renderingQueue;\n    if (this.defaultRenderingQueue) {\n      // Custom rendering queue is not specified, using default one\n      this.renderingQueue = new PDFRenderingQueue();\n      this.renderingQueue.setViewer(this);\n    } else {\n      this.renderingQueue = options.renderingQueue;\n    }\n\n    this.scroll = watchScroll(this.container, this._scrollUpdate.bind(this));\n    this.updateInProgress = false;\n    this.presentationModeState = PresentationModeState.UNKNOWN;\n    this._resetView();\n\n    if (this.removePageBorders) {\n      this.viewer.classList.add('removePageBorders');\n    }\n  }\n\n  PDFViewer.prototype = /** @lends PDFViewer.prototype */{\n    get pagesCount() {\n      return this._pages.length;\n    },\n\n    getPageView: function (index) {\n      return this._pages[index];\n    },\n\n    get currentPageNumber() {\n      return this._currentPageNumber;\n    },\n\n    set currentPageNumber(val) {\n      if (!this.pdfDocument) {\n        this._currentPageNumber = val;\n        return;\n      }\n\n      var event = document.createEvent('UIEvents');\n      event.initUIEvent('pagechange', true, true, window, 0);\n      event.updateInProgress = this.updateInProgress;\n\n      if (!(0 < val && val <= this.pagesCount)) {\n        event.pageNumber = this._currentPageNumber;\n        event.previousPageNumber = val;\n        this.container.dispatchEvent(event);\n        return;\n      }\n\n      event.previousPageNumber = this._currentPageNumber;\n      this._currentPageNumber = val;\n      event.pageNumber = val;\n      this.container.dispatchEvent(event);\n\n      // Check if the caller is `PDFViewer_update`, to avoid breaking scrolling.\n      if (this.updateInProgress) {\n        return;\n      }\n      this.scrollPageIntoView(val);\n    },\n\n    /**\n     * @returns {number}\n     */\n    get currentScale() {\n      return this._currentScale !== UNKNOWN_SCALE ? this._currentScale :\n                                                    DEFAULT_SCALE;\n    },\n\n    /**\n     * @param {number} val - Scale of the pages in percents.\n     */\n    set currentScale(val) {\n      if (isNaN(val))  {\n        throw new Error('Invalid numeric scale');\n      }\n      if (!this.pdfDocument) {\n        this._currentScale = val;\n        this._currentScaleValue = val !== UNKNOWN_SCALE ? val.toString() : null;\n        return;\n      }\n      this._setScale(val, false);\n    },\n\n    /**\n     * @returns {string}\n     */\n    get currentScaleValue() {\n      return this._currentScaleValue;\n    },\n\n    /**\n     * @param val - The scale of the pages (in percent or predefined value).\n     */\n    set currentScaleValue(val) {\n      if (!this.pdfDocument) {\n        this._currentScale = isNaN(val) ? UNKNOWN_SCALE : val;\n        this._currentScaleValue = val;\n        return;\n      }\n      this._setScale(val, false);\n    },\n\n    /**\n     * @returns {number}\n     */\n    get pagesRotation() {\n      return this._pagesRotation;\n    },\n\n    /**\n     * @param {number} rotation - The rotation of the pages (0, 90, 180, 270).\n     */\n    set pagesRotation(rotation) {\n      this._pagesRotation = rotation;\n\n      for (var i = 0, l = this._pages.length; i < l; i++) {\n        var pageView = this._pages[i];\n        pageView.update(pageView.scale, rotation);\n      }\n\n      this._setScale(this._currentScaleValue, true);\n\n      if (this.defaultRenderingQueue) {\n        this.update();\n      }\n    },\n\n    /**\n     * @param pdfDocument {PDFDocument}\n     */\n    setDocument: function (pdfDocument) {\n      if (this.pdfDocument) {\n        this._resetView();\n      }\n\n      this.pdfDocument = pdfDocument;\n      if (!pdfDocument) {\n        return;\n      }\n\n      var pagesCount = pdfDocument.numPages;\n      var self = this;\n\n      var resolvePagesPromise;\n      var pagesPromise = new Promise(function (resolve) {\n        resolvePagesPromise = resolve;\n      });\n      this.pagesPromise = pagesPromise;\n      pagesPromise.then(function () {\n        var event = document.createEvent('CustomEvent');\n        event.initCustomEvent('pagesloaded', true, true, {\n          pagesCount: pagesCount\n        });\n        self.container.dispatchEvent(event);\n      });\n\n      var isOnePageRenderedResolved = false;\n      var resolveOnePageRendered = null;\n      var onePageRendered = new Promise(function (resolve) {\n        resolveOnePageRendered = resolve;\n      });\n      this.onePageRendered = onePageRendered;\n\n      var bindOnAfterAndBeforeDraw = function (pageView) {\n        pageView.onBeforeDraw = function pdfViewLoadOnBeforeDraw() {\n          // Add the page to the buffer at the start of drawing. That way it can\n          // be evicted from the buffer and destroyed even if we pause its\n          // rendering.\n          self._buffer.push(this);\n        };\n        // when page is painted, using the image as thumbnail base\n        pageView.onAfterDraw = function pdfViewLoadOnAfterDraw() {\n          if (!isOnePageRenderedResolved) {\n            isOnePageRenderedResolved = true;\n            resolveOnePageRendered();\n          }\n        };\n      };\n\n      var firstPagePromise = pdfDocument.getPage(1);\n      this.firstPagePromise = firstPagePromise;\n\n      // Fetch a single page so we can get a viewport that will be the default\n      // viewport for all pages\n      return firstPagePromise.then(function(pdfPage) {\n        var scale = this.currentScale;\n        var viewport = pdfPage.getViewport(scale * CSS_UNITS);\n        for (var pageNum = 1; pageNum <= pagesCount; ++pageNum) {\n          var textLayerFactory = null;\n          if (!PDFJS.disableTextLayer) {\n            textLayerFactory = this;\n          }\n          var pageView = new PDFPageView({\n            container: this.viewer,\n            id: pageNum,\n            scale: scale,\n            defaultViewport: viewport.clone(),\n            renderingQueue: this.renderingQueue,\n            textLayerFactory: textLayerFactory,\n            annotationLayerFactory: this\n          });\n          bindOnAfterAndBeforeDraw(pageView);\n          this._pages.push(pageView);\n        }\n\n        var linkService = this.linkService;\n\n        // Fetch all the pages since the viewport is needed before printing\n        // starts to create the correct size canvas. Wait until one page is\n        // rendered so we don't tie up too many resources early on.\n        onePageRendered.then(function () {\n          if (!PDFJS.disableAutoFetch) {\n            var getPagesLeft = pagesCount;\n            for (var pageNum = 1; pageNum <= pagesCount; ++pageNum) {\n              pdfDocument.getPage(pageNum).then(function (pageNum, pdfPage) {\n                var pageView = self._pages[pageNum - 1];\n                if (!pageView.pdfPage) {\n                  pageView.setPdfPage(pdfPage);\n                }\n                linkService.cachePageRef(pageNum, pdfPage.ref);\n                getPagesLeft--;\n                if (!getPagesLeft) {\n                  resolvePagesPromise();\n                }\n              }.bind(null, pageNum));\n            }\n          } else {\n            // XXX: Printing is semi-broken with auto fetch disabled.\n            resolvePagesPromise();\n          }\n        });\n\n        var event = document.createEvent('CustomEvent');\n        event.initCustomEvent('pagesinit', true, true, null);\n        self.container.dispatchEvent(event);\n\n        if (this.defaultRenderingQueue) {\n          this.update();\n        }\n\n        if (this.findController) {\n          this.findController.resolveFirstPage();\n        }\n      }.bind(this));\n    },\n\n    _resetView: function () {\n      this._pages = [];\n      this._currentPageNumber = 1;\n      this._currentScale = UNKNOWN_SCALE;\n      this._currentScaleValue = null;\n      this._buffer = new PDFPageViewBuffer(DEFAULT_CACHE_SIZE);\n      this._location = null;\n      this._pagesRotation = 0;\n      this._pagesRequests = [];\n\n      var container = this.viewer;\n      while (container.hasChildNodes()) {\n        container.removeChild(container.lastChild);\n      }\n    },\n\n    _scrollUpdate: function PDFViewer_scrollUpdate() {\n      if (this.pagesCount === 0) {\n        return;\n      }\n      this.update();\n      for (var i = 0, ii = this._pages.length; i < ii; i++) {\n        this._pages[i].updatePosition();\n      }\n    },\n\n    _setScaleDispatchEvent: function pdfViewer_setScaleDispatchEvent(\n        newScale, newValue, preset) {\n      var event = document.createEvent('UIEvents');\n      event.initUIEvent('scalechange', true, true, window, 0);\n      event.scale = newScale;\n      if (preset) {\n        event.presetValue = newValue;\n      }\n      this.container.dispatchEvent(event);\n    },\n\n    _setScaleUpdatePages: function pdfViewer_setScaleUpdatePages(\n        newScale, newValue, noScroll, preset) {\n      this._currentScaleValue = newValue;\n\n      if (isSameScale(this._currentScale, newScale)) {\n        if (preset) {\n          this._setScaleDispatchEvent(newScale, newValue, true);\n        }\n        return;\n      }\n\n      for (var i = 0, ii = this._pages.length; i < ii; i++) {\n        this._pages[i].update(newScale);\n      }\n      this._currentScale = newScale;\n\n      if (!noScroll) {\n        var page = this._currentPageNumber, dest;\n        if (this._location && !IGNORE_CURRENT_POSITION_ON_ZOOM &&\n            !(this.isInPresentationMode || this.isChangingPresentationMode)) {\n          page = this._location.pageNumber;\n          dest = [null, { name: 'XYZ' }, this._location.left,\n                  this._location.top, null];\n        }\n        this.scrollPageIntoView(page, dest);\n      }\n\n      this._setScaleDispatchEvent(newScale, newValue, preset);\n\n      if (this.defaultRenderingQueue) {\n        this.update();\n      }\n    },\n\n    _setScale: function pdfViewer_setScale(value, noScroll) {\n      var scale = parseFloat(value);\n\n      if (scale > 0) {\n        this._setScaleUpdatePages(scale, value, noScroll, false);\n      } else {\n        var currentPage = this._pages[this._currentPageNumber - 1];\n        if (!currentPage) {\n          return;\n        }\n        var hPadding = (this.isInPresentationMode || this.removePageBorders) ?\n          0 : SCROLLBAR_PADDING;\n        var vPadding = (this.isInPresentationMode || this.removePageBorders) ?\n          0 : VERTICAL_PADDING;\n        var pageWidthScale = (this.container.clientWidth - hPadding) /\n                             currentPage.width * currentPage.scale;\n        var pageHeightScale = (this.container.clientHeight - vPadding) /\n                              currentPage.height * currentPage.scale;\n        switch (value) {\n          case 'page-actual':\n            scale = 1;\n            break;\n          case 'page-width':\n            scale = pageWidthScale;\n            break;\n          case 'page-height':\n            scale = pageHeightScale;\n            break;\n          case 'page-fit':\n            scale = Math.min(pageWidthScale, pageHeightScale);\n            break;\n          case 'auto':\n            var isLandscape = (currentPage.width > currentPage.height);\n            // For pages in landscape mode, fit the page height to the viewer\n            // *unless* the page would thus become too wide to fit horizontally.\n            var horizontalScale = isLandscape ?\n              Math.min(pageHeightScale, pageWidthScale) : pageWidthScale;\n            scale = Math.min(MAX_AUTO_SCALE, horizontalScale);\n            break;\n          default:\n            console.error('pdfViewSetScale: \\'' + value +\n              '\\' is an unknown zoom value.');\n            return;\n        }\n        this._setScaleUpdatePages(scale, value, noScroll, true);\n      }\n    },\n\n    /**\n     * Scrolls page into view.\n     * @param {number} pageNumber\n     * @param {Array} dest - (optional) original PDF destination array:\n     *   <page-ref> </XYZ|FitXXX> <args..>\n     */\n    scrollPageIntoView: function PDFViewer_scrollPageIntoView(pageNumber,\n                                                              dest) {\n      if (!this.pdfDocument) {\n        return;\n      }\n\n      var pageView = this._pages[pageNumber - 1];\n\n      if (this.isInPresentationMode) {\n        if (this._currentPageNumber !== pageView.id) {\n          // Avoid breaking getVisiblePages in presentation mode.\n          this.currentPageNumber = pageView.id;\n          return;\n        }\n        dest = null;\n        // Fixes the case when PDF has different page sizes.\n        this._setScale(this._currentScaleValue, true);\n      }\n      if (!dest) {\n        scrollIntoView(pageView.div);\n        return;\n      }\n\n      var x = 0, y = 0;\n      var width = 0, height = 0, widthScale, heightScale;\n      var changeOrientation = (pageView.rotation % 180 === 0 ? false : true);\n      var pageWidth = (changeOrientation ? pageView.height : pageView.width) /\n        pageView.scale / CSS_UNITS;\n      var pageHeight = (changeOrientation ? pageView.width : pageView.height) /\n        pageView.scale / CSS_UNITS;\n      var scale = 0;\n      switch (dest[1].name) {\n        case 'XYZ':\n          x = dest[2];\n          y = dest[3];\n          scale = dest[4];\n          // If x and/or y coordinates are not supplied, default to\n          // _top_ left of the page (not the obvious bottom left,\n          // since aligning the bottom of the intended page with the\n          // top of the window is rarely helpful).\n          x = x !== null ? x : 0;\n          y = y !== null ? y : pageHeight;\n          break;\n        case 'Fit':\n        case 'FitB':\n          scale = 'page-fit';\n          break;\n        case 'FitH':\n        case 'FitBH':\n          y = dest[2];\n          scale = 'page-width';\n          // According to the PDF spec, section 12.3.2.2, a `null` value in the\n          // parameter should maintain the position relative to the new page.\n          if (y === null && this._location) {\n            x = this._location.left;\n            y = this._location.top;\n          }\n          break;\n        case 'FitV':\n        case 'FitBV':\n          x = dest[2];\n          width = pageWidth;\n          height = pageHeight;\n          scale = 'page-height';\n          break;\n        case 'FitR':\n          x = dest[2];\n          y = dest[3];\n          width = dest[4] - x;\n          height = dest[5] - y;\n          var hPadding = this.removePageBorders ? 0 : SCROLLBAR_PADDING;\n          var vPadding = this.removePageBorders ? 0 : VERTICAL_PADDING;\n\n          widthScale = (this.container.clientWidth - hPadding) /\n            width / CSS_UNITS;\n          heightScale = (this.container.clientHeight - vPadding) /\n            height / CSS_UNITS;\n          scale = Math.min(Math.abs(widthScale), Math.abs(heightScale));\n          break;\n        default:\n          return;\n      }\n\n      if (scale && scale !== this._currentScale) {\n        this.currentScaleValue = scale;\n      } else if (this._currentScale === UNKNOWN_SCALE) {\n        this.currentScaleValue = DEFAULT_SCALE_VALUE;\n      }\n\n      if (scale === 'page-fit' && !dest[4]) {\n        scrollIntoView(pageView.div);\n        return;\n      }\n\n      var boundingRect = [\n        pageView.viewport.convertToViewportPoint(x, y),\n        pageView.viewport.convertToViewportPoint(x + width, y + height)\n      ];\n      var left = Math.min(boundingRect[0][0], boundingRect[1][0]);\n      var top = Math.min(boundingRect[0][1], boundingRect[1][1]);\n\n      scrollIntoView(pageView.div, { left: left, top: top });\n    },\n\n    _updateLocation: function (firstPage) {\n      var currentScale = this._currentScale;\n      var currentScaleValue = this._currentScaleValue;\n      var normalizedScaleValue =\n        parseFloat(currentScaleValue) === currentScale ?\n        Math.round(currentScale * 10000) / 100 : currentScaleValue;\n\n      var pageNumber = firstPage.id;\n      var pdfOpenParams = '#page=' + pageNumber;\n      pdfOpenParams += '&zoom=' + normalizedScaleValue;\n      var currentPageView = this._pages[pageNumber - 1];\n      var container = this.container;\n      var topLeft = currentPageView.getPagePoint(\n        (container.scrollLeft - firstPage.x),\n        (container.scrollTop - firstPage.y));\n      var intLeft = Math.round(topLeft[0]);\n      var intTop = Math.round(topLeft[1]);\n      pdfOpenParams += ',' + intLeft + ',' + intTop;\n\n      this._location = {\n        pageNumber: pageNumber,\n        scale: normalizedScaleValue,\n        top: intTop,\n        left: intLeft,\n        pdfOpenParams: pdfOpenParams\n      };\n    },\n\n    update: function PDFViewer_update() {\n      var visible = this._getVisiblePages();\n      var visiblePages = visible.views;\n      if (visiblePages.length === 0) {\n        return;\n      }\n\n      this.updateInProgress = true;\n\n      var suggestedCacheSize = Math.max(DEFAULT_CACHE_SIZE,\n          2 * visiblePages.length + 1);\n      this._buffer.resize(suggestedCacheSize);\n\n      this.renderingQueue.renderHighestPriority(visible);\n\n      var currentId = this._currentPageNumber;\n      var firstPage = visible.first;\n\n      for (var i = 0, ii = visiblePages.length, stillFullyVisible = false;\n           i < ii; ++i) {\n        var page = visiblePages[i];\n\n        if (page.percent < 100) {\n          break;\n        }\n        if (page.id === currentId) {\n          stillFullyVisible = true;\n          break;\n        }\n      }\n\n      if (!stillFullyVisible) {\n        currentId = visiblePages[0].id;\n      }\n\n      if (!this.isInPresentationMode) {\n        this.currentPageNumber = currentId;\n      }\n\n      this._updateLocation(firstPage);\n\n      this.updateInProgress = false;\n\n      var event = document.createEvent('UIEvents');\n      event.initUIEvent('updateviewarea', true, true, window, 0);\n      event.location = this._location;\n      this.container.dispatchEvent(event);\n    },\n\n    containsElement: function (element) {\n      return this.container.contains(element);\n    },\n\n    focus: function () {\n      this.container.focus();\n    },\n\n    get isInPresentationMode() {\n      return this.presentationModeState === PresentationModeState.FULLSCREEN;\n    },\n\n    get isChangingPresentationMode() {\n      return this.presentationModeState === PresentationModeState.CHANGING;\n    },\n\n    get isHorizontalScrollbarEnabled() {\n      return (this.isInPresentationMode ?\n        false : (this.container.scrollWidth > this.container.clientWidth));\n    },\n\n    _getVisiblePages: function () {\n      if (!this.isInPresentationMode) {\n        return getVisibleElements(this.container, this._pages, true);\n      } else {\n        // The algorithm in getVisibleElements doesn't work in all browsers and\n        // configurations when presentation mode is active.\n        var visible = [];\n        var currentPage = this._pages[this._currentPageNumber - 1];\n        visible.push({ id: currentPage.id, view: currentPage });\n        return { first: currentPage, last: currentPage, views: visible };\n      }\n    },\n\n    cleanup: function () {\n      for (var i = 0, ii = this._pages.length; i < ii; i++) {\n        if (this._pages[i] &&\n            this._pages[i].renderingState !== RenderingStates.FINISHED) {\n          this._pages[i].reset();\n        }\n      }\n    },\n\n    /**\n     * @param {PDFPageView} pageView\n     * @returns {PDFPage}\n     * @private\n     */\n    _ensurePdfPageLoaded: function (pageView) {\n      if (pageView.pdfPage) {\n        return Promise.resolve(pageView.pdfPage);\n      }\n      var pageNumber = pageView.id;\n      if (this._pagesRequests[pageNumber]) {\n        return this._pagesRequests[pageNumber];\n      }\n      var promise = this.pdfDocument.getPage(pageNumber).then(\n          function (pdfPage) {\n        pageView.setPdfPage(pdfPage);\n        this._pagesRequests[pageNumber] = null;\n        return pdfPage;\n      }.bind(this));\n      this._pagesRequests[pageNumber] = promise;\n      return promise;\n    },\n\n    forceRendering: function (currentlyVisiblePages) {\n      var visiblePages = currentlyVisiblePages || this._getVisiblePages();\n      var pageView = this.renderingQueue.getHighestPriority(visiblePages,\n                                                            this._pages,\n                                                            this.scroll.down);\n      if (pageView) {\n        this._ensurePdfPageLoaded(pageView).then(function () {\n          this.renderingQueue.renderView(pageView);\n        }.bind(this));\n        return true;\n      }\n      return false;\n    },\n\n    getPageTextContent: function (pageIndex) {\n      return this.pdfDocument.getPage(pageIndex + 1).then(function (page) {\n        return page.getTextContent({ normalizeWhitespace: true });\n      });\n    },\n\n    /**\n     * @param {HTMLDivElement} textLayerDiv\n     * @param {number} pageIndex\n     * @param {PageViewport} viewport\n     * @returns {TextLayerBuilder}\n     */\n    createTextLayerBuilder: function (textLayerDiv, pageIndex, viewport) {\n      return new TextLayerBuilder({\n        textLayerDiv: textLayerDiv,\n        pageIndex: pageIndex,\n        viewport: viewport,\n        findController: this.isInPresentationMode ? null : this.findController\n      });\n    },\n\n    /**\n     * @param {HTMLDivElement} pageDiv\n     * @param {PDFPage} pdfPage\n     * @returns {AnnotationLayerBuilder}\n     */\n    createAnnotationLayerBuilder: function (pageDiv, pdfPage) {\n      return new AnnotationLayerBuilder({\n        pageDiv: pageDiv,\n        pdfPage: pdfPage,\n        linkService: this.linkService\n      });\n    },\n\n    setFindController: function (findController) {\n      this.findController = findController;\n    },\n  };\n\n  return PDFViewer;\n})();\n\nvar SimpleLinkService = (function SimpleLinkServiceClosure() {\n  function SimpleLinkService() {}\n\n  SimpleLinkService.prototype = {\n    /**\n     * @returns {number}\n     */\n    get page() {\n      return 0;\n    },\n    /**\n     * @param {number} value\n     */\n    set page(value) {},\n    /**\n     * @param dest - The PDF destination object.\n     */\n    navigateTo: function (dest) {},\n    /**\n     * @param dest - The PDF destination object.\n     * @returns {string} The hyperlink to the PDF object.\n     */\n    getDestinationHash: function (dest) {\n      return '#';\n    },\n    /**\n     * @param hash - The PDF parameters/hash.\n     * @returns {string} The hyperlink to the PDF object.\n     */\n    getAnchorUrl: function (hash) {\n      return '#';\n    },\n    /**\n     * @param {string} hash\n     */\n    setHash: function (hash) {},\n    /**\n     * @param {string} action\n     */\n    executeNamedAction: function (action) {},\n    /**\n     * @param {number} pageNum - page number.\n     * @param {Object} pageRef - reference to the page.\n     */\n    cachePageRef: function (pageNum, pageRef) {}\n  };\n  return SimpleLinkService;\n})();\n\n\nvar PDFHistory = (function () {\n  function PDFHistory(options) {\n    this.linkService = options.linkService;\n\n    this.initialized = false;\n    this.initialDestination = null;\n    this.initialBookmark = null;\n  }\n\n  PDFHistory.prototype = {\n    /**\n     * @param {string} fingerprint\n     * @param {IPDFLinkService} linkService\n     */\n    initialize: function pdfHistoryInitialize(fingerprint) {\n      this.initialized = true;\n      this.reInitialized = false;\n      this.allowHashChange = true;\n      this.historyUnlocked = true;\n      this.isViewerInPresentationMode = false;\n\n      this.previousHash = window.location.hash.substring(1);\n      this.currentBookmark = '';\n      this.currentPage = 0;\n      this.updatePreviousBookmark = false;\n      this.previousBookmark = '';\n      this.previousPage = 0;\n      this.nextHashParam = '';\n\n      this.fingerprint = fingerprint;\n      this.currentUid = this.uid = 0;\n      this.current = {};\n\n      var state = window.history.state;\n      if (this._isStateObjectDefined(state)) {\n        // This corresponds to navigating back to the document\n        // from another page in the browser history.\n        if (state.target.dest) {\n          this.initialDestination = state.target.dest;\n        } else {\n          this.initialBookmark = state.target.hash;\n        }\n        this.currentUid = state.uid;\n        this.uid = state.uid + 1;\n        this.current = state.target;\n      } else {\n        // This corresponds to the loading of a new document.\n        if (state && state.fingerprint &&\n          this.fingerprint !== state.fingerprint) {\n          // Reinitialize the browsing history when a new document\n          // is opened in the web viewer.\n          this.reInitialized = true;\n        }\n        this._pushOrReplaceState({fingerprint: this.fingerprint}, true);\n      }\n\n      var self = this;\n      window.addEventListener('popstate', function pdfHistoryPopstate(evt) {\n        if (!self.historyUnlocked) {\n          return;\n        }\n        if (evt.state) {\n          // Move back/forward in the history.\n          self._goTo(evt.state);\n          return;\n        }\n\n        // If the state is not set, then the user tried to navigate to a\n        // different hash by manually editing the URL and pressing Enter, or by\n        // clicking on an in-page link (e.g. the \"current view\" link).\n        // Save the current view state to the browser history.\n\n        // Note: In Firefox, history.null could also be null after an in-page\n        // navigation to the same URL, and without dispatching the popstate\n        // event: https://bugzilla.mozilla.org/show_bug.cgi?id=1183881\n\n        if (self.uid === 0) {\n          // Replace the previous state if it was not explicitly set.\n          var previousParams = (self.previousHash && self.currentBookmark &&\n            self.previousHash !== self.currentBookmark) ?\n            {hash: self.currentBookmark, page: self.currentPage} :\n            {page: 1};\n          replacePreviousHistoryState(previousParams, function() {\n            updateHistoryWithCurrentHash();\n          });\n        } else {\n          updateHistoryWithCurrentHash();\n        }\n      }, false);\n\n\n      function updateHistoryWithCurrentHash() {\n        self.previousHash = window.location.hash.slice(1);\n        self._pushToHistory({hash: self.previousHash}, false, true);\n        self._updatePreviousBookmark();\n      }\n\n      function replacePreviousHistoryState(params, callback) {\n        // To modify the previous history entry, the following happens:\n        // 1. history.back()\n        // 2. _pushToHistory, which calls history.replaceState( ... )\n        // 3. history.forward()\n        // Because a navigation via the history API does not immediately update\n        // the history state, the popstate event is used for synchronization.\n        self.historyUnlocked = false;\n\n        // Suppress the hashchange event to avoid side effects caused by\n        // navigating back and forward.\n        self.allowHashChange = false;\n        window.addEventListener('popstate', rewriteHistoryAfterBack);\n        history.back();\n\n        function rewriteHistoryAfterBack() {\n          window.removeEventListener('popstate', rewriteHistoryAfterBack);\n          window.addEventListener('popstate', rewriteHistoryAfterForward);\n          self._pushToHistory(params, false, true);\n          history.forward();\n        }\n        function rewriteHistoryAfterForward() {\n          window.removeEventListener('popstate', rewriteHistoryAfterForward);\n          self.allowHashChange = true;\n          self.historyUnlocked = true;\n          callback();\n        }\n      }\n\n      function pdfHistoryBeforeUnload() {\n        var previousParams = self._getPreviousParams(null, true);\n        if (previousParams) {\n          var replacePrevious = (!self.current.dest &&\n          self.current.hash !== self.previousHash);\n          self._pushToHistory(previousParams, false, replacePrevious);\n          self._updatePreviousBookmark();\n        }\n        // Remove the event listener when navigating away from the document,\n        // since 'beforeunload' prevents Firefox from caching the document.\n        window.removeEventListener('beforeunload', pdfHistoryBeforeUnload,\n                                   false);\n      }\n\n      window.addEventListener('beforeunload', pdfHistoryBeforeUnload, false);\n\n      window.addEventListener('pageshow', function pdfHistoryPageShow(evt) {\n        // If the entire viewer (including the PDF file) is cached in\n        // the browser, we need to reattach the 'beforeunload' event listener\n        // since the 'DOMContentLoaded' event is not fired on 'pageshow'.\n        window.addEventListener('beforeunload', pdfHistoryBeforeUnload, false);\n      }, false);\n\n      window.addEventListener('presentationmodechanged', function(e) {\n        self.isViewerInPresentationMode = !!e.detail.active;\n      });\n    },\n\n    clearHistoryState: function pdfHistory_clearHistoryState() {\n      this._pushOrReplaceState(null, true);\n    },\n\n    _isStateObjectDefined: function pdfHistory_isStateObjectDefined(state) {\n      return (state && state.uid >= 0 &&\n      state.fingerprint && this.fingerprint === state.fingerprint &&\n      state.target && state.target.hash) ? true : false;\n    },\n\n    _pushOrReplaceState: function pdfHistory_pushOrReplaceState(stateObj,\n                                                                replace) {\n      if (replace) {\n      window.history.replaceState(stateObj, '');\n      } else {\n      window.history.pushState(stateObj, '');\n      }\n    },\n\n    get isHashChangeUnlocked() {\n      if (!this.initialized) {\n        return true;\n      }\n      return this.allowHashChange;\n    },\n\n    _updatePreviousBookmark: function pdfHistory_updatePreviousBookmark() {\n      if (this.updatePreviousBookmark &&\n        this.currentBookmark && this.currentPage) {\n        this.previousBookmark = this.currentBookmark;\n        this.previousPage = this.currentPage;\n        this.updatePreviousBookmark = false;\n      }\n    },\n\n    updateCurrentBookmark: function pdfHistoryUpdateCurrentBookmark(bookmark,\n                                                                    pageNum) {\n      if (this.initialized) {\n        this.currentBookmark = bookmark.substring(1);\n        this.currentPage = pageNum | 0;\n        this._updatePreviousBookmark();\n      }\n    },\n\n    updateNextHashParam: function pdfHistoryUpdateNextHashParam(param) {\n      if (this.initialized) {\n        this.nextHashParam = param;\n      }\n    },\n\n    push: function pdfHistoryPush(params, isInitialBookmark) {\n      if (!(this.initialized && this.historyUnlocked)) {\n        return;\n      }\n      if (params.dest && !params.hash) {\n        params.hash = (this.current.hash && this.current.dest &&\n        this.current.dest === params.dest) ?\n          this.current.hash :\n          this.linkService.getDestinationHash(params.dest).split('#')[1];\n      }\n      if (params.page) {\n        params.page |= 0;\n      }\n      if (isInitialBookmark) {\n        var target = window.history.state.target;\n        if (!target) {\n          // Invoked when the user specifies an initial bookmark,\n          // thus setting initialBookmark, when the document is loaded.\n          this._pushToHistory(params, false);\n          this.previousHash = window.location.hash.substring(1);\n        }\n        this.updatePreviousBookmark = this.nextHashParam ? false : true;\n        if (target) {\n          // If the current document is reloaded,\n          // avoid creating duplicate entries in the history.\n          this._updatePreviousBookmark();\n        }\n        return;\n      }\n      if (this.nextHashParam) {\n        if (this.nextHashParam === params.hash) {\n          this.nextHashParam = null;\n          this.updatePreviousBookmark = true;\n          return;\n        } else {\n          this.nextHashParam = null;\n        }\n      }\n\n      if (params.hash) {\n        if (this.current.hash) {\n          if (this.current.hash !== params.hash) {\n            this._pushToHistory(params, true);\n          } else {\n            if (!this.current.page && params.page) {\n              this._pushToHistory(params, false, true);\n            }\n            this.updatePreviousBookmark = true;\n          }\n        } else {\n          this._pushToHistory(params, true);\n        }\n      } else if (this.current.page && params.page &&\n        this.current.page !== params.page) {\n        this._pushToHistory(params, true);\n      }\n    },\n\n    _getPreviousParams: function pdfHistory_getPreviousParams(onlyCheckPage,\n                                                              beforeUnload) {\n      if (!(this.currentBookmark && this.currentPage)) {\n        return null;\n      } else if (this.updatePreviousBookmark) {\n        this.updatePreviousBookmark = false;\n      }\n      if (this.uid > 0 && !(this.previousBookmark && this.previousPage)) {\n        // Prevent the history from getting stuck in the current state,\n        // effectively preventing the user from going back/forward in\n        // the history.\n        //\n        // This happens if the current position in the document didn't change\n        // when the history was previously updated. The reasons for this are\n        // either:\n        // 1. The current zoom value is such that the document does not need to,\n        //    or cannot, be scrolled to display the destination.\n        // 2. The previous destination is broken, and doesn't actally point to a\n        //    position within the document.\n        //    (This is either due to a bad PDF generator, or the user making a\n        //     mistake when entering a destination in the hash parameters.)\n        return null;\n      }\n      if ((!this.current.dest && !onlyCheckPage) || beforeUnload) {\n        if (this.previousBookmark === this.currentBookmark) {\n          return null;\n        }\n      } else if (this.current.page || onlyCheckPage) {\n        if (this.previousPage === this.currentPage) {\n          return null;\n        }\n      } else {\n        return null;\n      }\n      var params = {hash: this.currentBookmark, page: this.currentPage};\n      if (this.isViewerInPresentationMode) {\n        params.hash = null;\n      }\n      return params;\n    },\n\n    _stateObj: function pdfHistory_stateObj(params) {\n      return {fingerprint: this.fingerprint, uid: this.uid, target: params};\n    },\n\n    _pushToHistory: function pdfHistory_pushToHistory(params,\n                                                      addPrevious, overwrite) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!params.hash && params.page) {\n        params.hash = ('page=' + params.page);\n      }\n      if (addPrevious && !overwrite) {\n        var previousParams = this._getPreviousParams();\n        if (previousParams) {\n          var replacePrevious = (!this.current.dest &&\n          this.current.hash !== this.previousHash);\n          this._pushToHistory(previousParams, false, replacePrevious);\n        }\n      }\n      this._pushOrReplaceState(this._stateObj(params),\n        (overwrite || this.uid === 0));\n      this.currentUid = this.uid++;\n      this.current = params;\n      this.updatePreviousBookmark = true;\n    },\n\n    _goTo: function pdfHistory_goTo(state) {\n      if (!(this.initialized && this.historyUnlocked &&\n        this._isStateObjectDefined(state))) {\n        return;\n      }\n      if (!this.reInitialized && state.uid < this.currentUid) {\n        var previousParams = this._getPreviousParams(true);\n        if (previousParams) {\n          this._pushToHistory(this.current, false);\n          this._pushToHistory(previousParams, false);\n          this.currentUid = state.uid;\n          window.history.back();\n          return;\n        }\n      }\n      this.historyUnlocked = false;\n\n      if (state.target.dest) {\n        this.linkService.navigateTo(state.target.dest);\n      } else {\n        this.linkService.setHash(state.target.hash);\n      }\n      this.currentUid = state.uid;\n      if (state.uid > this.uid) {\n        this.uid = state.uid;\n      }\n      this.current = state.target;\n      this.updatePreviousBookmark = true;\n\n      var currentHash = window.location.hash.substring(1);\n      if (this.previousHash !== currentHash) {\n        this.allowHashChange = false;\n      }\n      this.previousHash = currentHash;\n\n      this.historyUnlocked = true;\n    },\n\n    back: function pdfHistoryBack() {\n      this.go(-1);\n    },\n\n    forward: function pdfHistoryForward() {\n      this.go(1);\n    },\n\n    go: function pdfHistoryGo(direction) {\n      if (this.initialized && this.historyUnlocked) {\n        var state = window.history.state;\n        if (direction === -1 && state && state.uid > 0) {\n          window.history.back();\n        } else if (direction === 1 && state && state.uid < (this.uid - 1)) {\n          window.history.forward();\n        }\n      }\n    }\n  };\n\n  return PDFHistory;\n})();\n\n\n  PDFJS.PDFViewer = PDFViewer;\n  PDFJS.PDFPageView = PDFPageView;\n  PDFJS.PDFLinkService = PDFLinkService;\n  PDFJS.TextLayerBuilder = TextLayerBuilder;\n  PDFJS.DefaultTextLayerFactory = DefaultTextLayerFactory;\n  PDFJS.AnnotationLayerBuilder = AnnotationLayerBuilder;\n  PDFJS.DefaultAnnotationLayerFactory = DefaultAnnotationLayerFactory;\n  PDFJS.PDFHistory = PDFHistory;\n\n  PDFJS.getFileName = getFileName;\n  PDFJS.ProgressBar = ProgressBar;\n}).call((typeof window === 'undefined') ? this : window);\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./shared/pdf_viewer.js\n **/"],"sourceRoot":""}